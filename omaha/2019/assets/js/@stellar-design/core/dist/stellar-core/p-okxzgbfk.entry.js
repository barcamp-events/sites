import{r as t,g as i,h as e,c as s,d as n,H as r,e as a}from"./p-8388b2f5.js";import"./p-20de5b5b.js";import{T as h}from"./p-3ddd0228.js";import{m as o}from"./p-7021fe2a.js";import{i as u}from"./p-9be3ef6c.js";import{A as c}from"./p-e6db9c02.js";import{d as l}from"./p-7a6a8a00.js";import{c as f,a as d}from"./p-c428ff15.js";import{a as m,c as b}from"./p-5d42c00f.js";import"./p-c93f133f.js";import"./p-22e0cac7.js";import"./p-3a3a4911.js";import{r as w}from"./p-171d2cab.js";const p=class{constructor(i){t(this,i),this.context={},this.renderer=()=>null}connectedCallback(){null!=this.subscribe&&(this.unsubscribe=this.subscribe(this.el,"context"))}disconnectedCallback(){null!=this.unsubscribe&&this.unsubscribe()}render(){return this.renderer(Object.assign({},this.context))}get el(){return i(this)}},v=class{constructor(i){t(this,i),this.name="person",this.language="ios-",this.block=!1}componentWillLoad(){this.ariaLabel=this.name.replace("ios-","").replace("md-","").replace(/\-/g," ")}render(){return e("div",{class:"icon-wrap"},e("stellar-icon",{src:this.src,name:this.name,ariaLabel:this.ariaLabel,"aria-label":this.ariaLabel}))}static get style(){return":host,:host *,:host :after,:host :before{-webkit-box-sizing:border-box;box-sizing:border-box}:host{display:block;-webkit-transform-origin:.5em .5em;transform-origin:.5em .5em}:host .icon-wrap{display:-ms-flexbox;display:flex}"}},g=class{constructor(i){t(this,i),this.tag="link",this.label="Submit",this.name="",this.value="",this.href="#",this.target="_self",this.icon=!1,this.active=!1,this.disabled=!1,this.danger=!1,this.pill=!1,this.block=!1,this.outline=!1,this.invert=!1,this.contrast=!1,this.dark=!1,this.processable=!1,this.processing=!1,this.ghost=!1}componentWillLoad(){this.icon=this.element.querySelectorAll("stellar-asset").length>0}async click(){if(this.processable&&(this.processing=!0),this.for){const t=this.for.split(":");"modal"===t[0]&&document.querySelector(`stellar-modal[name="${t[1]}"]`).open()}return"submit"===this.tag&&this.element.closest("stellar-form").submit_form(),"link"===this.tag&&(window.location.href=this.href),!0}renderSVG(){return e("stellar-asset",{src:"Loading",color:"white"})}renderButton(){return e("button",{type:"button",class:"button",title:this.label,disabled:this.disabled,onClick:()=>{this.click()}},e("div",{class:"content"},e("slot",null,"Submit")),this.processing&&e("div",{class:"processing"},this.renderSVG()))}renderSubmit(){return e("button",{type:"submit",class:"button",title:this.label,disabled:this.disabled,name:this.name,value:this.value,onClick:()=>{this.click()}},e("div",{class:"content"},e("slot",null,"Submit")),this.processing&&e("div",{class:"processing"},this.renderSVG()))}renderLink(){return e("a",{href:this.href,target:this.target,class:"button","data-disabled":this.disabled,title:this.label,onClick:()=>{this.click()}},e("div",{class:"content"},e("slot",null,"Submit")),this.processing&&e("div",{class:"processing"},this.renderSVG()))}renderAppLink(){return e("stencil-route-link",{url:this.href,anchorClass:"button","data-disabled":this.disabled,title:this.label,onClick:()=>{this.click()}},e("div",{class:"content"},e("slot",null,"Submit")),this.processing&&e("div",{class:"processing"},this.renderSVG()))}renderSpan(){return e("span",{class:"button",title:this.label,"data-disabled":this.disabled,"aria-label":`Button ${this.label} ${this.element.textContent}`,tabIndex:0,onClick:()=>{this.click()}},e("div",{class:"content"},e("slot",null,"Submit")),this.processing&&e("div",{class:"processing"},this.renderSVG()))}render(){return["button"===this.tag&&this.renderButton(),"submit"===this.tag&&this.renderSubmit(),"link"===this.tag&&this.renderLink(),"route-link"===this.tag&&this.renderAppLink(),"span"===this.tag&&this.renderSpan()]}get element(){return i(this)}static get style(){return":host,:host *,:host :after,:host :before{-webkit-box-sizing:border-box;box-sizing:border-box}:host{-moz-appearance:none!important;appearance:none!important;-webkit-appearance:none!important;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;display:var(--wrap-display,inline-block);font-family:var(--font-heading);text-align:center;vertical-align:baseline;-ms-flex-item-align:center;align-self:center;--width:auto;--height:auto;--padding-vertical:var(--ms0);--padding-horizontal:var(--ms2);--padding:var(--padding-vertical) var(--padding-horizontal);--background:var(--theme-base5);--color:var(--white);--active-background:var(--theme-base7);--active-color:var(--white);--active-border:none;--border:none;--border-radius:0;--font-size:var(--ms0);--text-decoration:none}:host([outline]){--background:transparent;--border:2px solid currentColor;--active-background:var(--theme-base0);--active-border:2px solid currentColor}:host([ghost]),:host([outline]){--color:var(--theme-base5);--active-color:var(--theme-base7)}:host([ghost]){--padding-vertical:0;--padding-horizontal:0;--background:none;--border:none;--active-background:none;--active-border:none}:host([outline][invert]){--background:transparent;--border:2px solid currentColor;--active-background:var(--theme-base0);--active-border:2px solid currentColor}:host([ghost][invert]){--background:none;--active-background:none}:host([ghost][invert]),:host([invert]){--color:var(--theme-base2);--border:none;--active-color:var(--theme-base5);--active-border:none}:host([invert]){--background:var(--white);--active-background:var(--theme-base0)}:host([contrast]){--background:var(--theme-base7);--color:var(--white);--border:none;--active-background:var(--theme-base9);--active-color:var(--theme-base0);--active-border:none}:host([pill]){--border-radius:1000px}:host([size=tiny]){--font-size:var(--ms-2)}:host([size=small]){--font-size:var(--ms-1)}:host([size=medium]){--font-size:var(--ms1)}:host([size=large]){--font-size:var(--ms2)}:host([padding=tiny]){--padding-vertical:var(--ms-2);--padding-horizontal:var(--ms0)}:host([padding=small]){--padding-vertical:var(--ms-1);--padding-horizontal:var(--ms1)}:host([padding=medium]){--padding-vertical:var(--ms1);--padding-horizontal:var(--ms3)}:host([padding=large]){--padding-vertical:var(--ms2);--padding-horizontal:var(--ms4)}:host(:active){-webkit-transform:scale(.925);transform:scale(.925)}:host(.h-auto){--height:100%;--padding-vertical:0}:host .button{cursor:pointer;display:-ms-inline-flexbox;display:inline-flex;position:relative;-ms-flex-align:center;align-items:center;outline:0;border:var(--border);background:var(--background);padding:var(--padding);width:var(--width);height:var(--height);vertical-align:bottom;-webkit-text-decoration:var(--text-decoration);text-decoration:var(--text-decoration);line-height:1;letter-spacing:var(--letter-spacing,.0275em);white-space:nowrap;color:var(--color);font-family:inherit;font-size:var(--font-size);font-weight:600;border-radius:var(--border-radius,0)}:host a.button,:host span.button{width:auto}:host .button:focus,:host .button:hover{border:var(--active-border);background-color:var(--active-background);color:var(--active-color)}:host .button .content{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center}:host([block]),:host([block]) .button{display:block;width:100%}:host ::slotted(*){line-height:1!important;font-family:inherit}:host([icon]) .button .content{display:inline-grid;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;grid-template-columns:auto auto;grid-gap:.1em}:host ::slotted(img),:host ::slotted(stellar-asset){display:inline-block;float:none;width:1em;height:1em;font-size:1.75em;margin:calc(var(--padding-vertical) * -.5) 0 calc(var(--padding-vertical) * -.5) calc(var(--padding-vertical) * -.5)}:host([ghost]) ::slotted(img),:host([ghost]) ::slotted(stellar-asset){font-size:1.65em}:host ::slotted(img[align=left]),:host ::slotted(stellar-asset[align=left]){-ms-flex-order:-1;order:-1;margin-right:var(--ms-7)}:host ::slotted(img[align=right]),:host ::slotted(stellar-asset[align=right]){-ms-flex-order:2;order:2;margin-left:var(--ms-7)}:host([dark]){--background:var(--theme-base7);--active-color:var(--white);--active-border:none}:host([dark]),:host([dark][outline]){--color:var(--white);--active-background:var(--theme-base9)}:host([dark][outline]){--background:transparent;--border:2px solid var(--theme-base5);--active-color:var(--theme-base0);--active-border:2px solid var(--theme-base9)}:host([dark][ghost]){--padding:0.05em 0 0.125em;--background:none;--color:var(--theme-base5);--border:none;--active-background:none;--active-color:var(--theme-base7);--active-border:none}"}};let y;h.injectProps(g,["dark"]);const E=(t,i,e,s,n)=>(e="ios"===(e&&e.toLowerCase())?"ios":"md",s&&"ios"===e?t=s.toLowerCase():n&&"md"===e?t=n.toLowerCase():(t||!i||T(i)||(t=i),_(t)&&(t=t.toLowerCase(),/^md-|^ios-|^logo-/.test(t)||(t=e+"-"+t))),_(t)&&""!==t.trim()?""!==t.replace(/[a-z]|-|\d/gi,"")?null:t:null),M=t=>_(t)&&(t=t.trim(),T(t))?t:null,T=t=>t.length>0&&/(\/|\.)/.test(t),_=t=>"string"==typeof t,k=t=>{if(1===t.nodeType){if("script"===t.nodeName.toLowerCase())return!1;for(let i=0;i<t.attributes.length;i++){const e=t.attributes[i].value;if(_(e)&&0===e.toLowerCase().indexOf("on"))return!1}for(let i=0;i<t.childNodes.length;i++)if(!k(t.childNodes[i]))return!1}return!0},A=new Map,R=class{constructor(i){t(this,i),this.mode=I(this),this.isVisible=!1,this.lazy=!1}connectedCallback(){this.waitUntilVisible(this.el,"50px",()=>{this.isVisible=!0,this.loadIcon()})}disconnectedCallback(){this.io&&(this.io.disconnect(),this.io=void 0)}waitUntilVisible(t,i,e){if(this.lazy&&"undefined"!=typeof window&&window.IntersectionObserver){const s=this.io=new window.IntersectionObserver(t=>{t[0].isIntersecting&&(s.disconnect(),this.io=void 0,e())},{rootMargin:i});s.observe(t)}else e()}loadIcon(){if(this.isVisible){const t=(t=>{let i=M(t.src);if(i)return i;if(i=E(t.name,t.icon,t.mode,t.ios,t.md))return(t=>{return(()=>{if(!y){const t=window;t.Ionicons=t.Ionicons||{},y=t.Ionicons.map=t.Ionicons.map||new Map}return y})().get(t)||s(`svg/${t}.svg`)})(i);if(t.icon){if(i=M(t.icon))return i;if(i=M(t.icon[t.mode]))return i}return null})(this);t&&(t=>{let i=A.get(t);return i||(i=fetch(t).then(t=>t.status<=299?t.text():Promise.resolve(null)).then(t=>(t=>{if(t){const i=document.createElement("div");i.innerHTML=t;for(let t=i.childNodes.length-1;t>=0;t--)"svg"!==i.childNodes[t].nodeName.toLowerCase()&&i.removeChild(i.childNodes[t]);const e=i.firstElementChild;if(e&&"svg"===e.nodeName.toLowerCase()&&(e.setAttribute("class","s-ion-icon"),k(e)))return i.innerHTML}return""})(t)),A.set(t,i)),i})(t).then(t=>this.svgContent=t)}if(!this.ariaLabel){const t=E(this.name,this.icon,this.mode,this.ios,this.md);t&&(this.ariaLabel=t.replace("ios-","").replace("md-","").replace(/\-/g," "))}}render(){const t=this.mode||"ios",i=this.flipRtl||this.ariaLabel&&this.ariaLabel.indexOf("arrow")>-1&&!1!==this.flipRtl;return e(r,{role:"img",class:{[t]:!0,[`icon-${this.size}`]:!!this.size,"flip-rtl":!!i&&"rtl"===this.el.ownerDocument.dir}},e("div",this.svgContent?{class:"icon-inner",innerHTML:this.svgContent}:{class:"icon-inner"}))}static get assetsDirs(){return["svg"]}get el(){return i(this)}static get watchers(){return{name:["loadIcon"],src:["loadIcon"],icon:["loadIcon"]}}static get style(){return"stellar-icon{display:inline-block;width:1em;height:1em;contain:strict;fill:currentColor;-webkit-box-sizing:content-box!important;box-sizing:content-box!important}stellar-icon .icon-inner,stellar-icon svg{display:block;height:100%;width:100%}stellar-asset.flip-rtl .icon-inner{-webkit-transform:scaleX(-1);transform:scaleX(-1)}"}},I=t=>n(t)||document.documentElement.getAttribute("mode")||"ios",C=class{constructor(i){t(this,i),this.unsubscribe=()=>{},this.activeClass="link-active",this.exact=!1,this.strict=!0,this.custom="a",this.match=null}componentWillLoad(){this.computeMatch()}computeMatch(){this.location&&(this.match=o(this.location.pathname,{path:this.urlMatch||this.url,exact:this.exact,strict:this.strict}))}handleClick(t){if(!u(t)&&this.history&&this.url&&this.root)return t.preventDefault(),this.history.push(((t,i)=>"/"==t.charAt(0)&&"/"==i.charAt(i.length-1)?i.slice(0,i.length-1)+t:i+t)(this.url,this.root))}render(){let t={class:{[this.activeClass]:null!==this.match},onClick:this.handleClick.bind(this)};return this.anchorClass&&(t.class[this.anchorClass]=!0),"a"===this.custom&&(t=Object.assign({},t,{href:this.url,title:this.anchorTitle,role:this.anchorRole,tabindex:this.anchorTabIndex,"aria-haspopup":this.ariaHaspopup,id:this.anchorId,"aria-posinset":this.ariaPosinset,"aria-setsize":this.ariaSetsize,"aria-label":this.ariaLabel})),e(this.custom,Object.assign({},t),e("slot",null))}get el(){return i(this)}static get watchers(){return{location:["computeMatch"]}}};c.injectProps(C,["history","location","root"]);class ${constructor(t,i,e){this.loadBuffer=function(t,i){var e=new XMLHttpRequest;e.open("GET",t,!0),e.responseType="arraybuffer";var s=this;e.onload=function(){s.context.decodeAudioData(e.response,(function(e){e?(s.bufferList[i]=e,++s.loadCount==s.urlList.length&&s.onload(s.bufferList)):alert("error decoding file data: "+t)}),(function(t){console.error("decodeAudioData error",t)}))},e.onerror=function(){alert("BufferLoader: XHR error")},e.send()},this.load=function(){for(var t=0;t<this.urlList.length;++t)this.loadBuffer(this.urlList[t],t)},this.context=t,this.urlList=i,this.onload=e,this.bufferList=new Array,this.loadCount=0}}var N=f((function(t){!function(i){function e(){if(e.prototype._singleton)throw new Error("WebMidi is a singleton, it cannot be instantiated directly.");(e.prototype._singleton=this)._inputs=[],this._outputs=[],this._userHandlers={},this._stateChangeQueue=[],this._processingStateChange=!1,this._midiInterfaceEvents=["connected","disconnected"],this._nrpnBuffer=[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]],this._nrpnEventsEnabled=!0,this._nrpnTypes=["entry","increment","decrement"],this._notes=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],this._semitones={C:0,D:2,E:4,F:5,G:7,A:9,B:11},Object.defineProperties(this,{MIDI_SYSTEM_MESSAGES:{value:{sysex:240,timecode:241,songposition:242,songselect:243,tuningrequest:246,sysexend:247,clock:248,start:250,continue:251,stop:252,activesensing:254,reset:255,midimessage:0,unknownsystemmessage:-1},writable:!1,enumerable:!0,configurable:!1},MIDI_CHANNEL_MESSAGES:{value:{noteoff:8,noteon:9,keyaftertouch:10,controlchange:11,channelmode:11,nrpn:11,programchange:12,channelaftertouch:13,pitchbend:14},writable:!1,enumerable:!0,configurable:!1},MIDI_REGISTERED_PARAMETER:{value:{pitchbendrange:[0,0],channelfinetuning:[0,1],channelcoarsetuning:[0,2],tuningprogram:[0,3],tuningbank:[0,4],modulationrange:[0,5],azimuthangle:[61,0],elevationangle:[61,1],gain:[61,2],distanceratio:[61,3],maximumdistance:[61,4],maximumdistancegain:[61,5],referencedistanceratio:[61,6],panspreadangle:[61,7],rollangle:[61,8]},writable:!1,enumerable:!0,configurable:!1},MIDI_CONTROL_CHANGE_MESSAGES:{value:{bankselectcoarse:0,modulationwheelcoarse:1,breathcontrollercoarse:2,footcontrollercoarse:4,portamentotimecoarse:5,dataentrycoarse:6,volumecoarse:7,balancecoarse:8,pancoarse:10,expressioncoarse:11,effectcontrol1coarse:12,effectcontrol2coarse:13,generalpurposeslider1:16,generalpurposeslider2:17,generalpurposeslider3:18,generalpurposeslider4:19,bankselectfine:32,modulationwheelfine:33,breathcontrollerfine:34,footcontrollerfine:36,portamentotimefine:37,dataentryfine:38,volumefine:39,balancefine:40,panfine:42,expressionfine:43,effectcontrol1fine:44,effectcontrol2fine:45,holdpedal:64,portamento:65,sustenutopedal:66,softpedal:67,legatopedal:68,hold2pedal:69,soundvariation:70,resonance:71,soundreleasetime:72,soundattacktime:73,brightness:74,soundcontrol6:75,soundcontrol7:76,soundcontrol8:77,soundcontrol9:78,soundcontrol10:79,generalpurposebutton1:80,generalpurposebutton2:81,generalpurposebutton3:82,generalpurposebutton4:83,reverblevel:91,tremololevel:92,choruslevel:93,celestelevel:94,phaserlevel:95,databuttonincrement:96,databuttondecrement:97,nonregisteredparametercoarse:98,nonregisteredparameterfine:99,registeredparametercoarse:100,registeredparameterfine:101},writable:!1,enumerable:!0,configurable:!1},MIDI_NRPN_MESSAGES:{value:{entrymsb:6,entrylsb:38,increment:96,decrement:97,paramlsb:98,parammsb:99,nullactiveparameter:127},writable:!1,enumerable:!0,configurable:!1},MIDI_CHANNEL_MODE_MESSAGES:{value:{allsoundoff:120,resetallcontrollers:121,localcontrol:122,allnotesoff:123,omnimodeoff:124,omnimodeon:125,monomodeon:126,polymodeon:127},writable:!1,enumerable:!0,configurable:!1},octaveOffset:{value:0,writable:!0,enumerable:!0,configurable:!1}}),Object.defineProperties(this,{supported:{enumerable:!0,get:function(){return"requestMIDIAccess"in navigator}},enabled:{enumerable:!0,get:function(){return void 0!==this.interface}.bind(this)},inputs:{enumerable:!0,get:function(){return this._inputs}.bind(this)},outputs:{enumerable:!0,get:function(){return this._outputs}.bind(this)},sysexEnabled:{enumerable:!0,get:function(){return!(!this.interface||!this.interface.sysexEnabled)}.bind(this)},nrpnEventsEnabled:{enumerable:!0,get:function(){return!!this._nrpnEventsEnabled}.bind(this),set:function(t){return this._nrpnEventsEnabled=t,this._nrpnEventsEnabled}},nrpnTypes:{enumerable:!0,get:function(){return this._nrpnTypes}.bind(this)},time:{enumerable:!0,get:function(){return performance.now()}}})}var s=new e;function n(t){var i=this;this._userHandlers={channel:{},system:{}},this._midiInput=t,Object.defineProperties(this,{connection:{enumerable:!0,get:function(){return i._midiInput.connection}},id:{enumerable:!0,get:function(){return i._midiInput.id}},manufacturer:{enumerable:!0,get:function(){return i._midiInput.manufacturer}},name:{enumerable:!0,get:function(){return i._midiInput.name}},state:{enumerable:!0,get:function(){return i._midiInput.state}},type:{enumerable:!0,get:function(){return i._midiInput.type}}}),this._initializeUserHandlers(),this._midiInput.onmidimessage=this._onMidiMessage.bind(this)}function r(t){var i=this;this._midiOutput=t,Object.defineProperties(this,{connection:{enumerable:!0,get:function(){return i._midiOutput.connection}},id:{enumerable:!0,get:function(){return i._midiOutput.id}},manufacturer:{enumerable:!0,get:function(){return i._midiOutput.manufacturer}},name:{enumerable:!0,get:function(){return i._midiOutput.name}},state:{enumerable:!0,get:function(){return i._midiOutput.state}},type:{enumerable:!0,get:function(){return i._midiOutput.type}}})}e.prototype.enable=function(t,i){this.enabled||(this.supported?navigator.requestMIDIAccess({sysex:i}).then(function(i){var e,s=[],n=[];this.interface=i,this._resetInterfaceUserHandlers(),this.interface.onstatechange=function(t){s.push(t)};for(var r=i.inputs.values(),a=r.next();a&&!a.done;a=r.next())n.push(a.value.open());for(var h=i.outputs.values(),o=h.next();o&&!o.done;o=h.next())n.push(o.value.open());function u(){clearTimeout(e),this._updateInputsAndOutputs(),this.interface.onstatechange=this._onInterfaceStateChange.bind(this),"function"==typeof t&&t.call(this),s.forEach(function(t){this._onInterfaceStateChange(t)}.bind(this))}e=setTimeout(u.bind(this),200),Promise&&Promise.all(n).catch((function(){})).then(u.bind(this))}.bind(this),function(i){"function"==typeof t&&t.call(this,i)}.bind(this)):"function"==typeof t&&t(new Error("The Web MIDI API is not supported by your browser.")))},e.prototype.disable=function(){if(!this.supported)throw new Error("The Web MIDI API is not supported by your browser.");this.interface&&(this.interface.onstatechange=void 0),this.interface=void 0,this._inputs=[],this._outputs=[],this._nrpnEventsEnabled=!0,this._resetInterfaceUserHandlers()},e.prototype.addListener=function(t,i){if(!this.enabled)throw new Error("WebMidi must be enabled before adding event listeners.");if("function"!=typeof i)throw new TypeError("The 'listener' parameter must be a function.");if(!(0<=this._midiInterfaceEvents.indexOf(t)))throw new TypeError("The specified event type is not supported.");return this._userHandlers[t].push(i),this},e.prototype.hasListener=function(t,i){if(!this.enabled)throw new Error("WebMidi must be enabled before checking event listeners.");if("function"!=typeof i)throw new TypeError("The 'listener' parameter must be a function.");if(!(0<=this._midiInterfaceEvents.indexOf(t)))throw new TypeError("The specified event type is not supported.");for(var e=0;e<this._userHandlers[t].length;e++)if(this._userHandlers[t][e]===i)return!0;return!1},e.prototype.removeListener=function(t,i){if(!this.enabled)throw new Error("WebMidi must be enabled before removing event listeners.");if(void 0!==i&&"function"!=typeof i)throw new TypeError("The 'listener' parameter must be a function.");if(0<=this._midiInterfaceEvents.indexOf(t))if(i)for(var e=0;e<this._userHandlers[t].length;e++)this._userHandlers[t][e]===i&&this._userHandlers[t].splice(e,1);else this._userHandlers[t]=[];else{if(void 0!==t)throw new TypeError("The specified event type is not supported.");this._resetInterfaceUserHandlers()}return this},e.prototype.toMIDIChannels=function(t){var i;if("all"===t||void 0===t)i=["all"];else{if("none"===t)return[];i=Array.isArray(t)?t:[t]}return-1<i.indexOf("all")&&(i=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]),i.map((function(t){return parseInt(t)})).filter((function(t){return 1<=t&&t<=16}))},e.prototype.getInputById=function(t){if(!this.enabled)throw new Error("WebMidi is not enabled.");t=String(t);for(var i=0;i<this.inputs.length;i++)if(this.inputs[i].id===t)return this.inputs[i];return!1},e.prototype.getOutputById=function(t){if(!this.enabled)throw new Error("WebMidi is not enabled.");t=String(t);for(var i=0;i<this.outputs.length;i++)if(this.outputs[i].id===t)return this.outputs[i];return!1},e.prototype.getInputByName=function(t){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var i=0;i<this.inputs.length;i++)if(~this.inputs[i].name.indexOf(t))return this.inputs[i];return!1},e.prototype.getOctave=function(t){if(null!=t&&0<=t&&t<=127)return Math.floor(Math.floor(t)/12-1)+Math.floor(s.octaveOffset)},e.prototype.getOutputByName=function(t){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var i=0;i<this.outputs.length;i++)if(~this.outputs[i].name.indexOf(t))return this.outputs[i];return!1},e.prototype.guessNoteNumber=function(t){var i=!1;if(t&&t.toFixed&&0<=t&&t<=127?i=Math.round(t):0<=parseInt(t)&&parseInt(t)<=127?i=parseInt(t):("string"==typeof t||t instanceof String)&&(i=this.noteNameToNumber(t)),!1===i)throw new Error("Invalid input value ("+t+").");return i},e.prototype.noteNameToNumber=function(t){"string"!=typeof t&&(t="");var i=t.match(/([CDEFGAB])(#{0,2}|b{0,2})(-?\d+)/i);if(!i)throw new RangeError("Invalid note name.");var e=s._semitones[i[1].toUpperCase()],n=12*(parseInt(i[3])+1-Math.floor(s.octaveOffset))+e;if(-1<i[2].toLowerCase().indexOf("b")?n-=i[2].length:-1<i[2].toLowerCase().indexOf("#")&&(n+=i[2].length),n<0||127<n)throw new RangeError("Invalid note name or note outside valid range.");return n},e.prototype._updateInputsAndOutputs=function(){this._updateInputs(),this._updateOutputs()},e.prototype._updateInputs=function(){for(var t=0;t<this._inputs.length;t++){for(var i=!0,e=this.interface.inputs.values(),s=e.next();s&&!s.done;s=e.next())if(this._inputs[t]._midiInput===s.value){i=!1;break}i&&this._inputs.splice(t,1)}this.interface&&this.interface.inputs.forEach(function(t){for(var i=!0,e=0;e<this._inputs.length;e++)this._inputs[e]._midiInput===t&&(i=!1);i&&this._inputs.push(new n(t))}.bind(this))},e.prototype._updateOutputs=function(){for(var t=0;t<this._outputs.length;t++){for(var i=!0,e=this.interface.outputs.values(),s=e.next();s&&!s.done;s=e.next())if(this._outputs[t]._midiOutput===s.value){i=!1;break}i&&this._outputs.splice(t,1)}this.interface&&this.interface.outputs.forEach(function(t){for(var i=!0,e=0;e<this._outputs.length;e++)this._outputs[e]._midiOutput===t&&(i=!1);i&&this._outputs.push(new r(t))}.bind(this))},e.prototype._onInterfaceStateChange=function(t){this._updateInputsAndOutputs();var i={timestamp:t.timeStamp,type:t.port.state};this.interface&&"connected"===t.port.state?"output"===t.port.type?i.port=this.getOutputById(t.port.id):"input"===t.port.type&&(i.port=this.getInputById(t.port.id)):i.port={connection:"closed",id:t.port.id,manufacturer:t.port.manufacturer,name:t.port.name,state:t.port.state,type:t.port.type},this._userHandlers[t.port.state].forEach((function(t){t(i)}))},e.prototype._resetInterfaceUserHandlers=function(){for(var t=0;t<this._midiInterfaceEvents.length;t++)this._userHandlers[this._midiInterfaceEvents[t]]=[]},n.prototype.on=n.prototype.addListener=function(t,i,e){var n=this;if(void 0===i&&(i="all"),Array.isArray(i)||(i=[i]),i.forEach((function(t){if("all"!==t&&!(1<=t&&t<=16))throw new RangeError("The 'channel' parameter is invalid.")})),"function"!=typeof e)throw new TypeError("The 'listener' parameter must be a function.");if(void 0!==s.MIDI_SYSTEM_MESSAGES[t])this._userHandlers.system[t]||(this._userHandlers.system[t]=[]),this._userHandlers.system[t].push(e);else{if(void 0===s.MIDI_CHANNEL_MESSAGES[t])throw new TypeError("The specified event type is not supported.");if(-1<i.indexOf("all")){i=[];for(var r=1;r<=16;r++)i.push(r)}this._userHandlers.channel[t]||(this._userHandlers.channel[t]=[]),i.forEach((function(i){n._userHandlers.channel[t][i]||(n._userHandlers.channel[t][i]=[]),n._userHandlers.channel[t][i].push(e)}))}return this},n.prototype.hasListener=function(t,i,e){var n=this;if("function"!=typeof e)throw new TypeError("The 'listener' parameter must be a function.");if(void 0===i&&(i="all"),i.constructor!==Array&&(i=[i]),void 0!==s.MIDI_SYSTEM_MESSAGES[t]){for(var r=0;r<this._userHandlers.system[t].length;r++)if(this._userHandlers.system[t][r]===e)return!0}else if(void 0!==s.MIDI_CHANNEL_MESSAGES[t]){if(-1<i.indexOf("all")){i=[];for(var a=1;a<=16;a++)i.push(a)}return!!this._userHandlers.channel[t]&&i.every((function(i){var s=n._userHandlers.channel[t][i];return s&&-1<s.indexOf(e)}))}return!1},n.prototype.removeListener=function(t,i,e){var n=this;if(void 0!==e&&"function"!=typeof e)throw new TypeError("The 'listener' parameter must be a function.");if(void 0===i&&(i="all"),i.constructor!==Array&&(i=[i]),void 0!==s.MIDI_SYSTEM_MESSAGES[t])if(void 0===e)this._userHandlers.system[t]=[];else for(var r=0;r<this._userHandlers.system[t].length;r++)this._userHandlers.system[t][r]===e&&this._userHandlers.system[t].splice(r,1);else if(void 0!==s.MIDI_CHANNEL_MESSAGES[t]){if(-1<i.indexOf("all")){i=[];for(var a=1;a<=16;a++)i.push(a)}if(!this._userHandlers.channel[t])return this;i.forEach((function(i){var s=n._userHandlers.channel[t][i];if(s)if(void 0===e)n._userHandlers.channel[t][i]=[];else for(var r=0;r<s.length;r++)s[r]===e&&s.splice(r,1)}))}else{if(void 0!==t)throw new TypeError("The specified event type is not supported.");this._initializeUserHandlers()}return this},n.prototype._initializeUserHandlers=function(){for(var t in s.MIDI_CHANNEL_MESSAGES)s.MIDI_CHANNEL_MESSAGES.hasOwnProperty(t)&&(this._userHandlers.channel[t]={});for(var i in s.MIDI_SYSTEM_MESSAGES)s.MIDI_SYSTEM_MESSAGES.hasOwnProperty(i)&&(this._userHandlers.system[i]=[])},n.prototype._onMidiMessage=function(t){if(0<this._userHandlers.system.midimessage.length){var i={target:this,data:t.data,timestamp:t.timeStamp,type:"midimessage"};this._userHandlers.system.midimessage.forEach((function(t){t(i)}))}t.data[0]<240?(this._parseChannelEvent(t),this._parseNrpnEvent(t)):t.data[0]<=255&&this._parseSystemEvent(t)},n.prototype._parseNrpnEvent=function(t){var i,e,n=15&t.data[0];if(1<t.data.length&&(i=t.data[1],e=2<t.data.length?t.data[2]:void 0),s.nrpnEventsEnabled&&t.data[0]>>4===s.MIDI_CHANNEL_MESSAGES.controlchange&&(i>=s.MIDI_NRPN_MESSAGES.increment&&i<=s.MIDI_NRPN_MESSAGES.parammsb||i===s.MIDI_NRPN_MESSAGES.entrymsb||i===s.MIDI_NRPN_MESSAGES.entrylsb)){var r={target:this,type:"controlchange",data:t.data,timestamp:t.timeStamp,channel:1+n,controller:{number:i,name:this.getCcNameByNumber(i)},value:e};if(r.controller.number===s.MIDI_NRPN_MESSAGES.parammsb&&r.value!=s.MIDI_NRPN_MESSAGES.nullactiveparameter)s._nrpnBuffer[n]=[],s._nrpnBuffer[n][0]=r;else if(1===s._nrpnBuffer[n].length&&r.controller.number===s.MIDI_NRPN_MESSAGES.paramlsb)s._nrpnBuffer[n].push(r);else if(2!==s._nrpnBuffer[n].length||r.controller.number!==s.MIDI_NRPN_MESSAGES.increment&&r.controller.number!==s.MIDI_NRPN_MESSAGES.decrement&&r.controller.number!==s.MIDI_NRPN_MESSAGES.entrymsb)if(3===s._nrpnBuffer[n].length&&s._nrpnBuffer[n][2].number===s.MIDI_NRPN_MESSAGES.entrymsb&&r.controller.number===s.MIDI_NRPN_MESSAGES.entrylsb)s._nrpnBuffer[n].push(r);else if(3<=s._nrpnBuffer[n].length&&s._nrpnBuffer[n].length<=4&&r.controller.number===s.MIDI_NRPN_MESSAGES.parammsb&&r.value===s.MIDI_NRPN_MESSAGES.nullactiveparameter)s._nrpnBuffer[n].push(r);else if(4<=s._nrpnBuffer[n].length&&s._nrpnBuffer[n].length<=5&&r.controller.number===s.MIDI_NRPN_MESSAGES.paramlsb&&r.value===s.MIDI_NRPN_MESSAGES.nullactiveparameter){s._nrpnBuffer[n].push(r);var a=[];s._nrpnBuffer[n].forEach((function(t){a.push(t.data)}));var h=s._nrpnBuffer[n][0].value<<7|s._nrpnBuffer[n][1].value,o=s._nrpnBuffer[n][2].value;6===s._nrpnBuffer[n].length&&(o=s._nrpnBuffer[n][2].value<<7|s._nrpnBuffer[n][3].value);var u="";switch(s._nrpnBuffer[n][2].controller.number){case s.MIDI_NRPN_MESSAGES.entrymsb:u=s._nrpnTypes[0];break;case s.MIDI_NRPN_MESSAGES.increment:u=s._nrpnTypes[1];break;case s.MIDI_NRPN_MESSAGES.decrement:u=s._nrpnTypes[2];break;default:throw new Error("The NPRN type was unidentifiable.")}var c={timestamp:r.timestamp,channel:r.channel,type:"nrpn",data:a,controller:{number:h,type:u,name:"Non-Registered Parameter "+h},value:o};s._nrpnBuffer[n]=[],this._userHandlers.channel[c.type]&&this._userHandlers.channel[c.type][c.channel]&&this._userHandlers.channel[c.type][c.channel].forEach((function(t){t(c)}))}else s._nrpnBuffer[n]=[];else s._nrpnBuffer[n].push(r)}},n.prototype._parseChannelEvent=function(t){var i,e,n=t.data[0]>>4,r=1+(15&t.data[0]);1<t.data.length&&(i=t.data[1],e=2<t.data.length?t.data[2]:void 0);var a={target:this,data:t.data,timestamp:t.timeStamp,channel:r};n===s.MIDI_CHANNEL_MESSAGES.noteoff||n===s.MIDI_CHANNEL_MESSAGES.noteon&&0===e?(a.type="noteoff",a.note={number:i,name:s._notes[i%12],octave:s.getOctave(i)},a.velocity=e/127,a.rawVelocity=e):n===s.MIDI_CHANNEL_MESSAGES.noteon?(a.type="noteon",a.note={number:i,name:s._notes[i%12],octave:s.getOctave(i)},a.velocity=e/127,a.rawVelocity=e):n===s.MIDI_CHANNEL_MESSAGES.keyaftertouch?(a.type="keyaftertouch",a.note={number:i,name:s._notes[i%12],octave:s.getOctave(i)},a.value=e/127):n===s.MIDI_CHANNEL_MESSAGES.controlchange&&0<=i&&i<=119?(a.type="controlchange",a.controller={number:i,name:this.getCcNameByNumber(i)},a.value=e):n===s.MIDI_CHANNEL_MESSAGES.channelmode&&120<=i&&i<=127?(a.type="channelmode",a.controller={number:i,name:this.getChannelModeByNumber(i)},a.value=e):n===s.MIDI_CHANNEL_MESSAGES.programchange?(a.type="programchange",a.value=i):n===s.MIDI_CHANNEL_MESSAGES.channelaftertouch?(a.type="channelaftertouch",a.value=i/127):n===s.MIDI_CHANNEL_MESSAGES.pitchbend?(a.type="pitchbend",a.value=((e<<7)+i-8192)/8192):a.type="unknownchannelmessage",this._userHandlers.channel[a.type]&&this._userHandlers.channel[a.type][r]&&this._userHandlers.channel[a.type][r].forEach((function(t){t(a)}))},n.prototype.getCcNameByNumber=function(t){if(!(0<=(t=Math.floor(t))&&t<=119))throw new RangeError("The control change number must be between 0 and 119.");for(var i in s.MIDI_CONTROL_CHANGE_MESSAGES)if(s.MIDI_CONTROL_CHANGE_MESSAGES.hasOwnProperty(i)&&t===s.MIDI_CONTROL_CHANGE_MESSAGES[i])return i},n.prototype.getChannelModeByNumber=function(t){if(!(120<=(t=Math.floor(t))&&status<=127))throw new RangeError("The control change number must be between 120 and 127.");for(var i in s.MIDI_CHANNEL_MODE_MESSAGES)if(s.MIDI_CHANNEL_MODE_MESSAGES.hasOwnProperty(i)&&t===s.MIDI_CHANNEL_MODE_MESSAGES[i])return i},n.prototype._parseSystemEvent=function(t){var i=t.data[0],e={target:this,data:t.data,timestamp:t.timeStamp};i===s.MIDI_SYSTEM_MESSAGES.sysex?e.type="sysex":i===s.MIDI_SYSTEM_MESSAGES.timecode?e.type="timecode":i===s.MIDI_SYSTEM_MESSAGES.songposition?e.type="songposition":i===s.MIDI_SYSTEM_MESSAGES.songselect?(e.type="songselect",e.song=t.data[1]):e.type=i===s.MIDI_SYSTEM_MESSAGES.tuningrequest?"tuningrequest":i===s.MIDI_SYSTEM_MESSAGES.clock?"clock":i===s.MIDI_SYSTEM_MESSAGES.start?"start":i===s.MIDI_SYSTEM_MESSAGES.continue?"continue":i===s.MIDI_SYSTEM_MESSAGES.stop?"stop":i===s.MIDI_SYSTEM_MESSAGES.activesensing?"activesensing":i===s.MIDI_SYSTEM_MESSAGES.reset?"reset":"unknownsystemmessage",this._userHandlers.system[e.type]&&this._userHandlers.system[e.type].forEach((function(t){t(e)}))},r.prototype.send=function(t,i,e){if(!(128<=t&&t<=255))throw new RangeError("The status byte must be an integer between 128 (0x80) and 255 (0xFF).");void 0===i&&(i=[]),Array.isArray(i)||(i=[i]);var s=[];return i.forEach((function(t){var i=Math.floor(t);if(!(0<=i&&i<=255))throw new RangeError("Data bytes must be integers between 0 (0x00) and 255 (0xFF).");s.push(i)})),this._midiOutput.send([t].concat(s),parseFloat(e)||0),this},r.prototype.sendSysex=function(t,i,e){if(!s.sysexEnabled)throw new Error("Sysex message support must first be activated.");return e=e||{},t=[].concat(t),i.forEach((function(t){if(t<0||127<t)throw new RangeError("The data bytes of a sysex message must be integers between 0 (0x00) and 127 (0x7F).")})),i=t.concat(i,s.MIDI_SYSTEM_MESSAGES.sysexend),this.send(s.MIDI_SYSTEM_MESSAGES.sysex,i,this._parseTimeParameter(e.time)),this},r.prototype.sendTimecodeQuarterFrame=function(t,i){return this.send(s.MIDI_SYSTEM_MESSAGES.timecode,t,this._parseTimeParameter((i=i||{}).time)),this},r.prototype.sendSongPosition=function(t,i){i=i||{};var e=(t=Math.floor(t)||0)>>7&127;return this.send(s.MIDI_SYSTEM_MESSAGES.songposition,[e,127&t],this._parseTimeParameter(i.time)),this},r.prototype.sendSongSelect=function(t,i){if(i=i||{},!(0<=(t=Math.floor(t))&&t<=127))throw new RangeError("The song number must be between 0 and 127.");return this.send(s.MIDI_SYSTEM_MESSAGES.songselect,[t],this._parseTimeParameter(i.time)),this},r.prototype.sendTuningRequest=function(t){return this.send(s.MIDI_SYSTEM_MESSAGES.tuningrequest,void 0,this._parseTimeParameter((t=t||{}).time)),this},r.prototype.sendClock=function(t){return this.send(s.MIDI_SYSTEM_MESSAGES.clock,void 0,this._parseTimeParameter((t=t||{}).time)),this},r.prototype.sendStart=function(t){return this.send(s.MIDI_SYSTEM_MESSAGES.start,void 0,this._parseTimeParameter((t=t||{}).time)),this},r.prototype.sendContinue=function(t){return this.send(s.MIDI_SYSTEM_MESSAGES.continue,void 0,this._parseTimeParameter((t=t||{}).time)),this},r.prototype.sendStop=function(t){return this.send(s.MIDI_SYSTEM_MESSAGES.stop,void 0,this._parseTimeParameter((t=t||{}).time)),this},r.prototype.sendActiveSensing=function(t){return this.send(s.MIDI_SYSTEM_MESSAGES.activesensing,[],this._parseTimeParameter((t=t||{}).time)),this},r.prototype.sendReset=function(t){return this.send(s.MIDI_SYSTEM_MESSAGES.reset,void 0,this._parseTimeParameter((t=t||{}).time)),this},r.prototype.stopNote=function(t,i,e){if("all"===t)return this.sendChannelMode("allnotesoff",0,i,e);var n=64;return(e=e||{}).rawVelocity?!isNaN(e.velocity)&&0<=e.velocity&&e.velocity<=127&&(n=e.velocity):!isNaN(e.velocity)&&0<=e.velocity&&e.velocity<=1&&(n=127*e.velocity),this._convertNoteToArray(t).forEach(function(t){s.toMIDIChannels(i).forEach(function(i){this.send(i-1+(s.MIDI_CHANNEL_MESSAGES.noteoff<<4),[t,Math.round(n)],this._parseTimeParameter(e.time))}.bind(this))}.bind(this)),this},r.prototype.playNote=function(t,i,e){var n,r=64;if((e=e||{}).rawVelocity?!isNaN(e.velocity)&&0<=e.velocity&&e.velocity<=127&&(r=e.velocity):!isNaN(e.velocity)&&0<=e.velocity&&e.velocity<=1&&(r=127*e.velocity),n=this._parseTimeParameter(e.time),this._convertNoteToArray(t).forEach(function(t){s.toMIDIChannels(i).forEach(function(i){this.send(i-1+(s.MIDI_CHANNEL_MESSAGES.noteon<<4),[t,Math.round(r)],n)}.bind(this))}.bind(this)),!isNaN(e.duration)){e.duration<=0&&(e.duration=0);var a=64;e.rawVelocity?!isNaN(e.release)&&0<=e.release&&e.release<=127&&(a=e.release):!isNaN(e.release)&&0<=e.release&&e.release<=1&&(a=127*e.release),this._convertNoteToArray(t).forEach(function(t){s.toMIDIChannels(i).forEach(function(i){this.send(i-1+(s.MIDI_CHANNEL_MESSAGES.noteoff<<4),[t,Math.round(a)],(n||s.time)+e.duration)}.bind(this))}.bind(this))}return this},r.prototype.sendKeyAftertouch=function(t,i,e,n){var r=this;if(n=n||{},i<1||16<i)throw new RangeError("The channel must be between 1 and 16.");(isNaN(e)||e<0||1<e)&&(e=.5);var a=Math.round(127*e);return this._convertNoteToArray(t).forEach((function(t){s.toMIDIChannels(i).forEach((function(i){r.send(i-1+(s.MIDI_CHANNEL_MESSAGES.keyaftertouch<<4),[t,a],r._parseTimeParameter(n.time))}))})),this},r.prototype.sendControlChange=function(t,i,e,n){if(n=n||{},"string"==typeof t){if(void 0===(t=s.MIDI_CONTROL_CHANGE_MESSAGES[t]))throw new TypeError("Invalid controller name.")}else if(!(0<=(t=Math.floor(t))&&t<=119))throw new RangeError("Controller numbers must be between 0 and 119.");if(!(0<=(i=Math.floor(i)||0)&&i<=127))throw new RangeError("Controller value must be between 0 and 127.");return s.toMIDIChannels(e).forEach(function(e){this.send(e-1+(s.MIDI_CHANNEL_MESSAGES.controlchange<<4),[t,i],this._parseTimeParameter(n.time))}.bind(this)),this},r.prototype._selectRegisteredParameter=function(t,i,e){var n=this;if(t[0]=Math.floor(t[0]),!(0<=t[0]&&t[0]<=127))throw new RangeError("The control65 value must be between 0 and 127");if(t[1]=Math.floor(t[1]),!(0<=t[1]&&t[1]<=127))throw new RangeError("The control64 value must be between 0 and 127");return s.toMIDIChannels(i).forEach((function(){n.sendControlChange(101,t[0],i,{time:e}),n.sendControlChange(100,t[1],i,{time:e})})),this},r.prototype._selectNonRegisteredParameter=function(t,i,e){var n=this;if(t[0]=Math.floor(t[0]),!(0<=t[0]&&t[0]<=127))throw new RangeError("The control63 value must be between 0 and 127");if(t[1]=Math.floor(t[1]),!(0<=t[1]&&t[1]<=127))throw new RangeError("The control62 value must be between 0 and 127");return s.toMIDIChannels(i).forEach((function(){n.sendControlChange(99,t[0],i,{time:e}),n.sendControlChange(98,t[1],i,{time:e})})),this},r.prototype._setCurrentRegisteredParameter=function(t,i,e){var n=this;if((t=[].concat(t))[0]=Math.floor(t[0]),!(0<=t[0]&&t[0]<=127))throw new RangeError("The msb value must be between 0 and 127");return s.toMIDIChannels(i).forEach((function(){n.sendControlChange(6,t[0],i,{time:e})})),t[1]=Math.floor(t[1]),0<=t[1]&&t[1]<=127&&s.toMIDIChannels(i).forEach((function(){n.sendControlChange(38,t[1],i,{time:e})})),this},r.prototype._deselectRegisteredParameter=function(t,i){var e=this;return s.toMIDIChannels(t).forEach((function(){e.sendControlChange(101,127,t,{time:i}),e.sendControlChange(100,127,t,{time:i})})),this},r.prototype.setRegisteredParameter=function(t,i,e,n){var r=this;if(n=n||{},!Array.isArray(t)){if(!s.MIDI_REGISTERED_PARAMETER[t])throw new Error("The specified parameter is not available.");t=s.MIDI_REGISTERED_PARAMETER[t]}return s.toMIDIChannels(e).forEach((function(){r._selectRegisteredParameter(t,e,n.time),r._setCurrentRegisteredParameter(i,e,n.time),r._deselectRegisteredParameter(e,n.time)})),this},r.prototype.setNonRegisteredParameter=function(t,i,e,n){var r=this;if(n=n||{},!(0<=t[0]&&t[0]<=127&&0<=t[1]&&t[1]<=127))throw new Error("Position 0 and 1 of the 2-position parameter array must both be between 0 and 127.");return i=[].concat(i),s.toMIDIChannels(e).forEach((function(){r._selectNonRegisteredParameter(t,e,n.time),r._setCurrentRegisteredParameter(i,e,n.time),r._deselectRegisteredParameter(e,n.time)})),this},r.prototype.incrementRegisteredParameter=function(t,i,e){var n=this;if(e=e||{},!Array.isArray(t)){if(!s.MIDI_REGISTERED_PARAMETER[t])throw new Error("The specified parameter is not available.");t=s.MIDI_REGISTERED_PARAMETER[t]}return s.toMIDIChannels(i).forEach((function(){n._selectRegisteredParameter(t,i,e.time),n.sendControlChange(96,0,i,{time:e.time}),n._deselectRegisteredParameter(i,e.time)})),this},r.prototype.decrementRegisteredParameter=function(t,i,e){if(e=e||{},!Array.isArray(t)){if(!s.MIDI_REGISTERED_PARAMETER[t])throw new TypeError("The specified parameter is not available.");t=s.MIDI_REGISTERED_PARAMETER[t]}return s.toMIDIChannels(i).forEach(function(){this._selectRegisteredParameter(t,i,e.time),this.sendControlChange(97,0,i,{time:e.time}),this._deselectRegisteredParameter(i,e.time)}.bind(this)),this},r.prototype.setPitchBendRange=function(t,i,e,n){var r=this;if(n=n||{},!(0<=(t=Math.floor(t)||0)&&t<=127))throw new RangeError("The semitones value must be between 0 and 127");if(!(0<=(i=Math.floor(i)||0)&&i<=127))throw new RangeError("The cents value must be between 0 and 127");return s.toMIDIChannels(e).forEach((function(){r.setRegisteredParameter("pitchbendrange",[t,i],e,{time:n.time})})),this},r.prototype.setModulationRange=function(t,i,e,n){var r=this;if(n=n||{},!(0<=(t=Math.floor(t)||0)&&t<=127))throw new RangeError("The semitones value must be between 0 and 127");if(!(0<=(i=Math.floor(i)||0)&&i<=127))throw new RangeError("The cents value must be between 0 and 127");return s.toMIDIChannels(e).forEach((function(){r.setRegisteredParameter("modulationrange",[t,i],e,{time:n.time})})),this},r.prototype.setMasterTuning=function(t,i,e){var n=this;if(e=e||{},(t=parseFloat(t)||0)<=-65||64<=t)throw new RangeError("The value must be a decimal number larger than -65 and smaller than 64.");var r=Math.floor(t)+64,a=t-Math.floor(t),h=(a=Math.round((a+1)/2*16383))>>7&127,o=127&a;return s.toMIDIChannels(i).forEach((function(){n.setRegisteredParameter("channelcoarsetuning",r,i,{time:e.time}),n.setRegisteredParameter("channelfinetuning",[h,o],i,{time:e.time})})),this},r.prototype.setTuningProgram=function(t,i,e){var n=this;if(e=e||{},!(0<=(t=Math.floor(t))&&t<=127))throw new RangeError("The program value must be between 0 and 127");return s.toMIDIChannels(i).forEach((function(){n.setRegisteredParameter("tuningprogram",t,i,{time:e.time})})),this},r.prototype.setTuningBank=function(t,i,e){var n=this;if(e=e||{},!(0<=(t=Math.floor(t)||0)&&t<=127))throw new RangeError("The bank value must be between 0 and 127");return s.toMIDIChannels(i).forEach((function(){n.setRegisteredParameter("tuningbank",t,i,{time:e.time})})),this},r.prototype.sendChannelMode=function(t,i,e,n){if(n=n||{},"string"==typeof t){if(!(t=s.MIDI_CHANNEL_MODE_MESSAGES[t]))throw new TypeError("Invalid channel mode message name.")}else if(!(120<=(t=Math.floor(t))&&t<=127))throw new RangeError("Channel mode numerical identifiers must be between 120 and 127.");if((i=Math.floor(i)||0)<0||127<i)throw new RangeError("Value must be an integer between 0 and 127.");return s.toMIDIChannels(e).forEach(function(e){this.send(e-1+(s.MIDI_CHANNEL_MESSAGES.channelmode<<4),[t,i],this._parseTimeParameter(n.time))}.bind(this)),this},r.prototype.sendProgramChange=function(t,i,e){var n=this;if(e=e||{},t=Math.floor(t),isNaN(t)||t<0||127<t)throw new RangeError("Program numbers must be between 0 and 127.");return s.toMIDIChannels(i).forEach((function(i){n.send(i-1+(s.MIDI_CHANNEL_MESSAGES.programchange<<4),[t],n._parseTimeParameter(e.time))})),this},r.prototype.sendChannelAftertouch=function(t,i,e){var n=this;e=e||{},t=parseFloat(t),(isNaN(t)||t<0||1<t)&&(t=.5);var r=Math.round(127*t);return s.toMIDIChannels(i).forEach((function(t){n.send(t-1+(s.MIDI_CHANNEL_MESSAGES.channelaftertouch<<4),[r],n._parseTimeParameter(e.time))})),this},r.prototype.sendPitchBend=function(t,i,e){var n=this;if(e=e||{},isNaN(t)||t<-1||1<t)throw new RangeError("Pitch bend value must be between -1 and 1.");var r=Math.round((t+1)/2*16383),a=r>>7&127,h=127&r;return s.toMIDIChannels(i).forEach((function(t){n.send(t-1+(s.MIDI_CHANNEL_MESSAGES.pitchbend<<4),[h,a],n._parseTimeParameter(e.time))})),this},r.prototype._parseTimeParameter=function(t){var i,e=parseFloat(t);return"string"==typeof t&&"+"===t.substring(0,1)?e&&0<e&&(i=s.time+e):e>s.time&&(i=e),i},r.prototype._convertNoteToArray=function(t){var i=[];return Array.isArray(t)||(t=[t]),t.forEach((function(t){i.push(s.guessNoteNumber(t))})),i},t.exports?t.exports=s:i.WebMidi||(i.WebMidi=s)}(d)}));const S=class{constructor(i){t(this,i),this.name="web_audio",this.prepared=!1,this.midi=!1,this.sources=[],this.keys={}}async source(t){return 0===this.sources.length&&await this.connect_the_world(),this.sources[t]}async get_context(){return this.context}async is_prepared(){return this.prepared}async stop(){return await m(this.sources,async t=>{await t.stop()})}componentDidLoad(){this.connect_debugger()}async connect_the_world(){return this.connect_context(),this.gain=this.context.createGain(),await this.connect_visualizers(),await this.connect_sources(),await this.connect_midi(),this.prepared=!0,await l(500),!0}connect_context(){this.context=new(window.AudioContext||window.webkitAudioContext),this.log("Connected to this.context")}async connect_sources(){await this.build_sources()}async build_sources(){this.log("Building sources"),this._sources=Array.from(this.element.querySelectorAll("web-audio-source")),this.externalFiles=[],await m(this._sources,async(t,i)=>{this.log(`(${i}) Preparing ${t.name}`),this.sources[t.name]=t;let e=new $(this.context,[t.src],async i=>{await this.cache_sources(i,t)});await e.load()})}async cache_sources(t,i){await m(t,async t=>{this.log(`Caching ${i.name}`),this.midi&&(this.log(`Assigned ${i.name} to midi key ${i.midikey}, channel ${i.midichannel}`),null==this.keys[i.midichannel]&&(this.keys[i.midichannel]=[]),this.keys[i.midichannel][i.midikey]=i),this._currentSource=i,await this._currentSource.assignBuffer(this,t),this.log(`Source ${i.name} is ready`)}),this._currentSource=null}async connect_visualizers(){await l(20),this.visualizers=Array.from(document.querySelectorAll(`web-audio-visualizer[for="${this.name}"]`)),this.visualizers?(this.log("Attaching visualizers"),await m(this.visualizers,async(t,i)=>{t=0===i?await t.connect(this.context,this.context.destination):await t.connect(this.context,this.previousVisualizer.analyser),this.previousVisualizer=t})):this.log(`No visualizers for ${this.name}`),this.visualizers.length>=1?await this.gain.connect(this.previousVisualizer.analyser):await this.gain.connect(this.context.destination)}connect_debugger(){this.debugger=document.querySelector(`web-audio-debugger[for="${this.name}"]`),this.log("Connected debugger")}log(t){this.debugger&&this.debugger.addHistory(t)}connect_midi(){this.midi&&N.enable(t=>{this.log(t?"Midi couldn't be enabled."+t:"Midi is enabled");var i=N.inputs[0];i&&(i.addListener("noteon","all",t=>{this.log(`KEY: Channel: ${t.channel}, Note: ${t.note.number}, Name: ${t.note.name}, Oct: ${t.note.octave}`),this.keys[t.channel]&&(this.keys[t.channel][t.note.number].gain().value=t.data[2]/175,this.keys[t.channel][t.note.number].play())}),i.addListener("pitchbend","all",t=>{this.log(`PITCH: Channel: ${t.channel}, Value: ${t.value}`)}),i.addListener("controlchange","all",t=>{this.log(`CTRL: Channel: ${t.channel}, controller: ${t.controller.number}, Value: ${t.value}`);var i=new CustomEvent("midi-controller-update",{detail:t});document.dispatchEvent(i)}),this.log("Listeners added for notes, pitch bend, and controllers."))})}get element(){return i(this)}},L=class{constructor(i){t(this,i),this.name="web_audio_sequencer",this.autoplay=!1,this.taps=4,this.context=async()=>await document.querySelector("web-audio").get_context(),this.noteTime=0,this.currentTap=0,this.totalPlayTime=0,this.custom=async()=>{}}componentDidLoad(){this.autoplay&&this.play()}async schedule(){var t=(await this.context()).currentTime;for(t-=this.startTime;this.noteTime<t+.005;)try{await this.custom(),this.totalPlayTime=this.noteTime+this.startTime,0===this.currentTap&&this.iterations++,this.advance()}catch(t){console.error(t)}this.timer=setTimeout(async()=>{await this.schedule()},0)}advance(){var t=60/this.tempo;this.currentTap++,this.currentTap==this.taps&&(this.currentTap=0),this.noteTime+=.25*t}async play(){await this.context()||await document.querySelector("web-audio").connect_the_world(),this.iterations=0,this.startTime=(await this.context()).currentTime+.005||.005,await this.schedule()}async stop(){this.iterations=0,this.totalPlayTime=0,this.startTime=null,this.currentTap=0,this.noteTime=0,clearTimeout(this.timer)}},D=class{constructor(i){t(this,i),this.inert=!1,this.midikey=0,this.midichannel=1,this.prepared=!1,this.status="paused",this.effectsvolume=100,this.effects=[],this.instances=[],this.duration=0,this.startTime=0,this.pausedTime=0,this.elapsedTime=0,this.playing=!1,this.update=a(this,"update",7)}async getBuffer(){return this.buffer}async webAudio(){return this.webAudioWrapper}async gain(t="wet"){return"wet"===t?this.wetGain:"dry"===t?this.dryGain:"channel"===t?this.channelGain:void 0}async getDuration(){return this.duration}currentTime(){let t=0;return this.pausedTime?t=this.pausedTime:this.startTime&&(t=this.context.currentTime-this.startTime),t>=this.duration&&(t=this.duration),t}async prepare(){!this.inert&&this.context&&(this.source=this.context.createBufferSource(),this.source.buffer=this.buffer,this.wetGain?(this.wetGain.gain.value=this.effectsvolume/100,this.dryGain.gain.value=Math.abs((this.effectsvolume-100)/100)):this.dryGain.gain.value=1,this.wetGain&&this.source.connect(this.wetGain),this.source.connect(this.dryGain),this.duration=this.source.buffer.duration,this.prepared=!0)}async play(){if(this.inert)throw"Cannot play inert media.";await this.prepare(),this.source&&(this.source.start(0,this.pausedTime),this.startTime=this.context.currentTime-this.pausedTime,this.pausedTime=0,this.playing=!0,this.tick(),w(()=>{this.tick()}))}async skipTo(t){await this.stop(),this.pausedTime=t/1e3,await this.play()}async pause(){this.elapsedTime=this.context.currentTime-this.startTime,await this.stop(),this.pausedTime=this.elapsedTime,this.playing=!1}async toggle(){this.playing?await this.pause():await this.play()}async stop(){this.source&&(await this.source.disconnect(),await this.source.stop()),this.source=null,this.pausedTime=0,this.startTime=0,this.playing=!1}tick(){this.update.emit({time:this.currentTime(),duration:this.duration}),this.source&&w(()=>{this.tick()})}async assignBuffer(t,i){if(this.webAudioWrapper=t.element,this.context=t.context,this.buffer=i,!this.inert){if(this.masterGain=t.gain,this.channelGain=this.context.createGain(),await this.prepareEffects(),Object.keys(this.effects).length>0){this.wetGain=this.context.createGain();let t="";Object.keys(this.effects).reverse().forEach((i,e)=>{0===e?this.wetGain.connect(this.effects[i]):this.effects[t].connect(this.effects[i]),t=i}),this.effects[t].connect(this.channelGain)}this.dryGain=this.context.createGain(),this.dryGain.connect(this.channelGain),this.channelGain.connect(this.masterGain)}}async prepareEffects(){if("WEB-AUDIO"!==this.element.parentElement.nodeName){let t=this.element.parentElement;for(;"WEB-AUDIO"!==t.nodeName;)this.effects[t.getAttribute("name")]=await t.attachEffect(this.context,this.element),t=t.parentElement}}get element(){return i(this)}},x=250,j=100,O=15;var P=f((function(t){(function(){t.exports=function(t,i,e){var s,n,r,a,h,o;if(t/=255,i/=255,e/=255,n=0,o=0,r=((a=Math.max(t,i,e))+(h=Math.min(t,i,e)))/2,a===h)n=o=0;else{switch(s=a-h,o=r>.5?s/(2-a-h):s/(a+h),a){case t:n=(i-e)/s+(i<e?6:0);break;case i:n=(e-t)/s+2;break;case e:n=(t-i)/s+4}n/=6}return[n=Math.ceil(360*n),o=Math.ceil(100*o)+"%",r=Math.ceil(100*r)+"%"]}}).call(d)})),F=function(t){var i=P.apply(P,function(t){t.charAt&&"#"===t.charAt(0)&&(t=function(t){var i=t.split("");return i.shift(),i.join("")}(t)),3===t.length&&(t=function(t){return t.split("").reduce((function(t,i){return t.concat([i,i])}),[]).join("")}(t));var i=parseInt(t,16);return[i>>16&255,i>>8&255,255&i]}(t));return[i[0],parseInt(i[1],10),parseInt(i[2],10)]};const W=class{constructor(i){t(this,i),this.for="web_audio",this.type="wave",this.smoothing=.7,this.size=1024,this.color="white",this.width=1024,this.height=1024,this.clearBackground=()=>{this.canvasCTX.clearRect(0,0,this.canvas.width,this.canvas.height),this.canvasCTX.fillStyle="transparent",this.canvasCTX.fillRect(0,0,this.canvas.width,this.canvas.height)}}componentWillLoad(){this.handleColorChange()}componentDidLoad(){this.canvas=this.element.shadowRoot.querySelector("canvas")}handleColorChange(){this._color=["white","black","black-alt"].includes(this.color)?F(b[this.color]):F(b[this.color][5])}async connect(t,i){return this.context=t,this.analyser=this.context.createAnalyser(),i&&this.analyser.connect(i),this.freqs=new Uint8Array(this.analyser.frequencyBinCount),this.times=new Uint8Array(this.analyser.frequencyBinCount),this.canvasCTX=this.canvas.getContext("2d"),requestAnimationFrame(this.draw.bind(this)),this}draw(){this.analyser.smoothingTimeConstant=this.smoothing,this.analyser.fftSize=this.size,this.analyser.getByteFrequencyData(this.freqs),this.analyser.getByteTimeDomainData(this.times),this.canvas.width=this.width,this.canvas.height=this.height,this.clearBackground(),"wave"===this.type?(t=>{for(var i=0;i<t.analyser.frequencyBinCount;i++){var e=t.height-t.height*(t.times[i]/512)*1.25,s=t.width/t.analyser.frequencyBinCount+16;t.canvasCTX.fillStyle=`hsl(${t._color[0]}, ${t._color[1]}%, ${t._color[2]}%)`,t.canvasCTX.fillRect(i*s,e,24,24)}})(this):"bars"===this.type?(t=>{for(var i=0;i<t.analyser.frequencyBinCount;i++){var e=t.freqs[i]/256,s=t.height*e*.75,n=t.height-s+25,r=t.width/t.analyser.frequencyBinCount+24;t.canvasCTX.fillStyle=`hsl(${t._color[0]}, ${t._color[1]}%, ${100*e}%)`,t.canvasCTX.fillRect(i*r,n,r,s)}})(this):"bars2"===this.type?(t=>{const i=t.freqs,e=t.canvas,s=t.canvasCTX;for(var n=i.length-50*~~(i.length/70),r=t.size,a=~~(n/70),h=e.width/70,o=4,u=e.height-8,c=0;c<n;c+=a){var l=i[c]/r*u,f=u/2-l/2;s.beginPath(),s.shadowColor="rgba(24, 24, 24, 0.25)",s.shadowBlur=8,s.shadowOffsetX=0,s.shadowOffsetY=2,s.strokeStyle=`hsl(${t._color[0]}, ${t._color[1]}%, ${t._color[2]}%)`,s.lineWidth=4,s.lineCap="round",s.moveTo(o,f),s.lineTo(o,f+l),s.stroke(),o+=h}})(this):"circle"===this.type&&(t=>{const i=t.analyser.frequencyBinCount,e=function(t){return t.reduce((t,i)=>t+i)/t.length}(t.freqs),s=e<O?O:e;let n=0,r=t.width/2,a=t.height/2,h=2*j*Math.PI/i;t.canvasCTX.beginPath(),t.canvasCTX.arc(r,a,j,0,2*Math.PI),t.canvasCTX.lineWidth=s,t.canvasCTX.strokeStyle=`hsl(${t._color[0]}, ${t._color[1]}%, ${t._color[2]}%)`,t.canvasCTX.closePath(),t.canvasCTX.stroke(),t.canvasCTX.save(),t.canvasCTX.translate(r,a);for(var o=0;o<t.analyser.frequencyBinCount;o++){const e=t.freqs[o],s=e>x?x:e;t.canvasCTX.rotate(n),t.canvasCTX.fillStyle=`hsl(${t._color[0]}, ${t._color[1]}%, ${t._color[2]}%)`,t.canvasCTX.fillRect(j+100,-1*h/2,s,h),n=n/(i+h)%360+1}})(this),requestAnimationFrame(this.draw.bind(this))}getFrequencyValue(t){var i=Math.round(t/(this.context.sampleRate/2)*this.freqs.length);return this.freqs[i]}render(){return e("canvas",{id:"canvas"})}get element(){return i(this)}static get watchers(){return{color:["handleColorChange"]}}static get style(){return":host,:host canvas{display:block}:host canvas{width:100%;height:100%}"}};export{p as context_consumer,v as stellar_asset,g as stellar_button,R as stellar_icon,C as stencil_route_link,S as web_audio,L as web_audio_sequencer,D as web_audio_source,W as web_audio_visualizer};