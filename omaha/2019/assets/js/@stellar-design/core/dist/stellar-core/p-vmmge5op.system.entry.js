var __awaiter=this&&this.__awaiter||function(e,t,n,r){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,s){function o(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r["throw"](e))}catch(e){s(e)}}function u(e){e.done?n(e.value):i(e.value).then(o,a)}u((r=r.apply(e,t||[])).next())}))};var __generator=this&&this.__generator||function(e,t){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol==="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(e){return function(t){return u([e,t])}}function u(o){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(s=o[0]&2?i["return"]:o[0]?i["throw"]||((s=i["return"])&&s.call(i),0):i.next)&&!(s=s.call(i,o[1])).done)return s;if(i=0,s)o=[o[0]&2,s.value];switch(o[0]){case 0:case 1:s=o;break;case 4:n.label++;return{value:o[1],done:false};case 5:n.label++;i=o[1];o=[0];continue;case 7:o=n.ops.pop();n.trys.pop();continue;default:if(!(s=n.trys,s=s.length>0&&s[s.length-1])&&(o[0]===6||o[0]===2)){n=0;continue}if(o[0]===3&&(!s||o[1]>s[0]&&o[1]<s[3])){n.label=o[1];break}if(o[0]===6&&n.label<s[1]){n.label=s[1];s=o;break}if(s&&n.label<s[2]){n.label=s[2];n.ops.push(o);break}if(s[2])n.ops.pop();n.trys.pop();continue}o=t.call(e,n)}catch(e){o=[6,e];i=0}finally{r=s=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:true}}};System.register(["./p-94e3dad1.system.js","./p-c4dffc26.system.js","./p-69f4f799.system.js","./p-8abcb78c.system.js","./p-149c0ab3.system.js","./p-9f50cf1d.system.js","./p-198a5417.system.js","./p-752b9e3e.system.js","./p-b588c5b1.system.js","./p-fdba8b89.system.js","./p-bd9c4de0.system.js","./p-49be6f75.system.js","./p-6e0469ab.system.js"],(function(e){"use strict";var t,n,r,i,s,o,a,u,c,h,l,f,d,p,m,_,v;return{setters:[function(e){t=e.r;n=e.g;r=e.h;i=e.c;s=e.d;o=e.H;a=e.e},function(){},function(e){u=e.T},function(e){c=e.m},function(e){h=e.i},function(e){l=e.A},function(e){f=e.d},function(e){d=e.c;p=e.a},function(e){m=e.a;_=e.c},function(){},function(){},function(){},function(e){v=e.r}],execute:function(){var b=e("context_consumer",function(){function e(e){t(this,e);this.context={};this.renderer=function(){return null}}e.prototype.connectedCallback=function(){if(this.subscribe!=null){this.unsubscribe=this.subscribe(this.el,"context")}};e.prototype.disconnectedCallback=function(){if(this.unsubscribe!=null){this.unsubscribe()}};e.prototype.render=function(){return this.renderer(Object.assign({},this.context))};Object.defineProperty(e.prototype,"el",{get:function(){return n(this)},enumerable:true,configurable:true});return e}());var g=e("stellar_asset",function(){function e(e){t(this,e);this.name="person";this.language="ios-";this.block=false}e.prototype.componentWillLoad=function(){this.ariaLabel=this.name.replace("ios-","").replace("md-","").replace(/\-/g," ")};e.prototype.render=function(){return r("div",{class:"icon-wrap"},r("stellar-icon",{src:this.src,name:this.name,ariaLabel:this.ariaLabel,"aria-label":this.ariaLabel}))};Object.defineProperty(e,"style",{get:function(){return":host,:host *,:host :after,:host :before{-webkit-box-sizing:border-box;box-sizing:border-box}:host{display:block;-webkit-transform-origin:.5em .5em;transform-origin:.5em .5em}:host .icon-wrap{display:-ms-flexbox;display:flex}"},enumerable:true,configurable:true});return e}());var y=e("stellar_button",function(){function e(e){t(this,e);this.tag="link";this.label="Submit";this.name="";this.value="";this.href="#";this.target="_self";this.icon=false;this.active=false;this.disabled=false;this.danger=false;this.pill=false;this.block=false;this.outline=false;this.invert=false;this.contrast=false;this.dark=false;this.processable=false;this.processing=false;this.ghost=false}e.prototype.componentWillLoad=function(){this.icon=this.element.querySelectorAll("stellar-asset").length>0};e.prototype.click=function(){return __awaiter(this,void 0,void 0,(function(){var e,t;return __generator(this,(function(n){if(this.processable){this.processing=true}if(this.for){e=this.for.split(":");if(e[0]==="modal"){t=document.querySelector('stellar-modal[name="'+e[1]+'"]');t.open()}}if(this.tag==="submit"){this.element.closest("stellar-form").submit_form()}if(this.tag==="link"){window.location.href=this.href}return[2,true]}))}))};e.prototype.renderSVG=function(){return r("stellar-asset",{src:"Loading",color:"white"})};e.prototype.renderButton=function(){var e=this;return r("button",{type:"button",class:"button",title:this.label,disabled:this.disabled,onClick:function(){e.click()}},r("div",{class:"content"},r("slot",null,"Submit")),this.processing&&r("div",{class:"processing"},this.renderSVG()))};e.prototype.renderSubmit=function(){var e=this;return r("button",{type:"submit",class:"button",title:this.label,disabled:this.disabled,name:this.name,value:this.value,onClick:function(){e.click()}},r("div",{class:"content"},r("slot",null,"Submit")),this.processing&&r("div",{class:"processing"},this.renderSVG()))};e.prototype.renderLink=function(){var e=this;return r("a",{href:this.href,target:this.target,class:"button","data-disabled":this.disabled,title:this.label,onClick:function(){e.click()}},r("div",{class:"content"},r("slot",null,"Submit")),this.processing&&r("div",{class:"processing"},this.renderSVG()))};e.prototype.renderAppLink=function(){var e=this;return r("stencil-route-link",{url:this.href,anchorClass:"button","data-disabled":this.disabled,title:this.label,onClick:function(){e.click()}},r("div",{class:"content"},r("slot",null,"Submit")),this.processing&&r("div",{class:"processing"},this.renderSVG()))};e.prototype.renderSpan=function(){var e=this;return r("span",{class:"button",title:this.label,"data-disabled":this.disabled,"aria-label":"Button "+this.label+" "+this.element.textContent,tabIndex:0,onClick:function(){e.click()}},r("div",{class:"content"},r("slot",null,"Submit")),this.processing&&r("div",{class:"processing"},this.renderSVG()))};e.prototype.render=function(){return[this.tag==="button"&&this.renderButton(),this.tag==="submit"&&this.renderSubmit(),this.tag==="link"&&this.renderLink(),this.tag==="route-link"&&this.renderAppLink(),this.tag==="span"&&this.renderSpan()]};Object.defineProperty(e.prototype,"element",{get:function(){return n(this)},enumerable:true,configurable:true});Object.defineProperty(e,"style",{get:function(){return":host,:host *,:host :after,:host :before{-webkit-box-sizing:border-box;box-sizing:border-box}:host{-moz-appearance:none!important;appearance:none!important;-webkit-appearance:none!important;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;display:var(--wrap-display,inline-block);font-family:var(--font-heading);text-align:center;vertical-align:baseline;-ms-flex-item-align:center;align-self:center;--width:auto;--height:auto;--padding-vertical:var(--ms0);--padding-horizontal:var(--ms2);--padding:var(--padding-vertical) var(--padding-horizontal);--background:var(--theme-base5);--color:var(--white);--active-background:var(--theme-base7);--active-color:var(--white);--active-border:none;--border:none;--border-radius:0;--font-size:var(--ms0);--text-decoration:none}:host([outline]){--background:transparent;--border:2px solid currentColor;--active-background:var(--theme-base0);--active-border:2px solid currentColor}:host([ghost]),:host([outline]){--color:var(--theme-base5);--active-color:var(--theme-base7)}:host([ghost]){--padding-vertical:0;--padding-horizontal:0;--background:none;--border:none;--active-background:none;--active-border:none}:host([outline][invert]){--background:transparent;--border:2px solid currentColor;--active-background:var(--theme-base0);--active-border:2px solid currentColor}:host([ghost][invert]){--background:none;--active-background:none}:host([ghost][invert]),:host([invert]){--color:var(--theme-base2);--border:none;--active-color:var(--theme-base5);--active-border:none}:host([invert]){--background:var(--white);--active-background:var(--theme-base0)}:host([contrast]){--background:var(--theme-base7);--color:var(--white);--border:none;--active-background:var(--theme-base9);--active-color:var(--theme-base0);--active-border:none}:host([pill]){--border-radius:1000px}:host([size=tiny]){--font-size:var(--ms-2)}:host([size=small]){--font-size:var(--ms-1)}:host([size=medium]){--font-size:var(--ms1)}:host([size=large]){--font-size:var(--ms2)}:host([padding=tiny]){--padding-vertical:var(--ms-2);--padding-horizontal:var(--ms0)}:host([padding=small]){--padding-vertical:var(--ms-1);--padding-horizontal:var(--ms1)}:host([padding=medium]){--padding-vertical:var(--ms1);--padding-horizontal:var(--ms3)}:host([padding=large]){--padding-vertical:var(--ms2);--padding-horizontal:var(--ms4)}:host(:active){-webkit-transform:scale(.925);transform:scale(.925)}:host(.h-auto){--height:100%;--padding-vertical:0}:host .button{cursor:pointer;display:-ms-inline-flexbox;display:inline-flex;position:relative;-ms-flex-align:center;align-items:center;outline:0;border:var(--border);background:var(--background);padding:var(--padding);width:var(--width);height:var(--height);vertical-align:bottom;-webkit-text-decoration:var(--text-decoration);text-decoration:var(--text-decoration);line-height:1;letter-spacing:var(--letter-spacing,.0275em);white-space:nowrap;color:var(--color);font-family:inherit;font-size:var(--font-size);font-weight:600;border-radius:var(--border-radius,0)}:host a.button,:host span.button{width:auto}:host .button:focus,:host .button:hover{border:var(--active-border);background-color:var(--active-background);color:var(--active-color)}:host .button .content{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center}:host([block]),:host([block]) .button{display:block;width:100%}:host ::slotted(*){line-height:1!important;font-family:inherit}:host([icon]) .button .content{display:inline-grid;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;grid-template-columns:auto auto;grid-gap:.1em}:host ::slotted(img),:host ::slotted(stellar-asset){display:inline-block;float:none;width:1em;height:1em;font-size:1.75em;margin:calc(var(--padding-vertical) * -.5) 0 calc(var(--padding-vertical) * -.5) calc(var(--padding-vertical) * -.5)}:host([ghost]) ::slotted(img),:host([ghost]) ::slotted(stellar-asset){font-size:1.65em}:host ::slotted(img[align=left]),:host ::slotted(stellar-asset[align=left]){-ms-flex-order:-1;order:-1;margin-right:var(--ms-7)}:host ::slotted(img[align=right]),:host ::slotted(stellar-asset[align=right]){-ms-flex-order:2;order:2;margin-left:var(--ms-7)}:host([dark]){--background:var(--theme-base7);--active-color:var(--white);--active-border:none}:host([dark]),:host([dark][outline]){--color:var(--white);--active-background:var(--theme-base9)}:host([dark][outline]){--background:transparent;--border:2px solid var(--theme-base5);--active-color:var(--theme-base0);--active-border:2px solid var(--theme-base9)}:host([dark][ghost]){--padding:0.05em 0 0.125em;--background:none;--color:var(--theme-base5);--border:none;--active-background:none;--active-color:var(--theme-base7);--active-border:none}"},enumerable:true,configurable:true});return e}());u.injectProps(y,["dark"]);var E;var S=function(){if(!E){var e=window;e.Ionicons=e.Ionicons||{};E=e.Ionicons.map=e.Ionicons.map||new Map}return E};var w=function(e){var t=T(e.src);if(t){return t}t=I(e.name,e.icon,e.mode,e.ios,e.md);if(t){return M(t)}if(e.icon){t=T(e.icon);if(t){return t}t=T(e.icon[e.mode]);if(t){return t}}return null};var M=function(e){var t=S().get(e);if(t){return t}return i("svg/"+e+".svg")};var I=function(e,t,n,r,i){n=(n&&n.toLowerCase())==="ios"?"ios":"md";if(r&&n==="ios"){e=r.toLowerCase()}else if(i&&n==="md"){e=i.toLowerCase()}else{if(!e&&t&&!C(t)){e=t}if(A(e)){e=e.toLowerCase();if(!/^md-|^ios-|^logo-/.test(e)){e=n+"-"+e}}}if(!A(e)||e.trim()===""){return null}var s=e.replace(/[a-z]|-|\d/gi,"");if(s!==""){return null}return e};var T=function(e){if(A(e)){e=e.trim();if(C(e)){return e}}return null};var C=function(e){return e.length>0&&/(\/|\.)/.test(e)};var A=function(e){return typeof e==="string"};var N=function(e){if(e){var t=document.createElement("div");t.innerHTML=e;for(var n=t.childNodes.length-1;n>=0;n--){if(t.childNodes[n].nodeName.toLowerCase()!=="svg"){t.removeChild(t.childNodes[n])}}var r=t.firstElementChild;if(r&&r.nodeName.toLowerCase()==="svg"){r.setAttribute("class","s-ion-icon");if(D(r)){return t.innerHTML}}}return""};var D=function(e){if(e.nodeType===1){if(e.nodeName.toLowerCase()==="script"){return false}for(var t=0;t<e.attributes.length;t++){var n=e.attributes[t].value;if(A(n)&&n.toLowerCase().indexOf("on")===0){return false}}for(var t=0;t<e.childNodes.length;t++){if(!D(e.childNodes[t])){return false}}}return true};var R=new Map;var G=function(e){var t=R.get(e);if(!t){t=fetch(e).then((function(e){if(e.status<=299){return e.text()}return Promise.resolve(null)})).then((function(e){return N(e)}));R.set(e,t)}return t};var P=e("stellar_icon",function(){function e(e){t(this,e);this.mode=x(this);this.isVisible=false;this.lazy=false}e.prototype.connectedCallback=function(){var e=this;this.waitUntilVisible(this.el,"50px",(function(){e.isVisible=true;e.loadIcon()}))};e.prototype.disconnectedCallback=function(){if(this.io){this.io.disconnect();this.io=undefined}};e.prototype.waitUntilVisible=function(e,t,n){var r=this;if(this.lazy&&typeof window!=="undefined"&&window.IntersectionObserver){var i=this.io=new window.IntersectionObserver((function(e){if(e[0].isIntersecting){i.disconnect();r.io=undefined;n()}}),{rootMargin:t});i.observe(e)}else{n()}};e.prototype.loadIcon=function(){var e=this;if(this.isVisible){var t=w(this);if(t){G(t).then((function(t){return e.svgContent=t}))}}if(!this.ariaLabel){var n=I(this.name,this.icon,this.mode,this.ios,this.md);if(n){this.ariaLabel=n.replace("ios-","").replace("md-","").replace(/\-/g," ")}}};e.prototype.render=function(){var e;var t=this.mode||"ios";var n=this.flipRtl||this.ariaLabel&&this.ariaLabel.indexOf("arrow")>-1&&this.flipRtl!==false;return r(o,{role:"img",class:(e={},e[t]=true,e["icon-"+this.size]=!!this.size,e["flip-rtl"]=!!n&&this.el.ownerDocument.dir==="rtl",e)},this.svgContent?r("div",{class:"icon-inner",innerHTML:this.svgContent}):r("div",{class:"icon-inner"}))};Object.defineProperty(e,"assetsDirs",{get:function(){return["svg"]},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"el",{get:function(){return n(this)},enumerable:true,configurable:true});Object.defineProperty(e,"watchers",{get:function(){return{name:["loadIcon"],src:["loadIcon"],icon:["loadIcon"]}},enumerable:true,configurable:true});Object.defineProperty(e,"style",{get:function(){return"stellar-icon{display:inline-block;width:1em;height:1em;contain:strict;fill:currentColor;-webkit-box-sizing:content-box!important;box-sizing:content-box!important}stellar-icon .icon-inner,stellar-icon svg{display:block;height:100%;width:100%}stellar-asset.flip-rtl .icon-inner{-webkit-transform:scaleX(-1);transform:scaleX(-1)}"},enumerable:true,configurable:true});return e}());var x=function(e){return s(e)||document.documentElement.getAttribute("mode")||"ios"};var L=function(e,t){if(e.charAt(0)=="/"&&t.charAt(t.length-1)=="/"){return t.slice(0,t.length-1)+e}return t+e};var H=e("stencil_route_link",function(){function e(e){t(this,e);this.unsubscribe=function(){return};this.activeClass="link-active";this.exact=false;this.strict=true;this.custom="a";this.match=null}e.prototype.componentWillLoad=function(){this.computeMatch()};e.prototype.computeMatch=function(){if(this.location){this.match=c(this.location.pathname,{path:this.urlMatch||this.url,exact:this.exact,strict:this.strict})}};e.prototype.handleClick=function(e){if(h(e)||!this.history||!this.url||!this.root){return}e.preventDefault();return this.history.push(L(this.url,this.root))};e.prototype.render=function(){var e;var t={class:(e={},e[this.activeClass]=this.match!==null,e),onClick:this.handleClick.bind(this)};if(this.anchorClass){t.class[this.anchorClass]=true}if(this.custom==="a"){t=Object.assign({},t,{href:this.url,title:this.anchorTitle,role:this.anchorRole,tabindex:this.anchorTabIndex,"aria-haspopup":this.ariaHaspopup,id:this.anchorId,"aria-posinset":this.ariaPosinset,"aria-setsize":this.ariaSetsize,"aria-label":this.ariaLabel})}return r(this.custom,Object.assign({},t),r("slot",null))};Object.defineProperty(e.prototype,"el",{get:function(){return n(this)},enumerable:true,configurable:true});Object.defineProperty(e,"watchers",{get:function(){return{location:["computeMatch"]}},enumerable:true,configurable:true});return e}());l.injectProps(H,["history","location","root"]);var O=function(){function e(e,t,n){this.loadBuffer=function(e,t){var n=new XMLHttpRequest;n.open("GET",e,true);n.responseType="arraybuffer";var r=this;n.onload=function(){r.context.decodeAudioData(n.response,(function(n){if(!n){alert("error decoding file data: "+e);return}r.bufferList[t]=n;if(++r.loadCount==r.urlList.length)r.onload(r.bufferList)}),(function(e){console.error("decodeAudioData error",e)}))};n.onerror=function(){alert("BufferLoader: XHR error")};n.send()};this.load=function(){for(var e=0;e<this.urlList.length;++e){this.loadBuffer(this.urlList[e],e)}};this.context=e;this.urlList=t;this.onload=n;this.bufferList=new Array;this.loadCount=0}return e}();var k=d((function(e){!function(t){function n(){if(n.prototype._singleton)throw new Error("WebMidi is a singleton, it cannot be instantiated directly.");(n.prototype._singleton=this)._inputs=[],this._outputs=[],this._userHandlers={},this._stateChangeQueue=[],this._processingStateChange=!1,this._midiInterfaceEvents=["connected","disconnected"],this._nrpnBuffer=[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]],this._nrpnEventsEnabled=!0,this._nrpnTypes=["entry","increment","decrement"],this._notes=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],this._semitones={C:0,D:2,E:4,F:5,G:7,A:9,B:11},Object.defineProperties(this,{MIDI_SYSTEM_MESSAGES:{value:{sysex:240,timecode:241,songposition:242,songselect:243,tuningrequest:246,sysexend:247,clock:248,start:250,continue:251,stop:252,activesensing:254,reset:255,midimessage:0,unknownsystemmessage:-1},writable:!1,enumerable:!0,configurable:!1},MIDI_CHANNEL_MESSAGES:{value:{noteoff:8,noteon:9,keyaftertouch:10,controlchange:11,channelmode:11,nrpn:11,programchange:12,channelaftertouch:13,pitchbend:14},writable:!1,enumerable:!0,configurable:!1},MIDI_REGISTERED_PARAMETER:{value:{pitchbendrange:[0,0],channelfinetuning:[0,1],channelcoarsetuning:[0,2],tuningprogram:[0,3],tuningbank:[0,4],modulationrange:[0,5],azimuthangle:[61,0],elevationangle:[61,1],gain:[61,2],distanceratio:[61,3],maximumdistance:[61,4],maximumdistancegain:[61,5],referencedistanceratio:[61,6],panspreadangle:[61,7],rollangle:[61,8]},writable:!1,enumerable:!0,configurable:!1},MIDI_CONTROL_CHANGE_MESSAGES:{value:{bankselectcoarse:0,modulationwheelcoarse:1,breathcontrollercoarse:2,footcontrollercoarse:4,portamentotimecoarse:5,dataentrycoarse:6,volumecoarse:7,balancecoarse:8,pancoarse:10,expressioncoarse:11,effectcontrol1coarse:12,effectcontrol2coarse:13,generalpurposeslider1:16,generalpurposeslider2:17,generalpurposeslider3:18,generalpurposeslider4:19,bankselectfine:32,modulationwheelfine:33,breathcontrollerfine:34,footcontrollerfine:36,portamentotimefine:37,dataentryfine:38,volumefine:39,balancefine:40,panfine:42,expressionfine:43,effectcontrol1fine:44,effectcontrol2fine:45,holdpedal:64,portamento:65,sustenutopedal:66,softpedal:67,legatopedal:68,hold2pedal:69,soundvariation:70,resonance:71,soundreleasetime:72,soundattacktime:73,brightness:74,soundcontrol6:75,soundcontrol7:76,soundcontrol8:77,soundcontrol9:78,soundcontrol10:79,generalpurposebutton1:80,generalpurposebutton2:81,generalpurposebutton3:82,generalpurposebutton4:83,reverblevel:91,tremololevel:92,choruslevel:93,celestelevel:94,phaserlevel:95,databuttonincrement:96,databuttondecrement:97,nonregisteredparametercoarse:98,nonregisteredparameterfine:99,registeredparametercoarse:100,registeredparameterfine:101},writable:!1,enumerable:!0,configurable:!1},MIDI_NRPN_MESSAGES:{value:{entrymsb:6,entrylsb:38,increment:96,decrement:97,paramlsb:98,parammsb:99,nullactiveparameter:127},writable:!1,enumerable:!0,configurable:!1},MIDI_CHANNEL_MODE_MESSAGES:{value:{allsoundoff:120,resetallcontrollers:121,localcontrol:122,allnotesoff:123,omnimodeoff:124,omnimodeon:125,monomodeon:126,polymodeon:127},writable:!1,enumerable:!0,configurable:!1},octaveOffset:{value:0,writable:!0,enumerable:!0,configurable:!1}}),Object.defineProperties(this,{supported:{enumerable:!0,get:function(){return"requestMIDIAccess"in navigator}},enabled:{enumerable:!0,get:function(){return void 0!==this.interface}.bind(this)},inputs:{enumerable:!0,get:function(){return this._inputs}.bind(this)},outputs:{enumerable:!0,get:function(){return this._outputs}.bind(this)},sysexEnabled:{enumerable:!0,get:function(){return!(!this.interface||!this.interface.sysexEnabled)}.bind(this)},nrpnEventsEnabled:{enumerable:!0,get:function(){return!!this._nrpnEventsEnabled}.bind(this),set:function(e){return this._nrpnEventsEnabled=e,this._nrpnEventsEnabled}},nrpnTypes:{enumerable:!0,get:function(){return this._nrpnTypes}.bind(this)},time:{enumerable:!0,get:function(){return performance.now()}}})}var r=new n;function i(e){var t=this;this._userHandlers={channel:{},system:{}},this._midiInput=e,Object.defineProperties(this,{connection:{enumerable:!0,get:function(){return t._midiInput.connection}},id:{enumerable:!0,get:function(){return t._midiInput.id}},manufacturer:{enumerable:!0,get:function(){return t._midiInput.manufacturer}},name:{enumerable:!0,get:function(){return t._midiInput.name}},state:{enumerable:!0,get:function(){return t._midiInput.state}},type:{enumerable:!0,get:function(){return t._midiInput.type}}}),this._initializeUserHandlers(),this._midiInput.onmidimessage=this._onMidiMessage.bind(this)}function s(e){var t=this;this._midiOutput=e,Object.defineProperties(this,{connection:{enumerable:!0,get:function(){return t._midiOutput.connection}},id:{enumerable:!0,get:function(){return t._midiOutput.id}},manufacturer:{enumerable:!0,get:function(){return t._midiOutput.manufacturer}},name:{enumerable:!0,get:function(){return t._midiOutput.name}},state:{enumerable:!0,get:function(){return t._midiOutput.state}},type:{enumerable:!0,get:function(){return t._midiOutput.type}}})}n.prototype.enable=function(e,t){this.enabled||(this.supported?navigator.requestMIDIAccess({sysex:t}).then(function(t){var n,r=[],i=[];this.interface=t,this._resetInterfaceUserHandlers(),this.interface.onstatechange=function(e){r.push(e)};for(var s=t.inputs.values(),o=s.next();o&&!o.done;o=s.next())i.push(o.value.open());for(var a=t.outputs.values(),u=a.next();u&&!u.done;u=a.next())i.push(u.value.open());function c(){clearTimeout(n),this._updateInputsAndOutputs(),this.interface.onstatechange=this._onInterfaceStateChange.bind(this),"function"==typeof e&&e.call(this),r.forEach(function(e){this._onInterfaceStateChange(e)}.bind(this))}n=setTimeout(c.bind(this),200),Promise&&Promise.all(i).catch((function(e){})).then(c.bind(this))}.bind(this),function(t){"function"==typeof e&&e.call(this,t)}.bind(this)):"function"==typeof e&&e(new Error("The Web MIDI API is not supported by your browser.")))},n.prototype.disable=function(){if(!this.supported)throw new Error("The Web MIDI API is not supported by your browser.");this.interface&&(this.interface.onstatechange=void 0),this.interface=void 0,this._inputs=[],this._outputs=[],this._nrpnEventsEnabled=!0,this._resetInterfaceUserHandlers()},n.prototype.addListener=function(e,t){if(!this.enabled)throw new Error("WebMidi must be enabled before adding event listeners.");if("function"!=typeof t)throw new TypeError("The 'listener' parameter must be a function.");if(!(0<=this._midiInterfaceEvents.indexOf(e)))throw new TypeError("The specified event type is not supported.");return this._userHandlers[e].push(t),this},n.prototype.hasListener=function(e,t){if(!this.enabled)throw new Error("WebMidi must be enabled before checking event listeners.");if("function"!=typeof t)throw new TypeError("The 'listener' parameter must be a function.");if(!(0<=this._midiInterfaceEvents.indexOf(e)))throw new TypeError("The specified event type is not supported.");for(var n=0;n<this._userHandlers[e].length;n++)if(this._userHandlers[e][n]===t)return!0;return!1},n.prototype.removeListener=function(e,t){if(!this.enabled)throw new Error("WebMidi must be enabled before removing event listeners.");if(void 0!==t&&"function"!=typeof t)throw new TypeError("The 'listener' parameter must be a function.");if(0<=this._midiInterfaceEvents.indexOf(e))if(t)for(var n=0;n<this._userHandlers[e].length;n++)this._userHandlers[e][n]===t&&this._userHandlers[e].splice(n,1);else this._userHandlers[e]=[];else{if(void 0!==e)throw new TypeError("The specified event type is not supported.");this._resetInterfaceUserHandlers()}return this},n.prototype.toMIDIChannels=function(e){var t;if("all"===e||void 0===e)t=["all"];else{if("none"===e)return t=[];t=Array.isArray(e)?e:[e]}return-1<t.indexOf("all")&&(t=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]),t.map((function(e){return parseInt(e)})).filter((function(e){return 1<=e&&e<=16}))},n.prototype.getInputById=function(e){if(!this.enabled)throw new Error("WebMidi is not enabled.");e=String(e);for(var t=0;t<this.inputs.length;t++)if(this.inputs[t].id===e)return this.inputs[t];return!1},n.prototype.getOutputById=function(e){if(!this.enabled)throw new Error("WebMidi is not enabled.");e=String(e);for(var t=0;t<this.outputs.length;t++)if(this.outputs[t].id===e)return this.outputs[t];return!1},n.prototype.getInputByName=function(e){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var t=0;t<this.inputs.length;t++)if(~this.inputs[t].name.indexOf(e))return this.inputs[t];return!1},n.prototype.getOctave=function(e){if(null!=e&&0<=e&&e<=127)return Math.floor(Math.floor(e)/12-1)+Math.floor(r.octaveOffset)},n.prototype.getOutputByName=function(e){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var t=0;t<this.outputs.length;t++)if(~this.outputs[t].name.indexOf(e))return this.outputs[t];return!1},n.prototype.guessNoteNumber=function(e){var t=!1;if(e&&e.toFixed&&0<=e&&e<=127?t=Math.round(e):0<=parseInt(e)&&parseInt(e)<=127?t=parseInt(e):("string"==typeof e||e instanceof String)&&(t=this.noteNameToNumber(e)),!1===t)throw new Error("Invalid input value ("+e+").");return t},n.prototype.noteNameToNumber=function(e){"string"!=typeof e&&(e="");var t=e.match(/([CDEFGAB])(#{0,2}|b{0,2})(-?\d+)/i);if(!t)throw new RangeError("Invalid note name.");var n=r._semitones[t[1].toUpperCase()],i=12*(parseInt(t[3])+1-Math.floor(r.octaveOffset))+n;if(-1<t[2].toLowerCase().indexOf("b")?i-=t[2].length:-1<t[2].toLowerCase().indexOf("#")&&(i+=t[2].length),i<0||127<i)throw new RangeError("Invalid note name or note outside valid range.");return i},n.prototype._updateInputsAndOutputs=function(){this._updateInputs(),this._updateOutputs()},n.prototype._updateInputs=function(){for(var e=0;e<this._inputs.length;e++){for(var t=!0,n=this.interface.inputs.values(),r=n.next();r&&!r.done;r=n.next())if(this._inputs[e]._midiInput===r.value){t=!1;break}t&&this._inputs.splice(e,1)}this.interface&&this.interface.inputs.forEach(function(e){for(var t=!0,n=0;n<this._inputs.length;n++)this._inputs[n]._midiInput===e&&(t=!1);t&&this._inputs.push(new i(e))}.bind(this))},n.prototype._updateOutputs=function(){for(var e=0;e<this._outputs.length;e++){for(var t=!0,n=this.interface.outputs.values(),r=n.next();r&&!r.done;r=n.next())if(this._outputs[e]._midiOutput===r.value){t=!1;break}t&&this._outputs.splice(e,1)}this.interface&&this.interface.outputs.forEach(function(e){for(var t=!0,n=0;n<this._outputs.length;n++)this._outputs[n]._midiOutput===e&&(t=!1);t&&this._outputs.push(new s(e))}.bind(this))},n.prototype._onInterfaceStateChange=function(e){this._updateInputsAndOutputs();var t={timestamp:e.timeStamp,type:e.port.state};this.interface&&"connected"===e.port.state?"output"===e.port.type?t.port=this.getOutputById(e.port.id):"input"===e.port.type&&(t.port=this.getInputById(e.port.id)):t.port={connection:"closed",id:e.port.id,manufacturer:e.port.manufacturer,name:e.port.name,state:e.port.state,type:e.port.type},this._userHandlers[e.port.state].forEach((function(e){e(t)}))},n.prototype._resetInterfaceUserHandlers=function(){for(var e=0;e<this._midiInterfaceEvents.length;e++)this._userHandlers[this._midiInterfaceEvents[e]]=[]},i.prototype.on=i.prototype.addListener=function(e,t,n){var i=this;if(void 0===t&&(t="all"),Array.isArray(t)||(t=[t]),t.forEach((function(e){if("all"!==e&&!(1<=e&&e<=16))throw new RangeError("The 'channel' parameter is invalid.")})),"function"!=typeof n)throw new TypeError("The 'listener' parameter must be a function.");if(void 0!==r.MIDI_SYSTEM_MESSAGES[e])this._userHandlers.system[e]||(this._userHandlers.system[e]=[]),this._userHandlers.system[e].push(n);else{if(void 0===r.MIDI_CHANNEL_MESSAGES[e])throw new TypeError("The specified event type is not supported.");if(-1<t.indexOf("all")){t=[];for(var s=1;s<=16;s++)t.push(s)}this._userHandlers.channel[e]||(this._userHandlers.channel[e]=[]),t.forEach((function(t){i._userHandlers.channel[e][t]||(i._userHandlers.channel[e][t]=[]),i._userHandlers.channel[e][t].push(n)}))}return this},i.prototype.hasListener=function(e,t,n){var i=this;if("function"!=typeof n)throw new TypeError("The 'listener' parameter must be a function.");if(void 0===t&&(t="all"),t.constructor!==Array&&(t=[t]),void 0!==r.MIDI_SYSTEM_MESSAGES[e]){for(var s=0;s<this._userHandlers.system[e].length;s++)if(this._userHandlers.system[e][s]===n)return!0}else if(void 0!==r.MIDI_CHANNEL_MESSAGES[e]){if(-1<t.indexOf("all")){t=[];for(var o=1;o<=16;o++)t.push(o)}return!!this._userHandlers.channel[e]&&t.every((function(t){var r=i._userHandlers.channel[e][t];return r&&-1<r.indexOf(n)}))}return!1},i.prototype.removeListener=function(e,t,n){var i=this;if(void 0!==n&&"function"!=typeof n)throw new TypeError("The 'listener' parameter must be a function.");if(void 0===t&&(t="all"),t.constructor!==Array&&(t=[t]),void 0!==r.MIDI_SYSTEM_MESSAGES[e])if(void 0===n)this._userHandlers.system[e]=[];else for(var s=0;s<this._userHandlers.system[e].length;s++)this._userHandlers.system[e][s]===n&&this._userHandlers.system[e].splice(s,1);else if(void 0!==r.MIDI_CHANNEL_MESSAGES[e]){if(-1<t.indexOf("all")){t=[];for(var o=1;o<=16;o++)t.push(o)}if(!this._userHandlers.channel[e])return this;t.forEach((function(t){var r=i._userHandlers.channel[e][t];if(r)if(void 0===n)i._userHandlers.channel[e][t]=[];else for(var s=0;s<r.length;s++)r[s]===n&&r.splice(s,1)}))}else{if(void 0!==e)throw new TypeError("The specified event type is not supported.");this._initializeUserHandlers()}return this},i.prototype._initializeUserHandlers=function(){for(var e in r.MIDI_CHANNEL_MESSAGES)r.MIDI_CHANNEL_MESSAGES.hasOwnProperty(e)&&(this._userHandlers.channel[e]={});for(var t in r.MIDI_SYSTEM_MESSAGES)r.MIDI_SYSTEM_MESSAGES.hasOwnProperty(t)&&(this._userHandlers.system[t]=[])},i.prototype._onMidiMessage=function(e){if(0<this._userHandlers.system.midimessage.length){var t={target:this,data:e.data,timestamp:e.timeStamp,type:"midimessage"};this._userHandlers.system.midimessage.forEach((function(e){e(t)}))}e.data[0]<240?(this._parseChannelEvent(e),this._parseNrpnEvent(e)):e.data[0]<=255&&this._parseSystemEvent(e)},i.prototype._parseNrpnEvent=function(e){var t,n,i=e.data[0]>>4,s=15&e.data[0],o=1+s;if(1<e.data.length&&(t=e.data[1],n=2<e.data.length?e.data[2]:void 0),r.nrpnEventsEnabled&&i===r.MIDI_CHANNEL_MESSAGES.controlchange&&(t>=r.MIDI_NRPN_MESSAGES.increment&&t<=r.MIDI_NRPN_MESSAGES.parammsb||t===r.MIDI_NRPN_MESSAGES.entrymsb||t===r.MIDI_NRPN_MESSAGES.entrylsb)){var a={target:this,type:"controlchange",data:e.data,timestamp:e.timeStamp,channel:o,controller:{number:t,name:this.getCcNameByNumber(t)},value:n};if(a.controller.number===r.MIDI_NRPN_MESSAGES.parammsb&&a.value!=r.MIDI_NRPN_MESSAGES.nullactiveparameter)r._nrpnBuffer[s]=[],r._nrpnBuffer[s][0]=a;else if(1===r._nrpnBuffer[s].length&&a.controller.number===r.MIDI_NRPN_MESSAGES.paramlsb)r._nrpnBuffer[s].push(a);else if(2!==r._nrpnBuffer[s].length||a.controller.number!==r.MIDI_NRPN_MESSAGES.increment&&a.controller.number!==r.MIDI_NRPN_MESSAGES.decrement&&a.controller.number!==r.MIDI_NRPN_MESSAGES.entrymsb)if(3===r._nrpnBuffer[s].length&&r._nrpnBuffer[s][2].number===r.MIDI_NRPN_MESSAGES.entrymsb&&a.controller.number===r.MIDI_NRPN_MESSAGES.entrylsb)r._nrpnBuffer[s].push(a);else if(3<=r._nrpnBuffer[s].length&&r._nrpnBuffer[s].length<=4&&a.controller.number===r.MIDI_NRPN_MESSAGES.parammsb&&a.value===r.MIDI_NRPN_MESSAGES.nullactiveparameter)r._nrpnBuffer[s].push(a);else if(4<=r._nrpnBuffer[s].length&&r._nrpnBuffer[s].length<=5&&a.controller.number===r.MIDI_NRPN_MESSAGES.paramlsb&&a.value===r.MIDI_NRPN_MESSAGES.nullactiveparameter){r._nrpnBuffer[s].push(a);var u=[];r._nrpnBuffer[s].forEach((function(e){u.push(e.data)}));var c=r._nrpnBuffer[s][0].value<<7|r._nrpnBuffer[s][1].value,h=r._nrpnBuffer[s][2].value;6===r._nrpnBuffer[s].length&&(h=r._nrpnBuffer[s][2].value<<7|r._nrpnBuffer[s][3].value);var l="";switch(r._nrpnBuffer[s][2].controller.number){case r.MIDI_NRPN_MESSAGES.entrymsb:l=r._nrpnTypes[0];break;case r.MIDI_NRPN_MESSAGES.increment:l=r._nrpnTypes[1];break;case r.MIDI_NRPN_MESSAGES.decrement:l=r._nrpnTypes[2];break;default:throw new Error("The NPRN type was unidentifiable.")}var f={timestamp:a.timestamp,channel:a.channel,type:"nrpn",data:u,controller:{number:c,type:l,name:"Non-Registered Parameter "+c},value:h};r._nrpnBuffer[s]=[],this._userHandlers.channel[f.type]&&this._userHandlers.channel[f.type][f.channel]&&this._userHandlers.channel[f.type][f.channel].forEach((function(e){e(f)}))}else r._nrpnBuffer[s]=[];else r._nrpnBuffer[s].push(a)}},i.prototype._parseChannelEvent=function(e){var t,n,i=e.data[0]>>4,s=1+(15&e.data[0]);1<e.data.length&&(t=e.data[1],n=2<e.data.length?e.data[2]:void 0);var o={target:this,data:e.data,timestamp:e.timeStamp,channel:s};i===r.MIDI_CHANNEL_MESSAGES.noteoff||i===r.MIDI_CHANNEL_MESSAGES.noteon&&0===n?(o.type="noteoff",o.note={number:t,name:r._notes[t%12],octave:r.getOctave(t)},o.velocity=n/127,o.rawVelocity=n):i===r.MIDI_CHANNEL_MESSAGES.noteon?(o.type="noteon",o.note={number:t,name:r._notes[t%12],octave:r.getOctave(t)},o.velocity=n/127,o.rawVelocity=n):i===r.MIDI_CHANNEL_MESSAGES.keyaftertouch?(o.type="keyaftertouch",o.note={number:t,name:r._notes[t%12],octave:r.getOctave(t)},o.value=n/127):i===r.MIDI_CHANNEL_MESSAGES.controlchange&&0<=t&&t<=119?(o.type="controlchange",o.controller={number:t,name:this.getCcNameByNumber(t)},o.value=n):i===r.MIDI_CHANNEL_MESSAGES.channelmode&&120<=t&&t<=127?(o.type="channelmode",o.controller={number:t,name:this.getChannelModeByNumber(t)},o.value=n):i===r.MIDI_CHANNEL_MESSAGES.programchange?(o.type="programchange",o.value=t):i===r.MIDI_CHANNEL_MESSAGES.channelaftertouch?(o.type="channelaftertouch",o.value=t/127):i===r.MIDI_CHANNEL_MESSAGES.pitchbend?(o.type="pitchbend",o.value=((n<<7)+t-8192)/8192):o.type="unknownchannelmessage",this._userHandlers.channel[o.type]&&this._userHandlers.channel[o.type][s]&&this._userHandlers.channel[o.type][s].forEach((function(e){e(o)}))},i.prototype.getCcNameByNumber=function(e){if(!(0<=(e=Math.floor(e))&&e<=119))throw new RangeError("The control change number must be between 0 and 119.");for(var t in r.MIDI_CONTROL_CHANGE_MESSAGES)if(r.MIDI_CONTROL_CHANGE_MESSAGES.hasOwnProperty(t)&&e===r.MIDI_CONTROL_CHANGE_MESSAGES[t])return t},i.prototype.getChannelModeByNumber=function(e){if(!(120<=(e=Math.floor(e))&&status<=127))throw new RangeError("The control change number must be between 120 and 127.");for(var t in r.MIDI_CHANNEL_MODE_MESSAGES)if(r.MIDI_CHANNEL_MODE_MESSAGES.hasOwnProperty(t)&&e===r.MIDI_CHANNEL_MODE_MESSAGES[t])return t},i.prototype._parseSystemEvent=function(e){var t=e.data[0],n={target:this,data:e.data,timestamp:e.timeStamp};t===r.MIDI_SYSTEM_MESSAGES.sysex?n.type="sysex":t===r.MIDI_SYSTEM_MESSAGES.timecode?n.type="timecode":t===r.MIDI_SYSTEM_MESSAGES.songposition?n.type="songposition":t===r.MIDI_SYSTEM_MESSAGES.songselect?(n.type="songselect",n.song=e.data[1]):t===r.MIDI_SYSTEM_MESSAGES.tuningrequest?n.type="tuningrequest":t===r.MIDI_SYSTEM_MESSAGES.clock?n.type="clock":t===r.MIDI_SYSTEM_MESSAGES.start?n.type="start":t===r.MIDI_SYSTEM_MESSAGES.continue?n.type="continue":t===r.MIDI_SYSTEM_MESSAGES.stop?n.type="stop":t===r.MIDI_SYSTEM_MESSAGES.activesensing?n.type="activesensing":t===r.MIDI_SYSTEM_MESSAGES.reset?n.type="reset":n.type="unknownsystemmessage",this._userHandlers.system[n.type]&&this._userHandlers.system[n.type].forEach((function(e){e(n)}))},s.prototype.send=function(e,t,n){if(!(128<=e&&e<=255))throw new RangeError("The status byte must be an integer between 128 (0x80) and 255 (0xFF).");void 0===t&&(t=[]),Array.isArray(t)||(t=[t]);var r=[];return t.forEach((function(e){var t=Math.floor(e);if(!(0<=t&&t<=255))throw new RangeError("Data bytes must be integers between 0 (0x00) and 255 (0xFF).");r.push(t)})),this._midiOutput.send([e].concat(r),parseFloat(n)||0),this},s.prototype.sendSysex=function(e,t,n){if(!r.sysexEnabled)throw new Error("Sysex message support must first be activated.");return n=n||{},e=[].concat(e),t.forEach((function(e){if(e<0||127<e)throw new RangeError("The data bytes of a sysex message must be integers between 0 (0x00) and 127 (0x7F).")})),t=e.concat(t,r.MIDI_SYSTEM_MESSAGES.sysexend),this.send(r.MIDI_SYSTEM_MESSAGES.sysex,t,this._parseTimeParameter(n.time)),this},s.prototype.sendTimecodeQuarterFrame=function(e,t){return t=t||{},this.send(r.MIDI_SYSTEM_MESSAGES.timecode,e,this._parseTimeParameter(t.time)),this},s.prototype.sendSongPosition=function(e,t){t=t||{};var n=(e=Math.floor(e)||0)>>7&127,i=127&e;return this.send(r.MIDI_SYSTEM_MESSAGES.songposition,[n,i],this._parseTimeParameter(t.time)),this},s.prototype.sendSongSelect=function(e,t){if(t=t||{},!(0<=(e=Math.floor(e))&&e<=127))throw new RangeError("The song number must be between 0 and 127.");return this.send(r.MIDI_SYSTEM_MESSAGES.songselect,[e],this._parseTimeParameter(t.time)),this},s.prototype.sendTuningRequest=function(e){return e=e||{},this.send(r.MIDI_SYSTEM_MESSAGES.tuningrequest,void 0,this._parseTimeParameter(e.time)),this},s.prototype.sendClock=function(e){return e=e||{},this.send(r.MIDI_SYSTEM_MESSAGES.clock,void 0,this._parseTimeParameter(e.time)),this},s.prototype.sendStart=function(e){return e=e||{},this.send(r.MIDI_SYSTEM_MESSAGES.start,void 0,this._parseTimeParameter(e.time)),this},s.prototype.sendContinue=function(e){return e=e||{},this.send(r.MIDI_SYSTEM_MESSAGES.continue,void 0,this._parseTimeParameter(e.time)),this},s.prototype.sendStop=function(e){return e=e||{},this.send(r.MIDI_SYSTEM_MESSAGES.stop,void 0,this._parseTimeParameter(e.time)),this},s.prototype.sendActiveSensing=function(e){return e=e||{},this.send(r.MIDI_SYSTEM_MESSAGES.activesensing,[],this._parseTimeParameter(e.time)),this},s.prototype.sendReset=function(e){return e=e||{},this.send(r.MIDI_SYSTEM_MESSAGES.reset,void 0,this._parseTimeParameter(e.time)),this},s.prototype.stopNote=function(e,t,n){if("all"===e)return this.sendChannelMode("allnotesoff",0,t,n);var i=64;return(n=n||{}).rawVelocity?!isNaN(n.velocity)&&0<=n.velocity&&n.velocity<=127&&(i=n.velocity):!isNaN(n.velocity)&&0<=n.velocity&&n.velocity<=1&&(i=127*n.velocity),this._convertNoteToArray(e).forEach(function(e){r.toMIDIChannels(t).forEach(function(t){this.send((r.MIDI_CHANNEL_MESSAGES.noteoff<<4)+(t-1),[e,Math.round(i)],this._parseTimeParameter(n.time))}.bind(this))}.bind(this)),this},s.prototype.playNote=function(e,t,n){var i,s=64;if((n=n||{}).rawVelocity?!isNaN(n.velocity)&&0<=n.velocity&&n.velocity<=127&&(s=n.velocity):!isNaN(n.velocity)&&0<=n.velocity&&n.velocity<=1&&(s=127*n.velocity),i=this._parseTimeParameter(n.time),this._convertNoteToArray(e).forEach(function(e){r.toMIDIChannels(t).forEach(function(t){this.send((r.MIDI_CHANNEL_MESSAGES.noteon<<4)+(t-1),[e,Math.round(s)],i)}.bind(this))}.bind(this)),!isNaN(n.duration)){n.duration<=0&&(n.duration=0);var o=64;n.rawVelocity?!isNaN(n.release)&&0<=n.release&&n.release<=127&&(o=n.release):!isNaN(n.release)&&0<=n.release&&n.release<=1&&(o=127*n.release),this._convertNoteToArray(e).forEach(function(e){r.toMIDIChannels(t).forEach(function(t){this.send((r.MIDI_CHANNEL_MESSAGES.noteoff<<4)+(t-1),[e,Math.round(o)],(i||r.time)+n.duration)}.bind(this))}.bind(this))}return this},s.prototype.sendKeyAftertouch=function(e,t,n,i){var s=this;if(i=i||{},t<1||16<t)throw new RangeError("The channel must be between 1 and 16.");(isNaN(n)||n<0||1<n)&&(n=.5);var o=Math.round(127*n);return this._convertNoteToArray(e).forEach((function(e){r.toMIDIChannels(t).forEach((function(t){s.send((r.MIDI_CHANNEL_MESSAGES.keyaftertouch<<4)+(t-1),[e,o],s._parseTimeParameter(i.time))}))})),this},s.prototype.sendControlChange=function(e,t,n,i){if(i=i||{},"string"==typeof e){if(void 0===(e=r.MIDI_CONTROL_CHANGE_MESSAGES[e]))throw new TypeError("Invalid controller name.")}else if(!(0<=(e=Math.floor(e))&&e<=119))throw new RangeError("Controller numbers must be between 0 and 119.");if(!(0<=(t=Math.floor(t)||0)&&t<=127))throw new RangeError("Controller value must be between 0 and 127.");return r.toMIDIChannels(n).forEach(function(n){this.send((r.MIDI_CHANNEL_MESSAGES.controlchange<<4)+(n-1),[e,t],this._parseTimeParameter(i.time))}.bind(this)),this},s.prototype._selectRegisteredParameter=function(e,t,n){var i=this;if(e[0]=Math.floor(e[0]),!(0<=e[0]&&e[0]<=127))throw new RangeError("The control65 value must be between 0 and 127");if(e[1]=Math.floor(e[1]),!(0<=e[1]&&e[1]<=127))throw new RangeError("The control64 value must be between 0 and 127");return r.toMIDIChannels(t).forEach((function(){i.sendControlChange(101,e[0],t,{time:n}),i.sendControlChange(100,e[1],t,{time:n})})),this},s.prototype._selectNonRegisteredParameter=function(e,t,n){var i=this;if(e[0]=Math.floor(e[0]),!(0<=e[0]&&e[0]<=127))throw new RangeError("The control63 value must be between 0 and 127");if(e[1]=Math.floor(e[1]),!(0<=e[1]&&e[1]<=127))throw new RangeError("The control62 value must be between 0 and 127");return r.toMIDIChannels(t).forEach((function(){i.sendControlChange(99,e[0],t,{time:n}),i.sendControlChange(98,e[1],t,{time:n})})),this},s.prototype._setCurrentRegisteredParameter=function(e,t,n){var i=this;if((e=[].concat(e))[0]=Math.floor(e[0]),!(0<=e[0]&&e[0]<=127))throw new RangeError("The msb value must be between 0 and 127");return r.toMIDIChannels(t).forEach((function(){i.sendControlChange(6,e[0],t,{time:n})})),e[1]=Math.floor(e[1]),0<=e[1]&&e[1]<=127&&r.toMIDIChannels(t).forEach((function(){i.sendControlChange(38,e[1],t,{time:n})})),this},s.prototype._deselectRegisteredParameter=function(e,t){var n=this;return r.toMIDIChannels(e).forEach((function(){n.sendControlChange(101,127,e,{time:t}),n.sendControlChange(100,127,e,{time:t})})),this},s.prototype.setRegisteredParameter=function(e,t,n,i){var s=this;if(i=i||{},!Array.isArray(e)){if(!r.MIDI_REGISTERED_PARAMETER[e])throw new Error("The specified parameter is not available.");e=r.MIDI_REGISTERED_PARAMETER[e]}return r.toMIDIChannels(n).forEach((function(){s._selectRegisteredParameter(e,n,i.time),s._setCurrentRegisteredParameter(t,n,i.time),s._deselectRegisteredParameter(n,i.time)})),this},s.prototype.setNonRegisteredParameter=function(e,t,n,i){var s=this;if(i=i||{},!(0<=e[0]&&e[0]<=127&&0<=e[1]&&e[1]<=127))throw new Error("Position 0 and 1 of the 2-position parameter array must both be between 0 and 127.");return t=[].concat(t),r.toMIDIChannels(n).forEach((function(){s._selectNonRegisteredParameter(e,n,i.time),s._setCurrentRegisteredParameter(t,n,i.time),s._deselectRegisteredParameter(n,i.time)})),this},s.prototype.incrementRegisteredParameter=function(e,t,n){var i=this;if(n=n||{},!Array.isArray(e)){if(!r.MIDI_REGISTERED_PARAMETER[e])throw new Error("The specified parameter is not available.");e=r.MIDI_REGISTERED_PARAMETER[e]}return r.toMIDIChannels(t).forEach((function(){i._selectRegisteredParameter(e,t,n.time),i.sendControlChange(96,0,t,{time:n.time}),i._deselectRegisteredParameter(t,n.time)})),this},s.prototype.decrementRegisteredParameter=function(e,t,n){if(n=n||{},!Array.isArray(e)){if(!r.MIDI_REGISTERED_PARAMETER[e])throw new TypeError("The specified parameter is not available.");e=r.MIDI_REGISTERED_PARAMETER[e]}return r.toMIDIChannels(t).forEach(function(){this._selectRegisteredParameter(e,t,n.time),this.sendControlChange(97,0,t,{time:n.time}),this._deselectRegisteredParameter(t,n.time)}.bind(this)),this},s.prototype.setPitchBendRange=function(e,t,n,i){var s=this;if(i=i||{},!(0<=(e=Math.floor(e)||0)&&e<=127))throw new RangeError("The semitones value must be between 0 and 127");if(!(0<=(t=Math.floor(t)||0)&&t<=127))throw new RangeError("The cents value must be between 0 and 127");return r.toMIDIChannels(n).forEach((function(){s.setRegisteredParameter("pitchbendrange",[e,t],n,{time:i.time})})),this},s.prototype.setModulationRange=function(e,t,n,i){var s=this;if(i=i||{},!(0<=(e=Math.floor(e)||0)&&e<=127))throw new RangeError("The semitones value must be between 0 and 127");if(!(0<=(t=Math.floor(t)||0)&&t<=127))throw new RangeError("The cents value must be between 0 and 127");return r.toMIDIChannels(n).forEach((function(){s.setRegisteredParameter("modulationrange",[e,t],n,{time:i.time})})),this},s.prototype.setMasterTuning=function(e,t,n){var i=this;if(n=n||{},(e=parseFloat(e)||0)<=-65||64<=e)throw new RangeError("The value must be a decimal number larger than -65 and smaller than 64.");var s=Math.floor(e)+64,o=e-Math.floor(e),a=(o=Math.round((o+1)/2*16383))>>7&127,u=127&o;return r.toMIDIChannels(t).forEach((function(){i.setRegisteredParameter("channelcoarsetuning",s,t,{time:n.time}),i.setRegisteredParameter("channelfinetuning",[a,u],t,{time:n.time})})),this},s.prototype.setTuningProgram=function(e,t,n){var i=this;if(n=n||{},!(0<=(e=Math.floor(e))&&e<=127))throw new RangeError("The program value must be between 0 and 127");return r.toMIDIChannels(t).forEach((function(){i.setRegisteredParameter("tuningprogram",e,t,{time:n.time})})),this},s.prototype.setTuningBank=function(e,t,n){var i=this;if(n=n||{},!(0<=(e=Math.floor(e)||0)&&e<=127))throw new RangeError("The bank value must be between 0 and 127");return r.toMIDIChannels(t).forEach((function(){i.setRegisteredParameter("tuningbank",e,t,{time:n.time})})),this},s.prototype.sendChannelMode=function(e,t,n,i){if(i=i||{},"string"==typeof e){if(!(e=r.MIDI_CHANNEL_MODE_MESSAGES[e]))throw new TypeError("Invalid channel mode message name.")}else if(!(120<=(e=Math.floor(e))&&e<=127))throw new RangeError("Channel mode numerical identifiers must be between 120 and 127.");if((t=Math.floor(t)||0)<0||127<t)throw new RangeError("Value must be an integer between 0 and 127.");return r.toMIDIChannels(n).forEach(function(n){this.send((r.MIDI_CHANNEL_MESSAGES.channelmode<<4)+(n-1),[e,t],this._parseTimeParameter(i.time))}.bind(this)),this},s.prototype.sendProgramChange=function(e,t,n){var i=this;if(n=n||{},e=Math.floor(e),isNaN(e)||e<0||127<e)throw new RangeError("Program numbers must be between 0 and 127.");return r.toMIDIChannels(t).forEach((function(t){i.send((r.MIDI_CHANNEL_MESSAGES.programchange<<4)+(t-1),[e],i._parseTimeParameter(n.time))})),this},s.prototype.sendChannelAftertouch=function(e,t,n){var i=this;n=n||{},e=parseFloat(e),(isNaN(e)||e<0||1<e)&&(e=.5);var s=Math.round(127*e);return r.toMIDIChannels(t).forEach((function(e){i.send((r.MIDI_CHANNEL_MESSAGES.channelaftertouch<<4)+(e-1),[s],i._parseTimeParameter(n.time))})),this},s.prototype.sendPitchBend=function(e,t,n){var i=this;if(n=n||{},isNaN(e)||e<-1||1<e)throw new RangeError("Pitch bend value must be between -1 and 1.");var s=Math.round((e+1)/2*16383),o=s>>7&127,a=127&s;return r.toMIDIChannels(t).forEach((function(e){i.send((r.MIDI_CHANNEL_MESSAGES.pitchbend<<4)+(e-1),[a,o],i._parseTimeParameter(n.time))})),this},s.prototype._parseTimeParameter=function(e){var t,n=parseFloat(e);return"string"==typeof e&&"+"===e.substring(0,1)?n&&0<n&&(t=r.time+n):n>r.time&&(t=n),t},s.prototype._convertNoteToArray=function(e){var t=[];return Array.isArray(e)||(e=[e]),e.forEach((function(e){t.push(r.guessNoteNumber(e))})),t},e.exports?e.exports=r:t.WebMidi||(t.WebMidi=r)}(p)}));var B=e("web_audio",function(){function e(e){t(this,e);this.name="web_audio";this.prepared=false;this.midi=false;this.sources=[];this.keys={}}e.prototype.source=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:if(!(this.sources.length===0))return[3,2];return[4,this.connect_the_world()];case 1:t.sent();t.label=2;case 2:return[2,this.sources[e]]}}))}))};e.prototype.get_context=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){return[2,this.context]}))}))};e.prototype.is_prepared=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){return[2,this.prepared]}))}))};e.prototype.stop=function(){return __awaiter(this,void 0,void 0,(function(){var e=this;return __generator(this,(function(t){switch(t.label){case 0:return[4,m(this.sources,(function(t){return __awaiter(e,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,t.stop()];case 1:e.sent();return[2]}}))}))}))];case 1:return[2,t.sent()]}}))}))};e.prototype.componentDidLoad=function(){this.connect_debugger()};e.prototype.connect_the_world=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:this.connect_context();this.gain=this.context.createGain();return[4,this.connect_visualizers()];case 1:e.sent();return[4,this.connect_sources()];case 2:e.sent();return[4,this.connect_midi()];case 3:e.sent();this.prepared=true;return[4,f(500)];case 4:e.sent();return[2,true]}}))}))};e.prototype.connect_context=function(){this.context=new(window.AudioContext||window.webkitAudioContext);this.log("Connected to this.context")};e.prototype.connect_sources=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.build_sources()];case 1:e.sent();return[2]}}))}))};e.prototype.build_sources=function(){return __awaiter(this,void 0,void 0,(function(){var e=this;return __generator(this,(function(t){switch(t.label){case 0:this.log("Building sources");this._sources=Array.from(this.element.querySelectorAll("web-audio-source"));this.externalFiles=[];return[4,m(this._sources,(function(t,n){return __awaiter(e,void 0,void 0,(function(){var e;var r=this;return __generator(this,(function(i){switch(i.label){case 0:this.log("("+n+") Preparing "+t.name);this.sources[t.name]=t;e=new O(this.context,[t.src],(function(e){return __awaiter(r,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:return[4,this.cache_sources(e,t)];case 1:n.sent();return[2]}}))}))}));return[4,e.load()];case 1:i.sent();return[2]}}))}))}))];case 1:t.sent();return[2]}}))}))};e.prototype.cache_sources=function(e,t){return __awaiter(this,void 0,void 0,(function(){var n=this;return __generator(this,(function(r){switch(r.label){case 0:return[4,m(e,(function(e){return __awaiter(n,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:this.log("Caching "+t.name);if(this.midi){this.log("Assigned "+t.name+" to midi key "+t.midikey+", channel "+t.midichannel);if(this.keys[t.midichannel]==undefined){this.keys[t.midichannel]=[]}this.keys[t.midichannel][t.midikey]=t}this._currentSource=t;return[4,this._currentSource.assignBuffer(this,e)];case 1:n.sent();this.log("Source "+t.name+" is ready");return[2]}}))}))}))];case 1:r.sent();this._currentSource=null;return[2]}}))}))};e.prototype.connect_visualizers=function(){return __awaiter(this,void 0,void 0,(function(){var e=this;return __generator(this,(function(t){switch(t.label){case 0:return[4,f(20)];case 1:t.sent();this.visualizers=Array.from(document.querySelectorAll('web-audio-visualizer[for="'+this.name+'"]'));if(!this.visualizers)return[3,3];this.log("Attaching visualizers");return[4,m(this.visualizers,(function(t,n){return __awaiter(e,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:if(!(n===0))return[3,2];return[4,t.connect(this.context,this.context.destination)];case 1:t=e.sent();return[3,4];case 2:return[4,t.connect(this.context,this.previousVisualizer.analyser)];case 3:t=e.sent();e.label=4;case 4:this.previousVisualizer=t;return[2]}}))}))}))];case 2:t.sent();return[3,4];case 3:this.log("No visualizers for "+this.name);t.label=4;case 4:if(!(this.visualizers.length>=1))return[3,6];return[4,this.gain.connect(this.previousVisualizer.analyser)];case 5:t.sent();return[3,8];case 6:return[4,this.gain.connect(this.context.destination)];case 7:t.sent();t.label=8;case 8:return[2]}}))}))};e.prototype.connect_debugger=function(){this.debugger=document.querySelector('web-audio-debugger[for="'+this.name+'"]');this.log("Connected debugger")};e.prototype.log=function(e){if(this.debugger){this.debugger.addHistory(e)}};e.prototype.connect_midi=function(){var e=this;if(this.midi){k.enable((function(t){if(t){e.log("Midi couldn't be enabled."+t)}else{e.log("Midi is enabled")}var n=k.inputs[0];if(n){n.addListener("noteon","all",(function(t){e.log("KEY: Channel: "+t.channel+", Note: "+t.note.number+", Name: "+t.note.name+", Oct: "+t.note.octave);if(e.keys[t.channel]){e.keys[t.channel][t.note.number].gain().value=t.data[2]/175;e.keys[t.channel][t.note.number].play()}}));n.addListener("pitchbend","all",(function(t){e.log("PITCH: Channel: "+t.channel+", Value: "+t.value)}));n.addListener("controlchange","all",(function(t){e.log("CTRL: Channel: "+t.channel+", controller: "+t.controller.number+", Value: "+t.value);var n=new CustomEvent("midi-controller-update",{detail:t});document.dispatchEvent(n)}));e.log("Listeners added for notes, pitch bend, and controllers.")}}))}};Object.defineProperty(e.prototype,"element",{get:function(){return n(this)},enumerable:true,configurable:true});return e}());var j=e("web_audio_sequencer",function(){function e(e){var n=this;t(this,e);this.name="web_audio_sequencer";this.autoplay=false;this.taps=4;this.context=function(){return __awaiter(n,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,document.querySelector("web-audio").get_context()];case 1:return[2,e.sent()]}}))}))};this.noteTime=0;this.currentTap=0;this.totalPlayTime=0;this.custom=function(){return __awaiter(n,void 0,void 0,(function(){return __generator(this,(function(e){return[2]}))}))}}e.prototype.componentDidLoad=function(){if(this.autoplay){this.play()}};e.prototype.schedule=function(){return __awaiter(this,void 0,void 0,(function(){var e,t;var n=this;return __generator(this,(function(r){switch(r.label){case 0:return[4,this.context()];case 1:e=r.sent().currentTime;e-=this.startTime;r.label=2;case 2:if(!(this.noteTime<e+.005))return[3,7];r.label=3;case 3:r.trys.push([3,5,,6]);return[4,this.custom()];case 4:r.sent();this.totalPlayTime=this.noteTime+this.startTime;if(this.currentTap===0){this.iterations++}this.advance();return[3,6];case 5:t=r.sent();console.error(t);return[3,6];case 6:return[3,2];case 7:this.timer=setTimeout((function(){return __awaiter(n,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.schedule()];case 1:e.sent();return[2]}}))}))}),0);return[2]}}))}))};e.prototype.advance=function(){var e=60/this.tempo;this.currentTap++;if(this.currentTap==this.taps){this.currentTap=0}this.noteTime+=.25*e};e.prototype.play=function(){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return[4,this.context()];case 1:if(!!t.sent())return[3,3];return[4,document.querySelector("web-audio").connect_the_world()];case 2:t.sent();t.label=3;case 3:this.iterations=0;e=this;return[4,this.context()];case 4:e.startTime=t.sent().currentTime+.005||.005;return[4,this.schedule()];case 5:t.sent();return[2]}}))}))};e.prototype.stop=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){this.iterations=0;this.totalPlayTime=0;this.startTime=null;this.currentTap=0;this.noteTime=0;clearTimeout(this.timer);return[2]}))}))};return e}());var q=e("web_audio_source",function(){function e(e){t(this,e);this.inert=false;this.midikey=0;this.midichannel=1;this.prepared=false;this.status="paused";this.effectsvolume=100;this.effects=[];this.instances=[];this.duration=0;this.startTime=0;this.pausedTime=0;this.elapsedTime=0;this.playing=false;this.update=a(this,"update",7)}e.prototype.getBuffer=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){return[2,this.buffer]}))}))};e.prototype.webAudio=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){return[2,this.webAudioWrapper]}))}))};e.prototype.gain=function(e){if(e===void 0){e="wet"}return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){if(e==="wet"){return[2,this.wetGain]}else if(e==="dry"){return[2,this.dryGain]}else if(e==="channel"){return[2,this.channelGain]}return[2]}))}))};e.prototype.getDuration=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){return[2,this.duration]}))}))};e.prototype.currentTime=function(){var e=0;if(this.pausedTime){e=this.pausedTime}else{if(this.startTime){e=this.context.currentTime-this.startTime}}if(e>=this.duration){e=this.duration}return e};e.prototype.prepare=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){if(!this.inert&&this.context){this.source=this.context.createBufferSource();this.source.buffer=this.buffer;if(this.wetGain){this.wetGain.gain.value=this.effectsvolume/100;this.dryGain.gain.value=Math.abs((this.effectsvolume-100)/100)}else{this.dryGain.gain.value=1}if(this.wetGain){this.source.connect(this.wetGain)}this.source.connect(this.dryGain);this.duration=this.source.buffer.duration;this.prepared=true}return[2]}))}))};e.prototype.play=function(){return __awaiter(this,void 0,void 0,(function(){var e=this;return __generator(this,(function(t){switch(t.label){case 0:if(!!this.inert)return[3,2];return[4,this.prepare()];case 1:t.sent();if(this.source){this.source.start(0,this.pausedTime);this.startTime=this.context.currentTime-this.pausedTime;this.pausedTime=0;this.playing=true;this.tick();v((function(){e.tick()}))}return[3,3];case 2:throw"Cannot play inert media.";case 3:return[2]}}))}))};e.prototype.skipTo=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this.stop()];case 1:t.sent();this.pausedTime=e/1e3;return[4,this.play()];case 2:t.sent();return[2]}}))}))};e.prototype.pause=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:this.elapsedTime=this.context.currentTime-this.startTime;return[4,this.stop()];case 1:e.sent();this.pausedTime=this.elapsedTime;this.playing=false;return[2]}}))}))};e.prototype.toggle=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:if(!this.playing)return[3,2];return[4,this.pause()];case 1:e.sent();return[3,4];case 2:return[4,this.play()];case 3:e.sent();e.label=4;case 4:return[2]}}))}))};e.prototype.stop=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:if(!this.source)return[3,3];return[4,this.source.disconnect()];case 1:e.sent();return[4,this.source.stop()];case 2:e.sent();e.label=3;case 3:this.source=null;this.pausedTime=0;this.startTime=0;this.playing=false;return[2]}}))}))};e.prototype.tick=function(){var e=this;this.update.emit({time:this.currentTime(),duration:this.duration});if(this.source){v((function(){e.tick()}))}};e.prototype.assignBuffer=function(e,t){return __awaiter(this,void 0,void 0,(function(){var n;var r=this;return __generator(this,(function(i){switch(i.label){case 0:this.webAudioWrapper=e.element;this.context=e.context;this.buffer=t;if(!!this.inert)return[3,2];this.masterGain=e.gain;this.channelGain=this.context.createGain();return[4,this.prepareEffects()];case 1:i.sent();if(Object.keys(this.effects).length>0){this.wetGain=this.context.createGain();n="";Object.keys(this.effects).reverse().forEach((function(e,t){if(t===0){r.wetGain.connect(r.effects[e])}else{r.effects[n].connect(r.effects[e])}n=e}));this.effects[n].connect(this.channelGain)}this.dryGain=this.context.createGain();this.dryGain.connect(this.channelGain);this.channelGain.connect(this.masterGain);i.label=2;case 2:return[2]}}))}))};e.prototype.prepareEffects=function(){return __awaiter(this,void 0,void 0,(function(){var e,t,n;return __generator(this,(function(r){switch(r.label){case 0:if(!(this.element.parentElement.nodeName!=="WEB-AUDIO"))return[3,3];e=this.element.parentElement;r.label=1;case 1:if(!(e.nodeName!=="WEB-AUDIO"))return[3,3];t=this.effects;n=e.getAttribute("name");return[4,e.attachEffect(this.context,this.element)];case 2:t[n]=r.sent();e=e.parentElement;return[3,1];case 3:return[2]}}))}))};Object.defineProperty(e.prototype,"element",{get:function(){return n(this)},enumerable:true,configurable:true});return e}());var Y=function(e){for(var t=0;t<e.analyser.frequencyBinCount;t++){var n=e.freqs[t];var r=n/256;var i=e.height*r*.75;var s=e.height-i+25;var o=e.width/e.analyser.frequencyBinCount+24;e.canvasCTX.fillStyle="hsl("+e._color[0]+", "+e._color[1]+"%, "+r*100+"%)";e.canvasCTX.fillRect(t*o,s,o,i)}};var z=4;var X=4;var V=70;var W=function(e){var t=e.freqs;var n=e.canvas;var r=e.canvasCTX;var i=t.length-~~(t.length/V)*50;var s=e.size;var o=s;var a=~~(i/V);var u=n.width/V;var c=X;var h=n.height-z*2;for(var l=0;l<i;l+=a){var f=t[l]/o;var d=f*h;var p=h/2-d/2;r.beginPath();r.shadowColor="rgba(24, 24, 24, 0.25)";r.shadowBlur=8;r.shadowOffsetX=0;r.shadowOffsetY=2;r.strokeStyle="hsl("+e._color[0]+", "+e._color[1]+"%, "+e._color[2]+"%)";r.lineWidth=X;r.lineCap="round";r.moveTo(c,p);r.lineTo(c,p+d);r.stroke();c+=u}};function F(e){var t=e.reduce((function(e,t){return e+t}));return t/e.length}var U={BAR:{maxHeight:250},CIRCLE:{radius:100,width:15}};var K=function(e){var t=e.analyser.frequencyBinCount;var n=F(e.freqs);var r=n<U.CIRCLE.width?U.CIRCLE.width:n;var i=0;var s=e.width/2;var o=e.height/2;var a=U.CIRCLE.radius*2*Math.PI;var u=a/t;e.canvasCTX.beginPath();e.canvasCTX.arc(s,o,U.CIRCLE.radius,0,Math.PI*2);e.canvasCTX.lineWidth=r;e.canvasCTX.strokeStyle="hsl("+e._color[0]+", "+e._color[1]+"%, "+e._color[2]+"%)";e.canvasCTX.closePath();e.canvasCTX.stroke();e.canvasCTX.save();e.canvasCTX.translate(s,o);for(var c=0;c<e.analyser.frequencyBinCount;c++){var h=e.freqs[c];var l=h>U.BAR.maxHeight?U.BAR.maxHeight:h;e.canvasCTX.rotate(i);e.canvasCTX.fillStyle="hsl("+e._color[0]+", "+e._color[1]+"%, "+e._color[2]+"%)";e.canvasCTX.fillRect(U.CIRCLE.radius+100,u*-1/2,l,u);i=i/(t+u)%360+1}};var Q=function(e){for(var t=0;t<e.analyser.frequencyBinCount;t++){var n=e.times[t];var r=n/512;var i=e.height*r*1.25;var s=e.height-i;var o=e.width/e.analyser.frequencyBinCount+16;e.canvasCTX.fillStyle="hsl("+e._color[0]+", "+e._color[1]+"%, "+e._color[2]+"%)";e.canvasCTX.fillRect(t*o,s,24,24)}};var J=d((function(e){(function(){e.exports=function(e,t,n){var r,i,s,o,a,u;e/=255;t/=255;n/=255;o=Math.max(e,t,n);a=Math.min(e,t,n);i=0;u=0;s=(o+a)/2;if(o===a){i=u=0}else{r=o-a;u=s>.5?r/(2-o-a):r/(o+a);switch(o){case e:i=(t-n)/r+(t<n?6:0);break;case t:i=(n-e)/r+2;break;case n:i=(e-t)/r+4}i/=6}i=Math.ceil(i*360);u=Math.ceil(u*100)+"%";s=Math.ceil(s*100)+"%";return[i,u,s]}}).call(p)}));var Z=function e(t){if(t.charAt&&t.charAt(0)==="#"){t=$(t)}if(t.length===3){t=ee(t)}var n=parseInt(t,16);var r=n>>16&255;var i=n>>8&255;var s=n&255;return[r,i,s]};function $(e){var t=e.split("");t.shift();return t.join("")}function ee(e){return e.split("").reduce((function(e,t){return e.concat([t,t])}),[]).join("")}var te=function(e){var t=J.apply(J,Z(e));return[t[0],parseInt(t[1],10),parseInt(t[2],10)]};var ne=e("web_audio_visualizer",function(){function e(e){var n=this;t(this,e);this.for="web_audio";this.type="wave";this.smoothing=.7;this.size=1024;this.color="white";this.width=1024;this.height=1024;this.clearBackground=function(){n.canvasCTX.clearRect(0,0,n.canvas.width,n.canvas.height);n.canvasCTX.fillStyle="transparent";n.canvasCTX.fillRect(0,0,n.canvas.width,n.canvas.height)}}e.prototype.componentWillLoad=function(){this.handleColorChange()};e.prototype.componentDidLoad=function(){this.canvas=this.element.shadowRoot.querySelector("canvas")};e.prototype.handleColorChange=function(){if(["white","black","black-alt"].includes(this.color)){this._color=te(_[this.color])}else{this._color=te(_[this.color][5])}};e.prototype.connect=function(e,t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){this.context=e;this.analyser=this.context.createAnalyser();if(t){this.analyser.connect(t)}this.freqs=new Uint8Array(this.analyser.frequencyBinCount);this.times=new Uint8Array(this.analyser.frequencyBinCount);this.canvasCTX=this.canvas.getContext("2d");requestAnimationFrame(this.draw.bind(this));return[2,this]}))}))};e.prototype.draw=function(){this.analyser.smoothingTimeConstant=this.smoothing;this.analyser.fftSize=this.size;this.analyser.getByteFrequencyData(this.freqs);this.analyser.getByteTimeDomainData(this.times);this.canvas.width=this.width;this.canvas.height=this.height;this.clearBackground();if(this.type==="wave"){Q(this)}else if(this.type==="bars"){Y(this)}else if(this.type==="bars2"){W(this)}else if(this.type==="circle"){K(this)}requestAnimationFrame(this.draw.bind(this))};e.prototype.getFrequencyValue=function(e){var t=this.context.sampleRate/2;var n=Math.round(e/t*this.freqs.length);return this.freqs[n]};e.prototype.render=function(){return r("canvas",{id:"canvas"})};Object.defineProperty(e.prototype,"element",{get:function(){return n(this)},enumerable:true,configurable:true});Object.defineProperty(e,"watchers",{get:function(){return{color:["handleColorChange"]}},enumerable:true,configurable:true});Object.defineProperty(e,"style",{get:function(){return":host,:host canvas{display:block}:host canvas{width:100%;height:100%}"},enumerable:true,configurable:true});return e}())}}}));