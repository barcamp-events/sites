import{r as s,c as t,h as i,g as a}from"./p-ca3a3989.js";import{a as h}from"./p-3586bef7.js";import"./p-c428ff15.js";import"./p-c93f133f.js";import"./p-22e0cac7.js";import"./p-3a3a4911.js";import"./p-20de5b5b.js";import{T as l}from"./p-9460f5fe.js";const e=class{constructor(i){s(this,i),this.visualizationColor="gray",this.visualizationType="bars",this.autoplay=!1,this.playlist="show",this.name="Playlist",this.remember=!0,this.artwork=!1,this.view="playlist",this.playing=!1,this.load=!1,this.loading=!1,this.dark=!1,this.current=0,this.currentTrack={title:"Loading...",artist:"One sec...",picture:void 0},this.progress_value=0,this.load_songs=t(this,"load_songs",7)}componentWillLoad(){this.loadFromStorage()}componentDidLoad(){this.visualizer=this.element.shadowRoot.querySelector("web-audio-visualizer"),this.audio=this.element.shadowRoot.querySelector("audio"),this.progress=this.element.shadowRoot.querySelector("progress"),this.playlistItems=this.element.querySelectorAll("stellar-song"),this.currentPlaylistItem=this.element.querySelector("stellar-song[playing]"),Array.from(this.playlistItems).forEach((s,t)=>{s.setIndex(t)}),this.audio&&(this.audio.volume=.7);var s=this.element.querySelector("stellar-song[playing]")||this.element.querySelector("stellar-song");s.playing=!0,this.prepare(s),this.autoplay&&this.play(),this.remember&&this.loadFromStorage(),this.handleUpdates(),this.handleProgressClick()}cycleVisualizations(){"circle"===this.visualizationType?this.visualizationType="bars":"bars"===this.visualizationType?this.visualizationType="bars2":"bars2"===this.visualizationType?this.visualizationType="wave":"wave"===this.visualizationType&&(this.visualizationType="circle")}handleProgressClick(){this.progress.addEventListener("click",s=>{this.audio.currentTime=s.offsetX/this.progress.offsetWidth*this.audio.duration})}handleUpdates(){this.audio.addEventListener("update",()=>{this.currentTime=h(parseFloat(this.audio.currentTime.toString()).toFixed(10)),this.duration=h(parseFloat(this.audio.duration.toString()).toFixed(10)),this.progress_value=0!==this.audio.currentTime&&0!==this.audio.duration?this.audio.currentTime/this.audio.duration*100:0}),this.audio.addEventListener("ended",this.next.bind(this))}handleKeydown(s){"space"===s.key?this.pause():"left"===s.key?this.previous():"right"===s.key&&this.next()}async handleSongLoaded(s){const t=s.detail.el;t.playing&&(await this.prepare(t),await this.play(!0))}loadFromStorage(){var s=localStorage.getItem("playlist");"show"!==s&&"hide"!==s||(this.playlist=s)}async prepare(s){this.currentPlaylistItem&&this.currentPlaylistItem.switching(),this.currentTrack={title:"Loading...",artist:"One sec...",picture:void 0},this.currentPlaylistItem=s,this.audio.src=this.currentPlaylistItem.src,await this.audio.load(),this.current=await this.currentPlaylistItem.getIndex(),this.currentPlaylistItem.playing=!0,this.currentTrack=await this.currentPlaylistItem.details()}async play(s=!1){if(s||(this.currentTrack={title:"Loading...",artist:"One sec...",picture:void 0}),this.loading=!0,this.playing=!0,await this.audio.play(),!this.context){const s=new(window.AudioContext||window.webkitAudioContext),t=s.createMediaElementSource(this.audio),i=await this.visualizer.connect(s);t.connect(i.analyser),i.analyser.connect(s.destination),this.context=s}this.currentTrack=await this.currentPlaylistItem.details(),this.loading=!1}async pause(){this.audio.paused?(this.playing=!0,await this.audio.play()):(this.playing=!1,await this.audio.pause())}async next(){var s;s=this.element.querySelector("stellar-song[playing]"),s=this.current===this.playlistItems.length-1?this.element.querySelector("stellar-song:first-child"):s.nextElementSibling,await s.play()}async previous(){var s;(s=this.element.querySelector("stellar-song[playing]")).removeAttribute("playing"),(s=0===this.current?this.element.querySelector("stellar-song:last-child"):s.previousElementSibling).setAttribute("playing",!0),s.play()}togglePlaylist(){this.playlist="show"===this.playlist?"hide":"show",localStorage.setItem("playlist",this.playlist)}toggleAlbumArtView(){this.view="playlist"===this.view?"art":"playlist"}async handlePlay(){this.load||(this.load=!0,this.load_songs.emit({})),this.pause()}render(){return i("div",{id:"player"},i("div",{class:"playlist-title"},i("h6",null,this.name),i("button",{class:"playlist",onClick:()=>this.togglePlaylist()},i("h6",{class:"list"},i("stellar-asset",{name:"musical-notes"}),"list")),i("button",{class:"switch-view",onClick:()=>this.toggleAlbumArtView(),"data-playing":this.playing},i("h6",{class:"list"},i("stellar-asset","art"===this.view?{name:"albums"}:{name:"radio"}),"art"===this.view?"Art":"Player")),i("stellar-color-picker",{val:this.visualizationColor,notransparent:!0,onUpdate:s=>{this.visualizationColor=s.detail}})),i("div",{class:"playlist-playing"},i("button",{onClick:()=>{this.handlePlay()},class:"toggle-button","data-playing":this.playing},i("stellar-asset",this.playing?{name:"pause"}:{name:"play"})),!this.load&&i("stellar-button",{tag:"button",size:"tiny",onClick:()=>{this.load=!0,this.load_songs.emit({})}},"Load ",this.name||"this playlist"),this.load&&i("div",{class:"playlist-playing-details"},i("h2",null,this.currentTrack.title||"Loading..."),i("h3",null,this.currentTrack.artist||"One Sec...")),this.load&&i("div",{class:"playlist-playing-image"},this.loading&&i("stellar-progress",{indeterminate:!0}),!this.loading&&void 0!==this.currentTrack.picture&&i("img",{src:this.currentTrack.picture,onClick:()=>this.toggleAlbumArtView()})),!this.load&&void 0===this.currentTrack.picture&&i("skeleton-img",{width:1024,height:1024,block:!0,loading:!0}),i("web-audio-visualizer",{type:this.visualizationType,color:this.visualizationColor,onClick:()=>{this.cycleVisualizations()},width:1024,height:"art"===this.view?1024:256}),i("div",{class:`playlist-progress ${this.load?"load":"noload"}`},i("h6",{id:"currentTime"},this.currentTime),i("h6",{id:"totalTime"},this.duration),i("progress",{id:"progress",max:"100",value:this.progress_value}))),i("div",{id:"controls",class:"controls"},i("button",{onClick:()=>this.previous(),class:"button previous"},i("stellar-asset",{name:"skip-backward"})),i("button",{onClick:()=>this.next(),class:"button next"},i("stellar-asset",{name:"skip-forward"}))),i("audio",{id:"playlist-audio",preload:"auto",tabindex:"0",controls:!0},i("source",{id:"source",type:"audio/mp3"})),i("div",{id:"playlist",class:`playlist-list ${this.playlist}`},this.load&&i("slot",null)))}get element(){return a(this)}static get style(){return":host,:host *{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-box-sizing:border-box;box-sizing:border-box}:host{--color-one:var(--theme-base1);--color-two:var(--theme-base9);--color-three:var(--theme-base5);--color-four:var(--theme-base7);--color-bg:var(--theme-base0);--color-bg-active:var(--theme-base1);--color-bg-playing:var(--theme-base2);--color-line:var(--theme-base1)}:host([dark]){--color-one:var(--theme-base9);--color-two:var(--theme-base1);--color-three:var(--theme-base7);--color-four:var(--theme-base2);--color-bg:var(--black-alt);--color-bg-active:var(--theme-base8);--color-bg-playing:var(--theme-base8);--color-line:var(--black)}:host{display:block;-webkit-box-sizing:border-box;box-sizing:border-box;background:var(--color-bg);max-width:650px;width:100%;margin:0 auto}:host button{-webkit-appearance:none;-moz-appearance:none;appearance:none;background:none;outline:0;border:0;cursor:pointer}:host button.playlist{margin:0 .5rem 0 auto}:host button.switch-view{margin:0 .5rem 0 0}:host audio{display:none}:host #player{position:relative}:host stellar-color-picker{z-index:99}:host web-audio-visualizer{height:0;margin-top:1rem;opacity:0;-webkit-transition:all .25s var(--ease) 0s;transition:all .25s var(--ease) 0s;width:100%}:host([playing]) web-audio-visualizer{opacity:1;height:10rem}:host h6{font-size:.75rem;margin:0;text-transform:uppercase;color:var(--color-two);letter-spacing:.23em;z-index:1}:host h6.list{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center}:host h6.list stellar-asset{margin-right:.5rem}:host .playlist-playing,:host .playlist-playing-details,:host .playlist-progress,:host .playlist-title{-webkit-transition:all .1875s ease-in-out 0s;transition:all .1875s ease-in-out 0s}:host .playlist-playing-image{-webkit-transition:all .25s ease-in-out 0s;transition:all .25s ease-in-out 0s}:host .playlist-title{background:var(--color-one);height:3rem;display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:justify;justify-content:space-between;padding:.5rem 1rem}:host .playlist-playing-details{margin-right:30px}:host .playlist-playing{display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;-ms-flex-align:center;align-items:center;padding:2rem 1rem 3rem;position:relative}:host .playlist-playing h2,:host .playlist-playing h3{font-weight:400;margin:0}:host .playlist-playing h2{color:var(--color-two);font-weight:700;font-size:17px;overflow:hidden;width:100%}:host .playlist-playing h3{color:var(--color-four);font-size:16px;overflow:hidden;width:100%}:host .playlist-progress{display:-ms-flexbox;display:flex;position:absolute;-ms-flex-align:baseline;align-items:baseline;-ms-flex-pack:justify;justify-content:space-between;width:100%;padding:0 15px 15px;z-index:5;bottom:0;left:0;-webkit-transition:all .1s ease 0s;transition:all .1s ease 0s;opacity:0;-webkit-transform:translateY(-10px);transform:translateY(-10px);max-height:0}:host .playlist-progress.load{opacity:1;-webkit-transform:translateY(0);transform:translateY(0);max-height:100px}:host .playlist-progress progress{-webkit-appearance:none;-moz-appearance:none;appearance:none;position:absolute;height:3px;bottom:0;left:0;width:100%;-webkit-transition:all 75ms ease-in-out .25s;transition:all 75ms ease-in-out .25s;cursor:pointer;z-index:2}:host .playlist-progress progress:hover{-webkit-transition:all 75ms ease-in-out 0s;transition:all 75ms ease-in-out 0s;height:16px;bottom:-8px}:host .playlist-progress progress[value]::-moz-progress-bar{background-color:var(--color-line)}:host .playlist-progress progress[value]::-webkit-progress-bar{background-color:var(--color-line)}:host .playlist-progress progress[value]::-webkit-progress-value{background-color:var(--color-three)}:host .playlist-list{max-height:24rem;overflow:auto;-webkit-transition:all .2s ease 0s;transition:all .2s ease 0s}:host .playlist-list.hide{max-height:0}:host .controls{display:-ms-flexbox;display:flex;display:none;margin:1em 0}:host .controls .button{font-size:2rem;width:50%;-ms-flex:12 6 200px;flex:12 6 200px}:host .controls .button stellar-asset{display:inline-block}:host .playlist-playing-image{margin:auto 0 auto auto;width:5rem;-ms-flex:0 0 5rem;flex:0 0 5rem;height:5rem;cursor:pointer}:host .playlist-playing-image img{width:100%;background:#fff;border-radius:3px;height:auto;-webkit-box-shadow:0 3px 3px 0 hsla(0,0%,91%,.6);box-shadow:0 3px 3px 0 hsla(0,0%,91%,.6)}:host .playlist-playing .toggle-button{padding:0;margin-right:2rem;width:3rem;height:3rem;padding:14px;border-radius:100%;background:var(--color-three);color:#fff;position:relative}:host .playlist-playing .toggle-button stellar-asset{font-size:2rem;position:absolute;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}:host .playlist-playing .toggle-button stellar-asset[name=play]{-webkit-transform:translate(-43%,-50%);transform:translate(-43%,-50%)}:host .playlist-playing .toggle-button[data-playing=false]{padding:14px 12px 14px 16px}:host .st0{fill:var(--color-three)}:host .st1{fill:#fff}:host skeleton-img{display:none}:host([view=art]) .playlist-playing{position:relative;margin:0;padding:0;overflow:hidden}:host([view=art]) web-audio-visualizer{height:100%;position:absolute;bottom:0;z-index:2;-webkit-transition:all 0s var(--ease) 0s;transition:all 0s var(--ease) 0s}:host([view=art]) .playlist-playing .toggle-button{display:none}:host([view=art]) .playlist-playing .playlist-playing-details{position:absolute;bottom:0;width:100%;padding:2rem;background:var(--color-one);left:0;right:0;text-align:center;mix-blend-mode:hard-light;margin:0;-webkit-transform:translateY(100%);transform:translateY(100%);z-index:3}:host([view=art]:hover) .playlist-playing-details{-webkit-transform:translateY(0);transform:translateY(0)}:host([view=art]) .playlist-progress{padding:0 15px 0}:host([view=art]) .playlist-progress h6{display:none}:host([view=art]) .playlist-playing stellar-button{position:absolute;left:50%;top:50%;z-index:3;-webkit-transform:translate(-50%,-50%)!important;transform:translate(-50%,-50%)!important}:host([view=art]) .playlist-playing-image,:host([view=art]) skeleton-img{display:block;width:100%;margin:0 auto;-ms-flex:none;flex:none;height:0;padding-bottom:100%}:host([view=art]) .playlist-playing-image:focus,:host([view=art]) .playlist-playing-image:hover{-webkit-transform:scale(1.025);transform:scale(1.025);cursor:pointer}:host([view=art]) .playlist-playing-image img{width:100%}:host([view=art]) .controls{display:none}:host([dark]) .playlist-playing-image img{-webkit-box-shadow:0 3px 3px 0 rgba(24,24,24,.6);box-shadow:0 3px 3px 0 rgba(24,24,24,.6)}:host([dark]) web-audio-visualizer{-webkit-filter:hue-rotate(180deg) invert(80%);filter:hue-rotate(180deg) invert(80%)}"}};l.injectProps(e,["dark"]);export{e as stellar_playlist};