var __awaiter=this&&this.__awaiter||function(e,t,r,n){function i(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n["throw"](e))}catch(e){a(e)}}function u(e){e.done?r(e.value):i(e.value).then(o,s)}u((n=n.apply(e,t||[])).next())}))};var __generator=this&&this.__generator||function(e,t){var r={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol==="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(e){return function(t){return u([e,t])}}function u(o){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,i&&(a=o[0]&2?i["return"]:o[0]?i["throw"]||((a=i["return"])&&a.call(i),0):i.next)&&!(a=a.call(i,o[1])).done)return a;if(i=0,a)o=[o[0]&2,a.value];switch(o[0]){case 0:case 1:a=o;break;case 4:r.label++;return{value:o[1],done:false};case 5:r.label++;i=o[1];o=[0];continue;case 7:o=r.ops.pop();r.trys.pop();continue;default:if(!(a=r.trys,a=a.length>0&&a[a.length-1])&&(o[0]===6||o[0]===2)){r=0;continue}if(o[0]===3&&(!a||o[1]>a[0]&&o[1]<a[3])){r.label=o[1];break}if(o[0]===6&&r.label<a[1]){r.label=a[1];a=o;break}if(a&&r.label<a[2]){r.label=a[2];r.ops.push(o);break}if(a[2])r.ops.pop();r.trys.pop();continue}o=t.call(e,r)}catch(e){o=[6,e];i=0}finally{n=a=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:true}}};System.register(["./p-94e3dad1.system.js","./p-5cf15a0c.system.js","./p-752b9e3e.system.js","./p-fdba8b89.system.js","./p-bd9c4de0.system.js","./p-49be6f75.system.js"],(function(e){"use strict";var t,r,n,i,a,o;return{setters:[function(e){t=e.r;r=e.e;n=e.h;i=e.g},function(e){a=e.r;o=e.l},function(){},function(){},function(){},function(){}],execute:function(){(function(t){"object"===typeof e&&"undefined"!==typeof module?module.exports=t():"function"===typeof define&&define.amd?define([],t):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).jsmediatags=t()})((function(){return function e(t,r,n){function i(o,s){if(!r[o]){if(!t[o]){var u="function"==typeof require&&require;if(!s&&u)return u(o,!0);if(a)return a(o,!0);s=Error("Cannot find module '"+o+"'");throw s.code="MODULE_NOT_FOUND",s}s=r[o]={exports:{}};t[o][0].call(s.exports,(function(e){var r=t[o][1][e];return i(r?r:e)}),s,s.exports,e,t,r,n)}return r[o].exports}for(var a="function"==typeof require&&require,o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,r){},{}],2:[function(e,t,r){t.exports=XMLHttpRequest},{}],3:[function(e,t,r){function n(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}});t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}return function(t,r,n){r&&e(t.prototype,r);n&&e(t,n);return t}}();e=function(e){function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");var r=(t.__proto__||Object.getPrototypeOf(t)).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");r=!r||"object"!==typeof r&&"function"!==typeof r?this:r;r._array=e;r._size=e.length;r._isInitialized=!0;return r}n(t,e);i(t,[{key:"init",value:function(e){setTimeout(e.onSuccess,0)}},{key:"loadRange",value:function(e,t){setTimeout(t.onSuccess,0)}},{key:"getByteAt",value:function(e){if(e>=this._array.length)throw Error("Offset "+e+" hasn't been loaded yet.");return this._array[e]}}],[{key:"canReadFile",value:function(e){return Array.isArray(e)||"function"===typeof Buffer&&Buffer.isBuffer(e)}}]);return t}(e("./MediaFileReader"));t.exports=e},{"./MediaFileReader":11}],4:[function(e,t,r){function n(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}});t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}return function(t,r,n){r&&e(t.prototype,r);n&&e(t,n);return t}}(),a=e("./ChunkedFileData");e=function(e){function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");var r=(t.__proto__||Object.getPrototypeOf(t)).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");r=!r||"object"!==typeof r&&"function"!==typeof r?this:r;r._blob=e;r._fileData=new a;return r}n(t,e);i(t,[{key:"_init",value:function(e){this._size=this._blob.size;setTimeout(e.onSuccess,1)}},{key:"loadRange",value:function(e,t){var r=this,n=(this._blob.slice||this._blob.mozSlice||this._blob.webkitSlice).call(this._blob,e[0],e[1]+1),i=new FileReader;i.onloadend=function(n){n=new Uint8Array(i.result);r._fileData.addData(e[0],n);t.onSuccess()};i.onerror=i.onabort=function(e){if(t.onError)t.onError({type:"blob",info:i.error})};i.readAsArrayBuffer(n)}},{key:"getByteAt",value:function(e){return this._fileData.getByteAt(e)}}],[{key:"canReadFile",value:function(e){return"undefined"!==typeof Blob&&e instanceof Blob||"undefined"!==typeof File&&e instanceof File}}]);return t}(e("./MediaFileReader"));t.exports=e},{"./ChunkedFileData":5,"./MediaFileReader":11}],5:[function(e,t,r){var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}return function(t,r,n){r&&e(t.prototype,r);n&&e(t,n);return t}}();e=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this._fileData=[]}n(e,null,[{key:"NOT_FOUND",get:function(){return-1}}]);n(e,[{key:"addData",value:function(e,t){var r=e+t.length-1,n=this._getChunkRange(e,r);if(-1===n.startIx)this._fileData.splice(n.insertIx||0,0,{offset:e,data:t});else{var i=this._fileData[n.startIx],a=this._fileData[n.endIx];r=r<a.offset+a.data.length-1;var o={offset:Math.min(e,i.offset),data:t};e>i.offset&&(e=this._sliceData(i.data,0,e-i.offset),o.data=this._concatData(e,t));r&&(e=this._sliceData(o.data,0,a.offset-o.offset),o.data=this._concatData(e,a.data));this._fileData.splice(n.startIx,n.endIx-n.startIx+1,o)}}},{key:"_concatData",value:function(e,t){if("undefined"!==typeof ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(e)){var r=new e.constructor(e.length+t.length);r.set(e,0);r.set(t,e.length);return r}return e.concat(t)}},{key:"_sliceData",value:function(e,t,r){return e.slice?e.slice(t,r):e.subarray(t,r)}},{key:"_getChunkRange",value:function(e,t){for(var r,n,i=-1,a=-1,o=0,s=0;s<this._fileData.length;s++,o=s){n=this._fileData[s].offset;r=n+this._fileData[s].data.length;if(t<n-1)break;if(e<=r+1&&t>=n-1){i=s;break}}if(-1===i)return{startIx:-1,endIx:-1,insertIx:o};for(s=i;s<this._fileData.length&&!(n=this._fileData[s].offset,r=n+this._fileData[s].data.length,t>=n-1&&(a=s),t<=r+1);s++);-1===a&&(a=i);return{startIx:i,endIx:a}}},{key:"hasDataRange",value:function(e,t){for(var r=0;r<this._fileData.length;r++){var n=this._fileData[r];if(t<n.offset)break;if(e>=n.offset&&t<n.offset+n.data.length)return!0}return!1}},{key:"getByteAt",value:function(e){for(var t,r=0;r<this._fileData.length;r++){var n=this._fileData[r].offset,i=n+this._fileData[r].data.length-1;if(e>=n&&e<=i){t=this._fileData[r];break}}if(t)return t.data[e-t.offset];throw Error("Offset "+e+" hasn't been loaded yet.")}}]);return e}();t.exports=e},{}],6:[function(e,t,r){function n(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}});t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}return function(t,r,n){r&&e(t.prototype,r);n&&e(t,n);return t}}(),a=[4,132],o=[6,134],s="Other;32x32 pixels 'file icon' (PNG only);Other file icon;Cover (front);Cover (back);Leaflet page;Media (e.g. label side of CD);Lead artist/lead performer/soloist;Artist/performer;Conductor;Band/Orchestra;Composer;Lyricist/text writer;Recording Location;During recording;During performance;Movie/video screen capture;A bright coloured fish;Illustration;Band/artist logotype;Publisher/Studio logotype".split(";");e=function(e){function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");var e=(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?this:e}n(t,e);i(t,[{key:"_loadData",value:function(e,t){var r=this;e.loadRange([4,7],{onSuccess:function(){r._loadBlock(e,4,t)}})}},{key:"_loadBlock",value:function(e,t,r){var n=this,i=e.getByteAt(t),s=e.getInteger24At(t+1,!0);if(-1!==a.indexOf(i)){var u=t+4;e.loadRange([u,u+s],{onSuccess:function(){n._commentOffset=u;n._nextBlock(e,t,i,s,r)}})}else-1!==o.indexOf(i)?(u=t+4,e.loadRange([u,u+s],{onSuccess:function(){n._pictureOffset=u;n._nextBlock(e,t,i,s,r)}})):n._nextBlock(e,t,i,s,r)}},{key:"_nextBlock",value:function(e,t,r,n,i){var a=this;if(127<r)if(a._commentOffset)i.onSuccess();else i.onError({type:"loadData",info:"Comment block could not be found."});else e.loadRange([t+4+n,t+4+4+n],{onSuccess:function(){a._loadBlock(e,t+4+n,i)}})}},{key:"_parseData",value:function(e,t){var r=e.getLongAt(this._commentOffset,!1)+(this._commentOffset+4);t=e.getLongAt(r,!1);r+=4;for(var n,i,a,o,u,c,l=0;l<t;l++){var f=e.getLongAt(r,!1),d=e.getStringWithCharsetAt(r+4,f,"utf-8").toString(),g=d.indexOf("=");d=[d.slice(0,g),d.slice(g+1)];switch(d[0]){case"TITLE":n=d[1];break;case"ARTIST":i=d[1];break;case"ALBUM":a=d[1];break;case"TRACKNUMBER":o=d[1];break;case"GENRE":u=d[1]}r+=4+f}this._pictureOffset&&(c=e.getLongAt(this._pictureOffset,!0),t=this._pictureOffset+4,r=e.getLongAt(t,!0),l=t+4,t=e.getStringAt(l,r),r=l+r,l=e.getLongAt(r,!0),f=r+4,r=e.getStringWithCharsetAt(f,l,"utf-8").toString(),l=f+l+16,f=e.getLongAt(l,!0),e=e.getBytesAt(l+4,f,!0),c={format:t,type:s[c],description:r,data:e});return{type:"FLAC",version:"1",tags:{title:n,artist:i,album:a,track:o,genre:u,picture:c}}}}],[{key:"getTagIdentifierByteRange",value:function(){return{offset:0,length:4}}},{key:"canReadTagFormat",value:function(e){return"fLaC"===String.fromCharCode.apply(String,e.slice(0,4))}}]);return t}(e("./MediaTagReader"));t.exports=e},{"./MediaTagReader":12}],7:[function(e,t,r){function n(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}});t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}return function(t,r,n){r&&e(t.prototype,r);n&&e(t,n);return t}}();r=e("./MediaTagReader");e("./MediaFileReader");e=function(e){function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");var e=(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?this:e}n(t,e);i(t,[{key:"_loadData",value:function(e,t){var r=e.getSize();e.loadRange([r-128,r-1],t)}},{key:"_parseData",value:function(e,t){var r=e.getSize()-128,n=e.getStringWithCharsetAt(r+3,30).toString(),i=e.getStringWithCharsetAt(r+33,30).toString(),o=e.getStringWithCharsetAt(r+63,30).toString(),s=e.getStringWithCharsetAt(r+93,4).toString();var u=e.getByteAt(r+97+28);t=e.getByteAt(r+97+29);if(0==u&&0!=t){var c="1.1";u=e.getStringWithCharsetAt(r+97,28).toString()}else c="1.0",u=e.getStringWithCharsetAt(r+97,30).toString(),t=0;e=e.getByteAt(r+97+30);e={type:"ID3",version:c,tags:{title:n,artist:i,album:o,year:s,comment:u,genre:255>e?a[e]:""}};t&&(e.tags.track=t);return e}}],[{key:"getTagIdentifierByteRange",value:function(){return{offset:-128,length:128}}},{key:"canReadTagFormat",value:function(e){return"TAG"===String.fromCharCode.apply(String,e.slice(0,3))}}]);return t}(r);var a="Blues;Classic Rock;Country;Dance;Disco;Funk;Grunge;Hip-Hop;Jazz;Metal;New Age;Oldies;Other;Pop;R&B;Rap;Reggae;Rock;Techno;Industrial;Alternative;Ska;Death Metal;Pranks;Soundtrack;Euro-Techno;Ambient;Trip-Hop;Vocal;Jazz+Funk;Fusion;Trance;Classical;Instrumental;Acid;House;Game;Sound Clip;Gospel;Noise;AlternRock;Bass;Soul;Punk;Space;Meditative;Instrumental Pop;Instrumental Rock;Ethnic;Gothic;Darkwave;Techno-Industrial;Electronic;Pop-Folk;Eurodance;Dream;Southern Rock;Comedy;Cult;Gangsta;Top 40;Christian Rap;Pop/Funk;Jungle;Native American;Cabaret;New Wave;Psychadelic;Rave;Showtunes;Trailer;Lo-Fi;Tribal;Acid Punk;Acid Jazz;Polka;Retro;Musical;Rock & Roll;Hard Rock;Folk;Folk-Rock;National Folk;Swing;Fast Fusion;Bebob;Latin;Revival;Celtic;Bluegrass;Avantgarde;Gothic Rock;Progressive Rock;Psychedelic Rock;Symphonic Rock;Slow Rock;Big Band;Chorus;Easy Listening;Acoustic;Humour;Speech;Chanson;Opera;Chamber Music;Sonata;Symphony;Booty Bass;Primus;Porn Groove;Satire;Slow Jam;Club;Tango;Samba;Folklore;Ballad;Power Ballad;Rhythmic Soul;Freestyle;Duet;Punk Rock;Drum Solo;Acapella;Euro-House;Dance Hall".split(";");t.exports=e},{"./MediaFileReader":11,"./MediaTagReader":12}],8:[function(e,t,r){function n(e){switch(e){case 0:e="iso-8859-1";break;case 1:e="utf-16";break;case 2:e="utf-16be";break;case 3:e="utf-8";break;default:e="iso-8859-1"}return e}function i(e,t,r,n){n=r.getStringWithCharsetAt(e+1,t-1,n);e=r.getStringWithCharsetAt(e+1+n.bytesReadCount,t-1-n.bytesReadCount);return{user_description:n.toString(),data:e.toString()}}var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}return function(t,r,n){r&&e(t.prototype,r);n&&e(t,n);return t}}();e("./MediaFileReader");var o=e("./StringUtils"),s=e("./ArrayFileReader"),u={BUF:"Recommended buffer size",CNT:"Play counter",COM:"Comments",CRA:"Audio encryption",CRM:"Encrypted meta frame",ETC:"Event timing codes",EQU:"Equalization",GEO:"General encapsulated object",IPL:"Involved people list",LNK:"Linked information",MCI:"Music CD Identifier",MLL:"MPEG location lookup table",PIC:"Attached picture",POP:"Popularimeter",REV:"Reverb",RVA:"Relative volume adjustment",SLT:"Synchronized lyric/text",STC:"Synced tempo codes",TAL:"Album/Movie/Show title",TBP:"BPM (Beats Per Minute)",TCM:"Composer",TCO:"Content type",TCR:"Copyright message",TDA:"Date",TDY:"Playlist delay",TEN:"Encoded by",TFT:"File type",TIM:"Time",TKE:"Initial key",TLA:"Language(s)",TLE:"Length",TMT:"Media type",TOA:"Original artist(s)/performer(s)",TOF:"Original filename",TOL:"Original Lyricist(s)/text writer(s)",TOR:"Original release year",TOT:"Original album/Movie/Show title",TP1:"Lead artist(s)/Lead performer(s)/Soloist(s)/Performing group",TP2:"Band/Orchestra/Accompaniment",TP3:"Conductor/Performer refinement",TP4:"Interpreted, remixed, or otherwise modified by",TPA:"Part of a set",TPB:"Publisher",TRC:"ISRC (International Standard Recording Code)",TRD:"Recording dates",TRK:"Track number/Position in set",TSI:"Size",TSS:"Software/hardware and settings used for encoding",TT1:"Content group description",TT2:"Title/Songname/Content description",TT3:"Subtitle/Description refinement",TXT:"Lyricist/text writer",TXX:"User defined text information frame",TYE:"Year",UFI:"Unique file identifier",ULT:"Unsychronized lyric/text transcription",WAF:"Official audio file webpage",WAR:"Official artist/performer webpage",WAS:"Official audio source webpage",WCM:"Commercial information",WCP:"Copyright/Legal information",WPB:"Publishers official webpage",WXX:"User defined URL link frame",AENC:"Audio encryption",APIC:"Attached picture",ASPI:"Audio seek point index",CHAP:"Chapter",CTOC:"Table of contents",COMM:"Comments",COMR:"Commercial frame",ENCR:"Encryption method registration",EQU2:"Equalisation (2)",EQUA:"Equalization",ETCO:"Event timing codes",GEOB:"General encapsulated object",GRID:"Group identification registration",IPLS:"Involved people list",LINK:"Linked information",MCDI:"Music CD identifier",MLLT:"MPEG location lookup table",OWNE:"Ownership frame",PRIV:"Private frame",PCNT:"Play counter",POPM:"Popularimeter",POSS:"Position synchronisation frame",RBUF:"Recommended buffer size",RVA2:"Relative volume adjustment (2)",RVAD:"Relative volume adjustment",RVRB:"Reverb",SEEK:"Seek frame",SYLT:"Synchronized lyric/text",SYTC:"Synchronized tempo codes",TALB:"Album/Movie/Show title",TBPM:"BPM (beats per minute)",TCOM:"Composer",TCON:"Content type",TCOP:"Copyright message",TDAT:"Date",TDLY:"Playlist delay",TDRC:"Recording time",TDRL:"Release time",TDTG:"Tagging time",TENC:"Encoded by",TEXT:"Lyricist/Text writer",TFLT:"File type",TIME:"Time",TIPL:"Involved people list",TIT1:"Content group description",TIT2:"Title/songname/content description",TIT3:"Subtitle/Description refinement",TKEY:"Initial key",TLAN:"Language(s)",TLEN:"Length",TMCL:"Musician credits list",TMED:"Media type",TMOO:"Mood",TOAL:"Original album/movie/show title",TOFN:"Original filename",TOLY:"Original lyricist(s)/text writer(s)",TOPE:"Original artist(s)/performer(s)",TORY:"Original release year",TOWN:"File owner/licensee",TPE1:"Lead performer(s)/Soloist(s)",TPE2:"Band/orchestra/accompaniment",TPE3:"Conductor/performer refinement",TPE4:"Interpreted, remixed, or otherwise modified by",TPOS:"Part of a set",TPRO:"Produced notice",TPUB:"Publisher",TRCK:"Track number/Position in set",TRDA:"Recording dates",TRSN:"Internet radio station name",TRSO:"Internet radio station owner",TSOA:"Album sort order",TSOP:"Performer sort order",TSOT:"Title sort order",TSIZ:"Size",TSRC:"ISRC (international standard recording code)",TSSE:"Software/Hardware and settings used for encoding",TSST:"Set subtitle",TYER:"Year",TXXX:"User defined text information frame",UFID:"Unique file identifier",USER:"Terms of use",USLT:"Unsychronized lyric/text transcription",WCOM:"Commercial information",WCOP:"Copyright/Legal information",WOAF:"Official audio file webpage",WOAR:"Official artist/performer webpage",WOAS:"Official audio source webpage",WORS:"Official internet radio station homepage",WPAY:"Payment",WPUB:"Publishers official webpage",WXXX:"User defined URL link frame"};e=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function")}a(e,null,[{key:"getFrameReaderFunction",value:function(e){return e in c?c[e]:"T"===e[0]?c["T*"]:"W"===e[0]?c["W*"]:null}},{key:"readFrames",value:function(t,r,n,i,a){for(var o={},s=this._getFrameHeaderSize(i);t<r-s;){var u=this._readFrameHeader(n,t,i),c=u.id;if(!c)break;var l=u.flags,f=u.size,d=t+u.headerSize,g=n;t+=u.headerSize+u.size;if(!a||-1!==a.indexOf(c)){if("MP3e"===c||"\0MP3"===c||"\0\0MP"===c||" MP3"===c)break;l&&l.format.unsynchronisation&&(g=this.getUnsyncFileReader(g,d,f),d=0,f=g.getSize());l&&l.format.data_length_indicator&&(d+=4,f-=4);l=(u=e.getFrameReaderFunction(c))?u.apply(this,[d,f,g,l,i]):null;d=this._getFrameDescription(c);f={id:c,size:f,description:d,data:l};c in o?(o[c].id&&(o[c]=[o[c]]),o[c].push(f)):o[c]=f}}return o}},{key:"_getFrameHeaderSize",value:function(e){e=e.major;return 2==e?6:3==e||4==e?10:0}},{key:"_readFrameHeader",value:function(e,t,r){var n=r.major,i=null;r=this._getFrameHeaderSize(r);switch(n){case 2:var a=e.getStringAt(t,3);var o=e.getInteger24At(t+3,!0);break;case 3:a=e.getStringAt(t,4);o=e.getLongAt(t+4,!0);break;case 4:a=e.getStringAt(t,4),o=e.getSynchsafeInteger32At(t+4)}if(a==String.fromCharCode(0,0,0)||a==String.fromCharCode(0,0,0,0))a="";a&&2<n&&(i=this._readFrameFlags(e,t+8));return{id:a||"",size:o||0,headerSize:r||0,flags:i}}},{key:"_readFrameFlags",value:function(e,t){return{message:{tag_alter_preservation:e.isBitSetAt(t,6),file_alter_preservation:e.isBitSetAt(t,5),read_only:e.isBitSetAt(t,4)},format:{grouping_identity:e.isBitSetAt(t+1,7),compression:e.isBitSetAt(t+1,3),encryption:e.isBitSetAt(t+1,2),unsynchronisation:e.isBitSetAt(t+1,1),data_length_indicator:e.isBitSetAt(t+1,0)}}}},{key:"_getFrameDescription",value:function(e){return e in u?u[e]:"Unknown"}},{key:"getUnsyncFileReader",value:function(e,t,r){e=e.getBytesAt(t,r);for(t=0;t<e.length-1;t++)255===e[t]&&0===e[t+1]&&e.splice(t+1,1);return new s(e)}}]);return e}();var c={APIC:function(e,t,r,i,a){i=e;var o=n(r.getByteAt(e));switch(a&&a.major){case 2:a=r.getStringAt(e+1,3);e+=4;break;case 3:case 4:a=r.getStringWithCharsetAt(e+1,t-1);e+=1+a.bytesReadCount;break;default:throw Error("Couldn't read ID3v2 major version.")}var s=r.getByteAt(e);s=l[s];o=r.getStringWithCharsetAt(e+1,t-(e-i)-1,o);e+=1+o.bytesReadCount;return{format:a.toString(),type:s,description:o.toString(),data:r.getBytesAt(e,i+t-e)}},CHAP:function(e,t,r,n,i){n=e;var a={},s=o.readNullTerminatedString(r.getBytesAt(e,t));a.id=s.toString();e+=s.bytesReadCount;a.startTime=r.getLongAt(e,!0);e+=4;a.endTime=r.getLongAt(e,!0);e+=4;a.startOffset=r.getLongAt(e,!0);e+=4;a.endOffset=r.getLongAt(e,!0);e+=4;a.subFrames=this.readFrames(e,e+(t-(e-n)),r,i);return a},CTOC:function(e,t,r,n,i){n=e;var a={childElementIds:[],id:void 0,topLevel:void 0,ordered:void 0,entryCount:void 0,subFrames:void 0},s=o.readNullTerminatedString(r.getBytesAt(e,t));a.id=s.toString();e+=s.bytesReadCount;a.topLevel=r.isBitSetAt(e,1);a.ordered=r.isBitSetAt(e,0);e++;a.entryCount=r.getByteAt(e);e++;for(s=0;s<a.entryCount;s++){var u=o.readNullTerminatedString(r.getBytesAt(e,t-(e-n)));a.childElementIds.push(u.toString());e+=u.bytesReadCount}a.subFrames=this.readFrames(e,e+(t-(e-n)),r,i);return a},COMM:function(e,t,r,i,a){var o=e,s=n(r.getByteAt(e));i=r.getStringAt(e+1,3);a=r.getStringWithCharsetAt(e+4,t-4,s);e+=4+a.bytesReadCount;e=r.getStringWithCharsetAt(e,o+t-e,s);return{language:i,short_description:a.toString(),text:e.toString()}}};c.COM=c.COMM;c.PIC=function(e,t,r,n,i){return c.APIC(e,t,r,n,i)};c.PCNT=function(e,t,r,n,i){return r.getLongAt(e,!1)};c.CNT=c.PCNT;c["T*"]=function(e,t,r,i,a){i=n(r.getByteAt(e));return r.getStringWithCharsetAt(e+1,t-1,i).toString()};c.TXXX=function(e,t,r,a,o){a=n(r.getByteAt(e));return i(e,t,r,a)};c.WXXX=function(e,t,r,a,o){if(0===t)return null;a=n(r.getByteAt(e));return i(e,t,r,a)};c["W*"]=function(e,t,r,n,i){return 0===t?null:r.getStringWithCharsetAt(e,t,"iso-8859-1").toString()};c.TCON=function(e,t,r,n){return c["T*"].apply(this,arguments).replace(/^\(\d+\)/,"")};c.TCO=c.TCON;c.USLT=function(e,t,r,i,a){var o=e,s=n(r.getByteAt(e));i=r.getStringAt(e+1,3);a=r.getStringWithCharsetAt(e+4,t-4,s);e+=4+a.bytesReadCount;e=r.getStringWithCharsetAt(e,o+t-e,s);return{language:i,descriptor:a.toString(),lyrics:e.toString()}};c.ULT=c.USLT;c.UFID=function(e,t,r,n,i){n=o.readNullTerminatedString(r.getBytesAt(e,t));e+=n.bytesReadCount;e=r.getBytesAt(e,t-n.bytesReadCount);return{ownerIdentifier:n.toString(),identifier:e}};var l="Other;32x32 pixels 'file icon' (PNG only);Other file icon;Cover (front);Cover (back);Leaflet page;Media (e.g. label side of CD);Lead artist/lead performer/soloist;Artist/performer;Conductor;Band/Orchestra;Composer;Lyricist/text writer;Recording Location;During recording;During performance;Movie/video screen capture;A bright coloured fish;Illustration;Band/artist logotype;Publisher/Studio logotype".split(";");t.exports=e},{"./ArrayFileReader":3,"./MediaFileReader":11,"./StringUtils":13}],9:[function(e,t,r){function n(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}});t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}return function(t,r,n){r&&e(t.prototype,r);n&&e(t,n);return t}}();r=e("./MediaTagReader");e("./MediaFileReader");var a=e("./ID3v2FrameReader");e=function(e){function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");var e=(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?this:e}n(t,e);i(t,[{key:"_loadData",value:function(e,t){e.loadRange([6,9],{onSuccess:function(){e.loadRange([0,10+e.getSynchsafeInteger32At(6)-1],t)},onError:t.onError})}},{key:"_parseData",value:function(e,t){var r,n=0,i=e.getByteAt(n+3);if(4<i)return{type:"ID3",version:">2.4",tags:{}};var s=e.getByteAt(n+4),u=e.isBitSetAt(n+5,7),c=e.isBitSetAt(n+5,6),l=e.isBitSetAt(n+5,5),f=e.getSynchsafeInteger32At(n+6);n+=10;if(c)if(4===i){var d=e.getSynchsafeInteger32At(n);n+=d}else d=e.getLongAt(n,!0),n+=d+4;d={type:"ID3",version:"2."+i+"."+s,major:i,revision:s,flags:{unsynchronisation:u,extended_header:c,experimental_indicator:l,footer_present:!1},size:f,tags:{}};t&&(r=this._expandShortcutTags(t));t=f+10;d.flags.unsynchronisation&&(e=a.getUnsyncFileReader(e,n,f),n=0,t=e.getSize());e=a.readFrames(n,t,e,d,r);for(var g in o)o.hasOwnProperty(g)&&(r=this._getFrameData(e,o[g]))&&(d.tags[g]=r);for(var h in e)e.hasOwnProperty(h)&&(d.tags[h]=e[h]);return d}},{key:"_getFrameData",value:function(e,t){for(var r=0,n;n=t[r];r++)if(n in e)return e=e[n]instanceof Array?e[n][0]:e[n],e.data}},{key:"getShortcuts",value:function(){return o}}],[{key:"getTagIdentifierByteRange",value:function(){return{offset:0,length:10}}},{key:"canReadTagFormat",value:function(e){return"ID3"===String.fromCharCode.apply(String,e.slice(0,3))}}]);return t}(r);var o={title:["TIT2","TT2"],artist:["TPE1","TP1"],album:["TALB","TAL"],year:["TYER","TYE"],comment:["COMM","COM"],track:["TRCK","TRK"],genre:["TCON","TCO"],picture:["APIC","PIC"],lyrics:["USLT","ULT"]};t.exports=e},{"./ID3v2FrameReader":8,"./MediaFileReader":11,"./MediaTagReader":12}],10:[function(e,t,r){function n(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}});t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}return function(t,r,n){r&&e(t.prototype,r);n&&e(t,n);return t}}();r=e("./MediaTagReader");e("./MediaFileReader");e=function(e){function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");var e=(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?this:e}n(t,e);i(t,[{key:"_loadData",value:function(e,t){var r=this;e.loadRange([0,16],{onSuccess:function(){r._loadAtom(e,0,"",t)},onError:t.onError})}},{key:"_loadAtom",value:function(e,t,r,n){if(t>=e.getSize())n.onSuccess();else{var i=this,a=e.getLongAt(t,!0);if(0==a||isNaN(a))n.onSuccess();else{var o=e.getStringAt(t+4,4);if(this._isContainerAtom(o)){"meta"==o&&(t+=4);var s=(r?r+".":"")+o;"moov.udta.meta.ilst"===s?e.loadRange([t,t+a],n):e.loadRange([t+8,t+8+8],{onSuccess:function(){i._loadAtom(e,t+8,s,n)},onError:n.onError})}else e.loadRange([t+a,t+a+8],{onSuccess:function(){i._loadAtom(e,t+a,r,n)},onError:n.onError})}}}},{key:"_isContainerAtom",value:function(e){return 0<=["moov","udta","meta","ilst"].indexOf(e)}},{key:"_canReadAtom",value:function(e){return"----"!==e}},{key:"_parseData",value:function(e,t){var r={};t=this._expandShortcutTags(t);this._readAtom(r,e,0,e.getSize(),t);for(var n in s)s.hasOwnProperty(n)&&(t=r[s[n]])&&(r[n]="track"===n?t.data.track:t.data);return{type:"MP4",ftyp:e.getStringAt(8,4),version:e.getLongAt(12,!0),tags:r}}},{key:"_readAtom",value:function(e,t,r,n,i,a,o){o=void 0===o?"":o+"  ";for(var s=r;s<r+n;){var u=t.getLongAt(s,!0);if(0==u)break;var c=t.getStringAt(s+4,4);if(this._isContainerAtom(c)){"meta"==c&&(s+=4);this._readAtom(e,t,s+8,u-8,i,(a?a+".":"")+c,o);break}(!i||0<=i.indexOf(c))&&"moov.udta.meta.ilst"===a&&this._canReadAtom(c)&&(e[c]=this._readMetadataAtom(t,s));s+=u}}},{key:"_readMetadataAtom",value:function(e,t){var r=e.getLongAt(t,!0),n=e.getStringAt(t+4,4),i=e.getInteger24At(t+16+1,!0);i=a[i];if("trkn"==n)var s={track:e.getByteAt(t+16+11),total:e.getByteAt(t+16+13)};else if("disk"==n)s={disk:e.getByteAt(t+16+11),total:e.getByteAt(t+16+13)};else{t+=24;var u=r-24;"covr"===n&&"uint8"===i&&(i="jpeg");switch(i){case"text":s=e.getStringWithCharsetAt(t,u,"utf-8").toString();break;case"uint8":s=e.getShortAt(t,!1);break;case"int":case"uint":s=("int"==i?1==u?e.getSByteAt:2==u?e.getSShortAt:4==u?e.getSLongAt:e.getLongAt:1==u?e.getByteAt:2==u?e.getShortAt:e.getLongAt).call(e,t+(8==u?4:0),!0);break;case"jpeg":case"png":s={format:"image/"+i,data:e.getBytesAt(t,u)}}}return{id:n,size:r,description:o[n]||"Unknown",data:s}}},{key:"getShortcuts",value:function(){return s}}],[{key:"getTagIdentifierByteRange",value:function(){return{offset:0,length:16}}},{key:"canReadTagFormat",value:function(e){return"ftyp"===String.fromCharCode.apply(String,e.slice(4,8))}}]);return t}(r);var a={0:"uint8",1:"text",13:"jpeg",14:"png",21:"int",22:"uint"},o={"©alb":"Album","©ART":"Artist",aART:"Album Artist","©day":"Release Date","©nam":"Title","©gen":"Genre",gnre:"Genre",trkn:"Track Number","©wrt":"Composer","©too":"Encoding Tool","©enc":"Encoded By",cprt:"Copyright",covr:"Cover Art","©grp":"Grouping",keyw:"Keywords","©lyr":"Lyrics","©cmt":"Comment",tmpo:"Tempo",cpil:"Compilation",disk:"Disc Number",tvsh:"TV Show Name",tven:"TV Episode ID",tvsn:"TV Season",tves:"TV Episode",tvnn:"TV Network",desc:"Description",ldes:"Long Description",sonm:"Sort Name",soar:"Sort Artist",soaa:"Sort Album",soco:"Sort Composer",sosn:"Sort Show",purd:"Purchase Date",pcst:"Podcast",purl:"Podcast URL",catg:"Category",hdvd:"HD Video",stik:"Media Type",rtng:"Content Rating",pgap:"Gapless Playback",apID:"Purchase Account",sfID:"Country Code",atID:"Artist ID",cnID:"Catalog ID",plID:"Collection ID",geID:"Genre ID","xid ":"Vendor Information",flvr:"Codec Flavor"},s={title:"©nam",artist:"©ART",album:"©alb",year:"©day",comment:"©cmt",track:"trkn",genre:"©gen",picture:"covr",lyrics:"©lyr"};t.exports=e},{"./MediaFileReader":11,"./MediaTagReader":12}],11:[function(e,t,r){var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}return function(t,r,n){r&&e(t.prototype,r);n&&e(t,n);return t}}(),i=e("./StringUtils");e=function(){function e(t){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this._isInitialized=!1;this._size=0}n(e,[{key:"init",value:function(e){var t=this;if(this._isInitialized)setTimeout(e.onSuccess,1);else return this._init({onSuccess:function(){t._isInitialized=!0;e.onSuccess()},onError:e.onError})}},{key:"_init",value:function(e){throw Error("Must implement init function")}},{key:"loadRange",value:function(e,t){throw Error("Must implement loadRange function")}},{key:"getSize",value:function(){if(!this._isInitialized)throw Error("init() must be called first.");return this._size}},{key:"getByteAt",value:function(e){throw Error("Must implement getByteAt function")}},{key:"getBytesAt",value:function(e,t){for(var r=Array(t),n=0;n<t;n++)r[n]=this.getByteAt(e+n);return r}},{key:"isBitSetAt",value:function(e,t){return 0!=(this.getByteAt(e)&1<<t)}},{key:"getSByteAt",value:function(e){e=this.getByteAt(e);return 127<e?e-256:e}},{key:"getShortAt",value:function(e,t){e=t?(this.getByteAt(e)<<8)+this.getByteAt(e+1):(this.getByteAt(e+1)<<8)+this.getByteAt(e);0>e&&(e+=65536);return e}},{key:"getSShortAt",value:function(e,t){e=this.getShortAt(e,t);return 32767<e?e-65536:e}},{key:"getLongAt",value:function(e,t){var r=this.getByteAt(e),n=this.getByteAt(e+1),i=this.getByteAt(e+2);e=this.getByteAt(e+3);t=t?(((r<<8)+n<<8)+i<<8)+e:(((e<<8)+i<<8)+n<<8)+r;0>t&&(t+=4294967296);return t}},{key:"getSLongAt",value:function(e,t){e=this.getLongAt(e,t);return 2147483647<e?e-4294967296:e}},{key:"getInteger24At",value:function(e,t){var r=this.getByteAt(e),n=this.getByteAt(e+1);e=this.getByteAt(e+2);t=t?((r<<8)+n<<8)+e:((e<<8)+n<<8)+r;0>t&&(t+=16777216);return t}},{key:"getStringAt",value:function(e,t){for(var r=[],n=e,i=0;n<e+t;n++,i++)r[i]=String.fromCharCode(this.getByteAt(n));return r.join("")}},{key:"getStringWithCharsetAt",value:function(e,t,r){e=this.getBytesAt(e,t);switch((r||"").toLowerCase()){case"utf-16":case"utf-16le":case"utf-16be":r=i.readUTF16String(e,"utf-16be"===r);break;case"utf-8":r=i.readUTF8String(e);break;default:r=i.readNullTerminatedString(e)}return r}},{key:"getCharAt",value:function(e){return String.fromCharCode(this.getByteAt(e))}},{key:"getSynchsafeInteger32At",value:function(e){var t=this.getByteAt(e),r=this.getByteAt(e+1),n=this.getByteAt(e+2);return this.getByteAt(e+3)&127|(n&127)<<7|(r&127)<<14|(t&127)<<21}}],[{key:"canReadFile",value:function(e){throw Error("Must implement canReadFile function")}}]);return e}();t.exports=e},{"./StringUtils":13}],12:[function(e,t,r){var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}return function(t,r,n){r&&e(t.prototype,r);n&&e(t,n);return t}}();e("./MediaFileReader");e=function(){function e(t){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this._mediaFileReader=t;this._tags=null}n(e,[{key:"setTagsToRead",value:function(e){this._tags=e;return this}},{key:"read",value:function(e){var t=this;this._mediaFileReader.init({onSuccess:function(){t._loadData(t._mediaFileReader,{onSuccess:function(){try{var r=t._parseData(t._mediaFileReader,t._tags)}catch(t){if(e.onError){e.onError({type:"parseData",info:t.message});return}}e.onSuccess(r)},onError:e.onError})},onError:e.onError})}},{key:"getShortcuts",value:function(){return{}}},{key:"_loadData",value:function(e,t){throw Error("Must implement _loadData function")}},{key:"_parseData",value:function(e,t){throw Error("Must implement _parseData function")}},{key:"_expandShortcutTags",value:function(e){if(!e)return null;for(var t=[],r=this.getShortcuts(),n=0,i;i=e[n];n++)t=t.concat(r[i]||[i]);return t}}],[{key:"getTagIdentifierByteRange",value:function(){throw Error("Must implement")}},{key:"canReadTagFormat",value:function(e){throw Error("Must implement")}}]);return e}();t.exports=e},{"./MediaFileReader":11}],13:[function(e,t,r){var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}return function(t,r,n){r&&e(t.prototype,r);n&&e(t,n);return t}}(),i=function(){function e(t,r){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this._value=t;this.bytesReadCount=r;this.length=t.length}n(e,[{key:"toString",value:function(){return this._value}}]);return e}();t.exports={readUTF16String:function(e,t,r){var n=0,a=1,o=0;r=Math.min(r||e.length,e.length);254==e[0]&&255==e[1]?(t=!0,n=2):255==e[0]&&254==e[1]&&(t=!1,n=2);t&&(a=0,o=1);t=[];for(var s=0;n<r;s++){var u=e[n+a],c=(u<<8)+e[n+o];n+=2;if(0==c)break;else 216>u||224<=u?t[s]=String.fromCharCode(c):(u=(e[n+a]<<8)+e[n+o],n+=2,t[s]=String.fromCharCode(c,u))}return new i(t.join(""),n)},readUTF8String:function(e,t){var r=0;t=Math.min(t||e.length,e.length);239==e[0]&&187==e[1]&&191==e[2]&&(r=3);for(var n=[],a=0;r<t;a++){var o=e[r++];if(0==o)break;else if(128>o)n[a]=String.fromCharCode(o);else if(194<=o&&224>o){var s=e[r++];n[a]=String.fromCharCode(((o&31)<<6)+(s&63))}else if(224<=o&&240>o){s=e[r++];var u=e[r++];n[a]=String.fromCharCode(((o&255)<<12)+((s&63)<<6)+(u&63))}else if(240<=o&&245>o){s=e[r++];u=e[r++];var c=e[r++];u=((o&7)<<18)+((s&63)<<12)+((u&63)<<6)+(c&63)-65536;n[a]=String.fromCharCode((u>>10)+55296,(u&1023)+56320)}}return new i(n.join(""),r)},readNullTerminatedString:function(e,t){var r=[];t=t||e.length;for(var n=0;n<t;){var a=e[n++];if(0==a)break;r[n-1]=String.fromCharCode(a)}return new i(r.join(""),n)}}},{}],14:[function(e,t,r){function n(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}});t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}return function(t,r,n){r&&e(t.prototype,r);n&&e(t,n);return t}}(),a=e("./ChunkedFileData");r=function(t){function r(e){if(!(this instanceof r))throw new TypeError("Cannot call a class as a function");var t=(r.__proto__||Object.getPrototypeOf(r)).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");t=!t||"object"!==typeof t&&"function"!==typeof t?this:t;t._url=e;t._fileData=new a;return t}n(r,t);i(r,[{key:"_init",value:function(e){r._config.avoidHeadRequests?this._fetchSizeWithGetRequest(e):this._fetchSizeWithHeadRequest(e)}},{key:"_fetchSizeWithHeadRequest",value:function(e){var t=this;this._makeXHRRequest("HEAD",null,{onSuccess:function(r){(r=t._parseContentLength(r))?(t._size=r,e.onSuccess()):t._fetchSizeWithGetRequest(e)},onError:e.onError})}},{key:"_fetchSizeWithGetRequest",value:function(e){var t=this,r=this._roundRangeToChunkMultiple([0,0]);this._makeXHRRequest("GET",r,{onSuccess:function(r){var n=t._parseContentRange(r);r=t._getXhrResponseContent(r);if(n){if(null==n.instanceLength){t._fetchEntireFile(e);return}t._size=n.instanceLength}else t._size=r.length;t._fileData.addData(0,r);e.onSuccess()},onError:e.onError})}},{key:"_fetchEntireFile",value:function(e){var t=this;this._makeXHRRequest("GET",null,{onSuccess:function(r){r=t._getXhrResponseContent(r);t._size=r.length;t._fileData.addData(0,r);e.onSuccess()},onError:e.onError})}},{key:"_getXhrResponseContent",value:function(e){return e.responseBody||e.responseText||""}},{key:"_parseContentLength",value:function(e){e=this._getResponseHeader(e,"Content-Length");return null==e?e:parseInt(e,10)}},{key:"_parseContentRange",value:function(e){if(e=this._getResponseHeader(e,"Content-Range")){var t=e.match(/bytes (\d+)-(\d+)\/(?:(\d+)|\*)/i);if(!t)throw Error("FIXME: Unknown Content-Range syntax: "+e);return{firstBytePosition:parseInt(t[1],10),lastBytePosition:parseInt(t[2],10),instanceLength:t[3]?parseInt(t[3],10):null}}return null}},{key:"loadRange",value:function(e,t){var r=this;r._fileData.hasDataRange(e[0],Math.min(r._size,e[1]))?setTimeout(t.onSuccess,1):(e=this._roundRangeToChunkMultiple(e),e[1]=Math.min(r._size,e[1]),this._makeXHRRequest("GET",e,{onSuccess:function(n){n=r._getXhrResponseContent(n);r._fileData.addData(e[0],n);t.onSuccess()},onError:t.onError}))}},{key:"_roundRangeToChunkMultiple",value:function(e){return[e[0],e[0]+1024*Math.ceil((e[1]-e[0]+1)/1024)-1]}},{key:"_makeXHRRequest",value:function(e,t,n){var i=this._createXHRObject();i.open(e,this._url);var a=function(){if(200===i.status||206===i.status)n.onSuccess(i);else if(n.onError)n.onError({type:"xhr",info:"Unexpected HTTP status "+i.status+".",xhr:i});i=null};"undefined"!==typeof i.onload?(i.onload=a,i.onerror=function(){if(n.onError)n.onError({type:"xhr",info:"Generic XHR error, check xhr object.",xhr:i})}):i.onreadystatechange=function(){4===i.readyState&&a()};r._config.timeoutInSec&&(i.timeout=1e3*r._config.timeoutInSec,i.ontimeout=function(){if(n.onError)n.onError({type:"xhr",info:"Timeout after "+i.timeout/1e3+"s. Use jsmediatags.Config.setXhrTimeout to override.",xhr:i})});i.overrideMimeType("text/plain; charset=x-user-defined");t&&this._setRequestHeader(i,"Range","bytes="+t[0]+"-"+t[1]);this._setRequestHeader(i,"If-Modified-Since","Sat, 01 Jan 1970 00:00:00 GMT");i.send(null)}},{key:"_setRequestHeader",value:function(e,t,n){0>r._config.disallowedXhrHeaders.indexOf(t.toLowerCase())&&e.setRequestHeader(t,n)}},{key:"_hasResponseHeader",value:function(e,t){e=e.getAllResponseHeaders();if(!e)return!1;e=e.split("\r\n");for(var r=[],n=0;n<e.length;n++)r[n]=e[n].split(":")[0].toLowerCase();return 0<=r.indexOf(t.toLowerCase())}},{key:"_getResponseHeader",value:function(e,t){return this._hasResponseHeader(e,t)?e.getResponseHeader(t):null}},{key:"getByteAt",value:function(e){return this._fileData.getByteAt(e).charCodeAt(0)&255}},{key:"_isWebWorker",value:function(){return"undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope}},{key:"_createXHRObject",value:function(){if("undefined"===typeof window&&!this._isWebWorker())return new(e("xhr2").XMLHttpRequest);if("undefined"!==typeof XMLHttpRequest)return new XMLHttpRequest;throw Error("XMLHttpRequest is not supported")}}],[{key:"canReadFile",value:function(e){return"string"===typeof e&&/^[a-z]+:\/\//i.test(e)}},{key:"setConfig",value:function(e){for(var t in e)e.hasOwnProperty(t)&&(this._config[t]=e[t]);e=this._config.disallowedXhrHeaders;for(t=0;t<e.length;t++)e[t]=e[t].toLowerCase()}}]);return r}(e("./MediaFileReader"));r._config={avoidHeadRequests:!1,disallowedXhrHeaders:[],timeoutInSec:30};t.exports=r},{"./ChunkedFileData":5,"./MediaFileReader":11,xhr2:2}],15:[function(e,t,r){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){var r=0>e.offset&&(-e.offset>t||0<e.offset+e.length);return!(0<=e.offset&&e.offset+e.length>=t||r)}var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}return function(t,r,n){r&&e(t.prototype,r);n&&e(t,n);return t}}();e("./MediaFileReader");r=e("./NodeFileReader");var o=e("./XhrFileReader"),s=e("./BlobFileReader"),u=e("./ArrayFileReader");e("./MediaTagReader");var c=e("./ID3v1TagReader"),l=e("./ID3v2TagReader"),f=e("./MP4TagReader");e=e("./FLACTagReader");var d=[],g=[],h=function(){function e(t){n(this,e);this._file=t}a(e,[{key:"setTagsToRead",value:function(e){this._tagsToRead=e;return this}},{key:"setFileReader",value:function(e){this._fileReader=e;return this}},{key:"setTagReader",value:function(e){this._tagReader=e;return this}},{key:"read",value:function(e){var t=new(this._getFileReader())(this._file),r=this;t.init({onSuccess:function(){r._getTagReader(t,{onSuccess:function(n){new n(t).setTagsToRead(r._tagsToRead).read(e)},onError:e.onError})},onError:e.onError})}},{key:"_getFileReader",value:function(){return this._fileReader?this._fileReader:this._findFileReader()}},{key:"_findFileReader",value:function(){for(var e=0;e<d.length;e++)if(d[e].canReadFile(this._file))return d[e];throw Error("No suitable file reader found for "+this._file)}},{key:"_getTagReader",value:function(e,t){if(this._tagReader){var r=this._tagReader;setTimeout((function(){t.onSuccess(r)}),1)}else this._findTagReader(e,t)}},{key:"_findTagReader",value:function(e,t){for(var r=[],n=[],a=e.getSize(),o=0;o<g.length;o++){var s=g[o].getTagIdentifierByteRange();i(s,a)&&(0<=s.offset&&s.offset<a/2||0>s.offset&&s.offset<-a/2?r.push(g[o]):n.push(g[o]))}var u=!1;o={onSuccess:function(){if(u){for(var r=0;r<g.length;r++){var n=g[r].getTagIdentifierByteRange();if(i(n,a)){try{var o=e.getBytesAt(0<=n.offset?n.offset:n.offset+a,n.length)}catch(e){if(t.onError)t.onError({type:"fileReader",info:e.message});return}if(g[r].canReadTagFormat(o)){t.onSuccess(g[r]);return}}}if(t.onError)t.onError({type:"tagFormat",info:"No suitable tag reader found"})}else u=!0},onError:t.onError};this._loadTagIdentifierRanges(e,r,o);this._loadTagIdentifierRanges(e,n,o)}},{key:"_loadTagIdentifierRanges",value:function(e,t,r){if(0===t.length)setTimeout(r.onSuccess,1);else{for(var n=[Number.MAX_VALUE,0],i=e.getSize(),a=0;a<t.length;a++){var o=t[a].getTagIdentifierByteRange(),s=0<=o.offset?o.offset:o.offset+i;o=s+o.length-1;n[0]=Math.min(s,n[0]);n[1]=Math.max(o,n[1])}e.loadRange(n,r)}}}]);return e}(),p=function(){function e(){n(this,e)}a(e,null,[{key:"addFileReader",value:function(t){d.push(t);return e}},{key:"addTagReader",value:function(t){g.push(t);return e}},{key:"removeTagReader",value:function(t){t=g.indexOf(t);0<=t&&g.splice(t,1);return e}},{key:"EXPERIMENTAL_avoidHeadRequests",value:function(){o.setConfig({avoidHeadRequests:!0})}},{key:"setDisallowedXhrHeaders",value:function(e){o.setConfig({disallowedXhrHeaders:e})}},{key:"setXhrTimeoutInSec",value:function(e){o.setConfig({timeoutInSec:e})}}]);return e}();p.addFileReader(o).addFileReader(s).addFileReader(u).addTagReader(l).addTagReader(c).addTagReader(f).addTagReader(e);"undefined"===typeof process||process.browser||p.addFileReader(r);t.exports={read:function(e,t){new h(e).read(t)},Reader:h,Config:p}},{"./ArrayFileReader":3,"./BlobFileReader":4,"./FLACTagReader":6,"./ID3v1TagReader":7,"./ID3v2TagReader":9,"./MP4TagReader":10,"./MediaFileReader":11,"./MediaTagReader":12,"./NodeFileReader":1,"./XhrFileReader":14}]},{},[15])(15)}));var s=function(){var e={};e.promise=new Promise((function(t,r){e.resolve=t;e.reject=r}));return e};var u=1;function c(e){var t=e;return new Promise((function(r,n){var i=window.indexedDB.open(e,u);i.onupgradeneeded=function(){return i.result.createObjectStore(t)};i.onblocked=function(){return n(new Error("onblocked"))};i.onerror=function(){return n(i.error)};i.onsuccess=function(){var e=i.result;r((function(r,n){return l({db:e,storeName:t,transactionType:r,fn:n})}))}}))}function l(e){var t=e.db,r=e.storeName,n=e.transactionType,i=e.fn;return new Promise((function(e,a){var o=t.transaction(r,n);var s=o.objectStore(r);var u=i(s);var c=Array.isArray(u)?Promise.all(u.map(f)):f(u);o.onerror=function(){return a(o.error)};o.oncomplete=function(){return e(c)}}))}function f(e){var t=s();e.onerror=function(r){if(typeof r.preventDefault==="function"){r.preventDefault()}t.reject(e.error)};e.onsuccess=function(){return t.resolve(e.result)};return t.promise}var d=e("stellar_song",function(){function e(e){t(this,e);this._index=0;this.songChanged=r(this,"songChanged",7);this.loaded=r(this,"loaded",7)}Object.defineProperty(e.prototype,"url",{get:function(){if(this.src.startsWith("http")){return this.src}else if(this.src.startsWith(".")){return window.location.origin+a(this.src)}else{return window.location.origin+this.src}},enumerable:true,configurable:true});e.prototype.componentWillLoad=function(){return __awaiter(this,void 0,void 0,(function(){var e=this;return __generator(this,(function(t){this.player=this.element.closest("stellar-playlist");if(this.player.load){this.load()}this.player.addEventListener("load_songs",(function(){e.load()}));return[2]}))}))};e.prototype.componentDidLoad=function(){};e.prototype.songChangedHandler=function(){this.songChanged.emit(this._index)};e.prototype.updateDetails=function(e){this.title=e.title;this.album=e.album;this.genre=e.genre;this.artist=e.artist;this.picture=e.picture};e.prototype.load=function(){return __awaiter(this,void 0,void 0,(function(){var e,t,r,n;var i=this;return __generator(this,(function(a){switch(a.label){case 0:return[4,c("songs")];case 1:e=a.sent();return[4,e("readonly",(function(e){return e.get(i.src)}))];case 2:t=a.sent();if(!!t)return[3,3];window["jsmediatags"].read(this.url,{onSuccess:function(t){return __awaiter(i,void 0,void 0,(function(){var r,n,i,a;var o=this;return __generator(this,(function(s){switch(s.label){case 0:r={title:t.tags.title,album:t.tags.album,genre:t.tags.genre,artist:t.tags.artist,picture:t.tags.picture};if(!t.tags.picture)return[3,2];n="";for(i=0;i<t.tags.picture.data.length;i++){n+=String.fromCharCode(t.tags.picture.data[i])}a="data:image/jpeg;base64,"+window.btoa(n);r.picture=a;return[4,e("readwrite",(function(e){return e.put(a,r.album+"_picture")}))];case 1:s.sent();return[3,3];case 2:r.picture=undefined;s.label=3;case 3:return[4,e("readwrite",(function(e){return e.put(JSON.stringify(r),o.src)}))];case 4:s.sent();this.updateDetails(r);return[2]}}))}))},onError:function(e){console.log(e);i.error=e}});return[3,5];case 3:r=JSON.parse(t);return[4,e("readonly",(function(e){return e.get(r.album+"_picture")}))];case 4:n=a.sent();r.picture=n;this.updateDetails(r);a.label=5;case 5:this.loaded.emit({el:this.element});return[2]}}))}))};e.prototype.details=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){return[2,{title:this.title,album:this.album,genre:this.genre,artist:this.artist,picture:this.picture}]}))}))};e.prototype.preload=function(){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(t){e=new Audio;e.src=this.src;e.preload="auto";e.volume=1;return[2]}))}))};e.prototype.play=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){if(!this.playing){this.songChangedHandler();this.playing=true;this.player.prepare(this.element);this.player.play()}return[2]}))}))};e.prototype.switching=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){this.playing=false;return[2]}))}))};e.prototype.getIndex=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){return[2,this._index]}))}))};e.prototype.setIndex=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){this._index=e;return[2]}))}))};e.prototype.render=function(){var e=this;return n("button",{onClick:function(){return e.play()}},n("span",{class:"index"},!this.playing&&o(this._index),this.playing&&n("stellar-asset",{name:"play"})),n("div",{class:"tracklisting"},this.artwork&&n("img",{src:this.picture,class:"preview-image"}),n("h2",null,n("span",null,this.title||"Loading...")," / ",this.artist||"Loading...")),n("img",{src:this.picture,class:"backdrop"}))};Object.defineProperty(e,"assetsDirs",{get:function(){return["./vendor"]},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"element",{get:function(){return i(this)},enumerable:true,configurable:true});Object.defineProperty(e,"style",{get:function(){return":host{display:block;width:100%;-ms-flex:0 0 100%;flex:0 0 100%}:host button{background:none;width:100%;border:0;outline:0;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-ms-flexbox;display:flex;padding:0;-ms-flex-align:center;align-items:center;-ms-flex-pack:start;justify-content:flex-start;position:relative;overflow:hidden;border-top:1px solid var(--color-line)}:host button:focus,:host button:hover{background:var(--color-bg-active)}:host([playing]) button{background:var(--color-bg-playing)!important}:host .index{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;height:45px;width:55px;-ms-flex:0 0 55px;flex:0 0 55px;border-right:1px solid var(--color-line);font-size:.75rem;margin:0;margin-right:20px;text-transform:uppercase;color:var(--color-two);letter-spacing:.23em;z-index:1;font-weight:900}:host([playing]) .index{font-size:1.5rem}:host img.preview-image{width:2rem;height:2rem;display:inline-block;margin-right:10px;-webkit-transition:all .15s ease-in-out 0s;transition:all .15s ease-in-out 0s;-webkit-filter:grayscale(100%);filter:grayscale(100%);padding:0;background:#fff;border-radius:4px;z-index:1}:host([playing]) img.preview-image{-webkit-filter:grayscale(0);filter:grayscale(0)}:host h2{z-index:1;color:var(--color-four);font-size:14px;font-weight:400;margin:0;line-height:1;margin-top:-3px;white-space:nowrap}:host h2 span{color:var(--color-two)}:host .tracklisting{overflow:auto;display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;width:100%;height:46px}:host .tracklisting:after{content:\"\";display:block;width:30px;height:30px;-ms-flex:0 0 30px;flex:0 0 30px}:host img.backdrop{position:absolute;width:100%;-webkit-filter:blur(20px) grayscale(75%);filter:blur(20px) grayscale(75%);opacity:.15;z-index:0;mix-blend-mode:color}:host button[data-playing=true] img.preview-image{width:30px;height:30px;-webkit-filter:grayscale(0);filter:grayscale(0)}:host button[data-playing=true] img.backdrop{opacity:1}:host button[data-playing=true] .index,:host button[data-playing=true] h2 span{color:var(--color-three)!important}"},enumerable:true,configurable:true});return e}())}}}));