function t(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function i(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function n(t,n,e){return n&&i(t.prototype,n),e&&i(t,e),t}function e(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function r(t,i){return!i||"object"!=typeof i&&"function"!=typeof i?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):i}function h(t,i,n){return(h="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,i,n){var e=function(t,i){for(;!Object.prototype.hasOwnProperty.call(t,i)&&null!==(t=s(t)););return t}(t,i);if(e){var r=Object.getOwnPropertyDescriptor(e,i);return r.get?r.get.call(n):r.value}})(t,i,n||t)}var o,a,u,f,c,l,v,d,p,m,M,g,w,y,_,x,E,S,b,A,P,T,L,O,U,N,k,D,F,I,R,C,B,G,V,j,X,H={REVISION:"75"},Y=H;void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Math.sign&&(Math.sign=function(t){return t<0?-1:t>0?1:+t}),void 0===Function.prototype.name&&void 0!==Object.defineProperty&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*(\S*)\s*\(/)[1]}}),void 0===Object.assign&&Object.defineProperty(Object,"assign",{writable:!0,configurable:!0,value:function(t){if(null==t)throw new TypeError("Cannot convert first argument to object");for(var i=Object(t),n=1,e=arguments.length;n!==e;++n){var s=arguments[n];if(null!=s){s=Object(s);for(var r=Object.keys(s),h=0,o=r.length;h!==o;++h){var a=r[h],u=Object.getOwnPropertyDescriptor(s,a);void 0!==u&&u.enumerable&&(i[a]=s[a])}}}return i}}),H.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2},H.CullFaceNone=0,H.CullFaceBack=1,H.CullFaceFront=2,H.CullFaceFrontBack=3,H.FrontFaceDirectionCW=0,H.FrontFaceDirectionCCW=1,H.BasicShadowMap=0,H.PCFShadowMap=1,H.PCFSoftShadowMap=2,H.FrontSide=0,H.BackSide=1,H.DoubleSide=2,H.FlatShading=1,H.SmoothShading=2,H.NoColors=0,H.FaceColors=1,H.VertexColors=2,H.NoBlending=0,H.NormalBlending=1,H.AdditiveBlending=2,H.SubtractiveBlending=3,H.MultiplyBlending=4,H.CustomBlending=5,H.AddEquation=100,H.SubtractEquation=101,H.ReverseSubtractEquation=102,H.MinEquation=103,H.MaxEquation=104,H.ZeroFactor=200,H.OneFactor=201,H.SrcColorFactor=202,H.OneMinusSrcColorFactor=203,H.SrcAlphaFactor=204,H.OneMinusSrcAlphaFactor=205,H.DstAlphaFactor=206,H.OneMinusDstAlphaFactor=207,H.DstColorFactor=208,H.OneMinusDstColorFactor=209,H.SrcAlphaSaturateFactor=210,H.NeverDepth=0,H.AlwaysDepth=1,H.LessDepth=2,H.LessEqualDepth=3,H.EqualDepth=4,H.GreaterEqualDepth=5,H.GreaterDepth=6,H.NotEqualDepth=7,H.MultiplyOperation=0,H.MixOperation=1,H.AddOperation=2,H.NoToneMapping=0,H.LinearToneMapping=1,H.ReinhardToneMapping=2,H.Uncharted2ToneMapping=3,H.CineonToneMapping=4,H.UVMapping=300,H.CubeReflectionMapping=301,H.CubeRefractionMapping=302,H.EquirectangularReflectionMapping=303,H.EquirectangularRefractionMapping=304,H.SphericalReflectionMapping=305,H.CubeUVReflectionMapping=306,H.CubeUVRefractionMapping=307,H.RepeatWrapping=1e3,H.ClampToEdgeWrapping=1001,H.MirroredRepeatWrapping=1002,H.NearestFilter=1003,H.NearestMipMapNearestFilter=1004,H.NearestMipMapLinearFilter=1005,H.LinearFilter=1006,H.LinearMipMapNearestFilter=1007,H.LinearMipMapLinearFilter=1008,H.UnsignedByteType=1009,H.ByteType=1010,H.ShortType=1011,H.UnsignedShortType=1012,H.IntType=1013,H.UnsignedIntType=1014,H.FloatType=1015,H.HalfFloatType=1025,H.UnsignedShort4444Type=1016,H.UnsignedShort5551Type=1017,H.UnsignedShort565Type=1018,H.AlphaFormat=1019,H.RGBFormat=1020,H.RGBAFormat=1021,H.LuminanceFormat=1022,H.LuminanceAlphaFormat=1023,H.RGBEFormat=H.RGBAFormat,H.RGB_S3TC_DXT1_Format=2001,H.RGBA_S3TC_DXT1_Format=2002,H.RGBA_S3TC_DXT3_Format=2003,H.RGBA_S3TC_DXT5_Format=2004,H.RGB_PVRTC_4BPPV1_Format=2100,H.RGB_PVRTC_2BPPV1_Format=2101,H.RGBA_PVRTC_4BPPV1_Format=2102,H.RGBA_PVRTC_2BPPV1_Format=2103,H.RGB_ETC1_Format=2151,H.LoopOnce=2200,H.LoopRepeat=2201,H.LoopPingPong=2202,H.InterpolateDiscrete=2300,H.InterpolateLinear=2301,H.InterpolateSmooth=2302,H.ZeroCurvatureEnding=2400,H.ZeroSlopeEnding=2401,H.WrapAroundEnding=2402,H.TrianglesDrawMode=0,H.TriangleStripDrawMode=1,H.TriangleFanDrawMode=2,H.LinearEncoding=3e3,H.sRGBEncoding=3001,H.GammaEncoding=3007,H.RGBEEncoding=3002,H.LogLuvEncoding=3003,H.RGBM7Encoding=3004,H.RGBM16Encoding=3005,H.RGBDEncoding=3006,H.Math={generateUUID:(f="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),c=new Array(36),l=0,function(){for(var t=0;t<36;t++)8===t||13===t||18===t||23===t?c[t]="-":14===t?c[t]="4":(l<=2&&(l=33554432+16777216*Math.random()|0),u=15&l,l>>=4,c[t]=f[19===t?3&u|8:u]);return c.join("")}),clamp:function(t,i,n){return Math.max(i,Math.min(n,t))},euclideanModulo:function(t,i){return(t%i+i)%i},mapLinear:function(t,i,n,e,s){return e+(t-i)*(s-e)/(n-i)},smoothstep:function(t,i,n){return t<=i?0:t>=n?1:(t=(t-i)/(n-i))*t*(3-2*t)},smootherstep:function(t,i,n){return t<=i?0:t>=n?1:(t=(t-i)/(n-i))*t*t*(t*(6*t-15)+10)},random16:function(){return Math.random()},randInt:function(t,i){return t+Math.floor(Math.random()*(i-t+1))},randFloat:function(t,i){return t+Math.random()*(i-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:(a=Math.PI/180,function(t){return t*a}),radToDeg:(o=180/Math.PI,function(t){return t*o}),isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},nearestPowerOfTwo:function(t){return Math.pow(2,Math.round(Math.log(t)/Math.LN2))},nextPowerOfTwo:function(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}},H.Color=function(t){return 3===arguments.length?this.fromArray(arguments):this.set(t)},H.Color.prototype={constructor:H.Color,r:1,g:1,b:1,set:function(t){return t instanceof H.Color?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this},setScalar:function(t){this.r=t,this.g=t,this.b=t},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,i,n){return this.r=t,this.g=i,this.b=n,this},setHSL:function(){function t(t,i,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(i-t)*n:n<.5?i:n<2/3?t+6*(i-t)*(2/3-n):t}return function(i,n,e){if(i=H.Math.euclideanModulo(i,1),n=H.Math.clamp(n,0,1),e=H.Math.clamp(e,0,1),0===n)this.r=this.g=this.b=e;else{var s=e<=.5?e*(1+n):e+n-e*n,r=2*e-s;this.r=t(r,s,i+1/3),this.g=t(r,s,i),this.b=t(r,s,i-1/3)}return this}}(),setStyle:function(t){var i;if(i=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){var n,e=i[2];switch(i[1]){case"rgb":case"rgba":if(n=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(e))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,this;if(n=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(e))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,this;break;case"hsl":case"hsla":if(n=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(e)){var s=parseFloat(n[1])/360,r=parseInt(n[2],10)/100,h=parseInt(n[3],10)/100;return this.setHSL(s,r,h)}}}else if(i=/^\#([A-Fa-f0-9]+)$/.exec(t)){var o,a=(o=i[1]).length;if(3===a)return this.r=parseInt(o.charAt(0)+o.charAt(0),16)/255,this.g=parseInt(o.charAt(1)+o.charAt(1),16)/255,this.b=parseInt(o.charAt(2)+o.charAt(2),16)/255,this;if(6===a)return this.r=parseInt(o.charAt(0)+o.charAt(1),16)/255,this.g=parseInt(o.charAt(2)+o.charAt(3),16)/255,this.b=parseInt(o.charAt(4)+o.charAt(5),16)/255,this}return t&&t.length>0&&void 0!==(o=H.ColorKeywords[t])&&this.setHex(o),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t,i){return void 0===i&&(i=2),this.r=Math.pow(t.r,i),this.g=Math.pow(t.g,i),this.b=Math.pow(t.b,i),this},copyLinearToGamma:function(t,i){void 0===i&&(i=2);var n=i>0?1/i:1;return this.r=Math.pow(t.r,n),this.g=Math.pow(t.g,n),this.b=Math.pow(t.b,n),this},convertGammaToLinear:function(){var t=this.r,i=this.g,n=this.b;return this.r=t*t,this.g=i*i,this.b=n*n,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){var i,n,e=t||{h:0,s:0,l:0},s=this.r,r=this.g,h=this.b,o=Math.max(s,r,h),a=Math.min(s,r,h),u=(a+o)/2;if(a===o)i=0,n=0;else{var f=o-a;switch(n=u<=.5?f/(o+a):f/(2-o-a),o){case s:i=(r-h)/f+(r<h?6:0);break;case r:i=(h-s)/f+2;break;case h:i=(s-r)/f+4}i/=6}return e.h=i,e.s=n,e.l=u,e},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(t,i,n){var e=this.getHSL();return e.h+=t,e.s+=i,e.l+=n,this.setHSL(e.h,e.s,e.l),this},add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,i){return this.r=t.r+i.r,this.g=t.g+i.g,this.b=t.b+i.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,i){return this.r+=(t.r-this.r)*i,this.g+=(t.g-this.g)*i,this.b+=(t.b-this.b)*i,this},equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t,i){return void 0===i&&(i=0),this.r=t[i],this.g=t[i+1],this.b=t[i+2],this},toArray:function(t,i){return void 0===t&&(t=[]),void 0===i&&(i=0),t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,t}},H.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},H.Vector2=function(t,i){this.x=t||0,this.y=i||0},H.Vector2.prototype={constructor:H.Vector2,get width(){return this.x},set width(t){this.x=t},get height(){return this.y},set height(t){this.y=t},set:function(t,i){return this.x=t,this.y=i,this},setScalar:function(t){return this.x=t,this.y=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+t)}},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,i){return void 0!==i?this.addVectors(t,i):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this},addScaledVector:function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this},sub:function(t,i){return void 0!==i?this.subVectors(t,i):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return isFinite(t)?(this.x*=t,this.y*=t):(this.x=0,this.y=0),this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this},clampScalar:function(t,i){return void 0===v&&(v=new H.Vector2,d=new H.Vector2),v.set(t,t),d.set(i,i),this.clamp(v,d)},clampLength:function(t,i){var n=this.length();return this.multiplyScalar(Math.max(t,Math.min(i,n))/n),this},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length())},angle:function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var i=this.x-t.x,n=this.y-t.y;return i*i+n*n},setLength:function(t){return this.multiplyScalar(t/this.length())},lerp:function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this},lerpVectors:function(t,i,n){return this.subVectors(i,t).multiplyScalar(n).add(t),this},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,i){return void 0===i&&(i=0),this.x=t[i],this.y=t[i+1],this},toArray:function(t,i){return void 0===t&&(t=[]),void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t},fromAttribute:function(t,i,n){return void 0===n&&(n=0),this.x=t.array[i=i*t.itemSize+n],this.y=t.array[i+1],this},rotateAround:function(t,i){var n=Math.cos(i),e=Math.sin(i),s=this.x-t.x,r=this.y-t.y;return this.x=s*n-r*e+t.x,this.y=s*e+r*n+t.y,this}},H.Vector3=function(t,i,n){this.x=t||0,this.y=i||0,this.z=n||0},H.Vector3.prototype={constructor:H.Vector3,set:function(t,i,n){return this.x=t,this.y=i,this.z=n,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+t)}},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,i){return void 0!==i?this.addVectors(t,i):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this},addScaledVector:function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this},sub:function(t,i){return void 0!==i?this.subVectors(t,i):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this},multiply:function(t,i){return void 0!==i?this.multiplyVectors(t,i):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return isFinite(t)?(this.x*=t,this.y*=t,this.z*=t):(this.x=0,this.y=0,this.z=0),this},multiplyVectors:function(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this},applyEuler:function(t){return void 0===g&&(g=new H.Quaternion),this.applyQuaternion(g.setFromEuler(t)),this},applyAxisAngle:function(){var t;return function(i,n){return void 0===t&&(t=new H.Quaternion),this.applyQuaternion(t.setFromAxisAngle(i,n)),this}}(),applyMatrix3:function(t){var i=this.x,n=this.y,e=this.z,s=t.elements;return this.x=s[0]*i+s[3]*n+s[6]*e,this.y=s[1]*i+s[4]*n+s[7]*e,this.z=s[2]*i+s[5]*n+s[8]*e,this},applyMatrix4:function(t){var i=this.x,n=this.y,e=this.z,s=t.elements;return this.x=s[0]*i+s[4]*n+s[8]*e+s[12],this.y=s[1]*i+s[5]*n+s[9]*e+s[13],this.z=s[2]*i+s[6]*n+s[10]*e+s[14],this},applyProjection:function(t){var i=this.x,n=this.y,e=this.z,s=t.elements,r=1/(s[3]*i+s[7]*n+s[11]*e+s[15]);return this.x=(s[0]*i+s[4]*n+s[8]*e+s[12])*r,this.y=(s[1]*i+s[5]*n+s[9]*e+s[13])*r,this.z=(s[2]*i+s[6]*n+s[10]*e+s[14])*r,this},applyQuaternion:function(t){var i=this.x,n=this.y,e=this.z,s=t.x,r=t.y,h=t.z,o=t.w,a=o*i+r*e-h*n,u=o*n+h*i-s*e,f=o*e+s*n-r*i,c=-s*i-r*n-h*e;return this.x=a*o+c*-s+u*-h-f*-r,this.y=u*o+c*-r+f*-s-a*-h,this.z=f*o+c*-h+a*-r-u*-s,this},project:function(t){return void 0===M&&(M=new H.Matrix4),M.multiplyMatrices(t.projectionMatrix,M.getInverse(t.matrixWorld)),this.applyProjection(M)},unproject:function(){var t;return function(i){return void 0===t&&(t=new H.Matrix4),t.multiplyMatrices(i.matrixWorld,t.getInverse(i.projectionMatrix)),this.applyProjection(t)}}(),transformDirection:function(t){var i=this.x,n=this.y,e=this.z,s=t.elements;return this.x=s[0]*i+s[4]*n+s[8]*e,this.y=s[1]*i+s[5]*n+s[9]*e,this.z=s[2]*i+s[6]*n+s[10]*e,this.normalize(),this},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this},clampScalar:function(){var t,i;return function(n,e){return void 0===t&&(t=new H.Vector3,i=new H.Vector3),t.set(n,n,n),i.set(e,e,e),this.clamp(t,i)}}(),clampLength:function(t,i){var n=this.length();return this.multiplyScalar(Math.max(t,Math.min(i,n))/n),this},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(t){return this.multiplyScalar(t/this.length())},lerp:function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this},lerpVectors:function(t,i,n){return this.subVectors(i,t).multiplyScalar(n).add(t),this},cross:function(t,i){if(void 0!==i)return this.crossVectors(t,i);var n=this.x,e=this.y,s=this.z;return this.x=e*t.z-s*t.y,this.y=s*t.x-n*t.z,this.z=n*t.y-e*t.x,this},crossVectors:function(t,i){var n=t.x,e=t.y,s=t.z,r=i.x,h=i.y,o=i.z;return this.x=e*o-s*h,this.y=s*r-n*o,this.z=n*h-e*r,this},projectOnVector:function(t){return void 0===p&&(p=new H.Vector3),p.copy(t).normalize(),m=this.dot(p),this.copy(p).multiplyScalar(m)},projectOnPlane:function(){var t;return function(i){return void 0===t&&(t=new H.Vector3),t.copy(this).projectOnVector(i),this.sub(t)}}(),reflect:function(){var t;return function(i){return void 0===t&&(t=new H.Vector3),this.sub(t.copy(i).multiplyScalar(2*this.dot(i)))}}(),angleTo:function(t){var i=this.dot(t)/Math.sqrt(this.lengthSq()*t.lengthSq());return Math.acos(H.Math.clamp(i,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var i=this.x-t.x,n=this.y-t.y,e=this.z-t.z;return i*i+n*n+e*e},setFromSpherical:function(t){var i=Math.sin(t.phi)*t.radius;return this.x=i*Math.sin(t.theta),this.y=Math.cos(t.phi)*t.radius,this.z=i*Math.cos(t.theta),this},setFromMatrixPosition:function(t){return this.setFromMatrixColumn(t,3)},setFromMatrixScale:function(t){var i=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),e=this.setFromMatrixColumn(t,2).length();return this.x=i,this.y=n,this.z=e,this},setFromMatrixColumn:function(t,i){return"number"==typeof t&&(t=arguments[1],i=arguments[0]),this.fromArray(t.elements,4*i)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,i){return void 0===i&&(i=0),this.x=t[i],this.y=t[i+1],this.z=t[i+2],this},toArray:function(t,i){return void 0===t&&(t=[]),void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t},fromAttribute:function(t,i,n){return void 0===n&&(n=0),this.x=t.array[i=i*t.itemSize+n],this.y=t.array[i+1],this.z=t.array[i+2],this}},H.Vector4=function(t,i,n,e){this.x=t||0,this.y=i||0,this.z=n||0,this.w=void 0!==e?e:1},H.Vector4.prototype={constructor:H.Vector4,set:function(t,i,n,e){return this.x=t,this.y=i,this.z=n,this.w=e,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+t)}},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},add:function(t,i){return void 0!==i?this.addVectors(t,i):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this.w=t.w+i.w,this},addScaledVector:function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this.w+=t.w*i,this},sub:function(t,i){return void 0!==i?this.subVectors(t,i):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},subVectors:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this.w=t.w-i.w,this},multiplyScalar:function(t){return isFinite(t)?(this.x*=t,this.y*=t,this.z*=t,this.w*=t):(this.x=0,this.y=0,this.z=0,this.w=0),this},applyMatrix4:function(t){var i=this.x,n=this.y,e=this.z,s=this.w,r=t.elements;return this.x=r[0]*i+r[4]*n+r[8]*e+r[12]*s,this.y=r[1]*i+r[5]*n+r[9]*e+r[13]*s,this.z=r[2]*i+r[6]*n+r[10]*e+r[14]*s,this.w=r[3]*i+r[7]*n+r[11]*e+r[15]*s,this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var i=Math.sqrt(1-t.w*t.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/i,this.y=t.y/i,this.z=t.z/i),this},setAxisAngleFromRotationMatrix:function(t){var i,n,e,s,r=t.elements,h=r[0],o=r[4],a=r[8],u=r[1],f=r[5],c=r[9],l=r[2],v=r[6],d=r[10];if(Math.abs(o-u)<.01&&Math.abs(a-l)<.01&&Math.abs(c-v)<.01){if(Math.abs(o+u)<.1&&Math.abs(a+l)<.1&&Math.abs(c+v)<.1&&Math.abs(h+f+d-3)<.1)return this.set(1,0,0,0),this;i=Math.PI;var p=(h+1)/2,m=(f+1)/2,M=(d+1)/2,g=(o+u)/4,w=(a+l)/4,y=(c+v)/4;return p>m&&p>M?p<.01?(n=0,e=.707106781,s=.707106781):(e=g/(n=Math.sqrt(p)),s=w/n):m>M?m<.01?(n=.707106781,e=0,s=.707106781):(n=g/(e=Math.sqrt(m)),s=y/e):M<.01?(n=.707106781,e=.707106781,s=0):(n=w/(s=Math.sqrt(M)),e=y/s),this.set(n,e,s,i),this}var _=Math.sqrt((v-c)*(v-c)+(a-l)*(a-l)+(u-o)*(u-o));return Math.abs(_)<.001&&(_=1),this.x=(v-c)/_,this.y=(a-l)/_,this.z=(u-o)/_,this.w=Math.acos((h+f+d-1)/2),this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},clamp:function(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this.w=Math.max(t.w,Math.min(i.w,this.w)),this},clampScalar:function(){var t,i;return function(n,e){return void 0===t&&(t=new H.Vector4,i=new H.Vector4),t.set(n,n,n,n),i.set(e,e,e,e),this.clamp(t,i)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(t){return this.multiplyScalar(t/this.length())},lerp:function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this.w+=(t.w-this.w)*i,this},lerpVectors:function(t,i,n){return this.subVectors(i,t).multiplyScalar(n).add(t),this},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,i){return void 0===i&&(i=0),this.x=t[i],this.y=t[i+1],this.z=t[i+2],this.w=t[i+3],this},toArray:function(t,i){return void 0===t&&(t=[]),void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,t},fromAttribute:function(t,i,n){return void 0===n&&(n=0),this.x=t.array[i=i*t.itemSize+n],this.y=t.array[i+1],this.z=t.array[i+2],this.w=t.array[i+3],this}},H.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1])},H.Matrix3.prototype={constructor:H.Matrix3,set:function(t,i,n,e,s,r,h,o,a){var u=this.elements;return u[0]=t,u[1]=e,u[2]=h,u[3]=i,u[4]=s,u[5]=o,u[6]=n,u[7]=r,u[8]=a,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t){var i=t.elements;return this.set(i[0],i[3],i[6],i[1],i[4],i[7],i[2],i[5],i[8]),this},setFromMatrix4:function(t){var i=t.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this},applyToVector3Array:function(){var t;return function(i,n,e){void 0===t&&(t=new H.Vector3),void 0===n&&(n=0),void 0===e&&(e=i.length);for(var s=0,r=n;s<e;s+=3,r+=3)t.fromArray(i,r),t.applyMatrix3(this),t.toArray(i,r);return i}}(),applyToBuffer:function(){var t;return function(i,n,e){void 0===t&&(t=new H.Vector3),void 0===n&&(n=0),void 0===e&&(e=i.length/i.itemSize);for(var s=0,r=n;s<e;s++,r++)t.x=i.getX(r),t.y=i.getY(r),t.z=i.getZ(r),t.applyMatrix3(this),i.setXYZ(t.x,t.y,t.z);return i}}(),multiplyScalar:function(t){var i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=t,i[4]*=t,i[7]*=t,i[2]*=t,i[5]*=t,i[8]*=t,this},determinant:function(){var t=this.elements,i=t[0],n=t[1],e=t[2],s=t[3],r=t[4],h=t[5],o=t[6],a=t[7],u=t[8];return i*r*u-i*h*a-n*s*u+n*h*o+e*s*a-e*r*o},getInverse:function(t,i){var n=t.elements,e=this.elements,s=n[0],r=n[1],h=n[2],o=n[3],a=n[4],u=n[5],f=n[6],c=n[7],l=n[8],v=l*a-u*c,d=u*f-l*o,p=c*o-a*f,m=s*v+r*d+h*p;if(0===m){if(i)throw new Error("THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0");return this.identity()}return e[0]=v,e[1]=h*c-l*r,e[2]=u*r-h*a,e[3]=d,e[4]=l*s-h*f,e[5]=h*o-u*s,e[6]=p,e[7]=r*f-c*s,e[8]=a*s-r*o,this.multiplyScalar(1/m)},transpose:function(){var t,i=this.elements;return t=i[1],i[1]=i[3],i[3]=t,t=i[2],i[2]=i[6],i[6]=t,t=i[5],i[5]=i[7],i[7]=t,this},flattenToArrayOffset:function(t,i){var n=this.elements;return t[i]=n[0],t[i+1]=n[1],t[i+2]=n[2],t[i+3]=n[3],t[i+4]=n[4],t[i+5]=n[5],t[i+6]=n[6],t[i+7]=n[7],t[i+8]=n[8],t},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){var i=this.elements;return t[0]=i[0],t[1]=i[3],t[2]=i[6],t[3]=i[1],t[4]=i[4],t[5]=i[7],t[6]=i[2],t[7]=i[5],t[8]=i[8],this},fromArray:function(t){return this.elements.set(t),this},toArray:function(){var t=this.elements;return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]}},H.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])},H.Matrix4.prototype={constructor:H.Matrix4,set:function(t,i,n,e,s,r,h,o,a,u,f,c,l,v,d,p){var m=this.elements;return m[0]=t,m[4]=i,m[8]=n,m[12]=e,m[1]=s,m[5]=r,m[9]=h,m[13]=o,m[2]=a,m[6]=u,m[10]=f,m[14]=c,m[3]=l,m[7]=v,m[11]=d,m[15]=p,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new H.Matrix4).fromArray(this.elements)},copy:function(t){return this.elements.set(t.elements),this},copyPosition:function(t){var i=this.elements,n=t.elements;return i[12]=n[12],i[13]=n[13],i[14]=n[14],this},extractBasis:function(t,i,n){return t.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},makeBasis:function(t,i,n){return this.set(t.x,i.x,n.x,0,t.y,i.y,n.y,0,t.z,i.z,n.z,0,0,0,0,1),this},extractRotation:function(){var t;return function(i){void 0===t&&(t=new H.Vector3);var n=this.elements,e=i.elements,s=1/t.setFromMatrixColumn(i,0).length(),r=1/t.setFromMatrixColumn(i,1).length(),h=1/t.setFromMatrixColumn(i,2).length();return n[0]=e[0]*s,n[1]=e[1]*s,n[2]=e[2]*s,n[4]=e[4]*r,n[5]=e[5]*r,n[6]=e[6]*r,n[8]=e[8]*h,n[9]=e[9]*h,n[10]=e[10]*h,this}}(),makeRotationFromEuler:function(t){var i=this.elements,n=t.x,e=t.y,s=t.z,r=Math.cos(n),h=Math.sin(n),o=Math.cos(e),a=Math.sin(e),u=Math.cos(s),f=Math.sin(s);if("XYZ"===t.order){var c=r*u,l=r*f,v=h*u,d=h*f;i[0]=o*u,i[4]=-o*f,i[8]=a,i[1]=l+v*a,i[5]=c-d*a,i[9]=-h*o,i[2]=d-c*a,i[6]=v+l*a,i[10]=r*o}else if("YXZ"===t.order){var p=o*f,m=a*u;i[0]=(M=o*u)+(g=a*f)*h,i[4]=m*h-p,i[8]=r*a,i[1]=r*f,i[5]=r*u,i[9]=-h,i[2]=p*h-m,i[6]=g+M*h,i[10]=r*o}else if("ZXY"===t.order){var M,g;p=o*f,m=a*u,i[0]=(M=o*u)-(g=a*f)*h,i[4]=-r*f,i[8]=m+p*h,i[1]=p+m*h,i[5]=r*u,i[9]=g-M*h,i[2]=-r*a,i[6]=h,i[10]=r*o}else if("ZYX"===t.order)c=r*u,l=r*f,v=h*u,d=h*f,i[0]=o*u,i[4]=v*a-l,i[8]=c*a+d,i[1]=o*f,i[5]=d*a+c,i[9]=l*a-v,i[2]=-a,i[6]=h*o,i[10]=r*o;else if("YZX"===t.order){var w=r*o,y=r*a,_=h*o,x=h*a;i[0]=o*u,i[4]=x-w*f,i[8]=_*f+y,i[1]=f,i[5]=r*u,i[9]=-h*u,i[2]=-a*u,i[6]=y*f+_,i[10]=w-x*f}else"XZY"===t.order&&(w=r*o,y=r*a,_=h*o,x=h*a,i[0]=o*u,i[4]=-f,i[8]=a*u,i[1]=w*f+x,i[5]=r*u,i[9]=y*f-_,i[2]=_*f-y,i[6]=h*u,i[10]=x*f+w);return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this},makeRotationFromQuaternion:function(t){var i=this.elements,n=t.x,e=t.y,s=t.z,r=t.w,h=n+n,o=e+e,a=s+s,u=n*h,f=n*o,c=n*a,l=e*o,v=e*a,d=s*a,p=r*h,m=r*o,M=r*a;return i[0]=1-(l+d),i[4]=f-M,i[8]=c+m,i[1]=f+M,i[5]=1-(u+d),i[9]=v-p,i[2]=c-m,i[6]=v+p,i[10]=1-(u+l),i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this},lookAt:function(t,i,n){void 0===w&&(w=new H.Vector3),void 0===y&&(y=new H.Vector3),void 0===_&&(_=new H.Vector3);var e=this.elements;return _.subVectors(t,i).normalize(),0===_.lengthSq()&&(_.z=1),w.crossVectors(n,_).normalize(),0===w.lengthSq()&&(_.x+=1e-4,w.crossVectors(n,_).normalize()),y.crossVectors(_,w),e[0]=w.x,e[4]=y.x,e[8]=_.x,e[1]=w.y,e[5]=y.y,e[9]=_.y,e[2]=w.z,e[6]=y.z,e[10]=_.z,this},multiply:function(t,i){return void 0!==i?this.multiplyMatrices(t,i):this.multiplyMatrices(this,t)},multiplyMatrices:function(t,i){var n=t.elements,e=i.elements,s=this.elements,r=n[0],h=n[4],o=n[8],a=n[12],u=n[1],f=n[5],c=n[9],l=n[13],v=n[2],d=n[6],p=n[10],m=n[14],M=n[3],g=n[7],w=n[11],y=n[15],_=e[0],x=e[4],E=e[8],S=e[12],b=e[1],A=e[5],P=e[9],T=e[13],L=e[2],O=e[6],U=e[10],N=e[14],k=e[3],D=e[7],F=e[11],I=e[15];return s[0]=r*_+h*b+o*L+a*k,s[4]=r*x+h*A+o*O+a*D,s[8]=r*E+h*P+o*U+a*F,s[12]=r*S+h*T+o*N+a*I,s[1]=u*_+f*b+c*L+l*k,s[5]=u*x+f*A+c*O+l*D,s[9]=u*E+f*P+c*U+l*F,s[13]=u*S+f*T+c*N+l*I,s[2]=v*_+d*b+p*L+m*k,s[6]=v*x+d*A+p*O+m*D,s[10]=v*E+d*P+p*U+m*F,s[14]=v*S+d*T+p*N+m*I,s[3]=M*_+g*b+w*L+y*k,s[7]=M*x+g*A+w*O+y*D,s[11]=M*E+g*P+w*U+y*F,s[15]=M*S+g*T+w*N+y*I,this},multiplyToArray:function(t,i,n){var e=this.elements;return this.multiplyMatrices(t,i),n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],this},multiplyScalar:function(t){var i=this.elements;return i[0]*=t,i[4]*=t,i[8]*=t,i[12]*=t,i[1]*=t,i[5]*=t,i[9]*=t,i[13]*=t,i[2]*=t,i[6]*=t,i[10]*=t,i[14]*=t,i[3]*=t,i[7]*=t,i[11]*=t,i[15]*=t,this},applyToVector3Array:function(){var t;return function(i,n,e){void 0===t&&(t=new H.Vector3),void 0===n&&(n=0),void 0===e&&(e=i.length);for(var s=0,r=n;s<e;s+=3,r+=3)t.fromArray(i,r),t.applyMatrix4(this),t.toArray(i,r);return i}}(),applyToBuffer:function(){var t;return function(i,n,e){void 0===t&&(t=new H.Vector3),void 0===n&&(n=0),void 0===e&&(e=i.length/i.itemSize);for(var s=0,r=n;s<e;s++,r++)t.x=i.getX(r),t.y=i.getY(r),t.z=i.getZ(r),t.applyMatrix4(this),i.setXYZ(t.x,t.y,t.z);return i}}(),determinant:function(){var t=this.elements,i=t[0],n=t[4],e=t[8],s=t[12],r=t[1],h=t[5],o=t[9],a=t[13],u=t[2],f=t[6],c=t[10],l=t[14];return t[3]*(+s*o*f-e*a*f-s*h*c+n*a*c+e*h*l-n*o*l)+t[7]*(+i*o*l-i*a*c+s*r*c-e*r*l+e*a*u-s*o*u)+t[11]*(+i*a*f-i*h*l-s*r*f+n*r*l+s*h*u-n*a*u)+t[15]*(-e*h*u-i*o*f+i*h*c+e*r*f-n*r*c+n*o*u)},transpose:function(){var t,i=this.elements;return t=i[1],i[1]=i[4],i[4]=t,t=i[2],i[2]=i[8],i[8]=t,t=i[6],i[6]=i[9],i[9]=t,t=i[3],i[3]=i[12],i[12]=t,t=i[7],i[7]=i[13],i[13]=t,t=i[11],i[11]=i[14],i[14]=t,this},flattenToArrayOffset:function(t,i){var n=this.elements;return t[i]=n[0],t[i+1]=n[1],t[i+2]=n[2],t[i+3]=n[3],t[i+4]=n[4],t[i+5]=n[5],t[i+6]=n[6],t[i+7]=n[7],t[i+8]=n[8],t[i+9]=n[9],t[i+10]=n[10],t[i+11]=n[11],t[i+12]=n[12],t[i+13]=n[13],t[i+14]=n[14],t[i+15]=n[15],t},getPosition:function(){var t;return function(){return void 0===t&&(t=new H.Vector3),t.setFromMatrixColumn(this,3)}}(),setPosition:function(t){var i=this.elements;return i[12]=t.x,i[13]=t.y,i[14]=t.z,this},getInverse:function(t,i){var n=this.elements,e=t.elements,s=e[0],r=e[1],h=e[2],o=e[3],a=e[4],u=e[5],f=e[6],c=e[7],l=e[8],v=e[9],d=e[10],p=e[11],m=e[12],M=e[13],g=e[14],w=e[15],y=v*g*c-M*d*c+M*f*p-u*g*p-v*f*w+u*d*w,_=m*d*c-l*g*c-m*f*p+a*g*p+l*f*w-a*d*w,x=l*M*c-m*v*c+m*u*p-a*M*p-l*u*w+a*v*w,E=m*v*f-l*M*f-m*u*d+a*M*d+l*u*g-a*v*g,S=s*y+r*_+h*x+o*E;if(0===S){if(i)throw new Error("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");return this.identity()}return n[0]=y,n[1]=M*d*o-v*g*o-M*h*p+r*g*p+v*h*w-r*d*w,n[2]=u*g*o-M*f*o+M*h*c-r*g*c-u*h*w+r*f*w,n[3]=v*f*o-u*d*o-v*h*c+r*d*c+u*h*p-r*f*p,n[4]=_,n[5]=l*g*o-m*d*o+m*h*p-s*g*p-l*h*w+s*d*w,n[6]=m*f*o-a*g*o-m*h*c+s*g*c+a*h*w-s*f*w,n[7]=a*d*o-l*f*o+l*h*c-s*d*c-a*h*p+s*f*p,n[8]=x,n[9]=m*v*o-l*M*o-m*r*p+s*M*p+l*r*w-s*v*w,n[10]=a*M*o-m*u*o+m*r*c-s*M*c-a*r*w+s*u*w,n[11]=l*u*o-a*v*o-l*r*c+s*v*c+a*r*p-s*u*p,n[12]=E,n[13]=l*M*h-m*v*h+m*r*d-s*M*d-l*r*g+s*v*g,n[14]=m*u*h-a*M*h-m*r*f+s*M*f+a*r*g-s*u*g,n[15]=a*v*h-l*u*h+l*r*f-s*v*f-a*r*d+s*u*d,this.multiplyScalar(1/S)},scale:function(t){var i=this.elements,n=t.x,e=t.y,s=t.z;return i[0]*=n,i[4]*=e,i[8]*=s,i[1]*=n,i[5]*=e,i[9]*=s,i[2]*=n,i[6]*=e,i[10]*=s,i[3]*=n,i[7]*=e,i[11]*=s,this},getMaxScaleOnAxis:function(){var t=this.elements;return Math.sqrt(Math.max(t[0]*t[0]+t[1]*t[1]+t[2]*t[2],t[4]*t[4]+t[5]*t[5]+t[6]*t[6],t[8]*t[8]+t[9]*t[9]+t[10]*t[10]))},makeTranslation:function(t,i,n){return this.set(1,0,0,t,0,1,0,i,0,0,1,n,0,0,0,1),this},makeRotationX:function(t){var i=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,i,-n,0,0,n,i,0,0,0,0,1),this},makeRotationY:function(t){var i=Math.cos(t),n=Math.sin(t);return this.set(i,0,n,0,0,1,0,0,-n,0,i,0,0,0,0,1),this},makeRotationZ:function(t){var i=Math.cos(t),n=Math.sin(t);return this.set(i,-n,0,0,n,i,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,i){var n=Math.cos(i),e=Math.sin(i),s=1-n,r=t.x,h=t.y,o=t.z,a=s*r,u=s*h;return this.set(a*r+n,a*h-e*o,a*o+e*h,0,a*h+e*o,u*h+n,u*o-e*r,0,a*o-e*h,u*o+e*r,s*o*o+n,0,0,0,0,1),this},makeScale:function(t,i,n){return this.set(t,0,0,0,0,i,0,0,0,0,n,0,0,0,0,1),this},compose:function(t,i,n){return this.makeRotationFromQuaternion(i),this.scale(n),this.setPosition(t),this},decompose:function(){var t,i;return function(n,e,s){void 0===t&&(t=new H.Vector3),void 0===i&&(i=new H.Matrix4);var r=this.elements,h=t.set(r[0],r[1],r[2]).length(),o=t.set(r[4],r[5],r[6]).length(),a=t.set(r[8],r[9],r[10]).length();this.determinant()<0&&(h=-h),n.x=r[12],n.y=r[13],n.z=r[14],i.elements.set(this.elements);var u=1/h,f=1/o,c=1/a;return i.elements[0]*=u,i.elements[1]*=u,i.elements[2]*=u,i.elements[4]*=f,i.elements[5]*=f,i.elements[6]*=f,i.elements[8]*=c,i.elements[9]*=c,i.elements[10]*=c,e.setFromRotationMatrix(i),s.x=h,s.y=o,s.z=a,this}}(),makeFrustum:function(t,i,n,e,s,r){var h=this.elements,o=2*s/(e-n),a=(i+t)/(i-t),u=(e+n)/(e-n),f=-(r+s)/(r-s),c=-2*r*s/(r-s);return h[0]=2*s/(i-t),h[4]=0,h[8]=a,h[12]=0,h[1]=0,h[5]=o,h[9]=u,h[13]=0,h[2]=0,h[6]=0,h[10]=f,h[14]=c,h[3]=0,h[7]=0,h[11]=-1,h[15]=0,this},makePerspective:function(t,i,n,e){var s=n*Math.tan(H.Math.degToRad(.5*t)),r=-s;return this.makeFrustum(r*i,s*i,r,s,n,e)},makeOrthographic:function(t,i,n,e,s,r){var h=this.elements,o=1/(i-t),a=1/(n-e),u=1/(r-s),f=(i+t)*o,c=(n+e)*a,l=(r+s)*u;return h[0]=2*o,h[4]=0,h[8]=0,h[12]=-f,h[1]=0,h[5]=2*a,h[9]=0,h[13]=-c,h[2]=0,h[6]=0,h[10]=-2*u,h[14]=-l,h[3]=0,h[7]=0,h[11]=0,h[15]=1,this},equals:function(t){for(var i=this.elements,n=t.elements,e=0;e<16;e++)if(i[e]!==n[e])return!1;return!0},fromArray:function(t){return this.elements.set(t),this},toArray:function(){var t=this.elements;return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]}},H.Plane=function(t,i){this.normal=void 0!==t?t:new H.Vector3(1,0,0),this.constant=void 0!==i?i:0},H.Plane.prototype={constructor:H.Plane,set:function(t,i){return this.normal.copy(t),this.constant=i,this},setComponents:function(t,i,n,e){return this.normal.set(t,i,n),this.constant=e,this},setFromNormalAndCoplanarPoint:function(t,i){return this.normal.copy(t),this.constant=-i.dot(this.normal),this},setFromCoplanarPoints:function(){var t=new H.Vector3,i=new H.Vector3;return function(n,e,s){var r=t.subVectors(s,e).cross(i.subVectors(n,e)).normalize();return this.setFromNormalAndCoplanarPoint(r,n),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,i){return this.orthoPoint(t,i).sub(t).negate()},orthoPoint:function(t,i){var n=this.distanceToPoint(t);return(i||new H.Vector3).copy(this.normal).multiplyScalar(n)},intersectLine:function(){var t=new H.Vector3;return function(i,n){var e=n||new H.Vector3,s=i.delta(t),r=this.normal.dot(s);if(0===r)return 0===this.distanceToPoint(i.start)?e.copy(i.start):void 0;var h=-(i.start.dot(this.normal)+this.constant)/r;return h<0||h>1?void 0:e.copy(s).multiplyScalar(h).add(i.start)}}(),intersectsLine:function(t){var i=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return i<0&&n>0||n<0&&i>0},intersectsBox:function(t){return t.intersectsPlane(this)},intersectsSphere:function(t){return t.intersectsPlane(this)},coplanarPoint:function(t){return(t||new H.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var t=new H.Vector3,i=new H.Vector3,n=new H.Matrix3;return function(e,s){var r=s||n.getNormalMatrix(e),h=t.copy(this.normal).applyMatrix3(r),o=this.coplanarPoint(i);return o.applyMatrix4(e),this.setFromNormalAndCoplanarPoint(h,o),this}}(),translate:function(t){return this.constant=this.constant-t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}},H.Quaternion=function(t,i,n,e){this._x=t||0,this._y=i||0,this._z=n||0,this._w=void 0!==e?e:1},H.Quaternion.prototype={constructor:H.Quaternion,get x(){return this._x},set x(t){this._x=t,this.onChangeCallback()},get y(){return this._y},set y(t){this._y=t,this.onChangeCallback()},get z(){return this._z},set z(t){this._z=t,this.onChangeCallback()},get w(){return this._w},set w(t){this._w=t,this.onChangeCallback()},set:function(t,i,n,e){return this._x=t,this._y=i,this._z=n,this._w=e,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this.onChangeCallback(),this},setFromEuler:function(t,i){if(t instanceof H.Euler==0)throw new Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var n=Math.cos(t._x/2),e=Math.cos(t._y/2),s=Math.cos(t._z/2),r=Math.sin(t._x/2),h=Math.sin(t._y/2),o=Math.sin(t._z/2),a=t.order;return"XYZ"===a?(this._x=r*e*s+n*h*o,this._y=n*h*s-r*e*o,this._z=n*e*o+r*h*s,this._w=n*e*s-r*h*o):"YXZ"===a?(this._x=r*e*s+n*h*o,this._y=n*h*s-r*e*o,this._z=n*e*o-r*h*s,this._w=n*e*s+r*h*o):"ZXY"===a?(this._x=r*e*s-n*h*o,this._y=n*h*s+r*e*o,this._z=n*e*o+r*h*s,this._w=n*e*s-r*h*o):"ZYX"===a?(this._x=r*e*s-n*h*o,this._y=n*h*s+r*e*o,this._z=n*e*o-r*h*s,this._w=n*e*s+r*h*o):"YZX"===a?(this._x=r*e*s+n*h*o,this._y=n*h*s+r*e*o,this._z=n*e*o-r*h*s,this._w=n*e*s-r*h*o):"XZY"===a&&(this._x=r*e*s-n*h*o,this._y=n*h*s-r*e*o,this._z=n*e*o+r*h*s,this._w=n*e*s+r*h*o),!1!==i&&this.onChangeCallback(),this},setFromAxisAngle:function(t,i){var n=i/2,e=Math.sin(n);return this._x=t.x*e,this._y=t.y*e,this._z=t.z*e,this._w=Math.cos(n),this.onChangeCallback(),this},setFromRotationMatrix:function(t){var i,n=t.elements,e=n[0],s=n[4],r=n[8],h=n[1],o=n[5],a=n[9],u=n[2],f=n[6],c=n[10],l=e+o+c;return l>0?(i=.5/Math.sqrt(l+1),this._w=.25/i,this._x=(f-a)*i,this._y=(r-u)*i,this._z=(h-s)*i):e>o&&e>c?(i=2*Math.sqrt(1+e-o-c),this._w=(f-a)/i,this._x=.25*i,this._y=(s+h)/i,this._z=(r+u)/i):o>c?(i=2*Math.sqrt(1+o-e-c),this._w=(r-u)/i,this._x=(s+h)/i,this._y=.25*i,this._z=(a+f)/i):(i=2*Math.sqrt(1+c-e-o),this._w=(h-s)/i,this._x=(r+u)/i,this._y=(a+f)/i,this._z=.25*i),this.onChangeCallback(),this},setFromUnitVectors:function(){var t,i;return function(n,e){return void 0===t&&(t=new H.Vector3),(i=n.dot(e)+1)<1e-6?(i=0,Math.abs(n.x)>Math.abs(n.z)?t.set(-n.y,n.x,0):t.set(0,-n.z,n.y)):t.crossVectors(n,e),this._x=t.x,this._y=t.y,this._z=t.z,this._w=i,this.normalize(),this}}(),inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(this._x=this._x*(t=1/t),this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this.onChangeCallback(),this},multiply:function(t,i){return void 0!==i?this.multiplyQuaternions(t,i):this.multiplyQuaternions(this,t)},multiplyQuaternions:function(t,i){var n=t._x,e=t._y,s=t._z,r=t._w,h=i._x,o=i._y,a=i._z,u=i._w;return this._x=n*u+r*h+e*a-s*o,this._y=e*u+r*o+s*h-n*a,this._z=s*u+r*a+n*o-e*h,this._w=r*u-n*h-e*o-s*a,this.onChangeCallback(),this},slerp:function(t,i){if(0===i)return this;if(1===i)return this.copy(t);var n=this._x,e=this._y,s=this._z,r=this._w,h=r*t._w+n*t._x+e*t._y+s*t._z;if(h<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,h=-h):this.copy(t),h>=1)return this._w=r,this._x=n,this._y=e,this._z=s,this;var o=Math.sqrt(1-h*h);if(Math.abs(o)<.001)return this._w=.5*(r+this._w),this._x=.5*(n+this._x),this._y=.5*(e+this._y),this._z=.5*(s+this._z),this;var a=Math.atan2(o,h),u=Math.sin((1-i)*a)/o,f=Math.sin(i*a)/o;return this._w=r*u+this._w*f,this._x=n*u+this._x*f,this._y=e*u+this._y*f,this._z=s*u+this._z*f,this.onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,i){return void 0===i&&(i=0),this._x=t[i],this._y=t[i+1],this._z=t[i+2],this._w=t[i+3],this.onChangeCallback(),this},toArray:function(t,i){return void 0===t&&(t=[]),void 0===i&&(i=0),t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._w,t},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}},Object.assign(H.Quaternion,{slerp:function(t,i,n,e){return n.copy(t).slerp(i,e)},slerpFlat:function(t,i,n,e,s,r,h){var o=n[e+0],a=n[e+1],u=n[e+2],f=n[e+3],c=s[r+0],l=s[r+1],v=s[r+2],d=s[r+3];if(f!==d||o!==c||a!==l||u!==v){var p=1-h,m=o*c+a*l+u*v+f*d,M=m>=0?1:-1,g=1-m*m;if(g>Number.EPSILON){var w=Math.sqrt(g),y=Math.atan2(w,m*M);p=Math.sin(p*y)/w,h=Math.sin(h*y)/w}var _=h*M;if(o=o*p+c*_,a=a*p+l*_,u=u*p+v*_,f=f*p+d*_,p===1-h){var x=1/Math.sqrt(o*o+a*a+u*u+f*f);o*=x,a*=x,u*=x,f*=x}}t[i]=o,t[i+1]=a,t[i+2]=u,t[i+3]=f}}),H.Triangle=function(t,i,n){this.a=void 0!==t?t:new H.Vector3,this.b=void 0!==i?i:new H.Vector3,this.c=void 0!==n?n:new H.Vector3},H.Triangle.normal=(x=new H.Vector3,function(t,i,n,e){var s=e||new H.Vector3;s.subVectors(n,i),x.subVectors(t,i),s.cross(x);var r=s.lengthSq();return r>0?s.multiplyScalar(1/Math.sqrt(r)):s.set(0,0,0)}),H.Triangle.barycoordFromPoint=function(){var t=new H.Vector3,i=new H.Vector3,n=new H.Vector3;return function(e,s,r,h,o){t.subVectors(h,s),i.subVectors(r,s),n.subVectors(e,s);var a=t.dot(t),u=t.dot(i),f=t.dot(n),c=i.dot(i),l=i.dot(n),v=a*c-u*u,d=o||new H.Vector3;if(0===v)return d.set(-2,-1,-1);var p=1/v,m=(c*f-u*l)*p,M=(a*l-u*f)*p;return d.set(1-m-M,M,m)}}(),H.Triangle.containsPoint=function(){var t=new H.Vector3;return function(i,n,e,s){var r=H.Triangle.barycoordFromPoint(i,n,e,s,t);return r.x>=0&&r.y>=0&&r.x+r.y<=1}}(),H.Triangle.prototype={constructor:H.Triangle,set:function(t,i,n){return this.a.copy(t),this.b.copy(i),this.c.copy(n),this},setFromPointsAndIndices:function(t,i,n,e){return this.a.copy(t[i]),this.b.copy(t[n]),this.c.copy(t[e]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},area:function(){var t=new H.Vector3,i=new H.Vector3;return function(){return t.subVectors(this.c,this.b),i.subVectors(this.a,this.b),.5*t.cross(i).length()}}(),midpoint:function(t){return(t||new H.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(t){return H.Triangle.normal(this.a,this.b,this.c,t)},plane:function(t){return(t||new H.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(t,i){return H.Triangle.barycoordFromPoint(t,this.a,this.b,this.c,i)},containsPoint:function(t){return H.Triangle.containsPoint(t,this.a,this.b,this.c)},equals:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}},H.Box3=function(t,i){this.min=void 0!==t?t:new H.Vector3(1/0,1/0,1/0),this.max=void 0!==i?i:new H.Vector3(-1/0,-1/0,-1/0)},H.Box3.prototype={constructor:H.Box3,set:function(t,i){return this.min.copy(t),this.max.copy(i),this},setFromArray:function(t){this.makeEmpty();for(var i=1/0,n=1/0,e=1/0,s=-1/0,r=-1/0,h=-1/0,o=0,a=t.length;o<a;o+=3){var u=t[o],f=t[o+1],c=t[o+2];u<i&&(i=u),f<n&&(n=f),c<e&&(e=c),u>s&&(s=u),f>r&&(r=f),c>h&&(h=c)}this.min.set(i,n,e),this.max.set(s,r,h)},setFromPoints:function(t){this.makeEmpty();for(var i=0,n=t.length;i<n;i++)this.expandByPoint(t[i]);return this},setFromCenterAndSize:function(){var t=new H.Vector3;return function(i,n){var e=t.copy(n).multiplyScalar(.5);return this.min.copy(i).sub(e),this.max.copy(i).add(e),this}}(),setFromObject:function(t){void 0===b&&(b=new H.Box3);var i=this;return this.makeEmpty(),t.updateMatrixWorld(!0),t.traverse((function(t){var n=t.geometry;void 0!==n&&(null===n.boundingBox&&n.computeBoundingBox(),!1===n.boundingBox.isEmpty()&&(b.copy(n.boundingBox),b.applyMatrix4(t.matrixWorld),i.union(b)))})),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(t){return(t||new H.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(t){return(t||new H.Vector3).subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,i){return(i||new H.Vector3).set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},intersectsSphere:function(t){return void 0===S&&(S=new H.Vector3),this.clampPoint(t.center,S),S.distanceToSquared(t.center)<=t.radius*t.radius},intersectsPlane:function(t){var i,n;return t.normal.x>0?(i=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(i=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(i+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(i+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(i+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(i+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),i<=t.constant&&n>=t.constant},clampPoint:function(t,i){return(i||new H.Vector3).copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new H.Vector3;return function(i){return t.copy(i).clamp(this.min,this.max).sub(i).length()}}(),getBoundingSphere:function(){var t=new H.Vector3;return function(i){var n=i||new H.Sphere;return n.center=this.center(),n.radius=.5*this.size(t).length(),n}}(),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:(E=[new H.Vector3,new H.Vector3,new H.Vector3,new H.Vector3,new H.Vector3,new H.Vector3,new H.Vector3,new H.Vector3],function(t){return E[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),E[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),E[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),E[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),E[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),E[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),E[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),E[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.makeEmpty(),this.setFromPoints(E),this}),translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}},H.Euler=function(t,i,n,e){this._x=t||0,this._y=i||0,this._z=n||0,this._order=e||H.Euler.DefaultOrder},H.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],H.Euler.DefaultOrder="XYZ",H.Euler.prototype={constructor:H.Euler,get x(){return this._x},set x(t){this._x=t,this.onChangeCallback()},get y(){return this._y},set y(t){this._y=t,this.onChangeCallback()},get z(){return this._z},set z(t){this._z=t,this.onChangeCallback()},get order(){return this._order},set order(t){this._order=t,this.onChangeCallback()},set:function(t,i,n,e){return this._x=t,this._y=i,this._z=n,this._order=e||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this.onChangeCallback(),this},setFromRotationMatrix:function(t,i,n){var e=H.Math.clamp,s=t.elements,r=s[0],h=s[4],o=s[8],a=s[1],u=s[5],f=s[9],c=s[2],l=s[6],v=s[10];return"XYZ"===(i=i||this._order)?(this._y=Math.asin(e(o,-1,1)),Math.abs(o)<.99999?(this._x=Math.atan2(-f,v),this._z=Math.atan2(-h,r)):(this._x=Math.atan2(l,u),this._z=0)):"YXZ"===i?(this._x=Math.asin(-e(f,-1,1)),Math.abs(f)<.99999?(this._y=Math.atan2(o,v),this._z=Math.atan2(a,u)):(this._y=Math.atan2(-c,r),this._z=0)):"ZXY"===i?(this._x=Math.asin(e(l,-1,1)),Math.abs(l)<.99999?(this._y=Math.atan2(-c,v),this._z=Math.atan2(-h,u)):(this._y=0,this._z=Math.atan2(a,r))):"ZYX"===i?(this._y=Math.asin(-e(c,-1,1)),Math.abs(c)<.99999?(this._x=Math.atan2(l,v),this._z=Math.atan2(a,r)):(this._x=0,this._z=Math.atan2(-h,u))):"YZX"===i?(this._z=Math.asin(e(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(-f,u),this._y=Math.atan2(-c,r)):(this._x=0,this._y=Math.atan2(o,v))):"XZY"===i&&(this._z=Math.asin(-e(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(l,u),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-f,v),this._y=0)),this._order=i,!1!==n&&this.onChangeCallback(),this},setFromQuaternion:function(){var t;return function(i,n,e){return void 0===t&&(t=new H.Matrix4),t.makeRotationFromQuaternion(i),this.setFromRotationMatrix(t,n,e),this}}(),setFromVector3:function(t,i){return this.set(t.x,t.y,t.z,i||this._order)},reorder:(A=new H.Quaternion,function(t){A.setFromEuler(this),this.setFromQuaternion(A,t)}),equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this.onChangeCallback(),this},toArray:function(t,i){return void 0===t&&(t=[]),void 0===i&&(i=0),t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new H.Vector3(this._x,this._y,this._z)},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}},H.Ray=function(t,i){this.origin=void 0!==t?t:new H.Vector3,this.direction=void 0!==i?i:new H.Vector3},H.Ray.prototype={constructor:H.Ray,set:function(t,i){return this.origin.copy(t),this.direction.copy(i),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,i){return(i||new H.Vector3).copy(this.direction).multiplyScalar(t).add(this.origin)},lookAt:function(t){this.direction.copy(t).sub(this.origin).normalize()},recast:function(){var t=new H.Vector3;return function(i){return this.origin.copy(this.at(i,t)),this}}(),closestPointToPoint:function(t,i){var n=i||new H.Vector3;n.subVectors(t,this.origin);var e=n.dot(this.direction);return e<0?n.copy(this.origin):n.copy(this.direction).multiplyScalar(e).add(this.origin)},distanceToPoint:function(t){return Math.sqrt(this.distanceSqToPoint(t))},distanceSqToPoint:function(){var t=new H.Vector3;return function(i){var n=t.subVectors(i,this.origin).dot(this.direction);return n<0?this.origin.distanceToSquared(i):(t.copy(this.direction).multiplyScalar(n).add(this.origin),t.distanceToSquared(i))}}(),distanceSqToSegment:(T=new H.Vector3,L=new H.Vector3,O=new H.Vector3,function(t,i,n,e){T.copy(t).add(i).multiplyScalar(.5),L.copy(i).sub(t).normalize(),O.copy(this.origin).sub(T);var s,r,h,o,a=.5*t.distanceTo(i),u=-this.direction.dot(L),f=O.dot(this.direction),c=-O.dot(L),l=O.lengthSq(),v=Math.abs(1-u*u);if(v>0)if(r=u*f-c,o=a*v,(s=u*c-f)>=0)if(r>=-o)if(r<=o){var d=1/v;h=(s*=d)*(s+u*(r*=d)+2*f)+r*(u*s+r+2*c)+l}else r=a,h=-(s=Math.max(0,-(u*r+f)))*s+r*(r+2*c)+l;else r=-a,h=-(s=Math.max(0,-(u*r+f)))*s+r*(r+2*c)+l;else r<=-o?h=-(s=Math.max(0,-(-u*a+f)))*s+(r=s>0?-a:Math.min(Math.max(-a,-c),a))*(r+2*c)+l:r<=o?(s=0,h=(r=Math.min(Math.max(-a,-c),a))*(r+2*c)+l):h=-(s=Math.max(0,-(u*a+f)))*s+(r=s>0?a:Math.min(Math.max(-a,-c),a))*(r+2*c)+l;else r=u>0?-a:a,h=-(s=Math.max(0,-(u*r+f)))*s+r*(r+2*c)+l;return n&&n.copy(this.direction).multiplyScalar(s).add(this.origin),e&&e.copy(L).multiplyScalar(r).add(T),h}),intersectSphere:function(){var t=new H.Vector3;return function(i,n){t.subVectors(i.center,this.origin);var e=t.dot(this.direction),s=t.dot(t)-e*e,r=i.radius*i.radius;if(s>r)return null;var h=Math.sqrt(r-s),o=e-h,a=e+h;return o<0&&a<0?null:this.at(o<0?a:o,n)}}(),intersectsSphere:function(t){return this.distanceToPoint(t.center)<=t.radius},distanceToPlane:function(t){var i=t.normal.dot(this.direction);if(0===i)return 0===t.distanceToPoint(this.origin)?0:null;var n=-(this.origin.dot(t.normal)+t.constant)/i;return n>=0?n:null},intersectPlane:function(t,i){var n=this.distanceToPlane(t);return null===n?null:this.at(n,i)},intersectsPlane:function(t){var i=t.distanceToPoint(this.origin);return 0===i||t.normal.dot(this.direction)*i<0},intersectBox:function(t,i){var n,e,s,r,h,o,a=1/this.direction.x,u=1/this.direction.y,f=1/this.direction.z,c=this.origin;return a>=0?(n=(t.min.x-c.x)*a,e=(t.max.x-c.x)*a):(n=(t.max.x-c.x)*a,e=(t.min.x-c.x)*a),u>=0?(s=(t.min.y-c.y)*u,r=(t.max.y-c.y)*u):(s=(t.max.y-c.y)*u,r=(t.min.y-c.y)*u),n>r||s>e?null:((s>n||n!=n)&&(n=s),(r<e||e!=e)&&(e=r),f>=0?(h=(t.min.z-c.z)*f,o=(t.max.z-c.z)*f):(h=(t.max.z-c.z)*f,o=(t.min.z-c.z)*f),n>o||h>e?null:((h>n||n!=n)&&(n=h),(o<e||e!=e)&&(e=o),e<0?null:this.at(n>=0?n:e,i)))},intersectsBox:(P=new H.Vector3,function(t){return null!==this.intersectBox(t,P)}),intersectTriangle:function(){var t=new H.Vector3,i=new H.Vector3,n=new H.Vector3,e=new H.Vector3;return function(s,r,h,o,a){i.subVectors(r,s),n.subVectors(h,s),e.crossVectors(i,n);var u,f=this.direction.dot(e);if(f>0){if(o)return null;u=1}else{if(!(f<0))return null;u=-1,f=-f}t.subVectors(this.origin,s);var c=u*this.direction.dot(n.crossVectors(t,n));if(c<0)return null;var l=u*this.direction.dot(i.cross(t));if(l<0)return null;if(c+l>f)return null;var v=-u*t.dot(e);return v<0?null:this.at(v/f,a)}}(),applyMatrix4:function(t){return this.direction.add(this.origin).applyMatrix4(t),this.origin.applyMatrix4(t),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}},H.Sphere=function(t,i){this.center=void 0!==t?t:new H.Vector3,this.radius=void 0!==i?i:0},H.Sphere.prototype={constructor:H.Sphere,set:function(t,i){return this.center.copy(t),this.radius=i,this},setFromPoints:function(){var t=new H.Box3;return function(i,n){var e=this.center;void 0!==n?e.copy(n):t.setFromPoints(i).center(e);for(var s=0,r=0,h=i.length;r<h;r++)s=Math.max(s,e.distanceToSquared(i[r]));return this.radius=Math.sqrt(s),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},empty:function(){return this.radius<=0},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var i=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=i*i},intersectsBox:function(t){return t.intersectsSphere(this)},intersectsPlane:function(t){return Math.abs(this.center.dot(t.normal)-t.constant)<=this.radius},clampPoint:function(t,i){var n=this.center.distanceToSquared(t),e=i||new H.Vector3;return e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e},getBoundingBox:function(t){var i=t||new H.Box3;return i.set(this.center,this.center),i.expandByScalar(this.radius),i},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}},H.Frustum=function(t,i,n,e,s,r){this.planes=[void 0!==t?t:new H.Plane,void 0!==i?i:new H.Plane,void 0!==n?n:new H.Plane,void 0!==e?e:new H.Plane,void 0!==s?s:new H.Plane,void 0!==r?r:new H.Plane]},H.Frustum.prototype={constructor:H.Frustum,set:function(t,i,n,e,s,r){var h=this.planes;return h[0].copy(t),h[1].copy(i),h[2].copy(n),h[3].copy(e),h[4].copy(s),h[5].copy(r),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){for(var i=this.planes,n=0;n<6;n++)i[n].copy(t.planes[n]);return this},setFromMatrix:function(t){var i=this.planes,n=t.elements,e=n[0],s=n[1],r=n[2],h=n[3],o=n[4],a=n[5],u=n[6],f=n[7],c=n[8],l=n[9],v=n[10],d=n[11],p=n[12],m=n[13],M=n[14],g=n[15];return i[0].setComponents(h-e,f-o,d-c,g-p).normalize(),i[1].setComponents(h+e,f+o,d+c,g+p).normalize(),i[2].setComponents(h+s,f+a,d+l,g+m).normalize(),i[3].setComponents(h-s,f-a,d-l,g-m).normalize(),i[4].setComponents(h-r,f-u,d-v,g-M).normalize(),i[5].setComponents(h+r,f+u,d+v,g+M).normalize(),this},intersectsObject:(k=new H.Sphere,function(t){var i=t.geometry;return null===i.boundingSphere&&i.computeBoundingSphere(),k.copy(i.boundingSphere),k.applyMatrix4(t.matrixWorld),this.intersectsSphere(k)}),intersectsSphere:function(t){for(var i=this.planes,n=t.center,e=-t.radius,s=0;s<6;s++)if(i[s].distanceToPoint(n)<e)return!1;return!0},intersectsBox:(U=new H.Vector3,N=new H.Vector3,function(t){for(var i=this.planes,n=0;n<6;n++){var e=i[n];U.x=e.normal.x>0?t.min.x:t.max.x,N.x=e.normal.x>0?t.max.x:t.min.x,U.y=e.normal.y>0?t.min.y:t.max.y,N.y=e.normal.y>0?t.max.y:t.min.y,U.z=e.normal.z>0?t.min.z:t.max.z,N.z=e.normal.z>0?t.max.z:t.min.z;var s=e.distanceToPoint(U),r=e.distanceToPoint(N);if(s<0&&r<0)return!1}return!0}),containsPoint:function(t){for(var i=this.planes,n=0;n<6;n++)if(i[n].distanceToPoint(t)<0)return!1;return!0}},H.EventDispatcher=function(){},H.EventDispatcher.prototype={constructor:H.EventDispatcher,apply:function(t){t.addEventListener=H.EventDispatcher.prototype.addEventListener,t.hasEventListener=H.EventDispatcher.prototype.hasEventListener,t.removeEventListener=H.EventDispatcher.prototype.removeEventListener,t.dispatchEvent=H.EventDispatcher.prototype.dispatchEvent},addEventListener:function(t,i){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(i)&&n[t].push(i)},hasEventListener:function(t,i){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(i)},removeEventListener:function(t,i){if(void 0!==this._listeners){var n=this._listeners[t];if(void 0!==n){var e=n.indexOf(i);-1!==e&&n.splice(e,1)}}},dispatchEvent:function(t){if(void 0!==this._listeners){var i=this._listeners[t.type];if(void 0!==i){t.target=this;for(var n=[],e=i.length,s=0;s<e;s++)n[s]=i[s];for(s=0;s<e;s++)n[s].call(this,t)}}}},H.Layers=function(){this.mask=1},H.Layers.prototype={constructor:H.Layers,set:function(t){this.mask=1<<t},enable:function(t){this.mask|=1<<t},toggle:function(t){this.mask^=1<<t},disable:function(t){this.mask&=~(1<<t)},test:function(t){return 0!=(this.mask&t.mask)}},H.Object3D=function(){Object.defineProperty(this,"id",{value:H.Object3DIdCount++}),this.uuid=H.Math.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=H.Object3D.DefaultUp.clone();var t=new H.Vector3,i=new H.Euler,n=new H.Quaternion,e=new H.Vector3(1,1,1);i.onChange((function(){n.setFromEuler(i,!1)})),n.onChange((function(){i.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{enumerable:!0,value:t},rotation:{enumerable:!0,value:i},quaternion:{enumerable:!0,value:n},scale:{enumerable:!0,value:e},modelViewMatrix:{value:new H.Matrix4},normalMatrix:{value:new H.Matrix3}}),this.rotationAutoUpdate=!0,this.matrix=new H.Matrix4,this.matrixWorld=new H.Matrix4,this.matrixAutoUpdate=H.Object3D.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new H.Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}},H.Object3D.DefaultUp=new H.Vector3(0,1,0),H.Object3D.DefaultMatrixAutoUpdate=!0,H.Object3D.prototype={constructor:H.Object3D,applyMatrix:function(t){this.matrix.multiplyMatrices(t,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(t,i){this.quaternion.setFromAxisAngle(t,i)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:(R=new H.Quaternion,function(t,i){return R.setFromAxisAngle(t,i),this.quaternion.multiply(R),this}),rotateX:function(){var t=new H.Vector3(1,0,0);return function(i){return this.rotateOnAxis(t,i)}}(),rotateY:function(){var t=new H.Vector3(0,1,0);return function(i){return this.rotateOnAxis(t,i)}}(),rotateZ:function(){var t=new H.Vector3(0,0,1);return function(i){return this.rotateOnAxis(t,i)}}(),translateOnAxis:function(){var t=new H.Vector3;return function(i,n){return t.copy(i).applyQuaternion(this.quaternion),this.position.add(t.multiplyScalar(n)),this}}(),translateX:function(){var t=new H.Vector3(1,0,0);return function(i){return this.translateOnAxis(t,i)}}(),translateY:function(){var t=new H.Vector3(0,1,0);return function(i){return this.translateOnAxis(t,i)}}(),translateZ:function(){var t=new H.Vector3(0,0,1);return function(i){return this.translateOnAxis(t,i)}}(),localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:(I=new H.Matrix4,function(t){return t.applyMatrix4(I.getInverse(this.matrixWorld))}),lookAt:function(){var t=new H.Matrix4;return function(i){t.lookAt(i,this.position,this.up),this.quaternion.setFromRotationMatrix(t)}}(),add:function(t){if(arguments.length>1){for(var i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return t===this?this:(t instanceof H.Object3D&&(null!==t.parent&&t.parent.remove(t),t.parent=this,t.dispatchEvent({type:"added"}),this.children.push(t)),this)},remove:function(t){if(arguments.length>1)for(var i=0;i<arguments.length;i++)this.remove(arguments[i]);var n=this.children.indexOf(t);-1!==n&&(t.parent=null,t.dispatchEvent({type:"removed"}),this.children.splice(n,1))},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,i){if(this[t]===i)return this;for(var n=0,e=this.children.length;n<e;n++){var s=this.children[n].getObjectByProperty(t,i);if(void 0!==s)return s}},getWorldPosition:function(t){var i=t||new H.Vector3;return this.updateMatrixWorld(!0),i.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:(D=new H.Vector3,F=new H.Vector3,function(t){var i=t||new H.Quaternion;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(D,i,F),i}),getWorldRotation:function(){var t=new H.Quaternion;return function(i){var n=i||new H.Euler;return this.getWorldQuaternion(t),n.setFromQuaternion(t,this.rotation.order,!1)}}(),getWorldScale:function(){var t=new H.Vector3,i=new H.Quaternion;return function(n){var e=n||new H.Vector3;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(t,i,e),e}}(),getWorldDirection:function(){var t=new H.Quaternion;return function(i){var n=i||new H.Vector3;return this.getWorldQuaternion(t),n.set(0,0,1).applyQuaternion(t)}}(),raycast:function(){},traverse:function(t){t(this);for(var i=this.children,n=0,e=i.length;n<e;n++)i[n].traverse(t)},traverseVisible:function(t){if(!1!==this.visible){t(this);for(var i=this.children,n=0,e=i.length;n<e;n++)i[n].traverseVisible(t)}},traverseAncestors:function(t){var i=this.parent;null!==i&&(t(i),i.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){!0===this.matrixAutoUpdate&&this.updateMatrix(),!0!==this.matrixWorldNeedsUpdate&&!0!==t||(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var i=0,n=this.children.length;i<n;i++)this.children[i].updateMatrixWorld(t)},toJSON:function(t){var i=void 0===t,n={};i&&(t={geometries:{},materials:{},textures:{},images:{}},n.metadata={version:4.4,type:"Object",generator:"Object3D.toJSON"});var e={};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),"{}"!==JSON.stringify(this.userData)&&(e.userData=this.userData),!0===this.castShadow&&(e.castShadow=!0),!0===this.receiveShadow&&(e.receiveShadow=!0),!1===this.visible&&(e.visible=!1),e.matrix=this.matrix.toArray(),void 0!==this.geometry&&(void 0===t.geometries[this.geometry.uuid]&&(t.geometries[this.geometry.uuid]=this.geometry.toJSON(t)),e.geometry=this.geometry.uuid),void 0!==this.material&&(void 0===t.materials[this.material.uuid]&&(t.materials[this.material.uuid]=this.material.toJSON(t)),e.material=this.material.uuid),this.children.length>0){e.children=[];for(var s=0;s<this.children.length;s++)e.children.push(this.children[s].toJSON(t).object)}if(i){var r=u(t.geometries),h=u(t.materials),o=u(t.textures),a=u(t.images);r.length>0&&(n.geometries=r),h.length>0&&(n.materials=h),o.length>0&&(n.textures=o),a.length>0&&(n.images=a)}return n.object=e,n;function u(t){var i=[];for(var n in t){var e=t[n];delete e.metadata,i.push(e)}return i}},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,i){if(void 0===i&&(i=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.rotationAutoUpdate=t.rotationAutoUpdate,this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===i)for(var n=0;n<t.children.length;n++)this.add(t.children[n].clone());return this}},H.EventDispatcher.prototype.apply(H.Object3D.prototype),H.Object3DIdCount=0,H.Face3=function(t,i,n,e,s,r){this.a=t,this.b=i,this.c=n,this.normal=e instanceof H.Vector3?e:new H.Vector3,this.vertexNormals=Array.isArray(e)?e:[],this.color=s instanceof H.Color?s:new H.Color,this.vertexColors=Array.isArray(s)?s:[],this.materialIndex=void 0!==r?r:0},H.Face3.prototype={constructor:H.Face3,clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(var i=0,n=t.vertexNormals.length;i<n;i++)this.vertexNormals[i]=t.vertexNormals[i].clone();for(i=0,n=t.vertexColors.length;i<n;i++)this.vertexColors[i]=t.vertexColors[i].clone();return this}},H.BufferAttribute=function(t,i){this.uuid=H.Math.generateUUID(),this.array=t,this.itemSize=i,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0},H.BufferAttribute.prototype={constructor:H.BufferAttribute,get count(){return this.array.length/this.itemSize},set needsUpdate(t){!0===t&&this.version++},setDynamic:function(t){return this.dynamic=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.dynamic=t.dynamic,this},copyAt:function(t,i,n){t*=this.itemSize,n*=i.itemSize;for(var e=0,s=this.itemSize;e<s;e++)this.array[t+e]=i.array[n+e];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){for(var i=this.array,n=0,e=0,s=t.length;e<s;e++){var r=t[e];void 0===r&&(r=new H.Color),i[n++]=r.r,i[n++]=r.g,i[n++]=r.b}return this},copyIndicesArray:function(t){for(var i=this.array,n=0,e=0,s=t.length;e<s;e++){var r=t[e];i[n++]=r.a,i[n++]=r.b,i[n++]=r.c}return this},copyVector2sArray:function(t){for(var i=this.array,n=0,e=0,s=t.length;e<s;e++){var r=t[e];void 0===r&&(r=new H.Vector2),i[n++]=r.x,i[n++]=r.y}return this},copyVector3sArray:function(t){for(var i=this.array,n=0,e=0,s=t.length;e<s;e++){var r=t[e];void 0===r&&(r=new H.Vector3),i[n++]=r.x,i[n++]=r.y,i[n++]=r.z}return this},copyVector4sArray:function(t){for(var i=this.array,n=0,e=0,s=t.length;e<s;e++){var r=t[e];void 0===r&&(r=new H.Vector4),i[n++]=r.x,i[n++]=r.y,i[n++]=r.z,i[n++]=r.w}return this},set:function(t,i){return void 0===i&&(i=0),this.array.set(t,i),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,i){return this.array[t*this.itemSize]=i,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,i){return this.array[t*this.itemSize+1]=i,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,i){return this.array[t*this.itemSize+2]=i,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,i){return this.array[t*this.itemSize+3]=i,this},setXY:function(t,i,n){return this.array[0+(t*=this.itemSize)]=i,this.array[t+1]=n,this},setXYZ:function(t,i,n,e){return this.array[0+(t*=this.itemSize)]=i,this.array[t+1]=n,this.array[t+2]=e,this},setXYZW:function(t,i,n,e,s){return this.array[0+(t*=this.itemSize)]=i,this.array[t+1]=n,this.array[t+2]=e,this.array[t+3]=s,this},clone:function(){return(new this.constructor).copy(this)}},H.Int8Attribute=function(t,i){return new H.BufferAttribute(new Int8Array(t),i)},H.Uint8Attribute=function(t,i){return new H.BufferAttribute(new Uint8Array(t),i)},H.Uint8ClampedAttribute=function(t,i){return new H.BufferAttribute(new Uint8ClampedArray(t),i)},H.Int16Attribute=function(t,i){return new H.BufferAttribute(new Int16Array(t),i)},H.Uint16Attribute=function(t,i){return new H.BufferAttribute(new Uint16Array(t),i)},H.Int32Attribute=function(t,i){return new H.BufferAttribute(new Int32Array(t),i)},H.Uint32Attribute=function(t,i){return new H.BufferAttribute(new Uint32Array(t),i)},H.Float32Attribute=function(t,i){return new H.BufferAttribute(new Float32Array(t),i)},H.Float64Attribute=function(t,i){return new H.BufferAttribute(new Float64Array(t),i)},H.DynamicBufferAttribute=function(t,i){return new H.BufferAttribute(t,i).setDynamic(!0)},H.InstancedBufferAttribute=function(t,i,n){H.BufferAttribute.call(this,t,i),this.meshPerAttribute=n||1},H.InstancedBufferAttribute.prototype=Object.create(H.BufferAttribute.prototype),H.InstancedBufferAttribute.prototype.constructor=H.InstancedBufferAttribute,H.InstancedBufferAttribute.prototype.copy=function(t){return H.BufferAttribute.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},H.BufferGeometry=function(){Object.defineProperty(this,"id",{value:H.GeometryIdCount++}),this.uuid=H.Math.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0}},H.BufferGeometry.prototype={constructor:H.BufferGeometry,getIndex:function(){return this.index},setIndex:function(t){this.index=t},addAttribute:function(t,i){if(i instanceof H.BufferAttribute!=0||i instanceof H.InterleavedBufferAttribute!=0){if("index"!==t)return this.attributes[t]=i,this;this.setIndex(i)}else this.addAttribute(t,new H.BufferAttribute(arguments[1],arguments[2]))},getAttribute:function(t){return this.attributes[t]},removeAttribute:function(t){return delete this.attributes[t],this},addGroup:function(t,i,n){this.groups.push({start:t,count:i,materialIndex:void 0!==n?n:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,i){this.drawRange.start=t,this.drawRange.count=i},applyMatrix:function(t){var i=this.attributes.position;void 0!==i&&(t.applyToVector3Array(i.array),i.needsUpdate=!0);var n=this.attributes.normal;return void 0!==n&&((new H.Matrix3).getNormalMatrix(t).applyToVector3Array(n.array),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var t;return function(i){return void 0===t&&(t=new H.Matrix4),t.makeRotationX(i),this.applyMatrix(t),this}}(),rotateY:function(){var t;return function(i){return void 0===t&&(t=new H.Matrix4),t.makeRotationY(i),this.applyMatrix(t),this}}(),rotateZ:function(){var t;return function(i){return void 0===t&&(t=new H.Matrix4),t.makeRotationZ(i),this.applyMatrix(t),this}}(),translate:function(){var t;return function(i,n,e){return void 0===t&&(t=new H.Matrix4),t.makeTranslation(i,n,e),this.applyMatrix(t),this}}(),scale:function(){var t;return function(i,n,e){return void 0===t&&(t=new H.Matrix4),t.makeScale(i,n,e),this.applyMatrix(t),this}}(),lookAt:function(t){void 0===C&&(C=new H.Object3D),C.lookAt(t),C.updateMatrix(),this.applyMatrix(C.matrix)},center:function(){this.computeBoundingBox();var t=this.boundingBox.center().negate();return this.translate(t.x,t.y,t.z),t},setFromObject:function(t){var i=t.geometry;if(t instanceof H.Points||t instanceof H.Line){var n=new H.Float32Attribute(3*i.vertices.length,3),e=new H.Float32Attribute(3*i.colors.length,3);if(this.addAttribute("position",n.copyVector3sArray(i.vertices)),this.addAttribute("color",e.copyColorsArray(i.colors)),i.lineDistances&&i.lineDistances.length===i.vertices.length){var s=new H.Float32Attribute(i.lineDistances.length,1);this.addAttribute("lineDistance",s.copyArray(i.lineDistances))}null!==i.boundingSphere&&(this.boundingSphere=i.boundingSphere.clone()),null!==i.boundingBox&&(this.boundingBox=i.boundingBox.clone())}else t instanceof H.Mesh&&i instanceof H.Geometry&&this.fromGeometry(i);return this},updateFromObject:function(t){var i,n=t.geometry;if(t instanceof H.Mesh){var e=n.__directGeometry;if(void 0===e)return this.fromGeometry(n);e.verticesNeedUpdate=n.verticesNeedUpdate,e.normalsNeedUpdate=n.normalsNeedUpdate,e.colorsNeedUpdate=n.colorsNeedUpdate,e.uvsNeedUpdate=n.uvsNeedUpdate,e.groupsNeedUpdate=n.groupsNeedUpdate,n.verticesNeedUpdate=!1,n.normalsNeedUpdate=!1,n.colorsNeedUpdate=!1,n.uvsNeedUpdate=!1,n.groupsNeedUpdate=!1,n=e}return!0===n.verticesNeedUpdate&&(void 0!==(i=this.attributes.position)&&(i.copyVector3sArray(n.vertices),i.needsUpdate=!0),n.verticesNeedUpdate=!1),!0===n.normalsNeedUpdate&&(void 0!==(i=this.attributes.normal)&&(i.copyVector3sArray(n.normals),i.needsUpdate=!0),n.normalsNeedUpdate=!1),!0===n.colorsNeedUpdate&&(void 0!==(i=this.attributes.color)&&(i.copyColorsArray(n.colors),i.needsUpdate=!0),n.colorsNeedUpdate=!1),n.uvsNeedUpdate&&(void 0!==(i=this.attributes.uv)&&(i.copyVector2sArray(n.uvs),i.needsUpdate=!0),n.uvsNeedUpdate=!1),n.lineDistancesNeedUpdate&&(void 0!==(i=this.attributes.lineDistance)&&(i.copyArray(n.lineDistances),i.needsUpdate=!0),n.lineDistancesNeedUpdate=!1),n.groupsNeedUpdate&&(n.computeGroups(t.geometry),this.groups=n.groups,n.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.__directGeometry=(new H.DirectGeometry).fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){var i=new Float32Array(3*t.vertices.length);if(this.addAttribute("position",new H.BufferAttribute(i,3).copyVector3sArray(t.vertices)),t.normals.length>0){var n=new Float32Array(3*t.normals.length);this.addAttribute("normal",new H.BufferAttribute(n,3).copyVector3sArray(t.normals))}if(t.colors.length>0){var e=new Float32Array(3*t.colors.length);this.addAttribute("color",new H.BufferAttribute(e,3).copyColorsArray(t.colors))}if(t.uvs.length>0){var s=new Float32Array(2*t.uvs.length);this.addAttribute("uv",new H.BufferAttribute(s,2).copyVector2sArray(t.uvs))}if(t.uvs2.length>0){var r=new Float32Array(2*t.uvs2.length);this.addAttribute("uv2",new H.BufferAttribute(r,2).copyVector2sArray(t.uvs2))}if(t.indices.length>0){var h=new(t.vertices.length>65535?Uint32Array:Uint16Array)(3*t.indices.length);this.setIndex(new H.BufferAttribute(h,1).copyIndicesArray(t.indices))}for(var o in this.groups=t.groups,t.morphTargets){for(var a=[],u=t.morphTargets[o],f=0,c=u.length;f<c;f++){var l=u[f],v=new H.Float32Attribute(3*l.length,3);a.push(v.copyVector3sArray(l))}this.morphAttributes[o]=a}if(t.skinIndices.length>0){var d=new H.Float32Attribute(4*t.skinIndices.length,4);this.addAttribute("skinIndex",d.copyVector4sArray(t.skinIndices))}if(t.skinWeights.length>0){var p=new H.Float32Attribute(4*t.skinWeights.length,4);this.addAttribute("skinWeight",p.copyVector4sArray(t.skinWeights))}return null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:(new H.Vector3,function(){null===this.boundingBox&&(this.boundingBox=new H.Box3);var t=this.attributes.position.array;t&&this.boundingBox.setFromArray(t),void 0!==t&&0!==t.length||(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0))}),computeBoundingSphere:function(){var t=new H.Box3,i=new H.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new H.Sphere);var n=this.attributes.position.array;if(n){var e=this.boundingSphere.center;t.setFromArray(n),t.center(e);for(var s=0,r=0,h=n.length;r<h;r+=3)i.fromArray(n,r),s=Math.max(s,e.distanceToSquared(i));this.boundingSphere.radius=Math.sqrt(s)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var t=this.index,i=this.attributes,n=this.groups;if(i.position){var e=i.position.array;if(void 0===i.normal)this.addAttribute("normal",new H.BufferAttribute(new Float32Array(e.length),3));else for(var s=i.normal.array,r=0,h=s.length;r<h;r++)s[r]=0;var o,a,u,f=i.normal.array,c=new H.Vector3,l=new H.Vector3,v=new H.Vector3,d=new H.Vector3,p=new H.Vector3;if(t){var m=t.array;0===n.length&&this.addGroup(0,m.length);for(var M=0,g=n.length;M<g;++M){var w=n[M],y=w.start;for(r=y,h=y+w.count;r<h;r+=3)a=3*m[r+1],u=3*m[r+2],c.fromArray(e,o=3*m[r+0]),l.fromArray(e,a),v.fromArray(e,u),d.subVectors(v,l),p.subVectors(c,l),d.cross(p),f[o]+=d.x,f[o+1]+=d.y,f[o+2]+=d.z,f[a]+=d.x,f[a+1]+=d.y,f[a+2]+=d.z,f[u]+=d.x,f[u+1]+=d.y,f[u+2]+=d.z}}else for(r=0,h=e.length;r<h;r+=9)c.fromArray(e,r),l.fromArray(e,r+3),v.fromArray(e,r+6),d.subVectors(v,l),p.subVectors(c,l),d.cross(p),f[r]=d.x,f[r+1]=d.y,f[r+2]=d.z,f[r+3]=d.x,f[r+4]=d.y,f[r+5]=d.z,f[r+6]=d.x,f[r+7]=d.y,f[r+8]=d.z;this.normalizeNormals(),i.normal.needsUpdate=!0}},merge:function(t,i){if(t instanceof H.BufferGeometry!=0){void 0===i&&(i=0);var n=this.attributes;for(var e in n)if(void 0!==t.attributes[e])for(var s=n[e].array,r=t.attributes[e],h=r.array,o=0,a=r.itemSize*i;o<h.length;o++,a++)s[a]=h[o];return this}},normalizeNormals:function(){for(var t,i,n,e,s=this.attributes.normal.array,r=0,h=s.length;r<h;r+=3)t=s[r],i=s[r+1],n=s[r+2],e=1/Math.sqrt(t*t+i*i+n*n),s[r]*=e,s[r+1]*=e,s[r+2]*=e},toNonIndexed:function(){if(null===this.index)return this;var t=new H.BufferGeometry,i=this.index.array,n=this.attributes;for(var e in n){for(var s=n[e],r=s.array,h=s.itemSize,o=new r.constructor(i.length*h),a=0,u=0,f=0,c=i.length;f<c;f++){a=i[f]*h;for(var l=0;l<h;l++)o[u++]=r[a++]}t.addAttribute(e,new H.BufferAttribute(o,h))}return t},toJSON:function(){var t={metadata:{version:4.4,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){var i=this.parameters;for(var n in i)void 0!==i[n]&&(t[n]=i[n]);return t}t.data={attributes:{}};var e=this.index;if(null!==e){var s=Array.prototype.slice.call(e.array);t.data.index={type:e.array.constructor.name,array:s}}var r=this.attributes;for(var n in r){var h=r[n];s=Array.prototype.slice.call(h.array),t.data.attributes[n]={itemSize:h.itemSize,type:h.array.constructor.name,array:s}}var o=this.groups;o.length>0&&(t.data.groups=JSON.parse(JSON.stringify(o)));var a=this.boundingSphere;return null!==a&&(t.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),t},clone:function(){return(new H.BufferGeometry).copy(this)},copy:function(t){var i=t.index;null!==i&&this.setIndex(i.clone());var n=t.attributes;for(var e in n)this.addAttribute(e,n[e].clone());for(var s=t.groups,r=0,h=s.length;r<h;r++){var o=s[r];this.addGroup(o.start,o.count)}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}},H.EventDispatcher.prototype.apply(H.BufferGeometry.prototype),H.BufferGeometry.MaxIndex=65535,H.InterleavedBufferAttribute=function(t,i,n){this.uuid=H.Math.generateUUID(),this.data=t,this.itemSize=i,this.offset=n},H.InterleavedBufferAttribute.prototype={constructor:H.InterleavedBufferAttribute,get length(){return this.array.length},get count(){return this.data.count},setX:function(t,i){return this.data.array[t*this.data.stride+this.offset]=i,this},setY:function(t,i){return this.data.array[t*this.data.stride+this.offset+1]=i,this},setZ:function(t,i){return this.data.array[t*this.data.stride+this.offset+2]=i,this},setW:function(t,i){return this.data.array[t*this.data.stride+this.offset+3]=i,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,i,n){return this.data.array[(t=t*this.data.stride+this.offset)+0]=i,this.data.array[t+1]=n,this},setXYZ:function(t,i,n,e){return this.data.array[(t=t*this.data.stride+this.offset)+0]=i,this.data.array[t+1]=n,this.data.array[t+2]=e,this},setXYZW:function(t,i,n,e,s){return this.data.array[(t=t*this.data.stride+this.offset)+0]=i,this.data.array[t+1]=n,this.data.array[t+2]=e,this.data.array[t+3]=s,this}},H.InstancedBufferGeometry=function(){H.BufferGeometry.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0},H.InstancedBufferGeometry.prototype=Object.create(H.BufferGeometry.prototype),H.InstancedBufferGeometry.prototype.constructor=H.InstancedBufferGeometry,H.InstancedBufferGeometry.prototype.addGroup=function(t,i,n){this.groups.push({start:t,count:i,instances:n})},H.InstancedBufferGeometry.prototype.copy=function(t){var i=t.index;null!==i&&this.setIndex(i.clone());var n=t.attributes;for(var e in n)this.addAttribute(e,n[e].clone());for(var s=t.groups,r=0,h=s.length;r<h;r++){var o=s[r];this.addGroup(o.start,o.count,o.instances)}return this},H.EventDispatcher.prototype.apply(H.InstancedBufferGeometry.prototype),H.Geometry=function(){Object.defineProperty(this,"id",{value:H.GeometryIdCount++}),this.uuid=H.Math.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1},H.Geometry.prototype={constructor:H.Geometry,applyMatrix:function(t){for(var i=(new H.Matrix3).getNormalMatrix(t),n=0,e=this.vertices.length;n<e;n++)this.vertices[n].applyMatrix4(t);for(n=0,e=this.faces.length;n<e;n++){var s=this.faces[n];s.normal.applyMatrix3(i).normalize();for(var r=0,h=s.vertexNormals.length;r<h;r++)s.vertexNormals[r].applyMatrix3(i).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var t;return function(i){return void 0===t&&(t=new H.Matrix4),t.makeRotationX(i),this.applyMatrix(t),this}}(),rotateY:function(){var t;return function(i){return void 0===t&&(t=new H.Matrix4),t.makeRotationY(i),this.applyMatrix(t),this}}(),rotateZ:function(){var t;return function(i){return void 0===t&&(t=new H.Matrix4),t.makeRotationZ(i),this.applyMatrix(t),this}}(),translate:function(){var t;return function(i,n,e){return void 0===t&&(t=new H.Matrix4),t.makeTranslation(i,n,e),this.applyMatrix(t),this}}(),scale:function(){var t;return function(i,n,e){return void 0===t&&(t=new H.Matrix4),t.makeScale(i,n,e),this.applyMatrix(t),this}}(),lookAt:function(){var t;return function(i){void 0===t&&(t=new H.Object3D),t.lookAt(i),t.updateMatrix(),this.applyMatrix(t.matrix)}}(),fromBufferGeometry:function(t){var i=this,n=null!==t.index?t.index.array:void 0,e=t.attributes,s=e.position.array,r=void 0!==e.normal?e.normal.array:void 0,h=void 0!==e.color?e.color.array:void 0,o=void 0!==e.uv?e.uv.array:void 0,a=void 0!==e.uv2?e.uv2.array:void 0;void 0!==a&&(this.faceVertexUvs[1]=[]);for(var u=[],f=[],c=[],l=0,v=0;l<s.length;l+=3,v+=2)i.vertices.push(new H.Vector3(s[l],s[l+1],s[l+2])),void 0!==r&&u.push(new H.Vector3(r[l],r[l+1],r[l+2])),void 0!==h&&i.colors.push(new H.Color(h[l],h[l+1],h[l+2])),void 0!==o&&f.push(new H.Vector2(o[v],o[v+1])),void 0!==a&&c.push(new H.Vector2(a[v],a[v+1]));function d(t,n,e,s){var l=void 0!==r?[u[t].clone(),u[n].clone(),u[e].clone()]:[],v=void 0!==h?[i.colors[t].clone(),i.colors[n].clone(),i.colors[e].clone()]:[],d=new H.Face3(t,n,e,l,v,s);i.faces.push(d),void 0!==o&&i.faceVertexUvs[0].push([f[t].clone(),f[n].clone(),f[e].clone()]),void 0!==a&&i.faceVertexUvs[1].push([c[t].clone(),c[n].clone(),c[e].clone()])}if(void 0!==n){var p=t.groups;if(p.length>0)for(l=0;l<p.length;l++)for(var m=p[l],M=m.start,g=(v=M,M+m.count);v<g;v+=3)d(n[v],n[v+1],n[v+2],m.materialIndex);else for(l=0;l<n.length;l+=3)d(n[l],n[l+1],n[l+2])}else for(l=0;l<s.length/3;l+=3)d(l,l+1,l+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this},center:function(){this.computeBoundingBox();var t=this.boundingBox.center().negate();return this.translate(t.x,t.y,t.z),t},normalize:function(){this.computeBoundingSphere();var t=this.boundingSphere.center,i=this.boundingSphere.radius,n=0===i?1:1/i,e=new H.Matrix4;return e.set(n,0,0,-n*t.x,0,n,0,-n*t.y,0,0,n,-n*t.z,0,0,0,1),this.applyMatrix(e),this},computeFaceNormals:function(){for(var t=new H.Vector3,i=new H.Vector3,n=0,e=this.faces.length;n<e;n++){var s=this.faces[n],r=this.vertices[s.a],h=this.vertices[s.b];t.subVectors(this.vertices[s.c],h),i.subVectors(r,h),t.cross(i),t.normalize(),s.normal.copy(t)}},computeVertexNormals:function(t){var i,n,e,s,r,h;for(void 0===t&&(t=!0),h=new Array(this.vertices.length),i=0,n=this.vertices.length;i<n;i++)h[i]=new H.Vector3;if(t){var o,a,u=new H.Vector3,f=new H.Vector3;for(e=0,s=this.faces.length;e<s;e++)o=this.vertices[(r=this.faces[e]).a],u.subVectors(this.vertices[r.c],a=this.vertices[r.b]),f.subVectors(o,a),u.cross(f),h[r.a].add(u),h[r.b].add(u),h[r.c].add(u)}else for(e=0,s=this.faces.length;e<s;e++)h[(r=this.faces[e]).a].add(r.normal),h[r.b].add(r.normal),h[r.c].add(r.normal);for(i=0,n=this.vertices.length;i<n;i++)h[i].normalize();for(e=0,s=this.faces.length;e<s;e++){var c=(r=this.faces[e]).vertexNormals;3===c.length?(c[0].copy(h[r.a]),c[1].copy(h[r.b]),c[2].copy(h[r.c])):(c[0]=h[r.a].clone(),c[1]=h[r.b].clone(),c[2]=h[r.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var t,i,n,e,s;for(n=0,e=this.faces.length;n<e;n++)for((s=this.faces[n]).__originalFaceNormal?s.__originalFaceNormal.copy(s.normal):s.__originalFaceNormal=s.normal.clone(),s.__originalVertexNormals||(s.__originalVertexNormals=[]),t=0,i=s.vertexNormals.length;t<i;t++)s.__originalVertexNormals[t]?s.__originalVertexNormals[t].copy(s.vertexNormals[t]):s.__originalVertexNormals[t]=s.vertexNormals[t].clone();var r=new H.Geometry;for(r.faces=this.faces,t=0,i=this.morphTargets.length;t<i;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];var h=this.morphNormals[t].faceNormals,o=this.morphNormals[t].vertexNormals;for(n=0,e=this.faces.length;n<e;n++)a=new H.Vector3,u={a:new H.Vector3,b:new H.Vector3,c:new H.Vector3},h.push(a),o.push(u)}var a,u,f=this.morphNormals[t];for(r.vertices=this.morphTargets[t].vertices,r.computeFaceNormals(),r.computeVertexNormals(),n=0,e=this.faces.length;n<e;n++)u=f.vertexNormals[n],(a=f.faceNormals[n]).copy((s=this.faces[n]).normal),u.a.copy(s.vertexNormals[0]),u.b.copy(s.vertexNormals[1]),u.c.copy(s.vertexNormals[2])}for(n=0,e=this.faces.length;n<e;n++)(s=this.faces[n]).normal=s.__originalFaceNormal,s.vertexNormals=s.__originalVertexNormals},computeTangents:function(){},computeLineDistances:function(){for(var t=0,i=this.vertices,n=0,e=i.length;n<e;n++)n>0&&(t+=i[n].distanceTo(i[n-1])),this.lineDistances[n]=t},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new H.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new H.Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,i,n){if(t instanceof H.Geometry!=0){var e,s=this.vertices.length,r=this.vertices,h=t.vertices,o=this.faces,a=t.faces,u=this.faceVertexUvs[0],f=t.faceVertexUvs[0];void 0===n&&(n=0),void 0!==i&&(e=(new H.Matrix3).getNormalMatrix(i));for(var c=0,l=h.length;c<l;c++){var v=h[c].clone();void 0!==i&&v.applyMatrix4(i),r.push(v)}for(c=0,l=a.length;c<l;c++){var d,p,m=a[c],M=m.vertexNormals,g=m.vertexColors;(d=new H.Face3(m.a+s,m.b+s,m.c+s)).normal.copy(m.normal),void 0!==e&&d.normal.applyMatrix3(e).normalize();for(var w=0,y=M.length;w<y;w++)p=M[w].clone(),void 0!==e&&p.applyMatrix3(e).normalize(),d.vertexNormals.push(p);for(d.color.copy(m.color),w=0,y=g.length;w<y;w++)d.vertexColors.push(g[w].clone());d.materialIndex=m.materialIndex+n,o.push(d)}for(c=0,l=f.length;c<l;c++){var _=f[c],x=[];if(void 0!==_){for(w=0,y=_.length;w<y;w++)x.push(_[w].clone());u.push(x)}}}},mergeMesh:function(t){t instanceof H.Mesh!=0&&(t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix))},mergeVertices:function(){var t,i,n,e,s,r,h,o,a={},u=[],f=[],c=Math.pow(10,4);for(n=0,e=this.vertices.length;n<e;n++)t=this.vertices[n],void 0===a[i=Math.round(t.x*c)+"_"+Math.round(t.y*c)+"_"+Math.round(t.z*c)]?(a[i]=n,u.push(this.vertices[n]),f[n]=u.length-1):f[n]=f[a[i]];var l=[];for(n=0,e=this.faces.length;n<e;n++){(s=this.faces[n]).a=f[s.a],s.b=f[s.b],s.c=f[s.c],r=[s.a,s.b,s.c];for(var v=0;v<3;v++)if(r[v]===r[(v+1)%3]){l.push(n);break}}for(n=l.length-1;n>=0;n--){var d=l[n];for(this.faces.splice(d,1),h=0,o=this.faceVertexUvs.length;h<o;h++)this.faceVertexUvs[h].splice(d,1)}var p=this.vertices.length-u.length;return this.vertices=u,p},sortFacesByMaterialIndex:function(){for(var t=this.faces,i=t.length,n=0;n<i;n++)t[n]._id=n;t.sort((function(t,i){return t.materialIndex-i.materialIndex}));var e,s,r=this.faceVertexUvs[0],h=this.faceVertexUvs[1];for(r&&r.length===i&&(e=[]),h&&h.length===i&&(s=[]),n=0;n<i;n++){var o=t[n]._id;e&&e.push(r[o]),s&&s.push(h[o])}e&&(this.faceVertexUvs[0]=e),s&&(this.faceVertexUvs[1]=s)},toJSON:function(){var t={metadata:{version:4.4,type:"Geometry",generator:"Geometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){var i=this.parameters;for(var n in i)void 0!==i[n]&&(t[n]=i[n]);return t}for(var e=[],s=0;s<this.vertices.length;s++){var r=this.vertices[s];e.push(r.x,r.y,r.z)}var h=[],o=[],a={},u=[],f={},c=[],l={};for(s=0;s<this.faces.length;s++){var v=this.faces[s],d=void 0!==this.faceVertexUvs[0][s],p=v.normal.length()>0,m=v.vertexNormals.length>0,M=1!==v.color.r||1!==v.color.g||1!==v.color.b,g=v.vertexColors.length>0,w=0;if(w=E(w,0,0),w=E(w,1,!0),w=E(w,2,!1),w=E(w,3,d),w=E(w,4,p),w=E(w,5,m),w=E(w,6,M),w=E(w,7,g),h.push(w),h.push(v.a,v.b,v.c),h.push(v.materialIndex),d){var y=this.faceVertexUvs[0][s];h.push(A(y[0]),A(y[1]),A(y[2]))}if(p&&h.push(S(v.normal)),m){var _=v.vertexNormals;h.push(S(_[0]),S(_[1]),S(_[2]))}if(M&&h.push(b(v.color)),g){var x=v.vertexColors;h.push(b(x[0]),b(x[1]),b(x[2]))}}function E(t,i,n){return n?t|1<<i:t&~(1<<i)}function S(t){var i=t.x.toString()+t.y.toString()+t.z.toString();return void 0!==a[i]?a[i]:(a[i]=o.length/3,o.push(t.x,t.y,t.z),a[i])}function b(t){var i=t.r.toString()+t.g.toString()+t.b.toString();return void 0!==f[i]?f[i]:(f[i]=u.length,u.push(t.getHex()),f[i])}function A(t){var i=t.x.toString()+t.y.toString();return void 0!==l[i]?l[i]:(l[i]=c.length/2,c.push(t.x,t.y),l[i])}return t.data={},t.data.vertices=e,t.data.normals=o,u.length>0&&(t.data.colors=u),c.length>0&&(t.data.uvs=[c]),t.data.faces=h,t},clone:function(){return(new H.Geometry).copy(this)},copy:function(t){this.vertices=[],this.faces=[],this.faceVertexUvs=[[]];for(var i=t.vertices,n=0,e=i.length;n<e;n++)this.vertices.push(i[n].clone());var s=t.faces;for(n=0,e=s.length;n<e;n++)this.faces.push(s[n].clone());for(n=0,e=t.faceVertexUvs.length;n<e;n++){var r=t.faceVertexUvs[n];void 0===this.faceVertexUvs[n]&&(this.faceVertexUvs[n]=[]);for(var h=0,o=r.length;h<o;h++){for(var a=r[h],u=[],f=0,c=a.length;f<c;f++)u.push(a[f].clone());this.faceVertexUvs[n].push(u)}}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}},H.EventDispatcher.prototype.apply(H.Geometry.prototype),H.GeometryIdCount=0,H.DirectGeometry=function(){Object.defineProperty(this,"id",{value:H.GeometryIdCount++}),this.uuid=H.Math.generateUUID(),this.name="",this.type="DirectGeometry",this.indices=[],this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1},H.DirectGeometry.prototype={constructor:H.DirectGeometry,computeBoundingBox:H.Geometry.prototype.computeBoundingBox,computeBoundingSphere:H.Geometry.prototype.computeBoundingSphere,computeFaceNormals:function(){},computeVertexNormals:function(){},computeGroups:function(t){for(var i,n,e=[],s=t.faces,r=0;r<s.length;r++){var h=s[r];h.materialIndex!==n&&(n=h.materialIndex,void 0!==i&&(i.count=3*r-i.start,e.push(i)),i={start:3*r,materialIndex:n})}void 0!==i&&(i.count=3*r-i.start,e.push(i)),this.groups=e},fromGeometry:function(t){var i,n=t.faces,e=t.vertices,s=t.faceVertexUvs,r=s[0]&&s[0].length>0,h=s[1]&&s[1].length>0,o=t.morphTargets,a=o.length;if(a>0){i=[];for(var u=0;u<a;u++)i[u]=[];this.morphTargets.position=i}var f,c=t.morphNormals,l=c.length;if(l>0){for(f=[],u=0;u<l;u++)f[u]=[];this.morphTargets.normal=f}var v=t.skinIndices,d=t.skinWeights,p=v.length===e.length,m=d.length===e.length;for(u=0;u<n.length;u++){var M=n[u];this.vertices.push(e[M.a],e[M.b],e[M.c]);var g=M.vertexNormals;if(3===g.length)this.normals.push(g[0],g[1],g[2]);else{var w=M.normal;this.normals.push(w,w,w)}var y,_=M.vertexColors;if(3===_.length)this.colors.push(_[0],_[1],_[2]);else{var x=M.color;this.colors.push(x,x,x)}!0===r&&(void 0!==(y=s[0][u])?this.uvs.push(y[0],y[1],y[2]):this.uvs.push(new H.Vector2,new H.Vector2,new H.Vector2)),!0===h&&(void 0!==(y=s[1][u])?this.uvs2.push(y[0],y[1],y[2]):this.uvs2.push(new H.Vector2,new H.Vector2,new H.Vector2));for(var E=0;E<a;E++){var S=o[E].vertices;i[E].push(S[M.a],S[M.b],S[M.c])}for(E=0;E<l;E++){var b=c[E].vertexNormals[u];f[E].push(b.a,b.b,b.c)}p&&this.skinIndices.push(v[M.a],v[M.b],v[M.c]),m&&this.skinWeights.push(d[M.a],d[M.b],d[M.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}},H.EventDispatcher.prototype.apply(H.DirectGeometry.prototype),H.Camera=function(){H.Object3D.call(this),this.type="Camera",this.matrixWorldInverse=new H.Matrix4,this.projectionMatrix=new H.Matrix4},H.Camera.prototype=Object.create(H.Object3D.prototype),H.Camera.prototype.constructor=H.Camera,H.Camera.prototype.getWorldDirection=function(){var t=new H.Quaternion;return function(i){var n=i||new H.Vector3;return this.getWorldQuaternion(t),n.set(0,0,-1).applyQuaternion(t)}}(),H.Camera.prototype.lookAt=function(){var t=new H.Matrix4;return function(i){t.lookAt(this.position,i,this.up),this.quaternion.setFromRotationMatrix(t)}}(),H.Camera.prototype.clone=function(){return(new this.constructor).copy(this)},H.Camera.prototype.copy=function(t){return H.Object3D.prototype.copy.call(this,t),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this},H.PerspectiveCamera=function(t,i,n,e){H.Camera.call(this),this.type="PerspectiveCamera",this.focalLength=10,this.zoom=1,this.fov=void 0!==t?t:50,this.aspect=void 0!==i?i:1,this.near=void 0!==n?n:.1,this.far=void 0!==e?e:2e3,this.updateProjectionMatrix()},H.PerspectiveCamera.prototype=Object.create(H.Camera.prototype),H.PerspectiveCamera.prototype.constructor=H.PerspectiveCamera,H.PerspectiveCamera.prototype.setLens=function(t,i){void 0===i&&(i=24),this.fov=2*H.Math.radToDeg(Math.atan(i/(2*t))),this.updateProjectionMatrix()},H.PerspectiveCamera.prototype.setViewOffset=function(t,i,n,e,s,r){this.fullWidth=t,this.fullHeight=i,this.x=n,this.y=e,this.width=s,this.height=r,this.updateProjectionMatrix()},H.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var t=H.Math.radToDeg(2*Math.atan(Math.tan(.5*H.Math.degToRad(this.fov))/this.zoom));if(this.fullWidth){var i=this.fullWidth/this.fullHeight,n=Math.tan(H.Math.degToRad(.5*t))*this.near,e=-n,s=i*e,r=Math.abs(i*n-s),h=Math.abs(n-e);this.projectionMatrix.makeFrustum(s+this.x*r/this.fullWidth,s+(this.x+this.width)*r/this.fullWidth,n-(this.y+this.height)*h/this.fullHeight,n-this.y*h/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(t,this.aspect,this.near,this.far)},H.PerspectiveCamera.prototype.copy=function(t){return H.Camera.prototype.copy.call(this,t),this.focalLength=t.focalLength,this.zoom=t.zoom,this.fov=t.fov,this.aspect=t.aspect,this.near=t.near,this.far=t.far,this},H.PerspectiveCamera.prototype.toJSON=function(t){var i=H.Object3D.prototype.toJSON.call(this,t);return i.object.focalLength=this.focalLength,i.object.zoom=this.zoom,i.object.fov=this.fov,i.object.aspect=this.aspect,i.object.near=this.near,i.object.far=this.far,i},H.Light=function(t,i){H.Object3D.call(this),this.type="Light",this.color=new H.Color(t),this.intensity=void 0!==i?i:1,this.receiveShadow=void 0},H.Light.prototype=Object.create(H.Object3D.prototype),H.Light.prototype.constructor=H.Light,H.Light.prototype.copy=function(t){return H.Object3D.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},H.Light.prototype.toJSON=function(t){var i=H.Object3D.prototype.toJSON.call(this,t);return i.object.color=this.color.getHex(),i.object.intensity=this.intensity,void 0!==this.groundColor&&(i.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(i.object.distance=this.distance),void 0!==this.angle&&(i.object.angle=this.angle),void 0!==this.decay&&(i.object.decay=this.decay),void 0!==this.penumbra&&(i.object.penumbra=this.penumbra),i},H.Scene=function(){H.Object3D.call(this),this.type="Scene",this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0},H.Scene.prototype=Object.create(H.Object3D.prototype),H.Scene.prototype.constructor=H.Scene,H.Scene.prototype.copy=function(t,i){return H.Object3D.prototype.copy.call(this,t,i),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this},H.FogExp2=function(t,i){this.name="",this.color=new H.Color(t),this.density=void 0!==i?i:25e-5},H.FogExp2.prototype.clone=function(){return new H.FogExp2(this.color.getHex(),this.density)},H.ImmediateRenderObject=function(t){H.Object3D.call(this),this.material=t,this.render=function(){}},H.ImmediateRenderObject.prototype=Object.create(H.Object3D.prototype),H.ImmediateRenderObject.prototype.constructor=H.ImmediateRenderObject,H.SphereBufferGeometry=function(t,i,n,e,s,r,h){H.BufferGeometry.call(this),this.type="SphereBufferGeometry",this.parameters={radius:t,widthSegments:i,heightSegments:n,phiStart:e,phiLength:s,thetaStart:r,thetaLength:h},t=t||50,i=Math.max(3,Math.floor(i)||8),n=Math.max(2,Math.floor(n)||6),e=void 0!==e?e:0,s=void 0!==s?s:2*Math.PI;for(var o=(r=void 0!==r?r:0)+(h=void 0!==h?h:Math.PI),a=(i+1)*(n+1),u=new H.BufferAttribute(new Float32Array(3*a),3),f=new H.BufferAttribute(new Float32Array(3*a),3),c=new H.BufferAttribute(new Float32Array(2*a),2),l=0,v=[],d=new H.Vector3,p=0;p<=n;p++){for(var m=[],M=p/n,g=0;g<=i;g++){var w=g/i,y=-t*Math.cos(e+w*s)*Math.sin(r+M*h),_=t*Math.cos(r+M*h),x=t*Math.sin(e+w*s)*Math.sin(r+M*h);d.set(y,_,x).normalize(),u.setXYZ(l,y,_,x),f.setXYZ(l,d.x,d.y,d.z),c.setXY(l,w,1-M),m.push(l),l++}v.push(m)}var E=[];for(p=0;p<n;p++)for(g=0;g<i;g++){var S=v[p][g],b=v[p+1][g],A=v[p+1][g+1];(0!==p||r>0)&&E.push(v[p][g+1],S,A),(p!==n-1||o<Math.PI)&&E.push(S,b,A)}this.setIndex(new(u.count>65535?H.Uint32Attribute:H.Uint16Attribute)(E,1)),this.addAttribute("position",u),this.addAttribute("normal",f),this.addAttribute("uv",c),this.boundingSphere=new H.Sphere(new H.Vector3,t)},H.SphereBufferGeometry.prototype=Object.create(H.BufferGeometry.prototype),H.SphereBufferGeometry.prototype.constructor=H.SphereBufferGeometry,H.SphereGeometry=function(t,i,n,e,s,r,h){H.Geometry.call(this),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:i,heightSegments:n,phiStart:e,phiLength:s,thetaStart:r,thetaLength:h},this.fromBufferGeometry(new H.SphereBufferGeometry(t,i,n,e,s,r,h))},H.SphereGeometry.prototype=Object.create(H.Geometry.prototype),H.SphereGeometry.prototype.constructor=H.SphereGeometry,H.Material=function(){Object.defineProperty(this,"id",{value:H.MaterialIdCount++}),this.uuid=H.Math.generateUUID(),this.name="",this.type="Material",this.side=H.FrontSide,this.opacity=1,this.transparent=!1,this.blending=H.NormalBlending,this.blendSrc=H.SrcAlphaFactor,this.blendDst=H.OneMinusSrcAlphaFactor,this.blendEquation=H.AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=H.LessEqualDepth,this.depthTest=!0,this.depthWrite=!0,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.premultipliedAlpha=!1,this.overdraw=0,this.visible=!0,this._needsUpdate=!0},H.Material.prototype={constructor:H.Material,get needsUpdate(){return this._needsUpdate},set needsUpdate(t){!0===t&&this.update(),this._needsUpdate=t},setValues:function(t){if(void 0!==t)for(var i in t){var n=t[i];if(void 0!==n){var e=this[i];void 0!==e&&(e instanceof H.Color?e.set(n):e instanceof H.Vector3&&n instanceof H.Vector3?e.copy(n):this[i]="overdraw"===i?Number(n):n)}}},toJSON:function(t){var i=void 0===t;i&&(t={textures:{},images:{}});var n={metadata:{version:4.4,type:"Material",generator:"Material.toJSON"}};function e(t){var i=[];for(var n in t){var e=t[n];delete e.metadata,i.push(e)}return i}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color instanceof H.Color&&(n.color=this.color.getHex()),.5!==this.roughness&&(n.roughness=this.roughness),.5!==this.metalness&&(n.metalness=this.metalness),this.emissive instanceof H.Color&&(n.emissive=this.emissive.getHex()),this.specular instanceof H.Color&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),this.map instanceof H.Texture&&(n.map=this.map.toJSON(t).uuid),this.alphaMap instanceof H.Texture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap instanceof H.Texture&&(n.lightMap=this.lightMap.toJSON(t).uuid),this.bumpMap instanceof H.Texture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap instanceof H.Texture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalScale=this.normalScale.toArray()),this.displacementMap instanceof H.Texture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap instanceof H.Texture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap instanceof H.Texture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap instanceof H.Texture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap instanceof H.Texture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.envMap instanceof H.Texture&&(n.envMap=this.envMap.toJSON(t).uuid,n.reflectivity=this.reflectivity),void 0!==this.size&&(n.size=this.size),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),void 0!==this.vertexColors&&this.vertexColors!==H.NoColors&&(n.vertexColors=this.vertexColors),void 0!==this.shading&&this.shading!==H.SmoothShading&&(n.shading=this.shading),void 0!==this.blending&&this.blending!==H.NormalBlending&&(n.blending=this.blending),void 0!==this.side&&this.side!==H.FrontSide&&(n.side=this.side),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),i){var s=e(t.textures),r=e(t.images);s.length>0&&(n.textures=s),r.length>0&&(n.images=r)}return n},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.name=t.name,this.side=t.side,this.opacity=t.opacity,this.transparent=t.transparent,this.blending=t.blending,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.overdraw=t.overdraw,this.visible=t.visible,this},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}},H.EventDispatcher.prototype.apply(H.Material.prototype),H.MaterialIdCount=0,H.LineBasicMaterial=function(t){H.Material.call(this),this.type="LineBasicMaterial",this.color=new H.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.blending=H.NormalBlending,this.vertexColors=H.NoColors,this.fog=!0,this.setValues(t)},H.LineBasicMaterial.prototype=Object.create(H.Material.prototype),H.LineBasicMaterial.prototype.constructor=H.LineBasicMaterial,H.LineBasicMaterial.prototype.copy=function(t){return H.Material.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.vertexColors=t.vertexColors,this.fog=t.fog,this},H.LineDashedMaterial=function(t){H.Material.call(this),this.type="LineDashedMaterial",this.color=new H.Color(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.blending=H.NormalBlending,this.vertexColors=H.NoColors,this.fog=!0,this.setValues(t)},H.LineDashedMaterial.prototype=Object.create(H.Material.prototype),H.LineDashedMaterial.prototype.constructor=H.LineDashedMaterial,H.LineDashedMaterial.prototype.copy=function(t){return H.Material.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this.vertexColors=t.vertexColors,this.fog=t.fog,this},H.PointsMaterial=function(t){H.Material.call(this),this.type="PointsMaterial",this.color=new H.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.blending=H.NormalBlending,this.vertexColors=H.NoColors,this.fog=!0,this.setValues(t)},H.PointsMaterial.prototype=Object.create(H.Material.prototype),H.PointsMaterial.prototype.constructor=H.PointsMaterial,H.PointsMaterial.prototype.copy=function(t){return H.Material.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.vertexColors=t.vertexColors,this.fog=t.fog,this},H.MeshDepthMaterial=function(t){H.Material.call(this),this.type="MeshDepthMaterial",this.morphTargets=!1,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)},H.MeshDepthMaterial.prototype=Object.create(H.Material.prototype),H.MeshDepthMaterial.prototype.constructor=H.MeshDepthMaterial,H.MeshDepthMaterial.prototype.copy=function(t){return H.Material.prototype.copy.call(this,t),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},H.MeshNormalMaterial=function(t){H.Material.call(this,t),this.type="MeshNormalMaterial",this.wireframe=!1,this.wireframeLinewidth=1,this.morphTargets=!1,this.setValues(t)},H.MeshNormalMaterial.prototype=Object.create(H.Material.prototype),H.MeshNormalMaterial.prototype.constructor=H.MeshNormalMaterial,H.MeshNormalMaterial.prototype.copy=function(t){return H.Material.prototype.copy.call(this,t),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},H.ShaderMaterial=function(t){H.Material.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.shading=H.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.vertexColors=H.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,void 0!==t&&this.setValues(t)},H.ShaderMaterial.prototype=Object.create(H.Material.prototype),H.ShaderMaterial.prototype.constructor=H.ShaderMaterial,H.ShaderMaterial.prototype.copy=function(t){return H.Material.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=H.UniformsUtils.clone(t.uniforms),this.defines=t.defines,this.shading=t.shading,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.vertexColors=t.vertexColors,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=t.extensions,this},H.ShaderMaterial.prototype.toJSON=function(t){var i=H.Material.prototype.toJSON.call(this,t);return i.uniforms=this.uniforms,i.vertexShader=this.vertexShader,i.fragmentShader=this.fragmentShader,i},H.MeshBasicMaterial=function(t){H.Material.call(this),this.type="MeshBasicMaterial",this.color=new H.Color(16777215),this.map=null,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=H.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=H.SmoothShading,this.blending=H.NormalBlending,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=H.NoColors,this.skinning=!1,this.morphTargets=!1,this.setValues(t)},H.MeshBasicMaterial.prototype=Object.create(H.Material.prototype),H.MeshBasicMaterial.prototype.constructor=H.MeshBasicMaterial,H.MeshBasicMaterial.prototype.copy=function(t){return H.Material.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.fog=t.fog,this.shading=t.shading,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.vertexColors=t.vertexColors,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this},H.MeshLambertMaterial=function(t){H.Material.call(this),this.type="MeshLambertMaterial",this.color=new H.Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new H.Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=H.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.blending=H.NormalBlending,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=H.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)},H.MeshLambertMaterial.prototype=Object.create(H.Material.prototype),H.MeshLambertMaterial.prototype.constructor=H.MeshLambertMaterial,H.MeshLambertMaterial.prototype.copy=function(t){return H.Material.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.fog=t.fog,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.vertexColors=t.vertexColors,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},H.MeshStandardMaterial=function(t){H.Material.call(this),this.type="MeshStandardMaterial",this.color=new H.Color(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new H.Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new H.Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.fog=!0,this.shading=H.SmoothShading,this.blending=H.NormalBlending,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=H.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)},H.MeshStandardMaterial.prototype=Object.create(H.Material.prototype),H.MeshStandardMaterial.prototype.constructor=H.MeshStandardMaterial,H.MeshStandardMaterial.prototype.copy=function(t){return H.Material.prototype.copy.call(this,t),this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.fog=t.fog,this.shading=t.shading,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.vertexColors=t.vertexColors,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},H.MeshPhongMaterial=function(t){H.Material.call(this),this.type="MeshPhongMaterial",this.color=new H.Color(16777215),this.specular=new H.Color(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new H.Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new H.Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=H.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=H.SmoothShading,this.blending=H.NormalBlending,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=H.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)},H.MeshPhongMaterial.prototype=Object.create(H.Material.prototype),H.MeshPhongMaterial.prototype.constructor=H.MeshPhongMaterial,H.MeshPhongMaterial.prototype.copy=function(t){return H.Material.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.fog=t.fog,this.shading=t.shading,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.vertexColors=t.vertexColors,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},H.MultiMaterial=function(t){this.uuid=H.Math.generateUUID(),this.type="MultiMaterial",this.materials=t instanceof Array?t:[],this.visible=!0},H.MultiMaterial.prototype={constructor:H.MultiMaterial,toJSON:function(t){for(var i={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]},n=this.materials,e=0,s=n.length;e<s;e++){var r=n[e].toJSON(t);delete r.metadata,i.materials.push(r)}return i.visible=this.visible,i},clone:function(){for(var t=new this.constructor,i=0;i<this.materials.length;i++)t.materials.push(this.materials[i].clone());return t.visible=this.visible,t}},H.RawShaderMaterial=function(t){H.ShaderMaterial.call(this,t),this.type="RawShaderMaterial"},H.RawShaderMaterial.prototype=Object.create(H.ShaderMaterial.prototype),H.RawShaderMaterial.prototype.constructor=H.RawShaderMaterial,H.Texture=function(t,i,n,e,s,r,h,o,a){Object.defineProperty(this,"id",{value:H.TextureIdCount++}),this.uuid=H.Math.generateUUID(),this.name="",this.sourceFile="",this.image=void 0!==t?t:H.Texture.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==i?i:H.Texture.DEFAULT_MAPPING,this.wrapS=void 0!==n?n:H.ClampToEdgeWrapping,this.wrapT=void 0!==e?e:H.ClampToEdgeWrapping,this.magFilter=void 0!==s?s:H.LinearFilter,this.minFilter=void 0!==r?r:H.LinearMipMapLinearFilter,this.anisotropy=void 0!==a?a:1,this.format=void 0!==h?h:H.RGBAFormat,this.type=void 0!==o?o:H.UnsignedByteType,this.offset=new H.Vector2(0,0),this.repeat=new H.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=H.LinearEncoding,this.version=0,this.onUpdate=null},H.Texture.DEFAULT_IMAGE=void 0,H.Texture.DEFAULT_MAPPING=H.UVMapping,H.Texture.prototype={constructor:H.Texture,set needsUpdate(t){!0===t&&this.version++},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},toJSON:function(t){if(void 0!==t.textures[this.uuid])return t.textures[this.uuid];var i={metadata:{version:4.4,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy};if(void 0!==this.image){var n=this.image;void 0===n.uuid&&(n.uuid=H.Math.generateUUID()),void 0===t.images[n.uuid]&&(t.images[n.uuid]={uuid:n.uuid,url:function(t){var i;return void 0!==t.toDataURL?i=t:((i=document.createElement("canvas")).width=t.width,i.height=t.height,i.getContext("2d").drawImage(t,0,0,t.width,t.height)),i.width>2048||i.height>2048?i.toDataURL("image/jpeg",.6):i.toDataURL("image/png")}(n)}),i.image=n.uuid}return t.textures[this.uuid]=i,i},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(this.mapping===H.UVMapping){if(t.multiply(this.repeat),t.add(this.offset),t.x<0||t.x>1)switch(this.wrapS){case H.RepeatWrapping:t.x=t.x-Math.floor(t.x);break;case H.ClampToEdgeWrapping:t.x=t.x<0?0:1;break;case H.MirroredRepeatWrapping:t.x=1===Math.abs(Math.floor(t.x)%2)?Math.ceil(t.x)-t.x:t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case H.RepeatWrapping:t.y=t.y-Math.floor(t.y);break;case H.ClampToEdgeWrapping:t.y=t.y<0?0:1;break;case H.MirroredRepeatWrapping:t.y=1===Math.abs(Math.floor(t.y)%2)?Math.ceil(t.y)-t.y:t.y-Math.floor(t.y)}this.flipY&&(t.y=1-t.y)}}},H.EventDispatcher.prototype.apply(H.Texture.prototype),H.TextureIdCount=0,H.DataTexture=function(t,i,n,e,s,r,h,o,a,u,f){H.Texture.call(this,null,r,h,o,a,u,e,s,f),this.image={data:t,width:i,height:n},this.magFilter=void 0!==a?a:H.NearestFilter,this.minFilter=void 0!==u?u:H.NearestFilter,this.flipY=!1,this.generateMipmaps=!1},H.DataTexture.prototype=Object.create(H.Texture.prototype),H.DataTexture.prototype.constructor=H.DataTexture,H.CompressedTexture=function(t,i,n,e,s,r,h,o,a,u,f){H.Texture.call(this,null,r,h,o,a,u,e,s,f),this.image={width:i,height:n},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1},H.CompressedTexture.prototype=Object.create(H.Texture.prototype),H.CompressedTexture.prototype.constructor=H.CompressedTexture,H.CubeTexture=function(t,i,n,e,s,r,h,o,a){H.Texture.call(this,t=void 0!==t?t:[],i=void 0!==i?i:H.CubeReflectionMapping,n,e,s,r,h,o,a),this.flipY=!1},H.CubeTexture.prototype=Object.create(H.Texture.prototype),H.CubeTexture.prototype.constructor=H.CubeTexture,Object.defineProperty(H.CubeTexture.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}}),H.VideoTexture=function(t,i,n,e,s,r,h,o,a){H.Texture.call(this,t,i,n,e,s,r,h,o,a),this.generateMipmaps=!1;var u=this;!function i(){requestAnimationFrame(i),t.readyState>=t.HAVE_CURRENT_DATA&&(u.needsUpdate=!0)}()},H.VideoTexture.prototype=Object.create(H.Texture.prototype),H.VideoTexture.prototype.constructor=H.VideoTexture,H.Sprite=(B=new Uint16Array([0,1,2,0,2,3]),G=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]),V=new Float32Array([0,0,1,0,1,1,0,1]),(j=new H.BufferGeometry).setIndex(new H.BufferAttribute(B,1)),j.addAttribute("position",new H.BufferAttribute(G,3)),j.addAttribute("uv",new H.BufferAttribute(V,2)),function(t){H.Object3D.call(this),this.type="Sprite",this.geometry=j,this.material=void 0!==t?t:new H.SpriteMaterial}),H.Sprite.prototype=Object.create(H.Object3D.prototype),H.Sprite.prototype.constructor=H.Sprite,H.Sprite.prototype.raycast=(X=new H.Vector3,function(t,i){X.setFromMatrixPosition(this.matrixWorld);var n=t.ray.distanceSqToPoint(X);n>this.scale.x*this.scale.y||i.push({distance:Math.sqrt(n),point:this.position,face:null,object:this})}),H.Sprite.prototype.clone=function(){return new this.constructor(this.material).copy(this)},H.Particle=H.Sprite,H.LensFlare=function(t,i,n,e,s){H.Object3D.call(this),this.lensFlares=[],this.positionScreen=new H.Vector3,this.customUpdateCallback=void 0,void 0!==t&&this.add(t,i,n,e,s)},H.LensFlare.prototype=Object.create(H.Object3D.prototype),H.LensFlare.prototype.constructor=H.LensFlare,H.LensFlare.prototype.add=function(t,i,n,e,s,r){void 0===i&&(i=-1),void 0===n&&(n=0),void 0===r&&(r=1),void 0===s&&(s=new H.Color(16777215)),void 0===e&&(e=H.NormalBlending),n=Math.min(n,Math.max(0,n)),this.lensFlares.push({texture:t,size:i,distance:n,x:0,y:0,z:0,scale:1,rotation:0,opacity:r,color:s,blending:e})},H.LensFlare.prototype.updateLensFlares=function(){var t,i,n=this.lensFlares.length,e=2*-this.positionScreen.x,s=2*-this.positionScreen.y;for(t=0;t<n;t++)(i=this.lensFlares[t]).x=this.positionScreen.x+e*i.distance,i.y=this.positionScreen.y+s*i.distance,i.wantedRotation=i.x*Math.PI*.25,i.rotation+=.25*(i.wantedRotation-i.rotation)},H.LensFlare.prototype.copy=function(t){H.Object3D.prototype.copy.call(this,t),this.positionScreen.copy(t.positionScreen),this.customUpdateCallback=t.customUpdateCallback;for(var i=0,n=t.lensFlares.length;i<n;i++)this.lensFlares.push(t.lensFlares[i]);return this},H.Line=function(t,i,n){if(1===n)return new H.LineSegments(t,i);H.Object3D.call(this),this.type="Line",this.geometry=void 0!==t?t:new H.Geometry,this.material=void 0!==i?i:new H.LineBasicMaterial({color:16777215*Math.random()})},H.Line.prototype=Object.create(H.Object3D.prototype),H.Line.prototype.constructor=H.Line,H.Line.prototype.raycast=function(){var t=new H.Matrix4,i=new H.Ray,n=new H.Sphere;return function(e,s){var r=e.linePrecision,h=r*r,o=this.geometry,a=this.matrixWorld;if(null===o.boundingSphere&&o.computeBoundingSphere(),n.copy(o.boundingSphere),n.applyMatrix4(a),!1!==e.ray.intersectsSphere(n)){t.getInverse(a),i.copy(e.ray).applyMatrix4(t);var u=new H.Vector3,f=new H.Vector3,c=new H.Vector3,l=new H.Vector3,v=this instanceof H.LineSegments?2:1;if(o instanceof H.BufferGeometry){var d=o.index,p=o.attributes.position.array;if(null!==d)for(var m=d.array,M=0,g=m.length-1;M<g;M+=v){var w=m[M+1];u.fromArray(p,3*m[M]),f.fromArray(p,3*w),i.distanceSqToSegment(u,f,l,c)>h||(l.applyMatrix4(this.matrixWorld),(x=e.ray.origin.distanceTo(l))<e.near||x>e.far||s.push({distance:x,point:c.clone().applyMatrix4(this.matrixWorld),index:M,face:null,faceIndex:null,object:this}))}else for(M=0,g=p.length/3-1;M<g;M+=v)u.fromArray(p,3*M),f.fromArray(p,3*M+3),i.distanceSqToSegment(u,f,l,c)>h||(l.applyMatrix4(this.matrixWorld),(x=e.ray.origin.distanceTo(l))<e.near||x>e.far||s.push({distance:x,point:c.clone().applyMatrix4(this.matrixWorld),index:M,face:null,faceIndex:null,object:this}))}else if(o instanceof H.Geometry){var y=o.vertices,_=y.length;for(M=0;M<_-1;M+=v){var x;i.distanceSqToSegment(y[M],y[M+1],l,c)>h||(l.applyMatrix4(this.matrixWorld),(x=e.ray.origin.distanceTo(l))<e.near||x>e.far||s.push({distance:x,point:c.clone().applyMatrix4(this.matrixWorld),index:M,face:null,faceIndex:null,object:this}))}}}}}(),H.Line.prototype.clone=function(){return new this.constructor(this.geometry,this.material).copy(this)},H.LineStrip=0,H.LinePieces=1,H.LineSegments=function(t,i){H.Line.call(this,t,i),this.type="LineSegments"},H.LineSegments.prototype=Object.create(H.Line.prototype),H.LineSegments.prototype.constructor=H.LineSegments,H.Mesh=function(t,i){H.Object3D.call(this),this.type="Mesh",this.geometry=void 0!==t?t:new H.Geometry,this.material=void 0!==i?i:new H.MeshBasicMaterial({color:16777215*Math.random()}),this.drawMode=H.TrianglesDrawMode,this.updateMorphTargets()},H.Mesh.prototype=Object.create(H.Object3D.prototype),H.Mesh.prototype.constructor=H.Mesh,H.Mesh.prototype.setDrawMode=function(t){this.drawMode=t},H.Mesh.prototype.updateMorphTargets=function(){if(void 0!==this.geometry.morphTargets&&this.geometry.morphTargets.length>0){this.morphTargetBase=-1,this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var t=0,i=this.geometry.morphTargets.length;t<i;t++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[t].name]=t}},H.Mesh.prototype.getMorphTargetIndexByName=function(t){return void 0!==this.morphTargetDictionary[t]?this.morphTargetDictionary[t]:0},H.Mesh.prototype.raycast=function(){var t=new H.Matrix4,i=new H.Ray,n=new H.Sphere,e=new H.Vector3,s=new H.Vector3,r=new H.Vector3,h=new H.Vector3,o=new H.Vector3,a=new H.Vector3,u=new H.Vector2,f=new H.Vector2,c=new H.Vector2,l=new H.Vector3,v=new H.Vector3,d=new H.Vector3;function p(t,i,n,e,s,r,h){return H.Triangle.barycoordFromPoint(t,i,n,e,l),s.multiplyScalar(l.x),r.multiplyScalar(l.y),h.multiplyScalar(l.z),s.add(r).add(h),s.clone()}function m(t,i,n,e,s,r,h){var o=t.material;if(null===(o.side===H.BackSide?n.intersectTriangle(r,s,e,!0,h):n.intersectTriangle(e,s,r,o.side!==H.DoubleSide,h)))return null;d.copy(h),d.applyMatrix4(t.matrixWorld);var a=i.ray.origin.distanceTo(d);return a<i.near||a>i.far?null:{distance:a,point:d.clone(),object:t}}function M(t,i,n,h,o,a,l,d){e.fromArray(h,3*a),s.fromArray(h,3*l),r.fromArray(h,3*d);var M=m(t,i,n,e,s,r,v);return M&&(o&&(u.fromArray(o,2*a),f.fromArray(o,2*l),c.fromArray(o,2*d),M.uv=p(v,e,s,r,u,f,c)),M.face=new H.Face3(a,l,d,H.Triangle.normal(e,s,r)),M.faceIndex=a),M}return function(l,d){var g,w,y=this.geometry,_=this.material,x=this.matrixWorld;if(void 0!==_&&(null===y.boundingSphere&&y.computeBoundingSphere(),n.copy(y.boundingSphere),n.applyMatrix4(x),!1!==l.ray.intersectsSphere(n)&&(t.getInverse(x),i.copy(l.ray).applyMatrix4(t),null===y.boundingBox||!1!==i.intersectsBox(y.boundingBox))))if(y instanceof H.BufferGeometry){var E,S=y.index,b=y.attributes,A=b.position.array;if(void 0!==b.uv&&(g=b.uv.array),null!==S)for(var P=S.array,T=0,L=P.length;T<L;T+=3)(w=M(this,l,i,A,g,E=P[T],P[T+1],P[T+2]))&&(w.faceIndex=Math.floor(T/3),d.push(w));else for(T=0,L=A.length;T<L;T+=9)(w=M(this,l,i,A,g,E=T/3,E+1,E+2))&&(w.index=E,d.push(w))}else if(y instanceof H.Geometry){var O,U,N,k=_ instanceof H.MultiMaterial,D=!0===k?_.materials:null,F=y.vertices,I=y.faces,R=y.faceVertexUvs[0];R.length>0&&(g=R);for(var C=0,B=I.length;C<B;C++){var G=I[C],V=!0===k?D[G.materialIndex]:_;if(void 0!==V){if(O=F[G.a],U=F[G.b],N=F[G.c],!0===V.morphTargets){var j=y.morphTargets,X=this.morphTargetInfluences;e.set(0,0,0),s.set(0,0,0),r.set(0,0,0);for(var Y=0,z=j.length;Y<z;Y++){var W=X[Y];if(0!==W){var Z=j[Y].vertices;e.addScaledVector(h.subVectors(Z[G.a],O),W),s.addScaledVector(o.subVectors(Z[G.b],U),W),r.addScaledVector(a.subVectors(Z[G.c],N),W)}}e.add(O),s.add(U),r.add(N),O=e,U=s,N=r}if(w=m(this,l,i,O,U,N,v)){if(g){var q=g[C];u.copy(q[0]),f.copy(q[1]),c.copy(q[2]),w.uv=p(v,O,U,N,u,f,c)}w.face=G,w.faceIndex=C,d.push(w)}}}}}}(),H.Mesh.prototype.clone=function(){return new this.constructor(this.geometry,this.material).copy(this)},H.SkinnedMesh=function(t,i,n){H.Mesh.call(this,t,i),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new H.Matrix4,this.bindMatrixInverse=new H.Matrix4;var e=[];if(this.geometry&&void 0!==this.geometry.bones){for(var s,r,h=0,o=this.geometry.bones.length;h<o;++h)r=this.geometry.bones[h],s=new H.Bone(this),e.push(s),s.name=r.name,s.position.fromArray(r.pos),s.quaternion.fromArray(r.rotq),void 0!==r.scl&&s.scale.fromArray(r.scl);for(h=0,o=this.geometry.bones.length;h<o;++h)-1!==(r=this.geometry.bones[h]).parent&&null!==r.parent?e[r.parent].add(e[h]):this.add(e[h])}this.normalizeSkinWeights(),this.updateMatrixWorld(!0),this.bind(new H.Skeleton(e,void 0,n),this.matrixWorld)},H.SkinnedMesh.prototype=Object.create(H.Mesh.prototype),H.SkinnedMesh.prototype.constructor=H.SkinnedMesh,H.SkinnedMesh.prototype.bind=function(t,i){this.skeleton=t,void 0===i&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),i=this.matrixWorld),this.bindMatrix.copy(i),this.bindMatrixInverse.getInverse(i)},H.SkinnedMesh.prototype.pose=function(){this.skeleton.pose()},H.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof H.Geometry)for(var t=0;t<this.geometry.skinWeights.length;t++){var i=this.geometry.skinWeights[t];(s=1/i.lengthManhattan())!=1/0?i.multiplyScalar(s):i.set(1,0,0,0)}else if(this.geometry instanceof H.BufferGeometry){var n=new H.Vector4,e=this.geometry.attributes.skinWeight;for(t=0;t<e.count;t++){var s;n.x=e.getX(t),n.y=e.getY(t),n.z=e.getZ(t),n.w=e.getW(t),(s=1/n.lengthManhattan())!=1/0?n.multiplyScalar(s):n.set(1,0,0,0),e.setXYZW(t,n.x,n.y,n.z,n.w)}}},H.SkinnedMesh.prototype.updateMatrixWorld=function(){H.Mesh.prototype.updateMatrixWorld.call(this,!0),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode&&this.bindMatrixInverse.getInverse(this.bindMatrix)},H.SkinnedMesh.prototype.clone=function(){return new this.constructor(this.geometry,this.material,this.useVertexTexture).copy(this)},H.Points=function(t,i){H.Object3D.call(this),this.type="Points",this.geometry=void 0!==t?t:new H.Geometry,this.material=void 0!==i?i:new H.PointsMaterial({color:16777215*Math.random()})},H.Points.prototype=Object.create(H.Object3D.prototype),H.Points.prototype.constructor=H.Points,H.Points.prototype.raycast=function(){var t=new H.Matrix4,i=new H.Ray,n=new H.Sphere;return function(e,s){var r=this,h=this.geometry,o=this.matrixWorld,a=e.params.Points.threshold;if(null===h.boundingSphere&&h.computeBoundingSphere(),n.copy(h.boundingSphere),n.applyMatrix4(o),!1!==e.ray.intersectsSphere(n)){t.getInverse(o),i.copy(e.ray).applyMatrix4(t);var u=a/((this.scale.x+this.scale.y+this.scale.z)/3),f=u*u,c=new H.Vector3;if(h instanceof H.BufferGeometry){var l=h.index,v=h.attributes.position.array;if(null!==l)for(var d=l.array,p=0,m=d.length;p<m;p++){var M=d[p];c.fromArray(v,3*M),y(c,M)}else{p=0;for(var g=v.length/3;p<g;p++)c.fromArray(v,3*p),y(c,p)}}else{var w=h.vertices;for(p=0,g=w.length;p<g;p++)y(w[p],p)}}function y(t,n){var h=i.distanceSqToPoint(t);if(h<f){var a=i.closestPointToPoint(t);a.applyMatrix4(o);var u=e.ray.origin.distanceTo(a);if(u<e.near||u>e.far)return;s.push({distance:u,distanceToRay:Math.sqrt(h),point:a.clone(),index:n,face:null,object:r})}}}}(),H.Points.prototype.clone=function(){return new this.constructor(this.geometry,this.material).copy(this)},H.Light=function(t,i){H.Object3D.call(this),this.type="Light",this.color=new H.Color(t),this.intensity=void 0!==i?i:1,this.receiveShadow=void 0},H.Light.prototype=Object.create(H.Object3D.prototype),H.Light.prototype.constructor=H.Light,H.Light.prototype.copy=function(t){return H.Object3D.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},H.Light.prototype.toJSON=function(t){var i=H.Object3D.prototype.toJSON.call(this,t);return i.object.color=this.color.getHex(),i.object.intensity=this.intensity,void 0!==this.groundColor&&(i.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(i.object.distance=this.distance),void 0!==this.angle&&(i.object.angle=this.angle),void 0!==this.decay&&(i.object.decay=this.decay),void 0!==this.penumbra&&(i.object.penumbra=this.penumbra),i},H.ShaderChunk={},H.ShaderChunk.alphamap_fragment="#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n",H.ShaderChunk.alphamap_pars_fragment="#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n",H.ShaderChunk.alphatest_fragment="#ifdef ALPHATEST\n\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n\n#endif\n",H.ShaderChunk.aomap_fragment="#ifdef USE_AOMAP\n\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\n\t#endif\n\n#endif\n",H.ShaderChunk.aomap_pars_fragment="#ifdef USE_AOMAP\n\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n\n#endif",H.ShaderChunk.begin_vertex="\nvec3 transformed = vec3( position );\n",H.ShaderChunk.beginnormal_vertex="\nvec3 objectNormal = vec3( normal );\n",H.ShaderChunk.color_fragment="#ifdef USE_COLOR\n\n\tdiffuseColor.rgb *= vColor;\n\n#endif",H.ShaderChunk.color_pars_fragment="#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif\n",H.ShaderChunk.color_pars_vertex="#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif",H.ShaderChunk.color_vertex="#ifdef USE_COLOR\n\n\tvColor.xyz = color.xyz;\n\n#endif",H.ShaderChunk.common="#define PI 3.14159\n#define PI2 6.28318\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\n\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\n\n\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\n\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\n\n\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n}\n\n// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n\n}\n\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\n\treturn - distance * planeNormal + point;\n\n}\n\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n\n}\n\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n\n}\n",H.ShaderChunk.defaultnormal_vertex="#ifdef FLIP_SIDED\n\n\tobjectNormal = -objectNormal;\n\n#endif\n\nvec3 transformedNormal = normalMatrix * objectNormal;\n",H.ShaderChunk.encodings_fragment="  gl_FragColor = linearToOutputTexel( gl_FragColor );\n",H.ShaderChunk.encodings_pars_fragment="// For a discussion of what this is, please read this: http://lousodrome.net/blog/light/2013/05/26/gamma-correct-and-hdr-rendering-in-a-32-bits-buffer/\n\nvec4 LinearToLinear( in vec4 value ) {\n  return value;\n}\n\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n  return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\n\nvec4 sRGBToLinear( in vec4 value ) {\n  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n  return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\n\nvec4 RGBEToLinear( in vec4 value ) {\n  return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n  float maxComponent = max( max( value.r, value.g ), value.b );\n  float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n  return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n//  return vec4( value.brg, ( 3.0 + 128.0 ) / 256.0 );\n}\n\n// reference: http://iwasbeingirony.blogspot.ca/2010/06/difference-between-rgbm-and-rgbd.html\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n  return vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n  float maxRGB = max( value.x, max( value.g, value.b ) );\n  float M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n  M            = ceil( M * 255.0 ) / 255.0;\n  return vec4( value.rgb / ( M * maxRange ), M );\n}\n\n// reference: http://iwasbeingirony.blogspot.ca/2010/06/difference-between-rgbm-and-rgbd.html\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n    return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n    float maxRGB = max( value.x, max( value.g, value.b ) );\n    float D      = max( maxRange / maxRGB, 1.0 );\n    D            = min( floor( D ) / 255.0, 1.0 );\n    return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\n\n// LogLuv reference: http://graphicrants.blogspot.ca/2009/04/rgbm-color-encoding.html\n\n// M matrix, for encoding\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n  vec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n  Xp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n  vec4 vResult;\n  vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n  float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n  vResult.w = fract(Le);\n  vResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n  return vResult;\n}\n\n// Inverse M matrix, for decoding\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n  float Le = value.z * 255.0 + value.w;\n  vec3 Xp_Y_XYZp;\n  Xp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n  Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n  Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n  vec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n  return vec4( max(vRGB, 0.0), 1.0 );\n}\n",H.ShaderChunk.envmap_fragment="#ifdef USE_ENVMAP\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\n\t\t// Transforming Normal Vectors with the Inverse Transformation\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\n\t\t#else\n\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#else\n\n\t\tvec3 reflectVec = vReflect;\n\n\t#endif\n\n\t#ifdef DOUBLE_SIDED\n\t\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#else\n\t\tfloat flipNormal = 1.0;\n\t#endif\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\n\t\tvec2 sampleUV;\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\n\t\tvec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\n\t#endif\n\n\tenvColor = envMapTexelToLinear( envColor );\n\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\n\t#endif\n\n#endif\n",H.ShaderChunk.envmap_pars_fragment="#if defined( USE_ENVMAP ) || defined( STANDARD )\n\tuniform float reflectivity;\n\tuniform float envMapIntenstiy;\n#endif\n\n#ifdef USE_ENVMAP\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( STANDARD )\n\n\t\tuniform float refractionRatio;\n\n\t#else\n\n\t\tvarying vec3 vReflect;\n\n\t#endif\n\n#endif\n",H.ShaderChunk.envmap_pars_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG ) && ! defined( STANDARD )\n\n\tvarying vec3 vReflect;\n\n\tuniform float refractionRatio;\n\n#endif\n",H.ShaderChunk.envmap_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG ) && ! defined( STANDARD )\n\n\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\n\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\n\t#else\n\n\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t#endif\n\n#endif\n",H.ShaderChunk.fog_fragment="#ifdef USE_FOG\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\n\t#else\n\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\n\t#endif\n\n\t#ifdef FOG_EXP2\n\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );\n\n\t#else\n\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n\n\t#endif\n\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n\n#endif\n",H.ShaderChunk.fog_pars_fragment="#ifdef USE_FOG\n\n\tuniform vec3 fogColor;\n\n\t#ifdef FOG_EXP2\n\n\t\tuniform float fogDensity;\n\n\t#else\n\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n\n#endif",H.ShaderChunk.logdepthbuf_fragment="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n#endif",H.ShaderChunk.logdepthbuf_pars_fragment="#ifdef USE_LOGDEPTHBUF\n\n\tuniform float logDepthBufFC;\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvarying float vFragDepth;\n\n\t#endif\n\n#endif\n",H.ShaderChunk.logdepthbuf_pars_vertex="#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvarying float vFragDepth;\n\n\t#endif\n\n\tuniform float logDepthBufFC;\n\n#endif",H.ShaderChunk.logdepthbuf_vertex="#ifdef USE_LOGDEPTHBUF\n\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\n\t#else\n\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\n\t#endif\n\n#endif\n",H.ShaderChunk.map_fragment="#ifdef USE_MAP\n\n\tvec4 texelColor = texture2D( map, vUv );\n\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n\n#endif\n",H.ShaderChunk.map_pars_fragment="#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif\n",H.ShaderChunk.morphnormal_vertex="#ifdef USE_MORPHNORMALS\n\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n\n#endif\n",H.ShaderChunk.morphtarget_pars_vertex="#ifdef USE_MORPHTARGETS\n\n\t#ifndef USE_MORPHNORMALS\n\n\tuniform float morphTargetInfluences[ 8 ];\n\n\t#else\n\n\tuniform float morphTargetInfluences[ 4 ];\n\n\t#endif\n\n#endif",H.ShaderChunk.morphtarget_vertex="#ifdef USE_MORPHTARGETS\n\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\n\t#ifndef USE_MORPHNORMALS\n\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\n\t#endif\n\n#endif\n",H.ShaderChunk.premultiplied_alpha_fragment="#ifdef PREMULTIPLIED_ALPHA\n\n\t// Get get normal blending with premultipled, use with CustomBlending, OneFactor, OneMinusSrcAlphaFactor, AddEquation.\n\tgl_FragColor.rgb *= gl_FragColor.a;\n\n#endif\n",H.ShaderChunk.project_vertex="#ifdef USE_SKINNING\n\n\tvec4 mvPosition = modelViewMatrix * skinned;\n\n#else\n\n\tvec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n\n#endif\n\ngl_Position = projectionMatrix * mvPosition;\n",H.ShaderChunk.skinbase_vertex="#ifdef USE_SKINNING\n\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif",H.ShaderChunk.skinning_pars_vertex="#ifdef USE_SKINNING\n\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\n\t#ifdef BONE_TEXTURE\n\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureWidth;\n\t\tuniform int boneTextureHeight;\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\n\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\n\n\t\t\ty = dy * ( y + 0.5 );\n\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\n\t\t\treturn bone;\n\n\t\t}\n\n\t#else\n\n\t\tuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tmat4 bone = boneGlobalMatrices[ int(i) ];\n\t\t\treturn bone;\n\n\t\t}\n\n\t#endif\n\n#endif\n",H.ShaderChunk.skinning_vertex="#ifdef USE_SKINNING\n\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned  = bindMatrixInverse * skinned;\n\n#endif\n",H.ShaderChunk.skinnormal_vertex="#ifdef USE_SKINNING\n\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\n#endif\n",H.ShaderChunk.specularmap_fragment="float specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n\n#else\n\n\tspecularStrength = 1.0;\n\n#endif",H.ShaderChunk.specularmap_pars_fragment="#ifdef USE_SPECULARMAP\n\n\tuniform sampler2D specularMap;\n\n#endif",H.ShaderChunk.tonemapping_fragment="#if defined( TONE_MAPPING )\n\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n\n#endif\n",H.ShaderChunk.tonemapping_pars_fragment="#define saturate(a) clamp( a, 0.0, 1.0 )\n\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\n\n// exposure only\nvec3 LinearToneMapping( vec3 color ) {\n\n  return toneMappingExposure * color;\n\n}\n\n// source: https://www.cs.utah.edu/~reinhard/cdrom/\nvec3 ReinhardToneMapping( vec3 color ) {\n\n  color *= toneMappingExposure;\n  return saturate( color / ( vec3( 1.0 ) + color ) );\n\n}\n\n// source: http://filmicgames.com/archives/75\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\n  // John Hable's filmic operator from Uncharted 2 video game\n  color *= toneMappingExposure;\n  return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n\n}\n\n// source: http://filmicgames.com/archives/75\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\n  // optimized filmic operator by Jim Hejl and Richard Burgess-Dawson\n  color *= toneMappingExposure;\n  color = max( vec3( 0.0 ), color - 0.004 );\n  return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n\n}\n",H.ShaderChunk.uv2_pars_fragment="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tvarying vec2 vUv2;\n\n#endif",H.ShaderChunk.uv2_pars_vertex="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\n#endif",H.ShaderChunk.uv2_vertex="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tvUv2 = uv2;\n\n#endif",H.ShaderChunk.uv_pars_fragment="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\n\tvarying vec2 vUv;\n\n#endif",H.ShaderChunk.uv_pars_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n\n#endif\n",H.ShaderChunk.uv_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n\n#endif",H.ShaderChunk.worldpos_vertex="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( STANDARD ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\n\t#ifdef USE_SKINNING\n\n\t\tvec4 worldPosition = modelMatrix * skinned;\n\n\t#else\n\n\t\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n\n\t#endif\n\n#endif\n",H.ShaderChunk.meshbasic_frag="uniform vec3 diffuse;\nuniform float opacity;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n\nvoid main() {\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\n\tReflectedLight reflectedLight;\n\treflectedLight.directDiffuse = vec3( 0.0 );\n\treflectedLight.directSpecular = vec3( 0.0 );\n\treflectedLight.indirectDiffuse = diffuseColor.rgb;\n\treflectedLight.indirectSpecular = vec3( 0.0 );\n\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\n}\n",H.ShaderChunk.meshbasic_vert="#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\n\t#ifdef USE_ENVMAP\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\n}\n",H.UniformsUtils={merge:function(t){for(var i={},n=0;n<t.length;n++){var e=this.clone(t[n]);for(var s in e)i[s]=e[s]}return i},clone:function(t){var i={};for(var n in t)for(var e in i[n]={},t[n]){var s=t[n][e];i[n][e]=s instanceof H.Color||s instanceof H.Vector2||s instanceof H.Vector3||s instanceof H.Vector4||s instanceof H.Matrix3||s instanceof H.Matrix4||s instanceof H.Texture?s.clone():Array.isArray(s)?s.slice():s}return i}},H.UniformsLib={common:{diffuse:{type:"c",value:new H.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new H.Vector4(0,0,1,1)},specularMap:{type:"t",value:null},alphaMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98}},aomap:{aoMap:{type:"t",value:null},aoMapIntensity:{type:"f",value:1}},lightmap:{lightMap:{type:"t",value:null},lightMapIntensity:{type:"f",value:1}},emissivemap:{emissiveMap:{type:"t",value:null}},bumpmap:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new H.Vector2(1,1)}},displacementmap:{displacementMap:{type:"t",value:null},displacementScale:{type:"f",value:1},displacementBias:{type:"f",value:0}},roughnessmap:{roughnessMap:{type:"t",value:null}},metalnessmap:{metalnessMap:{type:"t",value:null}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new H.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLights:{type:"sa",value:[],properties:{direction:{type:"v3"},color:{type:"c"},shadow:{type:"i"},shadowBias:{type:"f"},shadowRadius:{type:"f"},shadowMapSize:{type:"v2"}}},directionalShadowMap:{type:"tv",value:[]},directionalShadowMatrix:{type:"m4v",value:[]},spotLights:{type:"sa",value:[],properties:{color:{type:"c"},position:{type:"v3"},direction:{type:"v3"},distance:{type:"f"},coneCos:{type:"f"},penumbraCos:{type:"f"},decay:{type:"f"},shadow:{type:"i"},shadowBias:{type:"f"},shadowRadius:{type:"f"},shadowMapSize:{type:"v2"}}},spotShadowMap:{type:"tv",value:[]},spotShadowMatrix:{type:"m4v",value:[]},pointLights:{type:"sa",value:[],properties:{color:{type:"c"},position:{type:"v3"},decay:{type:"f"},distance:{type:"f"},shadow:{type:"i"},shadowBias:{type:"f"},shadowRadius:{type:"f"},shadowMapSize:{type:"v2"}}},pointShadowMap:{type:"tv",value:[]},pointShadowMatrix:{type:"m4v",value:[]},hemisphereLights:{type:"sa",value:[],properties:{direction:{type:"v3"},skyColor:{type:"c"},groundColor:{type:"c"}}}},points:{diffuse:{type:"c",value:new H.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new H.Vector4(0,0,1,1)}}},H.ShaderLib={basic:{uniforms:H.UniformsUtils.merge([H.UniformsLib.common,H.UniformsLib.aomap,H.UniformsLib.fog]),vertexShader:H.ShaderChunk.meshbasic_vert,fragmentShader:H.ShaderChunk.meshbasic_frag},lambert:{uniforms:H.UniformsUtils.merge([H.UniformsLib.common,H.UniformsLib.aomap,H.UniformsLib.lightmap,H.UniformsLib.emissivemap,H.UniformsLib.fog,H.UniformsLib.lights,{emissive:{type:"c",value:new H.Color(0)}}]),vertexShader:H.ShaderChunk.meshlambert_vert,fragmentShader:H.ShaderChunk.meshlambert_frag},phong:{uniforms:H.UniformsUtils.merge([H.UniformsLib.common,H.UniformsLib.aomap,H.UniformsLib.lightmap,H.UniformsLib.emissivemap,H.UniformsLib.bumpmap,H.UniformsLib.normalmap,H.UniformsLib.displacementmap,H.UniformsLib.fog,H.UniformsLib.lights,{emissive:{type:"c",value:new H.Color(0)},specular:{type:"c",value:new H.Color(1118481)},shininess:{type:"f",value:30}}]),vertexShader:H.ShaderChunk.meshphong_vert,fragmentShader:H.ShaderChunk.meshphong_frag},standard:{uniforms:H.UniformsUtils.merge([H.UniformsLib.common,H.UniformsLib.aomap,H.UniformsLib.lightmap,H.UniformsLib.emissivemap,H.UniformsLib.bumpmap,H.UniformsLib.normalmap,H.UniformsLib.displacementmap,H.UniformsLib.roughnessmap,H.UniformsLib.metalnessmap,H.UniformsLib.fog,H.UniformsLib.lights,{emissive:{type:"c",value:new H.Color(0)},roughness:{type:"f",value:.5},metalness:{type:"f",value:0},envMapIntensity:{type:"f",value:1}}]),vertexShader:H.ShaderChunk.meshstandard_vert,fragmentShader:H.ShaderChunk.meshstandard_frag},points:{uniforms:H.UniformsUtils.merge([H.UniformsLib.points,H.UniformsLib.fog]),vertexShader:H.ShaderChunk.points_vert,fragmentShader:H.ShaderChunk.points_frag},dashed:{uniforms:H.UniformsUtils.merge([H.UniformsLib.common,H.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:H.ShaderChunk.linedashed_vert,fragmentShader:H.ShaderChunk.linedashed_frag},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:H.ShaderChunk.depth_vert,fragmentShader:H.ShaderChunk.depth_frag},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:H.ShaderChunk.normal_vert,fragmentShader:H.ShaderChunk.normal_frag},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:H.ShaderChunk.cube_vert,fragmentShader:H.ShaderChunk.cube_frag},equirect:{uniforms:{tEquirect:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:H.ShaderChunk.equirect_vert,fragmentShader:H.ShaderChunk.equirect_frag},depthRGBA:{uniforms:{},vertexShader:H.ShaderChunk.depthRGBA_vert,fragmentShader:H.ShaderChunk.depthRGBA_frag},distanceRGBA:{uniforms:{lightPos:{type:"v3",value:new H.Vector3(0,0,0)}},vertexShader:H.ShaderChunk.distanceRGBA_vert,fragmentShader:H.ShaderChunk.distanceRGBA_frag}},H.WebGLRenderer=function(t){var i=void 0!==(t=t||{}).canvas?t.canvas:document.createElement("canvas"),n=void 0!==t.context?t.context:null,e=void 0!==t.alpha&&t.alpha,s=void 0===t.depth||t.depth,r=void 0===t.stencil||t.stencil,h=void 0!==t.antialias&&t.antialias,o=void 0===t.premultipliedAlpha||t.premultipliedAlpha,a=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,u=[],f=[],c=-1,l=[],v=-1,d=new Float32Array(8),p=[],m=[];this.domElement=i,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=H.LinearToneMapping,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0;var M,g=this,w=null,y=null,_=null,x=-1,E="",S=null,b=new H.Vector4,A=null,P=new H.Vector4,T=0,L=new H.Color(0),O=0,U=i.width,N=i.height,k=1,D=new H.Vector4(0,0,U,N),F=!1,I=new H.Vector4(0,0,U,N),R=new H.Frustum,C=new H.Matrix4,B=new H.Vector3,G={hash:"",ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],shadows:[],shadowsPointLight:0},V={geometries:0,textures:0},j={calls:0,vertices:0,faces:0,points:0};this.info={render:j,memory:V,programs:null};try{var X={alpha:e,depth:s,stencil:r,antialias:h,premultipliedAlpha:o,preserveDrawingBuffer:a};if(null===(M=n||i.getContext("webgl",X)||i.getContext("experimental-webgl",X)))throw null!==i.getContext("webgl")?"Error creating WebGL context with your selected attributes.":"Error creating WebGL context.";void 0===M.getShaderPrecisionFormat&&(M.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}),i.addEventListener("webglcontextlost",at,!1)}catch(t){}var Y=new H.WebGLExtensions(M);Y.get("OES_texture_float"),Y.get("OES_texture_float_linear"),Y.get("OES_texture_half_float"),Y.get("OES_texture_half_float_linear"),Y.get("OES_standard_derivatives"),Y.get("ANGLE_instanced_arrays"),Y.get("OES_element_index_uint")&&(H.BufferGeometry.MaxIndex=4294967296);var z=new H.WebGLCapabilities(M,Y,t),W=new H.WebGLState(M,Y,Nt),Z=new H.WebGLProperties,q=new H.WebGLObjects(M,Z,this.info),J=new H.WebGLPrograms(this,z),K=new H.WebGLLights;this.info.programs=J.programs;var Q=new H.WebGLBufferRenderer(M,Y,j),$=new H.WebGLIndexedBufferRenderer(M,Y,j);function tt(){return null===y?k:1}function it(t,i,n,e){!0===o&&(t*=e,i*=e,n*=e),W.clearColor(t,i,n,e)}function nt(){W.init(),W.scissor(b.copy(D).multiplyScalar(k)),W.viewport(P.copy(I).multiplyScalar(k)),it(L.r,L.g,L.b,O)}function et(){w=null,S=null,E="",x=-1,W.reset()}nt(),this.context=M,this.capabilities=z,this.extensions=Y,this.properties=Z,this.state=W;var st=new H.WebGLShadowMap(this,G,q);this.shadowMap=st;var rt,ht=new H.SpritePlugin(this,p),ot=new H.LensFlarePlugin(this,m);function at(t){t.preventDefault(),et(),nt(),Z.clear()}function ut(t){var i=t.target;i.removeEventListener("dispose",ut),function(t){var i=Z.get(t);if(t.image&&i.__image__webglTextureCube)M.deleteTexture(i.__image__webglTextureCube);else{if(void 0===i.__webglInit)return;M.deleteTexture(i.__webglTexture)}Z.delete(t)}(i),V.textures--}function ft(t){var i=t.target;i.removeEventListener("dispose",ft),function(t){var i=Z.get(t),n=Z.get(t.texture);if(t&&void 0!==n.__webglTexture){if(M.deleteTexture(n.__webglTexture),t instanceof H.WebGLRenderTargetCube)for(var e=0;e<6;e++)M.deleteFramebuffer(i.__webglFramebuffer[e]),M.deleteRenderbuffer(i.__webglDepthbuffer[e]);else M.deleteFramebuffer(i.__webglFramebuffer),M.deleteRenderbuffer(i.__webglDepthbuffer);Z.delete(t.texture),Z.delete(t)}}(i),V.textures--}function ct(t){var i=t.target;i.removeEventListener("dispose",ct),function(t){lt(t),Z.delete(t)}(i)}function lt(t){var i=Z.get(t).program;t.program=void 0,void 0!==i&&J.releaseProgram(i)}function vt(t,i){return Math.abs(i[0])-Math.abs(t[0])}function dt(t,i){return t.object.renderOrder!==i.object.renderOrder?t.object.renderOrder-i.object.renderOrder:t.material.id!==i.material.id?t.material.id-i.material.id:t.z!==i.z?t.z-i.z:t.id-i.id}function pt(t,i){return t.object.renderOrder!==i.object.renderOrder?t.object.renderOrder-i.object.renderOrder:t.z!==i.z?i.z-t.z:t.id-i.id}function mt(t,i,n,e,s){var r,h;n.transparent?(r=l,h=++v):(r=f,h=++c);var o=r[h];void 0!==o?(o.id=t.id,o.object=t,o.geometry=i,o.material=n,o.z=B.z,o.group=s):r.push(o={id:t.id,object:t,geometry:i,material:n,z:B.z,group:s})}function Mt(t,i,n,e){for(var s=0,r=t.length;s<r;s++){var h=t[s],o=h.object,a=h.geometry,u=void 0===e?h.material:e,f=h.group;if(o.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,o.matrixWorld),o.normalMatrix.getNormalMatrix(o.modelViewMatrix),o instanceof H.ImmediateRenderObject){gt(u);var c=wt(i,n,u,o);E="",o.render((function(t){g.renderBufferImmediate(t,c,u)}))}else g.renderBufferDirect(i,n,a,u,o,f)}}function gt(t){!function(t){t.side!==H.DoubleSide?W.enable(M.CULL_FACE):W.disable(M.CULL_FACE),W.setFlipSided(t.side===H.BackSide)}(t),!0===t.transparent?W.setBlending(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha):W.setBlending(H.NoBlending),W.setDepthFunc(t.depthFunc),W.setDepthTest(t.depthTest),W.setDepthWrite(t.depthWrite),W.setColorWrite(t.colorWrite),W.setPolygonOffset(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)}function wt(t,n,e,s){T=0;var r=Z.get(e);void 0===r.program&&(e.needsUpdate=!0),void 0!==r.lightsHash&&r.lightsHash!==G.hash&&(e.needsUpdate=!0),e.needsUpdate&&(function(t,i,n){var e=Z.get(t),s=J.getParameters(t,G,i,n),r=J.getProgramCode(t,s),h=e.program,o=!0;if(void 0===h)t.addEventListener("dispose",ct);else if(h.code!==r)lt(t);else{if(void 0!==s.shaderID)return;o=!1}if(o){if(s.shaderID){var a=H.ShaderLib[s.shaderID];e.__webglShader={name:t.type,uniforms:H.UniformsUtils.clone(a.uniforms),vertexShader:a.vertexShader,fragmentShader:a.fragmentShader}}else e.__webglShader={name:t.type,uniforms:t.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader};t.__webglShader=e.__webglShader,h=J.acquireProgram(t,s,r),e.program=h,t.program=h}var u=h.getAttributes();if(t.morphTargets){t.numSupportedMorphTargets=0;for(var f=0;f<g.maxMorphTargets;f++)u["morphTarget"+f]>=0&&t.numSupportedMorphTargets++}if(t.morphNormals)for(t.numSupportedMorphNormals=0,f=0;f<g.maxMorphNormals;f++)u["morphNormal"+f]>=0&&t.numSupportedMorphNormals++;e.uniformsList=[];var c=e.__webglShader.uniforms,l=e.program.getUniforms();for(var v in c){var d=l[v];d&&e.uniformsList.push([e.__webglShader.uniforms[v],d])}(t instanceof H.MeshPhongMaterial||t instanceof H.MeshLambertMaterial||t instanceof H.MeshStandardMaterial||t.lights)&&(e.lightsHash=G.hash,c.ambientLightColor.value=G.ambient,c.directionalLights.value=G.directional,c.spotLights.value=G.spot,c.pointLights.value=G.point,c.hemisphereLights.value=G.hemi,c.directionalShadowMap.value=G.directionalShadowMap,c.directionalShadowMatrix.value=G.directionalShadowMatrix,c.spotShadowMap.value=G.spotShadowMap,c.spotShadowMatrix.value=G.spotShadowMatrix,c.pointShadowMap.value=G.pointShadowMap,c.pointShadowMatrix.value=G.pointShadowMatrix),e.hasDynamicUniforms=!1;for(var p=0,m=e.uniformsList.length;p<m;p++)if(!0===e.uniformsList[p][0].dynamic){e.hasDynamicUniforms=!0;break}}(e,n,s),e.needsUpdate=!1);var h=!1,o=!1,a=!1,u=r.program,f=u.getUniforms(),c=r.__webglShader.uniforms;if(u.id!==w&&(M.useProgram(u.program),w=u.id,h=!0,o=!0,a=!0),e.id!==x&&(x=e.id,o=!0),(h||t!==S)&&(M.uniformMatrix4fv(f.projectionMatrix,!1,t.projectionMatrix.elements),z.logarithmicDepthBuffer&&M.uniform1f(f.logDepthBufFC,2/(Math.log(t.far+1)/Math.LN2)),t!==S&&(S=t,o=!0,a=!0),(e instanceof H.ShaderMaterial||e instanceof H.MeshPhongMaterial||e instanceof H.MeshStandardMaterial||e.envMap)&&void 0!==f.cameraPosition&&(B.setFromMatrixPosition(t.matrixWorld),M.uniform3f(f.cameraPosition,B.x,B.y,B.z)),(e instanceof H.MeshPhongMaterial||e instanceof H.MeshLambertMaterial||e instanceof H.MeshBasicMaterial||e instanceof H.MeshStandardMaterial||e instanceof H.ShaderMaterial||e.skinning)&&void 0!==f.viewMatrix&&M.uniformMatrix4fv(f.viewMatrix,!1,t.matrixWorldInverse.elements),void 0!==f.toneMappingExposure&&M.uniform1f(f.toneMappingExposure,g.toneMappingExposure),void 0!==f.toneMappingWhitePoint&&M.uniform1f(f.toneMappingWhitePoint,g.toneMappingWhitePoint)),e.skinning)if(s.bindMatrix&&void 0!==f.bindMatrix&&M.uniformMatrix4fv(f.bindMatrix,!1,s.bindMatrix.elements),s.bindMatrixInverse&&void 0!==f.bindMatrixInverse&&M.uniformMatrix4fv(f.bindMatrixInverse,!1,s.bindMatrixInverse.elements),z.floatVertexTextures&&s.skeleton&&s.skeleton.useVertexTexture){if(void 0!==f.boneTexture){var l=_t();M.uniform1i(f.boneTexture,l),g.setTexture(s.skeleton.boneTexture,l)}void 0!==f.boneTextureWidth&&M.uniform1i(f.boneTextureWidth,s.skeleton.boneTextureWidth),void 0!==f.boneTextureHeight&&M.uniform1i(f.boneTextureHeight,s.skeleton.boneTextureHeight)}else s.skeleton&&s.skeleton.boneMatrices&&void 0!==f.boneGlobalMatrices&&M.uniformMatrix4fv(f.boneGlobalMatrices,!1,s.skeleton.boneMatrices);return o&&((e instanceof H.MeshPhongMaterial||e instanceof H.MeshLambertMaterial||e instanceof H.MeshStandardMaterial||e.lights)&&function(t,i){t.ambientLightColor.needsUpdate=i,t.directionalLights.needsUpdate=i,t.pointLights.needsUpdate=i,t.spotLights.needsUpdate=i,t.hemisphereLights.needsUpdate=i}(c,a),n&&e.fog&&function(t,i){t.fogColor.value=i.color,i instanceof H.Fog?(t.fogNear.value=i.near,t.fogFar.value=i.far):i instanceof H.FogExp2&&(t.fogDensity.value=i.density)}(c,n),(e instanceof H.MeshBasicMaterial||e instanceof H.MeshLambertMaterial||e instanceof H.MeshPhongMaterial||e instanceof H.MeshStandardMaterial)&&function(t,i){var n;if(t.opacity.value=i.opacity,t.diffuse.value=i.color,i.emissive&&t.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),t.map.value=i.map,t.specularMap.value=i.specularMap,t.alphaMap.value=i.alphaMap,i.aoMap&&(t.aoMap.value=i.aoMap,t.aoMapIntensity.value=i.aoMapIntensity),i.map?n=i.map:i.specularMap?n=i.specularMap:i.displacementMap?n=i.displacementMap:i.normalMap?n=i.normalMap:i.bumpMap?n=i.bumpMap:i.roughnessMap?n=i.roughnessMap:i.metalnessMap?n=i.metalnessMap:i.alphaMap?n=i.alphaMap:i.emissiveMap&&(n=i.emissiveMap),void 0!==n){n instanceof H.WebGLRenderTarget&&(n=n.texture);var e=n.offset,s=n.repeat;t.offsetRepeat.value.set(e.x,e.y,s.x,s.y)}t.envMap.value=i.envMap,t.flipEnvMap.value=i.envMap instanceof H.WebGLRenderTargetCube?1:-1,t.reflectivity.value=i.reflectivity,t.refractionRatio.value=i.refractionRatio}(c,e),e instanceof H.LineBasicMaterial?yt(c,e):e instanceof H.LineDashedMaterial?(yt(c,e),function(t,i){t.dashSize.value=i.dashSize,t.totalSize.value=i.dashSize+i.gapSize,t.scale.value=i.scale}(c,e)):e instanceof H.PointsMaterial?function(t,n){if(t.diffuse.value=n.color,t.opacity.value=n.opacity,t.size.value=n.size*k,t.scale.value=i.clientHeight/2,t.map.value=n.map,null!==n.map){var e=n.map.offset,s=n.map.repeat;t.offsetRepeat.value.set(e.x,e.y,s.x,s.y)}}(c,e):e instanceof H.MeshLambertMaterial?function(t,i){i.lightMap&&(t.lightMap.value=i.lightMap,t.lightMapIntensity.value=i.lightMapIntensity),i.emissiveMap&&(t.emissiveMap.value=i.emissiveMap)}(c,e):e instanceof H.MeshPhongMaterial?function(t,i){t.specular.value=i.specular,t.shininess.value=Math.max(i.shininess,1e-4),i.lightMap&&(t.lightMap.value=i.lightMap,t.lightMapIntensity.value=i.lightMapIntensity),i.emissiveMap&&(t.emissiveMap.value=i.emissiveMap),i.bumpMap&&(t.bumpMap.value=i.bumpMap,t.bumpScale.value=i.bumpScale),i.normalMap&&(t.normalMap.value=i.normalMap,t.normalScale.value.copy(i.normalScale)),i.displacementMap&&(t.displacementMap.value=i.displacementMap,t.displacementScale.value=i.displacementScale,t.displacementBias.value=i.displacementBias)}(c,e):e instanceof H.MeshStandardMaterial?function(t,i){t.roughness.value=i.roughness,t.metalness.value=i.metalness,i.roughnessMap&&(t.roughnessMap.value=i.roughnessMap),i.metalnessMap&&(t.metalnessMap.value=i.metalnessMap),i.lightMap&&(t.lightMap.value=i.lightMap,t.lightMapIntensity.value=i.lightMapIntensity),i.emissiveMap&&(t.emissiveMap.value=i.emissiveMap),i.bumpMap&&(t.bumpMap.value=i.bumpMap,t.bumpScale.value=i.bumpScale),i.normalMap&&(t.normalMap.value=i.normalMap,t.normalScale.value.copy(i.normalScale)),i.displacementMap&&(t.displacementMap.value=i.displacementMap,t.displacementScale.value=i.displacementScale,t.displacementBias.value=i.displacementBias),i.envMap&&(t.envMapIntensity.value=i.envMapIntensity)}(c,e):e instanceof H.MeshDepthMaterial?(c.mNear.value=t.near,c.mFar.value=t.far,c.opacity.value=e.opacity):e instanceof H.MeshNormalMaterial&&(c.opacity.value=e.opacity),Et(r.uniformsList)),function(t,i){M.uniformMatrix4fv(t.modelViewMatrix,!1,i.modelViewMatrix.elements),t.normalMatrix&&M.uniformMatrix3fv(t.normalMatrix,!1,i.normalMatrix.elements)}(f,s),void 0!==f.modelMatrix&&M.uniformMatrix4fv(f.modelMatrix,!1,s.matrixWorld.elements),!0===r.hasDynamicUniforms&&function(t,i,n){for(var e=[],s=0,r=t.length;s<r;s++){var h=t[s][0],o=h.onUpdateCallback;void 0!==o&&(o.bind(h)(i,n),e.push(t[s]))}Et(e)}(r.uniformsList,s,t),u}function yt(t,i){t.diffuse.value=i.color,t.opacity.value=i.opacity}function _t(){var t=T;return T+=1,t}function xt(t,i,n,e){var s,r;if("1i"===i)M.uniform1i(n,e);else if("1f"===i)M.uniform1f(n,e);else if("2f"===i)M.uniform2f(n,e[0],e[1]);else if("3f"===i)M.uniform3f(n,e[0],e[1],e[2]);else if("4f"===i)M.uniform4f(n,e[0],e[1],e[2],e[3]);else if("1iv"===i)M.uniform1iv(n,e);else if("3iv"===i)M.uniform3iv(n,e);else if("1fv"===i)M.uniform1fv(n,e);else if("2fv"===i)M.uniform2fv(n,e);else if("3fv"===i)M.uniform3fv(n,e);else if("4fv"===i)M.uniform4fv(n,e);else if("Matrix2fv"===i)M.uniformMatrix2fv(n,!1,e);else if("Matrix3fv"===i)M.uniformMatrix3fv(n,!1,e);else if("Matrix4fv"===i)M.uniformMatrix4fv(n,!1,e);else if("i"===i)M.uniform1i(n,e);else if("f"===i)M.uniform1f(n,e);else if("v2"===i)M.uniform2f(n,e.x,e.y);else if("v3"===i)M.uniform3f(n,e.x,e.y,e.z);else if("v4"===i)M.uniform4f(n,e.x,e.y,e.z,e.w);else if("c"===i)M.uniform3f(n,e.r,e.g,e.b);else if("s"===i){var h=t.properties;for(var o in h)xt(f=h[o],f.type,n[o],e[o])}else if("sa"===i){h=t.properties;for(var a=0,u=e.length;a<u;a++)for(var o in h){var f;xt(f=h[o],f.type,n[a][o],e[a][o])}}else if("iv1"===i)M.uniform1iv(n,e);else if("iv"===i)M.uniform3iv(n,e);else if("fv1"===i)M.uniform1fv(n,e);else if("fv"===i)M.uniform3fv(n,e);else if("v2v"===i){void 0===t._array&&(t._array=new Float32Array(2*e.length)),a=0;for(var c=0,l=e.length;a<l;a++,c+=2)t._array[c+0]=e[a].x,t._array[c+1]=e[a].y;M.uniform2fv(n,t._array)}else if("v3v"===i){void 0===t._array&&(t._array=new Float32Array(3*e.length)),a=0;var v=0;for(l=e.length;a<l;a++,v+=3)t._array[v+0]=e[a].x,t._array[v+1]=e[a].y,t._array[v+2]=e[a].z;M.uniform3fv(n,t._array)}else if("v4v"===i){void 0===t._array&&(t._array=new Float32Array(4*e.length)),a=0;var d=0;for(l=e.length;a<l;a++,d+=4)t._array[d+0]=e[a].x,t._array[d+1]=e[a].y,t._array[d+2]=e[a].z,t._array[d+3]=e[a].w;M.uniform4fv(n,t._array)}else if("m2"===i)M.uniformMatrix2fv(n,!1,e.elements);else if("m3"===i)M.uniformMatrix3fv(n,!1,e.elements);else if("m3v"===i){for(void 0===t._array&&(t._array=new Float32Array(9*e.length)),a=0,l=e.length;a<l;a++)e[a].flattenToArrayOffset(t._array,9*a);M.uniformMatrix3fv(n,!1,t._array)}else if("m4"===i)M.uniformMatrix4fv(n,!1,e.elements);else if("m4v"===i){for(void 0===t._array&&(t._array=new Float32Array(16*e.length)),a=0,l=e.length;a<l;a++)e[a].flattenToArrayOffset(t._array,16*a);M.uniformMatrix4fv(n,!1,t._array)}else if("t"===i){if(s=e,r=_t(),M.uniform1i(n,r),!s)return;s instanceof H.CubeTexture||Array.isArray(s.image)&&6===s.image.length?Pt(s,r):s instanceof H.WebGLRenderTargetCube?Tt(s.texture,r):g.setTexture(s instanceof H.WebGLRenderTarget?s.texture:s,r)}else if("tv"===i){for(void 0===t._array&&(t._array=[]),a=0,l=t.value.length;a<l;a++)t._array[a]=_t();for(M.uniform1iv(n,t._array),a=0,l=t.value.length;a<l;a++)r=t._array[a],(s=t.value[a])&&(s instanceof H.CubeTexture||s.image instanceof Array&&6===s.image.length?Pt(s,r):s instanceof H.WebGLRenderTarget?g.setTexture(s.texture,r):s instanceof H.WebGLRenderTargetCube?Tt(s.texture,r):g.setTexture(s,r))}}function Et(t){for(var i=0,n=t.length;i<n;i++){var e=t[i][0];!1!==e.needsUpdate&&xt(e,e.type,t[i][1],e.value)}}function St(t,i,n){var e;if(n?(M.texParameteri(t,M.TEXTURE_WRAP_S,Nt(i.wrapS)),M.texParameteri(t,M.TEXTURE_WRAP_T,Nt(i.wrapT)),M.texParameteri(t,M.TEXTURE_MAG_FILTER,Nt(i.magFilter)),M.texParameteri(t,M.TEXTURE_MIN_FILTER,Nt(i.minFilter))):(M.texParameteri(t,M.TEXTURE_WRAP_S,M.CLAMP_TO_EDGE),M.texParameteri(t,M.TEXTURE_WRAP_T,M.CLAMP_TO_EDGE),M.texParameteri(t,M.TEXTURE_MAG_FILTER,Ut(i.magFilter)),M.texParameteri(t,M.TEXTURE_MIN_FILTER,Ut(i.minFilter))),e=Y.get("EXT_texture_filter_anisotropic")){if(i.type===H.FloatType&&null===Y.get("OES_texture_float_linear"))return;if(i.type===H.HalfFloatType&&null===Y.get("OES_texture_half_float_linear"))return;(i.anisotropy>1||Z.get(i).__currentAnisotropy)&&(M.texParameterf(t,e.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(i.anisotropy,g.getMaxAnisotropy())),Z.get(i).__currentAnisotropy=i.anisotropy)}}function bt(t,i){if(t.width>i||t.height>i){var n=i/Math.max(t.width,t.height),e=document.createElement("canvas");return e.width=Math.floor(t.width*n),e.height=Math.floor(t.height*n),e.getContext("2d").drawImage(t,0,0,t.width,t.height,0,0,e.width,e.height),e}return t}function At(t){return H.Math.isPowerOfTwo(t.width)&&H.Math.isPowerOfTwo(t.height)}function Pt(t,i){var n=Z.get(t);if(6===t.image.length)if(t.version>0&&n.__version!==t.version){n.__image__webglTextureCube||(t.addEventListener("dispose",ut),n.__image__webglTextureCube=M.createTexture(),V.textures++),W.activeTexture(M.TEXTURE0+i),W.bindTexture(M.TEXTURE_CUBE_MAP,n.__image__webglTextureCube),M.pixelStorei(M.UNPACK_FLIP_Y_WEBGL,t.flipY);for(var e=t instanceof H.CompressedTexture,s=t.image[0]instanceof H.DataTexture,r=[],h=0;h<6;h++)r[h]=!g.autoScaleCubemaps||e||s?s?t.image[h].image:t.image[h]:bt(t.image[h],z.maxCubemapSize);var o=At(r[0]),a=Nt(t.format),u=Nt(t.type);for(St(M.TEXTURE_CUBE_MAP,t,o),h=0;h<6;h++)if(e)for(var f,c=r[h].mipmaps,l=0,v=c.length;l<v;l++)f=c[l],t.format!==H.RGBAFormat&&t.format!==H.RGBFormat?W.getCompressedTextureFormats().indexOf(a)>-1&&W.compressedTexImage2D(M.TEXTURE_CUBE_MAP_POSITIVE_X+h,l,a,f.width,f.height,0,f.data):W.texImage2D(M.TEXTURE_CUBE_MAP_POSITIVE_X+h,l,a,f.width,f.height,0,a,u,f.data);else s?W.texImage2D(M.TEXTURE_CUBE_MAP_POSITIVE_X+h,0,a,r[h].width,r[h].height,0,a,u,r[h].data):W.texImage2D(M.TEXTURE_CUBE_MAP_POSITIVE_X+h,0,a,a,u,r[h]);t.generateMipmaps&&o&&M.generateMipmap(M.TEXTURE_CUBE_MAP),n.__version=t.version,t.onUpdate&&t.onUpdate(t)}else W.activeTexture(M.TEXTURE0+i),W.bindTexture(M.TEXTURE_CUBE_MAP,n.__image__webglTextureCube)}function Tt(t,i){W.activeTexture(M.TEXTURE0+i),W.bindTexture(M.TEXTURE_CUBE_MAP,Z.get(t).__webglTexture)}function Lt(t,i,n,e){var s=Nt(i.texture.format),r=Nt(i.texture.type);W.texImage2D(e,0,s,i.width,i.height,0,s,r,null),M.bindFramebuffer(M.FRAMEBUFFER,t),M.framebufferTexture2D(M.FRAMEBUFFER,n,e,Z.get(i.texture).__webglTexture,0),M.bindFramebuffer(M.FRAMEBUFFER,null)}function Ot(t,i){M.bindRenderbuffer(M.RENDERBUFFER,t),i.depthBuffer&&!i.stencilBuffer?(M.renderbufferStorage(M.RENDERBUFFER,M.DEPTH_COMPONENT16,i.width,i.height),M.framebufferRenderbuffer(M.FRAMEBUFFER,M.DEPTH_ATTACHMENT,M.RENDERBUFFER,t)):i.depthBuffer&&i.stencilBuffer?(M.renderbufferStorage(M.RENDERBUFFER,M.DEPTH_STENCIL,i.width,i.height),M.framebufferRenderbuffer(M.FRAMEBUFFER,M.DEPTH_STENCIL_ATTACHMENT,M.RENDERBUFFER,t)):M.renderbufferStorage(M.RENDERBUFFER,M.RGBA4,i.width,i.height),M.bindRenderbuffer(M.RENDERBUFFER,null)}function Ut(t){return t===H.NearestFilter||t===H.NearestMipMapNearestFilter||t===H.NearestMipMapLinearFilter?M.NEAREST:M.LINEAR}function Nt(t){var i;if(t===H.RepeatWrapping)return M.REPEAT;if(t===H.ClampToEdgeWrapping)return M.CLAMP_TO_EDGE;if(t===H.MirroredRepeatWrapping)return M.MIRRORED_REPEAT;if(t===H.NearestFilter)return M.NEAREST;if(t===H.NearestMipMapNearestFilter)return M.NEAREST_MIPMAP_NEAREST;if(t===H.NearestMipMapLinearFilter)return M.NEAREST_MIPMAP_LINEAR;if(t===H.LinearFilter)return M.LINEAR;if(t===H.LinearMipMapNearestFilter)return M.LINEAR_MIPMAP_NEAREST;if(t===H.LinearMipMapLinearFilter)return M.LINEAR_MIPMAP_LINEAR;if(t===H.UnsignedByteType)return M.UNSIGNED_BYTE;if(t===H.UnsignedShort4444Type)return M.UNSIGNED_SHORT_4_4_4_4;if(t===H.UnsignedShort5551Type)return M.UNSIGNED_SHORT_5_5_5_1;if(t===H.UnsignedShort565Type)return M.UNSIGNED_SHORT_5_6_5;if(t===H.ByteType)return M.BYTE;if(t===H.ShortType)return M.SHORT;if(t===H.UnsignedShortType)return M.UNSIGNED_SHORT;if(t===H.IntType)return M.INT;if(t===H.UnsignedIntType)return M.UNSIGNED_INT;if(t===H.FloatType)return M.FLOAT;if(null!==(i=Y.get("OES_texture_half_float"))&&t===H.HalfFloatType)return i.HALF_FLOAT_OES;if(t===H.AlphaFormat)return M.ALPHA;if(t===H.RGBFormat)return M.RGB;if(t===H.RGBAFormat)return M.RGBA;if(t===H.LuminanceFormat)return M.LUMINANCE;if(t===H.LuminanceAlphaFormat)return M.LUMINANCE_ALPHA;if(t===H.AddEquation)return M.FUNC_ADD;if(t===H.SubtractEquation)return M.FUNC_SUBTRACT;if(t===H.ReverseSubtractEquation)return M.FUNC_REVERSE_SUBTRACT;if(t===H.ZeroFactor)return M.ZERO;if(t===H.OneFactor)return M.ONE;if(t===H.SrcColorFactor)return M.SRC_COLOR;if(t===H.OneMinusSrcColorFactor)return M.ONE_MINUS_SRC_COLOR;if(t===H.SrcAlphaFactor)return M.SRC_ALPHA;if(t===H.OneMinusSrcAlphaFactor)return M.ONE_MINUS_SRC_ALPHA;if(t===H.DstAlphaFactor)return M.DST_ALPHA;if(t===H.OneMinusDstAlphaFactor)return M.ONE_MINUS_DST_ALPHA;if(t===H.DstColorFactor)return M.DST_COLOR;if(t===H.OneMinusDstColorFactor)return M.ONE_MINUS_DST_COLOR;if(t===H.SrcAlphaSaturateFactor)return M.SRC_ALPHA_SATURATE;if(null!==(i=Y.get("WEBGL_compressed_texture_s3tc"))){if(t===H.RGB_S3TC_DXT1_Format)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===H.RGBA_S3TC_DXT1_Format)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===H.RGBA_S3TC_DXT3_Format)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===H.RGBA_S3TC_DXT5_Format)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(null!==(i=Y.get("WEBGL_compressed_texture_pvrtc"))){if(t===H.RGB_PVRTC_4BPPV1_Format)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===H.RGB_PVRTC_2BPPV1_Format)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===H.RGBA_PVRTC_4BPPV1_Format)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===H.RGBA_PVRTC_2BPPV1_Format)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(null!==(i=Y.get("WEBGL_compressed_texture_etc1"))&&t===H.RGB_ETC1_Format)return i.COMPRESSED_RGB_ETC1_WEBGL;if(null!==(i=Y.get("EXT_blend_minmax"))){if(t===H.MinEquation)return i.MIN_EXT;if(t===H.MaxEquation)return i.MAX_EXT}return 0}this.getContext=function(){return M},this.getContextAttributes=function(){return M.getContextAttributes()},this.forceContextLoss=function(){Y.get("WEBGL_lose_context").loseContext()},this.getMaxAnisotropy=function(){if(void 0!==rt)return rt;var t=Y.get("EXT_texture_filter_anisotropic");return rt=null!==t?M.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},this.getPrecision=function(){return z.precision},this.getPixelRatio=function(){return k},this.setPixelRatio=function(t){void 0!==t&&(k=t,this.setSize(I.z,I.w,!1))},this.getSize=function(){return{width:U,height:N}},this.setSize=function(t,n,e){U=t,N=n,i.width=t*k,i.height=n*k,!1!==e&&(i.style.width=t+"px",i.style.height=n+"px"),this.setViewport(0,0,t,n)},this.setViewport=function(t,i,n,e){W.viewport(I.set(t,i,n,e))},this.setScissor=function(t,i,n,e){W.scissor(D.set(t,i,n,e))},this.setScissorTest=function(t){W.setScissorTest(F=t)},this.getClearColor=function(){return L},this.setClearColor=function(t,i){L.set(t),it(L.r,L.g,L.b,O=void 0!==i?i:1)},this.getClearAlpha=function(){return O},this.setClearAlpha=function(t){it(L.r,L.g,L.b,O=t)},this.clear=function(t,i,n){var e=0;(void 0===t||t)&&(e|=M.COLOR_BUFFER_BIT),(void 0===i||i)&&(e|=M.DEPTH_BUFFER_BIT),(void 0===n||n)&&(e|=M.STENCIL_BUFFER_BIT),M.clear(e)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.clearTarget=function(t,i,n,e){this.setRenderTarget(t),this.clear(i,n,e)},this.resetGLState=et,this.dispose=function(){i.removeEventListener("webglcontextlost",at,!1)},this.renderBufferImmediate=function(t,i,n){W.initAttributes();var e=Z.get(t);t.hasPositions&&!e.position&&(e.position=M.createBuffer()),t.hasNormals&&!e.normal&&(e.normal=M.createBuffer()),t.hasUvs&&!e.uv&&(e.uv=M.createBuffer()),t.hasColors&&!e.color&&(e.color=M.createBuffer());var s=i.getAttributes();if(t.hasPositions&&(M.bindBuffer(M.ARRAY_BUFFER,e.position),M.bufferData(M.ARRAY_BUFFER,t.positionArray,M.DYNAMIC_DRAW),W.enableAttribute(s.position),M.vertexAttribPointer(s.position,3,M.FLOAT,!1,0,0)),t.hasNormals){if(M.bindBuffer(M.ARRAY_BUFFER,e.normal),"MeshPhongMaterial"!==n.type&&"MeshStandardMaterial"!==n.type&&n.shading===H.FlatShading)for(var r=0,h=3*t.count;r<h;r+=9){var o=t.normalArray,a=(o[r+0]+o[r+3]+o[r+6])/3,u=(o[r+1]+o[r+4]+o[r+7])/3,f=(o[r+2]+o[r+5]+o[r+8])/3;o[r+0]=a,o[r+1]=u,o[r+2]=f,o[r+3]=a,o[r+4]=u,o[r+5]=f,o[r+6]=a,o[r+7]=u,o[r+8]=f}M.bufferData(M.ARRAY_BUFFER,t.normalArray,M.DYNAMIC_DRAW),W.enableAttribute(s.normal),M.vertexAttribPointer(s.normal,3,M.FLOAT,!1,0,0)}t.hasUvs&&n.map&&(M.bindBuffer(M.ARRAY_BUFFER,e.uv),M.bufferData(M.ARRAY_BUFFER,t.uvArray,M.DYNAMIC_DRAW),W.enableAttribute(s.uv),M.vertexAttribPointer(s.uv,2,M.FLOAT,!1,0,0)),t.hasColors&&n.vertexColors!==H.NoColors&&(M.bindBuffer(M.ARRAY_BUFFER,e.color),M.bufferData(M.ARRAY_BUFFER,t.colorArray,M.DYNAMIC_DRAW),W.enableAttribute(s.color),M.vertexAttribPointer(s.color,3,M.FLOAT,!1,0,0)),W.disableUnusedAttributes(),M.drawArrays(M.TRIANGLES,0,t.count),t.count=0},this.renderBufferDirect=function(t,i,n,e,s,r){gt(e);var h=wt(t,i,e,s),o=!1,a=n.id+"_"+h.id+"_"+e.wireframe;a!==E&&(E=a,o=!0);var u=s.morphTargetInfluences;if(void 0!==u){for(var f=[],c=0,l=u.length;c<l;c++)f.push([p=u[c],c]);f.sort(vt),f.length>8&&(f.length=8);var v=n.morphAttributes;for(c=0,l=f.length;c<l;c++){var p;if(d[c]=(p=f[c])[0],0!==p[0]){var m=p[1];!0===e.morphTargets&&v.position&&n.addAttribute("morphTarget"+c,v.position[m]),!0===e.morphNormals&&v.normal&&n.addAttribute("morphNormal"+c,v.normal[m])}else!0===e.morphTargets&&n.removeAttribute("morphTarget"+c),!0===e.morphNormals&&n.removeAttribute("morphNormal"+c)}var g=h.getUniforms();null!==g.morphTargetInfluences&&M.uniform1fv(g.morphTargetInfluences,d),o=!0}m=n.index;var w,y=n.attributes.position;!0===e.wireframe&&(m=q.getWireframeAttribute(n)),null!==m?(w=$).setIndex(m):w=Q,o&&(function(t,i,n,e){var s;if(!(n instanceof H.InstancedBufferGeometry&&null===(s=Y.get("ANGLE_instanced_arrays")))){void 0===e&&(e=0),W.initAttributes();var r=n.attributes,h=i.getAttributes(),o=t.defaultAttributeValues;for(var a in h){var u=h[a];if(u>=0){var f=r[a];if(void 0!==f){var c=f.itemSize,l=q.getAttributeBuffer(f);if(f instanceof H.InterleavedBufferAttribute){var v=f.data,d=v.stride,p=f.offset;v instanceof H.InstancedInterleavedBuffer?(W.enableAttributeAndDivisor(u,v.meshPerAttribute,s),void 0===n.maxInstancedCount&&(n.maxInstancedCount=v.meshPerAttribute*v.count)):W.enableAttribute(u),M.bindBuffer(M.ARRAY_BUFFER,l),M.vertexAttribPointer(u,c,M.FLOAT,!1,d*v.array.BYTES_PER_ELEMENT,(e*d+p)*v.array.BYTES_PER_ELEMENT)}else f instanceof H.InstancedBufferAttribute?(W.enableAttributeAndDivisor(u,f.meshPerAttribute,s),void 0===n.maxInstancedCount&&(n.maxInstancedCount=f.meshPerAttribute*f.count)):W.enableAttribute(u),M.bindBuffer(M.ARRAY_BUFFER,l),M.vertexAttribPointer(u,c,M.FLOAT,!1,0,e*c*4)}else if(void 0!==o){var m=o[a];if(void 0!==m)switch(m.length){case 2:M.vertexAttrib2fv(u,m);break;case 3:M.vertexAttrib3fv(u,m);break;case 4:M.vertexAttrib4fv(u,m);break;default:M.vertexAttrib1fv(u,m)}}}}W.disableUnusedAttributes()}}(e,h,n),null!==m&&M.bindBuffer(M.ELEMENT_ARRAY_BUFFER,q.getAttributeBuffer(m)));var _=1/0;null!==m?_=m.count:void 0!==y&&(_=y.count);var x=n.drawRange.start,S=n.drawRange.count,b=null!==r?r.start:0,A=null!==r?r.count:1/0,P=Math.max(0,x,b),T=Math.min(0+_,x+S,b+A)-1,L=Math.max(0,T-P+1);if(s instanceof H.Mesh)if(!0===e.wireframe)W.setLineWidth(e.wireframeLinewidth*tt()),w.setMode(M.LINES);else switch(s.drawMode){case H.TrianglesDrawMode:w.setMode(M.TRIANGLES);break;case H.TriangleStripDrawMode:w.setMode(M.TRIANGLE_STRIP);break;case H.TriangleFanDrawMode:w.setMode(M.TRIANGLE_FAN)}else if(s instanceof H.Line){var O=e.linewidth;void 0===O&&(O=1),W.setLineWidth(O*tt()),w.setMode(s instanceof H.LineSegments?M.LINES:M.LINE_STRIP)}else s instanceof H.Points&&w.setMode(M.POINTS);n instanceof H.InstancedBufferGeometry?n.maxInstancedCount>0&&w.renderInstances(n,P,L):w.render(P,L)},this.render=function(t,i,n,e){if(i instanceof H.Camera!=0){var s=t.fog;if(E="",x=-1,S=null,!0===t.autoUpdate&&t.updateMatrixWorld(),null===i.parent&&i.updateMatrixWorld(),i.matrixWorldInverse.getInverse(i.matrixWorld),C.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),R.setFromMatrix(C),u.length=0,c=-1,v=-1,p.length=0,m.length=0,function t(i,n){if(!1!==i.visible){if(i.layers.test(n.layers))if(i instanceof H.Light)u.push(i);else if(i instanceof H.Sprite)!1!==i.frustumCulled&&!0!==R.intersectsObject(i)||p.push(i);else if(i instanceof H.LensFlare)m.push(i);else if(i instanceof H.ImmediateRenderObject)!0===g.sortObjects&&(B.setFromMatrixPosition(i.matrixWorld),B.applyProjection(C)),mt(i,null,i.material,0,null);else if((i instanceof H.Mesh||i instanceof H.Line||i instanceof H.Points)&&(i instanceof H.SkinnedMesh&&i.skeleton.update(),!1===i.frustumCulled||!0===R.intersectsObject(i))){var e=i.material;if(!0===e.visible){!0===g.sortObjects&&(B.setFromMatrixPosition(i.matrixWorld),B.applyProjection(C));var s=q.update(i);if(e instanceof H.MultiMaterial)for(var r=s.groups,h=e.materials,o=0,a=r.length;o<a;o++){var f=r[o],c=h[f.materialIndex];!0===c.visible&&mt(i,s,c,0,f)}else mt(i,s,e,0,null)}}var l=i.children;for(o=0,a=l.length;o<a;o++)t(l[o],n)}}(t,i),f.length=c+1,l.length=v+1,!0===g.sortObjects&&(f.sort(dt),l.sort(pt)),function(t,i){var n,e,s,r,h,o,a=0,u=0,f=0,c=i.matrixWorldInverse,l=0,v=0,d=0,p=0,m=0;for(G.shadowsPointLight=0,n=0,e=t.length;n<e;n++)if(r=(s=t[n]).color,h=s.intensity,o=s.distance,s instanceof H.AmbientLight)a+=r.r*h,u+=r.g*h,f+=r.b*h;else if(s instanceof H.DirectionalLight)(M=K.get(s)).color.copy(s.color).multiplyScalar(s.intensity),M.direction.setFromMatrixPosition(s.matrixWorld),B.setFromMatrixPosition(s.target.matrixWorld),M.direction.sub(B),M.direction.transformDirection(c),M.shadow=s.castShadow,s.castShadow&&(M.shadowBias=s.shadow.bias,M.shadowRadius=s.shadow.radius,M.shadowMapSize=s.shadow.mapSize,G.shadows[m++]=s),G.directionalShadowMap[l]=s.shadow.map,G.directionalShadowMatrix[l]=s.shadow.matrix,G.directional[l++]=M;else if(s instanceof H.SpotLight)(M=K.get(s)).position.setFromMatrixPosition(s.matrixWorld),M.position.applyMatrix4(c),M.color.copy(r).multiplyScalar(h),M.distance=o,M.direction.setFromMatrixPosition(s.matrixWorld),B.setFromMatrixPosition(s.target.matrixWorld),M.direction.sub(B),M.direction.transformDirection(c),M.coneCos=Math.cos(s.angle),M.penumbraCos=Math.cos(s.angle*(1-s.penumbra)),M.decay=0===s.distance?0:s.decay,M.shadow=s.castShadow,s.castShadow&&(M.shadowBias=s.shadow.bias,M.shadowRadius=s.shadow.radius,M.shadowMapSize=s.shadow.mapSize,G.shadows[m++]=s),G.spotShadowMap[d]=s.shadow.map,G.spotShadowMatrix[d]=s.shadow.matrix,G.spot[d++]=M;else if(s instanceof H.PointLight)(M=K.get(s)).position.setFromMatrixPosition(s.matrixWorld),M.position.applyMatrix4(c),M.color.copy(s.color).multiplyScalar(s.intensity),M.distance=s.distance,M.decay=0===s.distance?0:s.decay,M.shadow=s.castShadow,s.castShadow&&(M.shadowBias=s.shadow.bias,M.shadowRadius=s.shadow.radius,M.shadowMapSize=s.shadow.mapSize,G.shadows[m++]=s),G.pointShadowMap[v]=s.shadow.map,void 0===G.pointShadowMatrix[v]&&(G.pointShadowMatrix[v]=new H.Matrix4),B.setFromMatrixPosition(s.matrixWorld).negate(),G.pointShadowMatrix[v].identity().setPosition(B),G.point[v++]=M;else if(s instanceof H.HemisphereLight){var M;(M=K.get(s)).direction.setFromMatrixPosition(s.matrixWorld),M.direction.transformDirection(c),M.direction.normalize(),M.skyColor.copy(s.color).multiplyScalar(h),M.groundColor.copy(s.groundColor).multiplyScalar(h),G.hemi[p++]=M}G.ambient[0]=a,G.ambient[1]=u,G.ambient[2]=f,G.directional.length=l,G.spot.length=d,G.point.length=v,G.hemi.length=p,G.shadows.length=m,G.hash=l+","+v+","+d+","+p+","+m}(u,i),st.render(t,i),j.calls=0,j.vertices=0,j.faces=0,j.points=0,void 0===n&&(n=null),this.setRenderTarget(n),(this.autoClear||e)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),t.overrideMaterial){var r=t.overrideMaterial;Mt(f,i,s,r),Mt(l,i,s,r)}else W.setBlending(H.NoBlending),Mt(f,i,s),Mt(l,i,s);if(ht.render(t,i),ot.render(t,i,P),n){var h=n.texture;h.generateMipmaps&&At(n)&&h.minFilter!==H.NearestFilter&&h.minFilter!==H.LinearFilter&&function(t){var i=t instanceof H.WebGLRenderTargetCube?M.TEXTURE_CUBE_MAP:M.TEXTURE_2D,n=Z.get(t.texture).__webglTexture;W.bindTexture(i,n),M.generateMipmap(i),W.bindTexture(i,null)}(n)}W.setDepthTest(!0),W.setDepthWrite(!0),W.setColorWrite(!0)}},this.setFaceCulling=function(t,i){t===H.CullFaceNone?W.disable(M.CULL_FACE):(M.frontFace(i===H.FrontFaceDirectionCW?M.CW:M.CCW),M.cullFace(t===H.CullFaceBack?M.BACK:t===H.CullFaceFront?M.FRONT:M.FRONT_AND_BACK),W.enable(M.CULL_FACE))},this.setTexture=function(t,i){var n=Z.get(t);if(t.version>0&&n.__version!==t.version){var e=t.image;if(void 0===e)return;if(!1===e.complete)return;!function(t,i,n){void 0===t.__webglInit&&(t.__webglInit=!0,i.addEventListener("dispose",ut),t.__webglTexture=M.createTexture(),V.textures++),W.activeTexture(M.TEXTURE0+n),W.bindTexture(M.TEXTURE_2D,t.__webglTexture),M.pixelStorei(M.UNPACK_FLIP_Y_WEBGL,i.flipY),M.pixelStorei(M.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),M.pixelStorei(M.UNPACK_ALIGNMENT,i.unpackAlignment);var e=bt(i.image,z.maxTextureSize);(function(t){return t.wrapS!==H.ClampToEdgeWrapping||t.wrapT!==H.ClampToEdgeWrapping||t.minFilter!==H.NearestFilter&&t.minFilter!==H.LinearFilter})(i)&&!1===At(e)&&(e=function(t){if(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement){var i=document.createElement("canvas");return i.width=H.Math.nearestPowerOfTwo(t.width),i.height=H.Math.nearestPowerOfTwo(t.height),i.getContext("2d").drawImage(t,0,0,i.width,i.height),i}return t}(e));var s=At(e),r=Nt(i.format),h=Nt(i.type);St(M.TEXTURE_2D,i,s);var o,a=i.mipmaps;if(i instanceof H.DataTexture)if(a.length>0&&s){for(var u=0,f=a.length;u<f;u++)W.texImage2D(M.TEXTURE_2D,u,r,(o=a[u]).width,o.height,0,r,h,o.data);i.generateMipmaps=!1}else W.texImage2D(M.TEXTURE_2D,0,r,e.width,e.height,0,r,h,e.data);else if(i instanceof H.CompressedTexture)for(u=0,f=a.length;u<f;u++)o=a[u],i.format!==H.RGBAFormat&&i.format!==H.RGBFormat?W.getCompressedTextureFormats().indexOf(r)>-1&&W.compressedTexImage2D(M.TEXTURE_2D,u,r,o.width,o.height,0,o.data):W.texImage2D(M.TEXTURE_2D,u,r,o.width,o.height,0,r,h,o.data);else if(a.length>0&&s){for(u=0,f=a.length;u<f;u++)W.texImage2D(M.TEXTURE_2D,u,r,r,h,o=a[u]);i.generateMipmaps=!1}else W.texImage2D(M.TEXTURE_2D,0,r,r,h,e);i.generateMipmaps&&s&&M.generateMipmap(M.TEXTURE_2D),t.__version=i.version,i.onUpdate&&i.onUpdate(i)}(n,t,i)}else W.activeTexture(M.TEXTURE0+i),W.bindTexture(M.TEXTURE_2D,n.__webglTexture)},this.getCurrentRenderTarget=function(){return y},this.setRenderTarget=function(t){y=t,t&&void 0===Z.get(t).__webglFramebuffer&&function(t){var i=Z.get(t),n=Z.get(t.texture);t.addEventListener("dispose",ft),n.__webglTexture=M.createTexture(),V.textures++;var e=t instanceof H.WebGLRenderTargetCube,s=H.Math.isPowerOfTwo(t.width)&&H.Math.isPowerOfTwo(t.height);if(e){i.__webglFramebuffer=[];for(var r=0;r<6;r++)i.__webglFramebuffer[r]=M.createFramebuffer()}else i.__webglFramebuffer=M.createFramebuffer();if(e){for(W.bindTexture(M.TEXTURE_CUBE_MAP,n.__webglTexture),St(M.TEXTURE_CUBE_MAP,t.texture,s),r=0;r<6;r++)Lt(i.__webglFramebuffer[r],t,M.COLOR_ATTACHMENT0,M.TEXTURE_CUBE_MAP_POSITIVE_X+r);t.texture.generateMipmaps&&s&&M.generateMipmap(M.TEXTURE_CUBE_MAP),W.bindTexture(M.TEXTURE_CUBE_MAP,null)}else W.bindTexture(M.TEXTURE_2D,n.__webglTexture),St(M.TEXTURE_2D,t.texture,s),Lt(i.__webglFramebuffer,t,M.COLOR_ATTACHMENT0,M.TEXTURE_2D),t.texture.generateMipmaps&&s&&M.generateMipmap(M.TEXTURE_2D),W.bindTexture(M.TEXTURE_2D,null);t.depthBuffer&&function(t){var i=Z.get(t);if(t instanceof H.WebGLRenderTargetCube){i.__webglDepthbuffer=[];for(var n=0;n<6;n++)M.bindFramebuffer(M.FRAMEBUFFER,i.__webglFramebuffer[n]),i.__webglDepthbuffer[n]=M.createRenderbuffer(),Ot(i.__webglDepthbuffer[n],t)}else M.bindFramebuffer(M.FRAMEBUFFER,i.__webglFramebuffer),i.__webglDepthbuffer=M.createRenderbuffer(),Ot(i.__webglDepthbuffer,t);M.bindFramebuffer(M.FRAMEBUFFER,null)}(t)}(t);var i,n=t instanceof H.WebGLRenderTargetCube;if(t){var e=Z.get(t);i=n?e.__webglFramebuffer[t.activeCubeFace]:e.__webglFramebuffer,b.copy(t.scissor),A=t.scissorTest,P.copy(t.viewport)}else i=null,b.copy(D).multiplyScalar(k),A=F,P.copy(I).multiplyScalar(k);if(_!==i&&(M.bindFramebuffer(M.FRAMEBUFFER,i),_=i),W.scissor(b),W.setScissorTest(A),W.viewport(P),n){var s=Z.get(t.texture);M.framebufferTexture2D(M.FRAMEBUFFER,M.COLOR_ATTACHMENT0,M.TEXTURE_CUBE_MAP_POSITIVE_X+t.activeCubeFace,s.__webglTexture,t.activeMipMapLevel)}},this.readRenderTargetPixels=function(t,i,n,e,s,r){if(t instanceof H.WebGLRenderTarget!=0){var h=Z.get(t).__webglFramebuffer;if(h){var o=!1;h!==_&&(M.bindFramebuffer(M.FRAMEBUFFER,h),o=!0);try{var a=t.texture;if(a.format!==H.RGBAFormat&&Nt(a.format)!==M.getParameter(M.IMPLEMENTATION_COLOR_READ_FORMAT))return;if(!(a.type===H.UnsignedByteType||Nt(a.type)===M.getParameter(M.IMPLEMENTATION_COLOR_READ_TYPE)||a.type===H.FloatType&&Y.get("WEBGL_color_buffer_float")||a.type===H.HalfFloatType&&Y.get("EXT_color_buffer_half_float")))return;M.checkFramebufferStatus(M.FRAMEBUFFER)===M.FRAMEBUFFER_COMPLETE&&M.readPixels(i,n,e,s,Nt(a.format),Nt(a.type),r)}finally{o&&M.bindFramebuffer(M.FRAMEBUFFER,_)}}}}},H.WebGLExtensions=function(t){var i={};this.get=function(n){if(void 0!==i[n])return i[n];var e;switch(n){case"EXT_texture_filter_anisotropic":e=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":e=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":e=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"WEBGL_compressed_texture_etc1":e=t.getExtension("WEBGL_compressed_texture_etc1");break;default:e=t.getExtension(n)}return i[n]=e,e}},H.WebGLCapabilities=function(t,i,n){function e(i){if("highp"===i){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";i="mediump"}return"mediump"===i&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}this.getMaxPrecision=e,this.precision=void 0!==n.precision?n.precision:"highp",this.logarithmicDepthBuffer=void 0!==n.logarithmicDepthBuffer&&n.logarithmicDepthBuffer,this.maxTextures=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),this.maxVertexTextures=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxCubemapSize=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),this.maxAttributes=t.getParameter(t.MAX_VERTEX_ATTRIBS),this.maxVertexUniforms=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),this.maxVaryings=t.getParameter(t.MAX_VARYING_VECTORS),this.maxFragmentUniforms=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),this.vertexTextures=this.maxVertexTextures>0,this.floatFragmentTextures=!!i.get("OES_texture_float"),this.floatVertexTextures=this.vertexTextures&&this.floatFragmentTextures;var s=e(this.precision);s!==this.precision&&(this.precision=s),this.logarithmicDepthBuffer&&(this.logarithmicDepthBuffer=!!i.get("EXT_frag_depth"))},H.WebGLProperties=function(){var t={};this.get=function(i){var n=i.uuid,e=t[n];return void 0===e&&(t[n]=e={}),e},this.delete=function(i){delete t[i.uuid]},this.clear=function(){t={}}},H.WebGLLights=function(){var t={};this.get=function(i){if(void 0!==t[i.id])return t[i.id];var n;switch(i.type){case"DirectionalLight":n={direction:new H.Vector3,color:new H.Color,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new H.Vector2};break;case"SpotLight":n={position:new H.Vector3,direction:new H.Vector3,color:new H.Color,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new H.Vector2};break;case"PointLight":n={position:new H.Vector3,color:new H.Color,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new H.Vector2};break;case"HemisphereLight":n={direction:new H.Vector3,skyColor:new H.Color,groundColor:new H.Color}}return t[i.id]=n,n}},H.WebGLState=function(t,i,n){var e=this,s=new H.Vector4,r=new Uint8Array(16),h=new Uint8Array(16),o=new Uint8Array(16),a={},u=null,f=null,c=null,l=null,v=null,d=null,p=null,m=null,M=!1,g=null,w=null,y=null,_=null,x=null,E=null,S=null,b=null,A=null,P=null,T=null,L=null,O=null,U=null,N=null,k=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),D=void 0,F={},I=new H.Vector4,R=null,C=null,B=new H.Vector4,G=new H.Vector4,V=t.createTexture();t.bindTexture(t.TEXTURE_2D,V),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGB,1,1,0,t.RGB,t.UNSIGNED_BYTE,new Uint8Array(3)),this.init=function(){this.clearColor(0,0,0,1),this.clearDepth(1),this.clearStencil(0),this.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL),t.frontFace(t.CCW),t.cullFace(t.BACK),this.enable(t.CULL_FACE),this.enable(t.BLEND),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA)},this.initAttributes=function(){for(var t=0,i=r.length;t<i;t++)r[t]=0},this.enableAttribute=function(n){r[n]=1,0===h[n]&&(t.enableVertexAttribArray(n),h[n]=1),0!==o[n]&&(i.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(n,0),o[n]=0)},this.enableAttributeAndDivisor=function(i,n,e){r[i]=1,0===h[i]&&(t.enableVertexAttribArray(i),h[i]=1),o[i]!==n&&(e.vertexAttribDivisorANGLE(i,n),o[i]=n)},this.disableUnusedAttributes=function(){for(var i=0,n=h.length;i<n;i++)h[i]!==r[i]&&(t.disableVertexAttribArray(i),h[i]=0)},this.enable=function(i){!0!==a[i]&&(t.enable(i),a[i]=!0)},this.disable=function(i){!1!==a[i]&&(t.disable(i),a[i]=!1)},this.getCompressedTextureFormats=function(){if(null===u&&(u=[],i.get("WEBGL_compressed_texture_pvrtc")||i.get("WEBGL_compressed_texture_s3tc")||i.get("WEBGL_compressed_texture_etc1")))for(var n=t.getParameter(t.COMPRESSED_TEXTURE_FORMATS),e=0;e<n.length;e++)u.push(n[e]);return u},this.setBlending=function(i,e,s,r,h,o,a,u){i===H.NoBlending?this.disable(t.BLEND):this.enable(t.BLEND),i===f&&u===M||(i===H.AdditiveBlending?u?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ONE,t.ONE,t.ONE)):(t.blendEquation(t.FUNC_ADD),t.blendFunc(t.SRC_ALPHA,t.ONE)):i===H.SubtractiveBlending?u?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ZERO,t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ONE_MINUS_SRC_ALPHA)):(t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ZERO,t.ONE_MINUS_SRC_COLOR)):i===H.MultiplyBlending?u?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ZERO,t.ZERO,t.SRC_COLOR,t.SRC_ALPHA)):(t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ZERO,t.SRC_COLOR)):u?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA)):(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA)),f=i,M=u),i===H.CustomBlending?(h=h||e,o=o||s,a=a||r,e===c&&h===d||(t.blendEquationSeparate(n(e),n(h)),c=e,d=h),s===l&&r===v&&o===p&&a===m||(t.blendFuncSeparate(n(s),n(r),n(o),n(a)),l=s,v=r,p=o,m=a)):(c=null,l=null,v=null,d=null,p=null,m=null)},this.setDepthFunc=function(i){if(g!==i){if(i)switch(i){case H.NeverDepth:t.depthFunc(t.NEVER);break;case H.AlwaysDepth:t.depthFunc(t.ALWAYS);break;case H.LessDepth:t.depthFunc(t.LESS);break;case H.LessEqualDepth:t.depthFunc(t.LEQUAL);break;case H.EqualDepth:t.depthFunc(t.EQUAL);break;case H.GreaterEqualDepth:t.depthFunc(t.GEQUAL);break;case H.GreaterDepth:t.depthFunc(t.GREATER);break;case H.NotEqualDepth:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}else t.depthFunc(t.LEQUAL);g=i}},this.setDepthTest=function(i){i?this.enable(t.DEPTH_TEST):this.disable(t.DEPTH_TEST)},this.setDepthWrite=function(i){w!==i&&(t.depthMask(i),w=i)},this.setColorWrite=function(i){y!==i&&(t.colorMask(i,i,i,i),y=i)},this.setStencilFunc=function(i,n,e){x===i&&E===n&&S===e||(t.stencilFunc(i,n,e),x=i,E=n,S=e)},this.setStencilOp=function(i,n,e){b===i&&A===n&&P===e||(t.stencilOp(i,n,e),b=i,A=n,P=e)},this.setStencilTest=function(i){i?this.enable(t.STENCIL_TEST):this.disable(t.STENCIL_TEST)},this.setStencilWrite=function(i){_!==i&&(t.stencilMask(i),_=i)},this.setFlipSided=function(i){T!==i&&(t.frontFace(i?t.CW:t.CCW),T=i)},this.setLineWidth=function(i){i!==L&&(t.lineWidth(i),L=i)},this.setPolygonOffset=function(i,n,e){i?this.enable(t.POLYGON_OFFSET_FILL):this.disable(t.POLYGON_OFFSET_FILL),!i||O===n&&U===e||(t.polygonOffset(n,e),O=n,U=e)},this.getScissorTest=function(){return N},this.setScissorTest=function(i){N=i,i?this.enable(t.SCISSOR_TEST):this.disable(t.SCISSOR_TEST)},this.activeTexture=function(i){void 0===i&&(i=t.TEXTURE0+k-1),D!==i&&(t.activeTexture(i),D=i)},this.bindTexture=function(i,n){void 0===D&&e.activeTexture();var s=F[D];void 0===s&&(F[D]=s={type:void 0,texture:void 0}),s.type===i&&s.texture===n||(t.bindTexture(i,n||V),s.type=i,s.texture=n)},this.compressedTexImage2D=function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){}},this.texImage2D=function(){try{t.texImage2D.apply(t,arguments)}catch(t){}},this.clearColor=function(i,n,e,r){s.set(i,n,e,r),!1===I.equals(s)&&(t.clearColor(i,n,e,r),I.copy(s))},this.clearDepth=function(i){R!==i&&(t.clearDepth(i),R=i)},this.clearStencil=function(i){C!==i&&(t.clearStencil(i),C=i)},this.scissor=function(i){!1===B.equals(i)&&(t.scissor(i.x,i.y,i.z,i.w),B.copy(i))},this.viewport=function(i){!1===G.equals(i)&&(t.viewport(i.x,i.y,i.z,i.w),G.copy(i))},this.reset=function(){for(var i=0;i<h.length;i++)1===h[i]&&(t.disableVertexAttribArray(i),h[i]=0);a={},u=null,D=void 0,F={},f=null,y=null,w=null,_=null,T=null}},H.WebGLGeometries=function(t,i,n){var e={};function s(t){var h=t.target,o=e[h.id];null!==o.index&&r(o.index),function(t){for(var i in t)r(t[i])}(o.attributes),h.removeEventListener("dispose",s),delete e[h.id];var a=i.get(h);a.wireframe&&r(a.wireframe),i.delete(h);var u=i.get(o);u.wireframe&&r(u.wireframe),i.delete(o),n.memory.geometries--}function r(n){var e=function(t){return t instanceof H.InterleavedBufferAttribute?i.get(t.data).__webglBuffer:i.get(t).__webglBuffer}(n);void 0!==e&&(t.deleteBuffer(e),function(t){i.delete(t instanceof H.InterleavedBufferAttribute?t.data:t)}(n))}this.get=function(t){var i,r=t.geometry;return void 0!==e[r.id]?e[r.id]:(r.addEventListener("dispose",s),r instanceof H.BufferGeometry?i=r:r instanceof H.Geometry&&(void 0===r._bufferGeometry&&(r._bufferGeometry=(new H.BufferGeometry).setFromObject(t)),i=r._bufferGeometry),e[r.id]=i,n.memory.geometries++,i)}},H.WebGLBufferRenderer=function(t,i,n){var e;this.setMode=function(t){e=t},this.render=function(i,s){t.drawArrays(e,i,s),n.calls++,n.vertices+=s,e===t.TRIANGLES&&(n.faces+=s/3)},this.renderInstances=function(s){var r=i.get("ANGLE_instanced_arrays");if(null!==r){var h,o=s.attributes.position;r.drawArraysInstancedANGLE(e,0,h=o instanceof H.InterleavedBufferAttribute?o.data.count:o.count,s.maxInstancedCount),n.calls++,n.vertices+=h*s.maxInstancedCount,e===t.TRIANGLES&&(n.faces+=s.maxInstancedCount*h/3)}}},H.WebGLIndexedBufferRenderer=function(t,i,n){var e,s,r;this.setMode=function(t){e=t},this.setIndex=function(n){n.array instanceof Uint32Array&&i.get("OES_element_index_uint")?(s=t.UNSIGNED_INT,r=4):(s=t.UNSIGNED_SHORT,r=2)},this.render=function(i,h){t.drawElements(e,h,s,i*r),n.calls++,n.vertices+=h,e===t.TRIANGLES&&(n.faces+=h/3)},this.renderInstances=function(h,o,a){var u=i.get("ANGLE_instanced_arrays");null!==u&&(u.drawElementsInstancedANGLE(e,a,s,o*r,h.maxInstancedCount),n.calls++,n.vertices+=a*h.maxInstancedCount,e===t.TRIANGLES&&(n.faces+=h.maxInstancedCount*a/3))}},H.WebGLShader=function(t,i,n){var e=t.createShader(i);return t.shaderSource(e,n),t.compileShader(e),t.getShaderParameter(e,t.COMPILE_STATUS),t.getShaderInfoLog(e),e},H.WebGLShadowMap=function(t,i,n){for(var e=t.context,s=t.state,r=new H.Frustum,h=new H.Matrix4,o=new H.Vector2,a=new H.Vector3,u=new H.Vector3,f=[],c=1,l=2,v=1+(c|l),d=new Array(v),p=new Array(v),m=[new H.Vector3(1,0,0),new H.Vector3(-1,0,0),new H.Vector3(0,0,1),new H.Vector3(0,0,-1),new H.Vector3(0,1,0),new H.Vector3(0,-1,0)],M=[new H.Vector3(0,1,0),new H.Vector3(0,1,0),new H.Vector3(0,1,0),new H.Vector3(0,1,0),new H.Vector3(0,0,1),new H.Vector3(0,0,-1)],g=[new H.Vector4,new H.Vector4,new H.Vector4,new H.Vector4,new H.Vector4,new H.Vector4],w=H.ShaderLib.depthRGBA,y=H.UniformsUtils.clone(w.uniforms),_=H.ShaderLib.distanceRGBA,x=H.UniformsUtils.clone(_.uniforms),E=0;E!==v;++E){var S=0!=(E&c),b=0!=(E&l),A=new H.ShaderMaterial({uniforms:y,vertexShader:w.vertexShader,fragmentShader:w.fragmentShader,morphTargets:S,skinning:b});d[E]=A;var P=new H.ShaderMaterial({defines:{USE_SHADOWMAP:""},uniforms:x,vertexShader:_.vertexShader,fragmentShader:_.fragmentShader,morphTargets:S,skinning:b});p[E]=P}var T=this;function L(t,i,n,e){var s=t.geometry,r=null,h=d,o=t.customDepthMaterial;if(n&&(h=p,o=t.customDistanceMaterial),o)r=o;else{var a=0;void 0!==s.morphTargets&&s.morphTargets.length>0&&i.morphTargets&&(a|=c),t instanceof H.SkinnedMesh&&i.skinning&&(a|=l),r=h[a]}return r.visible=i.visible,r.wireframe=i.wireframe,r.wireframeLinewidth=i.wireframeLinewidth,n&&void 0!==r.uniforms.lightPos&&r.uniforms.lightPos.value.copy(e),r}function O(t,i,n){if(!1!==t.visible){t.layers.test(i.layers)&&(t instanceof H.Mesh||t instanceof H.Line||t instanceof H.Points)&&(!t.castShadow||!1!==t.frustumCulled&&!0!==r.intersectsObject(t)||!0===t.material.visible&&(t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),f.push(t)));for(var e=t.children,s=0,h=e.length;s<h;s++)O(e[s],i,n)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=H.PCFShadowMap,this.cullFace=H.CullFaceFront,this.render=function(c,l){var v,d,p=i.shadows;if(0!==p.length&&!1!==T.enabled&&(!1!==T.autoUpdate||!1!==T.needsUpdate)){s.clearColor(1,1,1,1),s.disable(e.BLEND),s.enable(e.CULL_FACE),e.frontFace(e.CCW),e.cullFace(T.cullFace===H.CullFaceFront?e.FRONT:e.BACK),s.setDepthTest(!0),s.setScissorTest(!1);for(var w=0,y=p.length;w<y;w++){var _=p[w],x=_.shadow,E=x.camera;if(o.copy(x.mapSize),_ instanceof H.PointLight){v=6,d=!0;var S=o.x,b=o.y;g[0].set(2*S,b,S,b),g[1].set(0,b,S,b),g[2].set(3*S,b,S,b),g[3].set(S,b,S,b),g[4].set(3*S,0,S,b),g[5].set(S,0,S,b),o.x*=4,o.y*=2}else v=1,d=!1;null===x.map&&(x.map=new H.WebGLRenderTarget(o.x,o.y,{minFilter:H.NearestFilter,magFilter:H.NearestFilter,format:H.RGBAFormat}),_ instanceof H.SpotLight&&(E.aspect=o.x/o.y),E.updateProjectionMatrix());var A=x.map,P=x.matrix;u.setFromMatrixPosition(_.matrixWorld),E.position.copy(u),t.setRenderTarget(A),t.clear();for(var U=0;U<v;U++){d?(a.copy(E.position),a.add(m[U]),E.up.copy(M[U]),E.lookAt(a),s.viewport(g[U])):(a.setFromMatrixPosition(_.target.matrixWorld),E.lookAt(a)),E.updateMatrixWorld(),E.matrixWorldInverse.getInverse(E.matrixWorld),P.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),P.multiply(E.projectionMatrix),P.multiply(E.matrixWorldInverse),h.multiplyMatrices(E.projectionMatrix,E.matrixWorldInverse),r.setFromMatrix(h),f.length=0,O(c,l,E);for(var N=0,k=f.length;N<k;N++){var D=f[N],F=n.update(D),I=D.material;if(I instanceof H.MultiMaterial)for(var R=F.groups,C=I.materials,B=0,G=R.length;B<G;B++){var V=R[B],j=C[V.materialIndex];if(!0===j.visible){var X=L(D,j,d,u);t.renderBufferDirect(E,null,F,X,D,V)}}else X=L(D,I,d,u),t.renderBufferDirect(E,null,F,X,D,null)}}}var Y=t.getClearColor(),z=t.getClearAlpha();t.setClearColor(Y,z),s.enable(e.BLEND),T.cullFace===H.CullFaceFront&&e.cullFace(e.BACK),T.needsUpdate=!1}}},H.SpritePlugin=function(t,i){var n,e,s,r,h,o,a=t.context,u=t.state,f=new H.Vector3,c=new H.Quaternion,l=new H.Vector3;function v(t,i){return t.renderOrder!==i.renderOrder?t.renderOrder-i.renderOrder:t.z!==i.z?i.z-t.z:i.id-t.id}this.render=function(d,p){if(0!==i.length){void 0===s&&function(){var i=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),u=new Uint16Array([0,1,2,0,2,3]);n=a.createBuffer(),e=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,n),a.bufferData(a.ARRAY_BUFFER,i,a.STATIC_DRAW),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,e),a.bufferData(a.ELEMENT_ARRAY_BUFFER,u,a.STATIC_DRAW),s=function(){var i=a.createProgram(),n=a.createShader(a.VERTEX_SHADER),e=a.createShader(a.FRAGMENT_SHADER);return a.shaderSource(n,["precision "+t.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n")),a.shaderSource(e,["precision "+t.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")),a.compileShader(n),a.compileShader(e),a.attachShader(i,n),a.attachShader(i,e),a.linkProgram(i),i}(),r={position:a.getAttribLocation(s,"position"),uv:a.getAttribLocation(s,"uv")},h={uvOffset:a.getUniformLocation(s,"uvOffset"),uvScale:a.getUniformLocation(s,"uvScale"),rotation:a.getUniformLocation(s,"rotation"),scale:a.getUniformLocation(s,"scale"),color:a.getUniformLocation(s,"color"),map:a.getUniformLocation(s,"map"),opacity:a.getUniformLocation(s,"opacity"),modelViewMatrix:a.getUniformLocation(s,"modelViewMatrix"),projectionMatrix:a.getUniformLocation(s,"projectionMatrix"),fogType:a.getUniformLocation(s,"fogType"),fogDensity:a.getUniformLocation(s,"fogDensity"),fogNear:a.getUniformLocation(s,"fogNear"),fogFar:a.getUniformLocation(s,"fogFar"),fogColor:a.getUniformLocation(s,"fogColor"),alphaTest:a.getUniformLocation(s,"alphaTest")};var f=document.createElement("canvas");f.width=8,f.height=8;var c=f.getContext("2d");c.fillStyle="white",c.fillRect(0,0,8,8),(o=new H.Texture(f)).needsUpdate=!0}(),a.useProgram(s),u.initAttributes(),u.enableAttribute(r.position),u.enableAttribute(r.uv),u.disableUnusedAttributes(),u.disable(a.CULL_FACE),u.enable(a.BLEND),a.bindBuffer(a.ARRAY_BUFFER,n),a.vertexAttribPointer(r.position,2,a.FLOAT,!1,16,0),a.vertexAttribPointer(r.uv,2,a.FLOAT,!1,16,8),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,e),a.uniformMatrix4fv(h.projectionMatrix,!1,p.projectionMatrix.elements),u.activeTexture(a.TEXTURE0),a.uniform1i(h.map,0);var m=0,M=0,g=d.fog;g?(a.uniform3f(h.fogColor,g.color.r,g.color.g,g.color.b),g instanceof H.Fog?(a.uniform1f(h.fogNear,g.near),a.uniform1f(h.fogFar,g.far),a.uniform1i(h.fogType,1),m=1,M=1):g instanceof H.FogExp2&&(a.uniform1f(h.fogDensity,g.density),a.uniform1i(h.fogType,2),m=2,M=2)):(a.uniform1i(h.fogType,0),m=0,M=0);for(var w=0,y=i.length;w<y;w++)(x=i[w]).modelViewMatrix.multiplyMatrices(p.matrixWorldInverse,x.matrixWorld),x.z=-x.modelViewMatrix.elements[14];i.sort(v);var _=[];for(w=0,y=i.length;w<y;w++){var x,E=(x=i[w]).material;a.uniform1f(h.alphaTest,E.alphaTest),a.uniformMatrix4fv(h.modelViewMatrix,!1,x.modelViewMatrix.elements),x.matrixWorld.decompose(f,c,l),_[0]=l.x,_[1]=l.y;var S=0;d.fog&&E.fog&&(S=M),m!==S&&(a.uniform1i(h.fogType,S),m=S),null!==E.map?(a.uniform2f(h.uvOffset,E.map.offset.x,E.map.offset.y),a.uniform2f(h.uvScale,E.map.repeat.x,E.map.repeat.y)):(a.uniform2f(h.uvOffset,0,0),a.uniform2f(h.uvScale,1,1)),a.uniform1f(h.opacity,E.opacity),a.uniform3f(h.color,E.color.r,E.color.g,E.color.b),a.uniform1f(h.rotation,E.rotation),a.uniform2fv(h.scale,_),u.setBlending(E.blending,E.blendEquation,E.blendSrc,E.blendDst),u.setDepthTest(E.depthTest),u.setDepthWrite(E.depthWrite),t.setTexture(E.map&&E.map.image&&E.map.image.width?E.map:o,0),a.drawElements(a.TRIANGLES,6,a.UNSIGNED_SHORT,0)}u.enable(a.CULL_FACE),t.resetGLState()}}},H.LensFlarePlugin=function(t,i){var n,e,s,r,h,o,a,u,f=t.context,c=t.state;this.render=function(l,v,d){if(0!==i.length){var p=new H.Vector3,m=d.w/d.z,M=.5*d.z,g=.5*d.w,w=16/d.w,y=new H.Vector2(w*m,w),_=new H.Vector3(1,1,0),x=new H.Vector2(1,1);void 0===s&&function(){var i,l=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),v=new Uint16Array([0,1,2,0,2,3]);n=f.createBuffer(),e=f.createBuffer(),f.bindBuffer(f.ARRAY_BUFFER,n),f.bufferData(f.ARRAY_BUFFER,l,f.STATIC_DRAW),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,e),f.bufferData(f.ELEMENT_ARRAY_BUFFER,v,f.STATIC_DRAW),a=f.createTexture(),u=f.createTexture(),c.bindTexture(f.TEXTURE_2D,a),f.texImage2D(f.TEXTURE_2D,0,f.RGB,16,16,0,f.RGB,f.UNSIGNED_BYTE,null),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.NEAREST),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.NEAREST),c.bindTexture(f.TEXTURE_2D,u),f.texImage2D(f.TEXTURE_2D,0,f.RGBA,16,16,0,f.RGBA,f.UNSIGNED_BYTE,null),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.NEAREST),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.NEAREST),i=(o=f.getParameter(f.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0)?{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if ( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if ( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if ( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if ( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if ( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if ( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},s=function(i){var n=f.createProgram(),e=f.createShader(f.FRAGMENT_SHADER),s=f.createShader(f.VERTEX_SHADER),r="precision "+t.getPrecision()+" float;\n";return f.shaderSource(e,r+i.fragmentShader),f.shaderSource(s,r+i.vertexShader),f.compileShader(e),f.compileShader(s),f.attachShader(n,e),f.attachShader(n,s),f.linkProgram(n),n}(i),r={vertex:f.getAttribLocation(s,"position"),uv:f.getAttribLocation(s,"uv")},h={renderType:f.getUniformLocation(s,"renderType"),map:f.getUniformLocation(s,"map"),occlusionMap:f.getUniformLocation(s,"occlusionMap"),opacity:f.getUniformLocation(s,"opacity"),color:f.getUniformLocation(s,"color"),scale:f.getUniformLocation(s,"scale"),rotation:f.getUniformLocation(s,"rotation"),screenPosition:f.getUniformLocation(s,"screenPosition")}}(),f.useProgram(s),c.initAttributes(),c.enableAttribute(r.vertex),c.enableAttribute(r.uv),c.disableUnusedAttributes(),f.uniform1i(h.occlusionMap,0),f.uniform1i(h.map,1),f.bindBuffer(f.ARRAY_BUFFER,n),f.vertexAttribPointer(r.vertex,2,f.FLOAT,!1,16,0),f.vertexAttribPointer(r.uv,2,f.FLOAT,!1,16,8),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,e),c.disable(f.CULL_FACE),c.setDepthWrite(!1);for(var E=0,S=i.length;E<S;E++){y.set((w=16/d.w)*m,w);var b=i[E];if(p.set(b.matrixWorld.elements[12],b.matrixWorld.elements[13],b.matrixWorld.elements[14]),p.applyMatrix4(v.matrixWorldInverse),p.applyProjection(v.projectionMatrix),_.copy(p),x.x=_.x*M+M,x.y=_.y*g+g,o||x.x>0&&x.x<d.z&&x.y>0&&x.y<d.w){c.activeTexture(f.TEXTURE0),c.bindTexture(f.TEXTURE_2D,null),c.activeTexture(f.TEXTURE1),c.bindTexture(f.TEXTURE_2D,a),f.copyTexImage2D(f.TEXTURE_2D,0,f.RGB,d.x+x.x-8,d.y+x.y-8,16,16,0),f.uniform1i(h.renderType,0),f.uniform2f(h.scale,y.x,y.y),f.uniform3f(h.screenPosition,_.x,_.y,_.z),c.disable(f.BLEND),c.enable(f.DEPTH_TEST),f.drawElements(f.TRIANGLES,6,f.UNSIGNED_SHORT,0),c.activeTexture(f.TEXTURE0),c.bindTexture(f.TEXTURE_2D,u),f.copyTexImage2D(f.TEXTURE_2D,0,f.RGBA,d.x+x.x-8,d.y+x.y-8,16,16,0),f.uniform1i(h.renderType,1),c.disable(f.DEPTH_TEST),c.activeTexture(f.TEXTURE1),c.bindTexture(f.TEXTURE_2D,a),f.drawElements(f.TRIANGLES,6,f.UNSIGNED_SHORT,0),b.positionScreen.copy(_),b.customUpdateCallback?b.customUpdateCallback(b):b.updateLensFlares(),f.uniform1i(h.renderType,2),c.enable(f.BLEND);for(var A=0,P=b.lensFlares.length;A<P;A++){var T=b.lensFlares[A];T.opacity>.001&&T.scale>.001&&(_.x=T.x,_.y=T.y,_.z=T.z,y.x=(w=T.size*T.scale/d.w)*m,y.y=w,f.uniform3f(h.screenPosition,_.x,_.y,_.z),f.uniform2f(h.scale,y.x,y.y),f.uniform1f(h.rotation,T.rotation),f.uniform1f(h.opacity,T.opacity),f.uniform3f(h.color,T.color.r,T.color.g,T.color.b),c.setBlending(T.blending,T.blendEquation,T.blendSrc,T.blendDst),t.setTexture(T.texture,1),f.drawElements(f.TRIANGLES,6,f.UNSIGNED_SHORT,0))}}}c.enable(f.CULL_FACE),c.enable(f.DEPTH_TEST),c.setDepthWrite(!0),t.resetGLState()}}},H.WebGLObjects=function(t,i,n){var e=new H.WebGLGeometries(t,i,n);function s(n,e){var s=n instanceof H.InterleavedBufferAttribute?n.data:n,r=i.get(s);void 0===r.__webglBuffer?function(i,n,e){i.__webglBuffer=t.createBuffer(),t.bindBuffer(e,i.__webglBuffer),t.bufferData(e,n.array,n.dynamic?t.DYNAMIC_DRAW:t.STATIC_DRAW),i.version=n.version}(r,s,e):r.version!==s.version&&function(i,n,e){t.bindBuffer(e,i.__webglBuffer),!1===n.dynamic||-1===n.updateRange.count?t.bufferSubData(e,0,n.array):0===n.updateRange.count||(t.bufferSubData(e,n.updateRange.offset*n.array.BYTES_PER_ELEMENT,n.array.subarray(n.updateRange.offset,n.updateRange.offset+n.updateRange.count)),n.updateRange.count=0),i.version=n.version}(r,s,e)}function r(t,i,n){if(i>n){var e=i;i=n,n=e}var s=t[i];return void 0===s?(t[i]=[n],!0):-1===s.indexOf(n)&&(s.push(n),!0)}this.getAttributeBuffer=function(t){return t instanceof H.InterleavedBufferAttribute?i.get(t.data).__webglBuffer:i.get(t).__webglBuffer},this.getWireframeAttribute=function(n){var e=i.get(n);if(void 0!==e.wireframe)return e.wireframe;var h,o=[],a=n.index,u=n.attributes,f=u.position;if(null!==a)for(var c={},l=0,v=(h=a.array).length;l<v;l+=3){var d=h[l+2];r(c,p=h[l+0],m=h[l+1])&&o.push(p,m),r(c,m,d)&&o.push(m,d),r(c,d,p)&&o.push(d,p)}else for(l=0,v=(h=u.position.array).length/3-1;l<v;l+=3){var p,m;o.push(p=l+0,m=l+1,m,d=l+2,d,p)}var M=f.count>65535?Uint32Array:Uint16Array,g=new H.BufferAttribute(new M(o),1);return s(g,t.ELEMENT_ARRAY_BUFFER),e.wireframe=g,g},this.update=function(i){var n=e.get(i);i.geometry instanceof H.Geometry&&n.updateFromObject(i);var r=n.index,h=n.attributes;for(var o in null!==r&&s(r,t.ELEMENT_ARRAY_BUFFER),h)s(h[o],t.ARRAY_BUFFER);var a=n.morphAttributes;for(var o in a)for(var u=a[o],f=0,c=u.length;f<c;f++)s(u[f],t.ARRAY_BUFFER);return n}},H.WebGLProgram=function(){var t=0,i=/^([\w\d_]+)\.([\w\d_]+)$/,n=/^([\w\d_]+)\[(\d+)\]\.([\w\d_]+)$/,e=/^([\w\d_]+)\[0\]$/;function s(t){switch(t){case H.LinearEncoding:return["Linear","( value )"];case H.sRGBEncoding:return["sRGB","( value )"];case H.RGBEEncoding:return["RGBE","( value )"];case H.RGBM7Encoding:return["RGBM","( value, 7.0 )"];case H.RGBM16Encoding:return["RGBM","( value, 16.0 )"];case H.RGBDEncoding:return["RGBD","( value, 256.0 )"];case H.GammaEncoding:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+t)}}function r(t,i){var n=s(i);return"vec4 "+t+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function h(t,i){var n;switch(i){case H.LinearToneMapping:n="Linear";break;case H.ReinhardToneMapping:n="Reinhard";break;case H.Uncharted2ToneMapping:n="Uncharted2";break;case H.CineonToneMapping:n="OptimizedCineon";break;default:throw new Error("unsupported toneMapping: "+i)}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function o(t){return""!==t}function a(t,i){return t.replace(/NUM_DIR_LIGHTS/g,i.numDirLights).replace(/NUM_SPOT_LIGHTS/g,i.numSpotLights).replace(/NUM_POINT_LIGHTS/g,i.numPointLights).replace(/NUM_HEMI_LIGHTS/g,i.numHemiLights)}function u(t){return t.replace(/#include +<([\w\d.]+)>/g,(function(t,i){var n=H.ShaderChunk[i];if(void 0===n)throw new Error("Can not resolve #include <"+i+">");return u(n)}))}function f(t){return t.replace(/for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,(function(t,i,n,e){for(var s="",r=parseInt(i);r<parseInt(n);r++)s+=e.replace(/\[ i \]/g,"[ "+r+" ]");return s}))}return function(c,l,v,d){var p=c.context,m=v.extensions,M=v.defines,g=v.__webglShader.vertexShader,w=v.__webglShader.fragmentShader,y="SHADOWMAP_TYPE_BASIC";d.shadowMapType===H.PCFShadowMap?y="SHADOWMAP_TYPE_PCF":d.shadowMapType===H.PCFSoftShadowMap&&(y="SHADOWMAP_TYPE_PCF_SOFT");var _="ENVMAP_TYPE_CUBE",x="ENVMAP_MODE_REFLECTION",E="ENVMAP_BLENDING_MULTIPLY";if(d.envMap){switch(v.envMap.mapping){case H.CubeReflectionMapping:case H.CubeRefractionMapping:_="ENVMAP_TYPE_CUBE";break;case H.CubeUVReflectionMapping:case H.CubeUVRefractionMapping:_="ENVMAP_TYPE_CUBE_UV";break;case H.EquirectangularReflectionMapping:case H.EquirectangularRefractionMapping:_="ENVMAP_TYPE_EQUIREC";break;case H.SphericalReflectionMapping:_="ENVMAP_TYPE_SPHERE"}switch(v.envMap.mapping){case H.CubeRefractionMapping:case H.EquirectangularRefractionMapping:x="ENVMAP_MODE_REFRACTION"}switch(v.combine){case H.MultiplyOperation:E="ENVMAP_BLENDING_MULTIPLY";break;case H.MixOperation:E="ENVMAP_BLENDING_MIX";break;case H.AddOperation:E="ENVMAP_BLENDING_ADD"}}var S,b,A,P,T=c.gammaFactor>0?c.gammaFactor:1,L=function(t,i,n){return[(t=t||{}).derivatives||i.envMapCubeUV||i.bumpMap||i.normalMap||i.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(t.fragDepth||i.logarithmicDepthBuffer)&&n.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",t.drawBuffers&&n.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(t.shaderTextureLOD||i.envMap)&&n.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(o).join("\n")}(m,d,c.extensions),O=function(t){var i=[];for(var n in t){var e=t[n];!1!==e&&i.push("#define "+n+" "+e)}return i.join("\n")}(M),U=p.createProgram();v instanceof H.RawShaderMaterial?(S="",b=""):(S=["precision "+d.precision+" float;","precision "+d.precision+" int;","#define SHADER_NAME "+v.__webglShader.name,O,d.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+T,"#define MAX_BONES "+d.maxBones,d.map?"#define USE_MAP":"",d.envMap?"#define USE_ENVMAP":"",d.envMap?"#define "+x:"",d.lightMap?"#define USE_LIGHTMAP":"",d.aoMap?"#define USE_AOMAP":"",d.emissiveMap?"#define USE_EMISSIVEMAP":"",d.bumpMap?"#define USE_BUMPMAP":"",d.normalMap?"#define USE_NORMALMAP":"",d.displacementMap&&d.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",d.specularMap?"#define USE_SPECULARMAP":"",d.roughnessMap?"#define USE_ROUGHNESSMAP":"",d.metalnessMap?"#define USE_METALNESSMAP":"",d.alphaMap?"#define USE_ALPHAMAP":"",d.vertexColors?"#define USE_COLOR":"",d.flatShading?"#define FLAT_SHADED":"",d.skinning?"#define USE_SKINNING":"",d.useVertexTexture?"#define BONE_TEXTURE":"",d.morphTargets?"#define USE_MORPHTARGETS":"",d.morphNormals&&!1===d.flatShading?"#define USE_MORPHNORMALS":"",d.doubleSided?"#define DOUBLE_SIDED":"",d.flipSided?"#define FLIP_SIDED":"",d.shadowMapEnabled?"#define USE_SHADOWMAP":"",d.shadowMapEnabled?"#define "+y:"",d.pointLightShadows>0?"#define POINT_LIGHT_SHADOWS":"",d.sizeAttenuation?"#define USE_SIZEATTENUATION":"",d.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",d.logarithmicDepthBuffer&&c.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(o).join("\n"),b=[L,"precision "+d.precision+" float;","precision "+d.precision+" int;","#define SHADER_NAME "+v.__webglShader.name,O,d.alphaTest?"#define ALPHATEST "+d.alphaTest:"","#define GAMMA_FACTOR "+T,d.useFog&&d.fog?"#define USE_FOG":"",d.useFog&&d.fogExp?"#define FOG_EXP2":"",d.map?"#define USE_MAP":"",d.envMap?"#define USE_ENVMAP":"",d.envMap?"#define "+_:"",d.envMap?"#define "+x:"",d.envMap?"#define "+E:"",d.lightMap?"#define USE_LIGHTMAP":"",d.aoMap?"#define USE_AOMAP":"",d.emissiveMap?"#define USE_EMISSIVEMAP":"",d.bumpMap?"#define USE_BUMPMAP":"",d.normalMap?"#define USE_NORMALMAP":"",d.specularMap?"#define USE_SPECULARMAP":"",d.roughnessMap?"#define USE_ROUGHNESSMAP":"",d.metalnessMap?"#define USE_METALNESSMAP":"",d.alphaMap?"#define USE_ALPHAMAP":"",d.vertexColors?"#define USE_COLOR":"",d.flatShading?"#define FLAT_SHADED":"",d.doubleSided?"#define DOUBLE_SIDED":"",d.flipSided?"#define FLIP_SIDED":"",d.shadowMapEnabled?"#define USE_SHADOWMAP":"",d.shadowMapEnabled?"#define "+y:"",d.pointLightShadows>0?"#define POINT_LIGHT_SHADOWS":"",d.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",d.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",d.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",d.logarithmicDepthBuffer&&c.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"",d.envMap&&c.extensions.get("EXT_shader_texture_lod")?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",d.toneMapping!==H.NoToneMapping?"#define TONE_MAPPING":"",d.toneMapping!==H.NoToneMapping?H.ShaderChunk.tonemapping_pars_fragment:"",d.toneMapping!==H.NoToneMapping?h("toneMapping",d.toneMapping):"",d.outputEncoding||d.mapEncoding||d.envMapEncoding||d.emissiveMapEncoding?H.ShaderChunk.encodings_pars_fragment:"",d.mapEncoding?r("mapTexelToLinear",d.mapEncoding):"",d.envMapEncoding?r("envMapTexelToLinear",d.envMapEncoding):"",d.emissiveMapEncoding?r("emissiveMapTexelToLinear",d.emissiveMapEncoding):"",d.outputEncoding?("linearToOutputTexel",A=d.outputEncoding,P=s(A),"vec4 linearToOutputTexel( vec4 value ) { return LinearTo"+P[0]+P[1]+"; }"):"","\n"].filter(o).join("\n")),g=a(g=u(g),d),w=a(w=u(w),d),v instanceof H.ShaderMaterial==0&&(g=f(g),w=f(w));var N=b+w,k=H.WebGLShader(p,p.VERTEX_SHADER,S+g),D=H.WebGLShader(p,p.FRAGMENT_SHADER,N);p.attachShader(U,k),p.attachShader(U,D),void 0!==v.index0AttributeName?p.bindAttribLocation(U,0,v.index0AttributeName):!0===d.morphTargets&&p.bindAttribLocation(U,0,"position"),p.linkProgram(U);var F,I,R=p.getProgramInfoLog(U),C=p.getShaderInfoLog(k),B=p.getShaderInfoLog(D),G=!0,V=!0;return!1===p.getProgramParameter(U,p.LINK_STATUS)?G=!1:""!==R||""!==C&&""!==B||(V=!1),V&&(this.diagnostics={runnable:G,material:v,programLog:R,vertexShader:{log:C,prefix:S},fragmentShader:{log:B,prefix:b}}),p.deleteShader(k),p.deleteShader(D),this.getUniforms=function(){return void 0===F&&(F=function(t,s){for(var r={},h=t.getProgramParameter(s,t.ACTIVE_UNIFORMS),o=0;o<h;o++){var a=t.getActiveUniform(s,o).name,u=t.getUniformLocation(s,a),f=i.exec(a);if(f){var c=f[1],l=f[2],v=r[c];v||(v=r[c]={}),v[l]=u}else if(f=n.exec(a)){var d=f[2],p=f[3],m=r[g=f[1]];m||(m=r[g]=[]);var M=m[d];M||(M=m[d]={}),M[p]=u}else{var g;(f=e.exec(a))?r[g=f[1]]=u:r[a]=u}}return r}(p,U)),F},this.getAttributes=function(){return void 0===I&&(I=function(t,i){for(var n={},e=t.getProgramParameter(i,t.ACTIVE_ATTRIBUTES),s=0;s<e;s++){var r=t.getActiveAttrib(i,s).name;n[r]=t.getAttribLocation(i,r)}return n}(p,U)),I},this.destroy=function(){p.deleteProgram(U),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return this.getUniforms()}},attributes:{get:function(){return this.getAttributes()}}}),this.id=t++,this.code=l,this.usedTimes=1,this.program=U,this.vertexShader=k,this.fragmentShader=D,this}}(),H.WebGLRenderTarget=function(t,i,n){this.uuid=H.Math.generateUUID(),this.width=t,this.height=i,this.scissor=new H.Vector4(0,0,t,i),this.scissorTest=!1,this.viewport=new H.Vector4(0,0,t,i),void 0===(n=n||{}).minFilter&&(n.minFilter=H.LinearFilter),this.texture=new H.Texture(void 0,void 0,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy),this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0===n.stencilBuffer||n.stencilBuffer},H.WebGLRenderTarget.prototype={constructor:H.WebGLRenderTarget,setSize:function(t,i){this.width===t&&this.height===i||(this.width=t,this.height=i,this.dispose()),this.viewport.set(0,0,t,i),this.scissor.set(0,0,t,i)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this},dispose:function(){this.dispatchEvent({type:"dispose"})}},H.EventDispatcher.prototype.apply(H.WebGLRenderTarget.prototype),H.WebGLRenderTargetCube=function(t,i,n){H.WebGLRenderTarget.call(this,t,i,n),this.activeCubeFace=0,this.activeMipMapLevel=0},H.WebGLRenderTargetCube.prototype=Object.create(H.WebGLRenderTarget.prototype),H.WebGLRenderTargetCube.prototype.constructor=H.WebGLRenderTargetCube,H.WebGLPrograms=function(t,i){var n=[],e={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshStandardMaterial:"standard",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points"},s=["precision","supportsVertexTextures","map","mapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","displacementMap","specularMap","roughnessMap","metalnessMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","shadowMapEnabled","pointLightShadows","toneMapping","physicallyCorrectLights","shadowMapType","alphaTest","doubleSided","flipSided"];function r(t,i){var n;return t?t instanceof H.Texture?n=t.encoding:t instanceof H.WebGLRenderTarget&&(n=t.texture.encoding):n=H.LinearEncoding,n===H.LinearEncoding&&i&&(n=H.GammaEncoding),n}this.getParameters=function(n,s,h,o){var a=e[n.type],u=function(t){if(i.floatVertexTextures&&t&&t.skeleton&&t.skeleton.useVertexTexture)return 1024;var n=Math.floor((i.maxVertexUniforms-20)/4);return void 0!==t&&t instanceof H.SkinnedMesh&&(n=Math.min(t.skeleton.bones.length,n)),n}(o),f=t.getPrecision();return null!==n.precision&&(f=i.getMaxPrecision(n.precision)),{shaderID:a,precision:f,supportsVertexTextures:i.vertexTextures,outputEncoding:r(t.getCurrentRenderTarget(),t.gammaOutput),map:!!n.map,mapEncoding:r(n.map,t.gammaInput),envMap:!!n.envMap,envMapMode:n.envMap&&n.envMap.mapping,envMapEncoding:r(n.envMap,t.gammaInput),envMapCubeUV:!!n.envMap&&(n.envMap.mapping===H.CubeUVReflectionMapping||n.envMap.mapping===H.CubeUVRefractionMapping),lightMap:!!n.lightMap,aoMap:!!n.aoMap,emissiveMap:!!n.emissiveMap,emissiveMapEncoding:r(n.emissiveMap,t.gammaInput),bumpMap:!!n.bumpMap,normalMap:!!n.normalMap,displacementMap:!!n.displacementMap,roughnessMap:!!n.roughnessMap,metalnessMap:!!n.metalnessMap,specularMap:!!n.specularMap,alphaMap:!!n.alphaMap,combine:n.combine,vertexColors:n.vertexColors,fog:h,useFog:n.fog,fogExp:h instanceof H.FogExp2,flatShading:n.shading===H.FlatShading,sizeAttenuation:n.sizeAttenuation,logarithmicDepthBuffer:i.logarithmicDepthBuffer,skinning:n.skinning,maxBones:u,useVertexTexture:i.floatVertexTextures&&o&&o.skeleton&&o.skeleton.useVertexTexture,morphTargets:n.morphTargets,morphNormals:n.morphNormals,maxMorphTargets:t.maxMorphTargets,maxMorphNormals:t.maxMorphNormals,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numHemiLights:s.hemi.length,pointLightShadows:s.shadowsPointLight,shadowMapEnabled:t.shadowMap.enabled&&o.receiveShadow&&s.shadows.length>0,shadowMapType:t.shadowMap.type,toneMapping:t.toneMapping,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:n.premultipliedAlpha,alphaTest:n.alphaTest,doubleSided:n.side===H.DoubleSide,flipSided:n.side===H.BackSide}},this.getProgramCode=function(t,i){var n=[];if(i.shaderID?n.push(i.shaderID):(n.push(t.fragmentShader),n.push(t.vertexShader)),void 0!==t.defines)for(var e in t.defines)n.push(e),n.push(t.defines[e]);for(var r=0;r<s.length;r++){var h=s[r];n.push(h),n.push(i[h])}return n.join()},this.acquireProgram=function(i,e,s){for(var r,h=0,o=n.length;h<o;h++){var a=n[h];if(a.code===s){++(r=a).usedTimes;break}}return void 0===r&&(r=new H.WebGLProgram(t,s,i,e),n.push(r)),r},this.releaseProgram=function(t){if(0==--t.usedTimes){var i=n.indexOf(t);n[i]=n[n.length-1],n.pop(),t.destroy()}},this.programs=n};var z=function(){function i(n){t(this,i),Object.assign(this,n),this.renderer=new Y.WebGLRenderer,this.renderer.setClearColor(0,0),this.renderer.setSize(this.width,this.height),this.renderer.setPixelRatio(window.devicePixelRatio),this.el=this.renderer.domElement}return n(i,[{key:"setTexture",value:function(t){this.texture=t,this.mesh=this.createMesh()}},{key:"setSize",value:function(t){var i=t.height,n=t.width;this.height=i,this.width=n,this.renderer.setSize(n,i)}},{key:"createMesh",value:function(){return this.material=new Y.MeshBasicMaterial({map:this.texture}),this.geometry=new Y.SphereGeometry(1,50,50),this.geometry.scale(-1,1,1),new Y.Mesh(this.geometry,this.material)}},{key:"destroy",value:function(){this.geometry.dispose(),this.material.dispose(),this.renderer.dispose()}},{key:"render",value:function(t,i,n){n&&this.renderer.render(t,i)}}]),i}(),W=function(t){var i=1.70158;return--t*t*((i+1)*t+i)+1},Z=function(){function i(n){var e=this;t(this,i),Object.assign(this,n),this.el=this.renderer.el,this.theta=this.initialYaw*Math.PI/180,this.phi=0,this.velo=.02,this.rotateStart=new Y.Vector2,this.rotateEnd=new Y.Vector2,this.rotateDelta=new Y.Vector2,this.orientation=new Y.Quaternion,this.euler=new Y.Euler,this.momentum=!1,this.isUserInteracting=!1,this.addDraggableStyle(),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onTouchStart=function(t){return e.onMouseDown({clientX:t.touches[0].pageX,clientY:t.touches[0].pageY})},this.onTouchMove=function(t){return e.onMouseMove({clientX:t.touches[0].pageX,clientY:t.touches[0].pageY})},this.onTouchEnd=function(){return e.onMouseUp()},this.onDeviceMotion=this.onDeviceMotion.bind(this),this.onMessage=this.onMessage.bind(this),this.bindEvents()}return n(i,[{key:"bindEvents",value:function(){this.el.addEventListener("mouseleave",this.onMouseUp),this.el.addEventListener("mousemove",this.onMouseMove),this.el.addEventListener("mousedown",this.onMouseDown),this.el.addEventListener("mouseup",this.onMouseUp),this.el.addEventListener("touchstart",this.onTouchStart),this.el.addEventListener("touchmove",this.onTouchMove),this.el.addEventListener("touchend",this.onTouchEnd),this.isInIframe()||window.addEventListener("devicemotion",this.onDeviceMotion),window.addEventListener("message",this.onMessage)}},{key:"centralize",value:function(){var t=this,i=this.initialYaw*Math.PI/180,n=this.theta,e=this.phi,s=Date.now(),r=function h(){var o=Date.now()-s,a=o/750;return a=a>1?1:a,o>=750?cancelAnimationFrame(r):(t.theta=n+(i-n)*W(a),t.phi=e+(0-e)*W(a),requestAnimationFrame(h))}()}},{key:"isInIframe",value:function(){try{return window.self!==window.top}catch(t){return!0}}},{key:"destroy",value:function(){this.el.removeEventListener("mouseleave",this.onMouseUp),this.el.removeEventListener("mousemove",this.onMouseMove),this.el.removeEventListener("mousedown",this.onMouseDown),this.el.removeEventListener("mouseup",this.onMouseUp),this.el.removeEventListener("touchstart",this.onTouchStart),this.el.removeEventListener("touchmove",this.onTouchMove),this.el.removeEventListener("touchend",this.onTouchEnd),window.removeEventListener("devicemotion",this.onDeviceMotion),window.removeEventListener("message",this.onMessage)}},{key:"getCurrentStyle",value:function(){return"height: ".concat(parseInt(this.el.style.height,10),"px; width: ").concat(parseInt(this.el.style.width,10),"px; user-select: none; -webkit-user-select: none; -webkit-touch-callout: none; -webkit-tap-highlight-color: rgba(0,0,0,0);")}},{key:"addDraggingStyle",value:function(){this.el.setAttribute("style","".concat(this.getCurrentStyle()," cursor: -webkit-grabbing; cursor: -moz-grabbing; cursor: grabbing;"))}},{key:"addDraggableStyle",value:function(){this.el.setAttribute("style","".concat(this.getCurrentStyle()," cursor: -webkit-grab; cursor: -moz-grab; cursor: grab;"))}},{key:"onMessage",value:function(t){var i=t.data,n=i.rotationRate;n&&this.onDeviceMotion({orientation:i.orientation,portrait:i.portrait,rotationRate:n})}},{key:"onDeviceMotion",value:function(t){var i,n=void 0!==t.portrait?t.portrait:window.matchMedia("(orientation: portrait)").matches;i=void 0!==t.orientation?t.orientation:void 0!==window.orientation?window.orientation:-90;var e=Y.Math.degToRad(t.rotationRate.alpha),s=Y.Math.degToRad(t.rotationRate.beta);n?(this.phi=this.verticalPanning?this.phi+e*this.velo:this.phi,this.theta=this.theta-s*this.velo*-1):(this.verticalPanning&&(this.phi=-90===i?this.phi+s*this.velo:this.phi-s*this.velo),this.theta=-90===i?this.theta-e*this.velo:this.theta+e*this.velo),this.adjustPhi()}},{key:"onMouseMove",value:function(t){this.isUserInteracting&&(this.rotateEnd.set(t.clientX,t.clientY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart),this.rotateStart.copy(this.rotateEnd),this.phi=this.verticalPanning?this.phi+2*Math.PI*this.rotateDelta.y/this.renderer.height*.3:this.phi,this.theta+=2*Math.PI*this.rotateDelta.x/this.renderer.width*.5,this.adjustPhi())}},{key:"adjustPhi",value:function(){this.phi=Y.Math.clamp(this.phi,-Math.PI/1.95,Math.PI/1.95)}},{key:"onMouseDown",value:function(t){this.addDraggingStyle(),this.rotateStart.set(t.clientX,t.clientY),this.isUserInteracting=!0,this.momentum=!1,this.onDragStart&&this.onDragStart()}},{key:"inertia",value:function(){this.momentum&&(this.rotateDelta.y*=.9,this.rotateDelta.x*=.9,this.theta+=.005*this.rotateDelta.x,this.phi=this.verticalPanning?this.phi+.005*this.rotateDelta.y:this.phi,this.adjustPhi())}},{key:"onMouseUp",value:function(){this.isUserInteracting&&this.onDragStop&&this.onDragStop(),this.addDraggableStyle(),this.isUserInteracting=!1,this.momentum=!0,this.inertia()}},{key:"update",value:function(){return(this.phi!==this.previousPhi||this.theta!==this.previousTheta)&&(this.previousPhi=this.phi,this.previousTheta=this.theta,this.euler.set(this.phi,this.theta,0,"YXZ"),this.orientation.setFromEuler(this.euler),this.camera.quaternion.copy(this.orientation),this.inertia(),!0)}}]),i}(),q=function(){function i(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t(this,i),Object.assign(this,{height:360,width:640,initialYaw:90,verticalPanning:!0},n);var e=this.initialYaw,s=this.verticalPanning,r=this.onDragStart,h=this.onDragStop;this.renderer=new z({height:this.height,width:this.width}),this.camera=new Y.PerspectiveCamera(80,this.width/this.height,.1,100),this.controls=new Z({camera:this.camera,renderer:this.renderer,initialYaw:e,verticalPanning:s,onDragStart:r,onDragStop:h}),this.stopVideoLoop=this.stopVideoLoop.bind(this),this.onError=this.onError.bind(this),this.startVideoLoop=this.startVideoLoop.bind(this),this.needsUpdate=!1,this.scene=this.createScene(),this.scene.add(this.camera),this.element=this.getElement(),this.element.addEventListener("playing",this.startVideoLoop),this.element.addEventListener("pause",this.stopVideoLoop),this.element.addEventListener("ended",this.stopVideoLoop),this.texture=this.createTexture(),this.renderer.setTexture(this.texture),this.scene.getObjectByName("photo").children=[this.renderer.mesh],this.target=this.container?this.container:document.querySelector(this.containerId)}return n(i,[{key:"play",value:function(){this.element.play&&this.element.play()}},{key:"pause",value:function(){this.element.pause&&this.element.pause()}},{key:"centralize",value:function(){this.controls.centralize()}},{key:"stopVideoLoop",value:function(){clearTimeout(this.videoLoopId),this.videoLoopId=null,this.needsUpdate=!1}},{key:"destroy",value:function(){this.element.style.display="",clearTimeout(this.videoLoopId),cancelAnimationFrame(this.animationFrameId),this.element.pause&&this.element.pause(),this.target.removeChild(this.renderer.el),this.controls.destroy(),this.renderer.destroy()}},{key:"setSize",value:function(t){var i=t.height,n=t.width;this.camera.aspect=n/i,this.camera.updateProjectionMatrix(),this.renderer.setSize({height:i,width:n})}},{key:"getElement",value:function(){if(this.source&&this.source.tagName)return this.source;var t=document.createElement("video");return t.loop=this.loop||!1,t.muted=this.muted||!1,t.setAttribute("crossorigin","anonymous"),t.setAttribute("webkit-playsinline","true"),t.setAttribute("playsinline","true"),t.setAttribute("src",this.source),t.autoplay=void 0===this.autoplay||this.autoplay,t.addEventListener("error",this.onError),t}},{key:"createTexture",value:function(){var t=new Y.Texture(this.element);return t.minFilter=Y.LinearFilter,t.magFilter=Y.LinearFilter,t.format=Y.RGBFormat,t.generateMipmaps=!1,t.needsUpdate=!0,t}},{key:"createScene",value:function(){var t=new Y.Scene,i=new Y.Object3D;return i.name="photo",t.add(i),t}},{key:"onError",value:function(){}},{key:"startVideoLoop",value:function(){var t=this;this.videoLoopId&&(clearTimeout(this.videoLoopId),this.videoLoopId=null),function i(){t.needsUpdate=!0,t.videoLoopId=setTimeout(i,40)}()}},{key:"render",value:function(){var t=this;this.target.appendChild(this.renderer.el),this.element.style.display="none",this.startVideoLoop(),function i(){t.animationFrameId=requestAnimationFrame(i);var n=t.controls.update();t.renderer.render(t.scene,t.camera,t.needsUpdate||n),t.needsUpdate=!1}()}}]),i}(),J=function(){function i(n){return t(this,i),r(this,s(i).call(this,n))}return e(i,q),n(i,[{key:"createTexture",value:function(){var t=new Y.VideoTexture(this.element);return t.minFilter=Y.LinearFilter,t.magFilter=Y.LinearFilter,t.format=Y.RGBFormat,t.generateMipmaps=!1,t.needsUpdate=!0,t}}]),i}(),K=function(){function i(n){return t(this,i),r(this,s(i).call(this,n))}return e(i,q),n(i,[{key:"getElement",value:function(){if(this.source&&this.source.tagName)return this.source;var t=document.createElement("img");return t.setAttribute("crossorigin","anonymous"),t.src=this.source,t}}]),i}(),Q=function(){function i(n){var e;return t(this,i),(e=r(this,s(i).call(this,n))).context=e.element.getContext("2d"),e}return e(i,q),n(i,[{key:"play",value:function(){this.video.play&&this.video.play()}},{key:"pause",value:function(){this.video.pause&&this.video.pause()}},{key:"destroy",value:function(){this.video.style.display="",h(s(i.prototype),"destroy",this).call(this)}},{key:"getElement",value:function(){this.video=h(s(i.prototype),"getElement",this).call(this),this.video.addEventListener("playing",this.startVideoLoop),this.video.addEventListener("pause",this.stopVideoLoop),this.video.addEventListener("ended",this.stopVideoLoop);var t=document.createElement("canvas");return t.height=this.video.videoHeight,t.width=this.video.videoWidth,t}},{key:"render",value:function(){var t=this;this.target.appendChild(this.renderer.el),this.video.style.display="none",this.startVideoLoop(),function i(){t.animationFrameId=requestAnimationFrame(i);var n=t.video.videoHeight,e=t.video.videoWidth;t.element.height!=n&&(t.element.height=n),t.element.width!=e&&(t.element.width=e),t.context.clearRect(0,0,e,n),t.context.drawImage(t.video,0,0,e,n);var s=t.controls.update();t.renderer.render(t.scene,t.camera,t.needsUpdate||s),t.renderer.mesh.material.map.needsUpdate=!0,t.needsUpdate=!1}()}}]),i}(),$=function(){function i(n){var e;return t(this,i),(e=r(this,s(i).call(this,n))).driver.addEventListener("playing",e.startVideoLoop),e.driver.addEventListener("pause",e.stopVideoLoop),e.driver.addEventListener("ended",e.stopVideoLoop),e.driver.addEventListener("stalled",e.stopVideoLoop),e.driverInitialized=!1,e}return e(i,q),n(i,[{key:"play",value:function(){this.driver.play()}},{key:"pause",value:function(){this.driver.pause()}},{key:"getElement",value:function(){this.source&&this.source.tagName?this.driver=this.source:(this.driver=document.createElement("audio"),this.driver.src=this.source,this.driver.loop=this.loop||!1,this.driver.muted=this.muted||!1,this.driver.setAttribute("crossorigin","anonymous"),this.driver.autoplay=this.autoplay||!0),this.source=this.driver.src,this.driver.src="",this.driver.load();var t=document.createElement("video");return t.setAttribute("crossorigin","anonymous"),t.src=this.source,t.load(),t.addEventListener("error",this.onError),t}},{key:"createTexture",value:function(){var t=new Y.VideoTexture(this.element);return t.minFilter=Y.LinearFilter,t.magFilter=Y.LinearFilter,t.format=Y.RGBFormat,t.generateMipmaps=!1,t.needsUpdate=!0,t}},{key:"startVideoLoop",value:function(){var t=this;this.videoLoopId&&(clearTimeout(this.videoLoopId),this.videoLoopId=null),function i(){t.element.currentTime=t.driver.currentTime,t.needsUpdate=!0,t.videoLoopId=setTimeout(i,40)}()}},{key:"destroy",value:function(){this.driver.style.display="",h(s(i.prototype),"destroy",this).call(this)}},{key:"render",value:function(){var t=this;this.target.appendChild(this.renderer.el),this.element.style.display="none",this.driver.style.display="none",function i(){var n=t.controls.update();t.renderer.render(t.scene,t.camera,t.needsUpdate||n),t.needsUpdate=!1,t.animationFrameId=requestAnimationFrame(i),t.element.readyState>=t.element.HAVE_FUTURE_DATA&&!t.driverInitialized&&(t.driver.src=t.source,t.driver.load(),t.onDriverReady&&t.onDriverReady(),t.driverInitialized=!0)}()}}]),i}(),tt=function(t){return i=/iphone.*(7|8|9)_[0-9]/i.test(navigator.userAgent),n=/(iPhone|iPod).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent),i||n?new $(t):/trident|edge/i.test(navigator.userAgent)?new Q(t):new J(t);var i,n};export{K as I,tt as v};